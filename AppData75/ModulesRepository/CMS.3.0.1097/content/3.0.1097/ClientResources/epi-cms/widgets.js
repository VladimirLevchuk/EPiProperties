//>>built
require({cache:{"epi-cms/layers/cms-widgets":function(){define(["dijit/form/ValidationTextBox","epi-cms/_ContentContextMixin","epi-cms/ApplicationSettings","epi-cms/CMSModule","epi-cms/component/ContextHistory","epi-cms/component/GlobalToolbar","epi-cms/component/MainNavigationComponent","epi-cms/component/Media","epi-cms/component/PageNavigationTree","epi-cms/component/RecentlyChanged","epi-cms/component/SharedBlocks","epi-cms/component/SiteTree","epi-cms/component/Tasks","epi-cms/component/Trash","epi-cms/component/Versions","epi-cms/contentediting/_Renderer","epi-cms/contentediting/ContentDetails","epi-cms/contentediting/CreateContent","epi-cms/contentediting/CreateLanguageBranch","epi-cms/contentediting/DateTimeNowEditor","epi-cms/contentediting/DialogEditorWrapper","epi-cms/contentediting/EditActionPanel","epi-cms/contentediting/EditingBase","epi-cms/contentediting/editors/CheckBoxListEditor","epi-cms/contentediting/editors/CollectionEditor","epi-cms/contentediting/editors/ContentAreaEditor","epi-cms/contentediting/editors/ItemCollectionEditor","epi-cms/contentediting/editors/PreviewableDateTimeEditor","epi-cms/contentediting/editors/PreviewableTextEditor","epi-cms/contentediting/editors/SelectionEditor","epi-cms/contentediting/editors/ShortcutEditor","epi-cms/contentediting/editors/TinyMCEEditor","epi-cms/contentediting/editors/TinyMCEInlineEditor","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/FloatingEditorWrapper","epi-cms/contentediting/FlyoutEditorWrapper","epi-cms/contentediting/FormEditing","epi-cms/contentediting/InlineEditorWrapper","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/OnPageEditing","epi-cms/contentediting/PageDataController","epi-cms/contentediting/PropertyRenderer","epi-cms/contentediting/PublishMenu","epi-cms/contentediting/SettingsPanel","epi-cms/contentediting/ValidationTextboxWithWarning","epi-cms/contentediting/viewmodel/ContentDetailsViewModel","epi-cms/conversion/PropertyContentAreaConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/layout/CreateContentGroupContainer","epi-cms/layout/EditLayoutContainer","epi-cms/legacy/LegacyDialogPopup","epi-cms/legacy/LegacyFormEditor","epi-cms/widget/_GridWidgetBase","epi-cms/widget/CategorySelector","epi-cms/widget/ContentSelector","epi-cms/widget/HyperLinkSelector","epi-cms/widget/NotificationStatusBar","epi-cms/widget/NotificationStatusZone","epi-cms/widget/overlay/Block","epi-cms/widget/overlay/ContentArea","epi-cms/widget/overlay/ItemCollection","epi-cms/widget/overlay/overlayFactory","epi-cms/widget/ReadOnlyDateTimeEditor","epi-cms/widget/TooltipDialog","epi-cms/widget/UrlContentSelector","epi-cms/widget/UrlSelector","epi-cms/widget/XFormEditor"],1);},"epi-cms/_ContentContextMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/when","dijit/Destroyable","epi/dependency","epi/UriParser","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1([_9,_6],{ignoreVersionWhenComparingLinks:false,contentDataStore:null,_currentContentContext:null,postscript:function(){this.inherited(arguments);this.own(_3.after(this.getContentDataStore(),"onItemChanged",_2.hitch(this,this.itemChanged)));},getContentDataStore:function(){if(!this.contentDataStore){var _b=_7.resolve("epi.storeregistry");this.contentDataStore=_b.get("epi.cms.contentdata");}return this.contentDataStore;},getCurrentContent:function(){var _c=new _4();_5(this.getCurrentContext(),_2.hitch(this,function(_d){if(!this._isContentContext(_d)){_c.reject({message:"Not a content data",context:_d});return;}_5(this.getContentDataStore().get(_d.id),function(_e){_c.resolve(_e);});}));return _c;},contextChanged:function(_f,_10){this.inherited(arguments);if(!this._isContentContext(_f)){this._currentContentContext=null;return;}var _11=(_10&&_10.forceContextChange?_10.forceContextChange:false);if(!_11&&this._isSameAsCurrentContentContext(_f)){return;}this._currentContentContext=_f;this.contentContextChanged(_f,_10);},contextUpdated:function(ctx,_12){if(!this._isContentContext(ctx)){this._currentContentContext=null;return;}this._currentContentContext=ctx;this.contentContextUpdated(ctx,_12);},contentContextChanged:function(ctx,_13){},contentContextUpdated:function(ctx,_14){},itemChanged:function(id,_15){},_isContentContext:function(ctx){return ctx&&ctx.type==="epi.cms.contentdata";},_isSameAsCurrentContentContext:function(ctx){if(this._currentContentContext&&ctx){return this._currentContentContext.id===ctx.id&&(this._currentContentContext.languageContext&&ctx.languageContext&&this._currentContentContext.languageContext.preferredLanguage===ctx.languageContext.preferredLanguage);}else{return false;}},_isSameAsCurrentContext:function(uri){if(this._currentContext){return this._compareUris(uri,this._currentContext.uri);}else{return false;}},_compareUris:function(_16,_17){var _18=new _8(_16),_19=new _8(_17);if(this.ignoreVersionWhenComparingLinks&&_18.getType()==="epi.cms.contentdata"&&_19.getType()==="epi.cms.contentdata"&&_a.compareIgnoreVersion(_18.getId(),_19.getId())){return true;}else{if(_16===_17){return true;}}return false;}});});},"epi-cms/core/ContentReference":function(){define(["dojo/_base/declare","epi/epi"],function(_1a,epi){var _1b=_1a(null,{id:0,workId:0,providerName:null,isSelfReference:false,constructor:function(_1c){if(_1c){this._parse(_1c);}},_parse:function(_1d){if(typeof _1d==="object"){this.id=parseInt(_1d.ID||_1d.id||_1d.iD||_1d.Id,10);this.workId=parseInt(_1d.WorkID||_1d.workId||0,10);this.providerName=_1d.ProviderName||_1d.providerName||null;}else{if(typeof _1d==="string"){if(_1d==="-"){this.isSelfReference=true;this.id=0;this.workId=-1;}else{this.isSelfReference=false;var v=String();v.split("_");var _1e=_1d.split("_");this.id=parseInt(_1e[0],10);this.workId=parseInt(_1e[1],10)||0;this.providerName=_1e[2]||"";}}}if(typeof _1d==="number"){this.id=_1d;this.workId=0;this.providerName="";}if(typeof this.id!=="number"){throw new Error("The id parameter of a content reference must be an integer");}if(typeof this.workId!=="number"&&!this.isSelfReference){throw new Error("The workId of a content reference must be an integer");}},toString:function(){if(this.isSelfReference){return "-";}var _1f=String(this.id);if(this.workId!==0){_1f+="_"+this.workId;}if(this.providerName){_1f+=(this.workId===0?"__":"_")+this.providerName;}return _1f;},createVersionUnspecificReference:function(){return new _1b({id:this.id,providerName:this.providerName});}});_1b.toContentReference=function(obj){if(obj instanceof _1b){return obj;}else{if(typeof obj==="string"||typeof obj==="number"){return new _1b(obj);}}return _1b.emptyContentReference;};_1b.compareIgnoreVersion=function(_20,_21){var c1=_1b.toContentReference(_20);var c2=_1b.toContentReference(_21);var _22=c1.createVersionUnspecificReference();var _23=c2.createVersionUnspecificReference();return epi.areEqual(_22,_23);};_1b.emptyContentReference=new _1b({id:-1,workId:-1});return _1b;});},"epi-cms/ApplicationSettings":function(){define("epi-cms/ApplicationSettings",[],function(){return {};});},"epi-cms/CMSModule":function(){define("epi-cms/CMSModule",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi","epi/_Module","epi/dependency","epi/routes","epi/shell/conversion/ObjectConverterRegistry","epi/shell/store/JsonRest","epi/shell/store/Throttle","epi/shell/TypeDescriptorManager","epi/shell/ViewSettings","epi-cms/ApplicationSettings","epi-cms/BackContextHistory","epi-cms/ContextSynchronizer","epi-cms/conversion/ContentLightUriConverter","epi-cms/conversion/ContentReferenceConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/store/CustomQueryEngine","epi-cms/store/PageVersionQueryEngine","epi-cms/component/command/GlobalToolbarCommandProvider","epi-cms/contentediting/EditorFactory","epi-cms/contentediting/InUseNotificationManager","epi-cms/contentediting/ViewSettingsManager","epi-cms/contentediting/command/Editing","epi-cms/contentediting/commandproviders/ContentDetails","epi-cms/contentediting/commandproviders/PublishMenu","epi-cms/contentediting/commandproviders/PublishMenuGlobal","epi-cms/contentediting/viewsettings/ChannelViewSetting","epi-cms/contentediting/viewsettings/ResolutionViewSetting","epi-cms/contentediting/viewsettings/ViewLanguageViewSetting","epi-cms/contentediting/viewsettings/VisitorGroupViewSetting","epi-cms/Profile"],function(_24,_25,_26,_27,epi,_28,_29,_2a,_2b,_2c,_2d,_2e,_2f,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_3a,_3b,_3c,_3d,_3e,_3f,_40,_41,_42,_43,_44,_45){return _25([_28],{_settings:null,_hashWrapper:null,_firstTimeHashUpdated:false,constructor:function(_46){this._settings=_46;},initialize:function(){this.inherited(arguments);_25.safeMixin(_30,this._settings);this.registerDependency("epi.cms.BackContextHistory",new _31());this.registerDependency("epi.cms.ContextSynchronizer",new _32(),undefined,function(_47){_47.destroy();});this.registerDependency("epi.cms.contentEditing.command.Editing",_3d);this._hashWrapper=_29.resolve("epi.shell.HashWrapper");var _48=_29.resolve("epi.globalcommandregistry");var _49=new _40();_48.registerProvider("epi.cms.publishmenu",_49);var _4a=this.resolveDependency("epi.shell.ContextService");this.registerDependency("epi.cms.contentRepositoryDescriptors",this._settings.contentRepositoryDescriptors);_4a.registerRoute("epi.cms.contentdata",_26.hitch(this,this._redirectContentDataContext));this._initializeEditorFactory();this._initializeStores();this._setupConverters(_29);this._setupViewSettings(_4a);_48.registerProvider("epi.cms.globalToolbar",new _39());this._setupInUseNotificationManager(_48);var _4b=_29.resolve("epi.shell.Profile");var def=_4b.getContentLanguage();_27(def,function(_4c){_30.currentContentLanguage=_4b.contentLanguage=_4c;});return def;},_redirectContentDataContext:function(_4d,_4e,uri){if(_2f.viewName=="/episerver/dashboard"){var _4f=_2a.getActionPath({moduleArea:"CMS",controller:"Home",action:""});_4f=_4f.substring(0,_4f.length-1);var _50=_4f+"#"+this._hashWrapper.extractHash(_4d,_4e);this._redirect(_50);}else{if(_4d.hasSiteChanged){var _51=_4d.fullHomeUrl+"#"+this._hashWrapper.extractHash(_4d,_4e);this._redirect(_51);}else{if(_4e&&_4e.trigger=="internal"&&this._firstTimeHashUpdated){return;}this._firstTimeHashUpdated=true;this._hashWrapper.onContextChange(_4d,_4e);}}},_redirect:function(url){window.location=url;},_setupConverters:function(_52){var _53=new _33(),_54=new _34(),_55=new _35(),_56=this.resolveDependency("epi.cms.contentRepositoryDescriptors"),key;for(key in _56){var _57=_56[key];if(_57.linkableTypes){_57.linkableTypes.forEach(function(_58){_2b.registerConverter(_58,_58+".link",_53);_2b.registerConverter(_58,"link",_53);});}}for(key in _2e._uiDescriptors){var _59=_2e._uiDescriptors[key];_2b.registerConverter(_59.typeIdentifier,_59.typeIdentifier+".reference",_54);_2b.registerConverter(_59.typeIdentifier,_59.typeIdentifier+".light",_53);}_53.registerDefaultConverters(_2b);_55.registerDefaultConverters(_2b);},_setupViewSettings:function(_5a){var _5b=new _43();_5b.initialize(_5a);var _5c=new _3c({viewSettings:[new _42(),new _44(),new _41(),_5b]});this.registerDependency("epi.viewsettingsmanager",_5c);},_initializeStores:function(){var _5d=this.resolveDependency("epi.storeregistry"),_5e,_5f,_60;_5e=_5d.create("epi.cms.contentdata",this._getRestPath("contentdata"),{idProperty:"contentLink"});_5f=_5d.create("epi.cms.content.light",this._getRestPath("contentstructure"),{idProperty:"contentLink",queryEngine:_37});_60=_5d.create("epi.cms.contentversion",this._getRestPath("contentversion"),{idProperty:"contentLink",queryEngine:_38});_5d.create("epi.cms.displayoptions",this._getRestPath("displayoptions"));_5d.create("epi.cms.category",this._getRestPath("categories"));_5d.create("epi.cms.inusenotification",this._getRestPath("inusenotification")).addDependentStore(_5e);_5d.create("epi.cms.visitorgroup",this._getRestPath("visitorgroup"));_5d.create("epi.cms.language",this._getRestPath("language"),{idProperty:"languageId"});_5d.create("epi.cms.sitestructure",this._getRestPath("sitestructure"),{idProperty:"url"});_5d.create("epi.cms.displaychannels",this._getRestPath("channel"));_5d.create("epi.cms.wastebasket",this._getRestPath("wastebasket"));_5d.create("epi.cms.xform",this._getRestPath("xform"));_5d.create("epi.cms.workflowtask",this._getRestPath("workflowtask"),{idProperty:"taskId"});_5d.create("epi.cms.contenttype",this._getRestPath("contenttype"),{preventCache:false}).query();_5d.add("epi.cms.contentreferences",new _2d(new _2c({target:this._getRestPath("contentreferences"),idProperty:"contentLink"})));_5d.add("epi.cms.content.search",new _2d(new _2c({target:this._getRestPath("contentstructure"),idProperty:"contentLink"})));_5e.addDependentStore(_5f,{refreshOnPatch:true,refresh:function(_61){var id=_5e.getIdentity(_61);var _62=new _36(id).createVersionUnspecificReference().toString();_5f.refresh(_62);}});_5e.addDependentStore(_60,{transformDelegate:function(_63){if(_63.capabilities&&!_63.capabilities.versionable){return null;}if(!_63.properties){return null;}var _64={"pageChangedBy":"savedBy","pageSaved":"savedDate","pageLanguageBranch":"language","pageName":"name","name":"name","icontent_name":"name"};var _65=_26.mixin({},_63);for(var p in _64){if(p in _65.properties){_65[_64[p]]=_65.properties[p];}}return _65;}});},_getRestPath:function(_66){return _2a.getRestPath({moduleArea:"cms",storeName:_66});},_initializeEditorFactory:function(){this.registerDependency("epi.cms.contentediting.EditorFactory",function(){var _67=new _3a();_67.registerEditorWrapper("inline","epi-cms.contentediting.InlineEditorWrapper",function(_68,_69){});_67.registerEditorWrapper("richtextinline","epi-cms.contentediting.RichTextInlineEditorWrapper",function(_6a,_6b){});_67.registerEditorWrapper("flyout","epi-cms.contentediting.FlyoutEditorWrapper",function(_6c,_6d){});_67.registerEditorWrapper("floating","epi-cms.contentediting.FloatingEditorWrapper",function(_6e,_6f){});_67.registerEditorWrapper("contenteditable","epi-cms.contentediting.ContentEditableWrapper",function(_70,_71){});_67.registerEditorWrapper("legacyProperty","epi-cms.contentediting.DialogEditorWrapper",function(_72,_73){_72.closeOnChange=true;_72.showButtons=false;});return _67;});},_setupInUseNotificationManager:function(_74){var _75=new _3b();this.registerDependency("epi.cms.contentediting.inUseNotificationManager",_75);_74.registerProvider("epi.cms.publishmenu",new _3f());_74.registerProvider("epi.cms.contentdetailsmenu",new _3e());}});});},"epi-cms/BackContextHistory":function(){define("epi-cms/BackContextHistory",["dojo/_base/declare","dojo/_base/lang","dojo/store/Memory","epi/shell/ContextHistory"],function(_76,_77,_78,_79){return _76([_79],{createStore:function(){return new _78({data:[],idProperty:"index"});},onContextChanged:function(_7a,_7b,_7c){if(_7b&&_7b.trigger==="back"){this._removeLastItem();return;}this.inherited(arguments);},getPrevious:function(){var _7d=this.store.query({},{count:2,sort:[{attribute:"dateAdded",descending:true}]});return (_7d&&_7d.length>1)?_7d[1]:null;},_updateStore:function(_7e){var _7f=this._getLastItem();if(_7f&&_7f.uri===_7e.versionAgnosticUri){return;}this.inherited(arguments);},_getLastItem:function(){if(this.store&&this.store.data&&this.store.data.length>0){return this.store.data[this.store.data.length-1];}return null;},_removeLastItem:function(){var _80=this._getLastItem();if(_80){this.store.remove(this.store.getIdentity(_80));}}});});},"epi-cms/ContextSynchronizer":function(){define("epi-cms/ContextSynchronizer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/when","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_81,_82,_83,_84,_85,_86){return _81([_85],{_subscribeHandle:null,constructor:function(){this._subscribeHandle=_83.subscribe("/epi/cms/contentdata/updated",this,this._updateCurrentContext);},_updateCurrentContext:function(_87){var _88=_87.contentLink;_84(this.getCurrentContext(),function(_89){if(_89&&_86.compareIgnoreVersion(_89.id,_88)){var _8a={uri:"epi.cms.contentdata:///"+_88};if(_89.languageContext){_8a.epslanguage=_89.languageContext.preferredLanguage;}_83.publish("/epi/shell/context/updateRequest",_8a);}});},destroy:function(){_83.unsubscribe(this._subscribeHandle);}});});},"epi-cms/conversion/ContentLightUriConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper"],function(_8b,_8c,_8d,_8e,_8f,_90,_91){return _8b(null,{_contentStore:null,constructor:function(_92){_8c.mixin(this,_92);this._contentStore=this._contentStore||_8e.resolve("epi.storeregistry").get("epi.cms.content.light");},registerDefaultConverters:function(_93){},convert:function(_94,_95,_96){if(!_96||(!_96.contentLink&&!_96.uri)){return null;}var _97=_96.contentLink||new _8f(_96.uri).getId();if(!_97){return null;}_97=new _90(_97).createVersionUnspecificReference().toString();return _8d(this._contentStore.get(_97),function(_98){return {url:_98.publicUrl,previewUrl:_98.previewUrl,permanentUrl:_91.toPermanentLink(_98),text:_98.name,typeIdentifier:_98.typeIdentifier};});}});});},"epi-cms/core/PermanentLinkHelper":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/store/Memory","dojo/when","epi/dependency","epi/Url","epi-cms/ApplicationSettings","epi-cms/core/ContentReference"],function(_99,_9a,_9b,_9c,_9d,_9e,Url,_9f,_a0){var _a1={_cacheStore:new _9c({idAttribute:"id",data:[]}),_storeCache:function(_a2){if(!_a2){return;}var _a3=this._cacheStore.get(_a2.contentLink);if(_a3){return;}this._cacheStore.put({id:_a2.contentLink,internalLink:this._toInternal(_a2)});},_tryGetContentLink:function(_a4){if(!_a4){return null;}var url=new Url(_a4),_a5=url.query["id"];if(!_a5){try{_a5=_a0.toContentReference(_a4);if(isNaN(_a5.id)){return null;}return _a5.toString();}catch(e){return null;}}return _a5;},_toInternal:function(_a6){var _a7,_a8=_9f.applicationVirtualPath||"";if(_a6){_a7=_a8+"/link/"+_a6.contentGuid.replace(/-/g,"")+".aspx";_a7=_a7.replace(/\/\//g,"/");}return _a7;},toPermanentLink:function(_a9,_aa){this._storeCache(_a9);return this._toInternal(_a9);},isPermanentLink:function(_ab){return (/(\/link\/)(?=([0-9a-z]{32})(\.aspx))/i).test(_ab);},getContent:function(_ac,_ad){if(!_ac){return null;}var dfd=new _9a(),_ae=_9e.resolve("epi.storeregistry"),_af=_ae.get("epi.cms.content.light"),_b0=_9b.mixin({"query":"getcontentbypermanentlink","permanentLink":_ac},_ad||{}),_b1;var _b2=this._cacheStore.query({internalLink:_ac}),_b3=_b2&&_b2.length>0,_b4=this.isPermanentLink(_ac),_b5=_b4?null:this._tryGetContentLink(_ac);_b1=_b3||_b5?_af.get(_b5||_b2[0].id):_af.query(_b0);_9d(_b1,_9b.hitch(this,function(_b6){var _b7=_b6&&_b6 instanceof Array?_b6[0]:_b6;if(!_b3){this._storeCache(_b7);}dfd.resolve(_b7);}));return dfd;}};return _a1;});},"epi-cms/conversion/ContentReferenceConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference"],function(_b8,_b9,_ba,_bb,_bc,_bd){return _b8(null,{convert:function(_be,_bf,_c0){if(!_c0){return null;}var uri=new _bc(_c0.uri);var _c1=uri.getId();var _c2=new _bd(_c1).createVersionUnspecificReference().toString();return _c2;}});});},"epi-cms/conversion/PropertyDateConverter":function(){define(["dojo/_base/declare","dojo/date/locale","epi/datetime"],function(_c3,_c4,_c5){return _c3(null,{sourceDataType:"epi.cms.propertydate",targetDataType:"runtimeType",registerDefaultConverters:function(_c6){_c6.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_c7,_c8,_c9){if(_c9&&_c7===this.sourceDataType&&_c8===this.targetDataType){var _ca=_c5.deserialize(_c9);var _cb=_c4.format(_ca,{});return _c4.parse(_cb,{});}return null;}});});},"epi-cms/store/CustomQueryEngine":function(){define(["dojo/_base/array"],function(_cc){return function(_cd,_ce){switch(typeof _cd){case "object":case "undefined":var _cf=_cd;_cd=function(_d0){for(var key in _cf){if(_ce&&_ce.ignore){var _d1;for(var _d2 in _ce.ignore){if(key==_ce.ignore[_d2]){_d1=true;break;}}if(_d1){_d1=false;continue;}}var _d3=_cf[key];if(_ce&&_ce.comparers&&_ce.comparers[key]){if(!_ce.comparers[key](_d3,_d0)){return false;}}else{if(_d3&&_d3.test){if(!_d3.test(_d0[key])){return false;}}else{if(_d3&&_d3!=_d0[key]){return false;}}}}return true;};break;case "string":if(!this[_cd]){throw new Error("No filter function "+_cd+" was found in store");}_cd=this[_cd];break;case "function":break;default:throw new Error("Can not query with a "+typeof _cd);}function _d4(_d5){var _d6=_cc.filter(_d5,_cd);if(_ce&&_ce.sort){_d6.sort(function(a,b){for(var _d7,i=0;_d7=_ce.sort[i];i++){var _d8=a[_d7.attribute];var _d9=b[_d7.attribute];if(typeof _d8==="string"&&typeof _d9==="string"){_d8=_d8.toLowerCase();_d9=_d9.toLowerCase();}if(_d8!=_d9){return _d7.descending==(_d8>_d9)?-1:1;}}return 0;});}if(_ce&&(_ce.start||_ce.count)){var _da=_d6.length;_d6=_d6.slice(_ce.start||0,(_ce.start||0)+(_ce.count||Infinity));_d6.total=_da;}return _d6;};_d4.matches=_cd;return _d4;};});},"epi-cms/store/PageVersionQueryEngine":function(){define(["dojo/_base/array","epi-cms/core/ContentReference"],function(_db,_dc){return function(_dd,_de){switch(typeof _dd){case "object":case "undefined":var _df=_dd;_dd=function(_e0){for(var key in _df){var _e1,_e2=_df[key],_e3=_e2.toString();if(_e3.indexOf("_")>=0){_e1=new _dc(_e3);_e2=RegExp("^"+_e1.id+"_.*$");}if(_e2&&_e2.test){if(!_e2.test(_e0[key])){return false;}}else{if(_e2!=_e0[key]){return false;}}}return true;};break;case "string":if(!this[_dd]){throw new Error("No filter function "+_dd+" was found in store");}_dd=this[_dd];break;case "function":break;default:throw new Error("Can not query with a "+typeof _dd);}function _e4(_e5){var _e6=_db.filter(_e5,_dd);if(_de&&_de.sort){_e6.sort(function(a,b){for(var _e7,i=0;_e7=_de.sort[i];i++){var _e8=a[_e7.attribute];var _e9=b[_e7.attribute];if(_e8!=_e9){return _e7.descending==(_e8>_e9)?-1:1;}}return 0;});}if(_de&&(_de.start||_de.count)){var _ea=_e6.length;_e6=_e6.slice(_de.start||0,(_de.start||0)+(_de.count||Infinity));_e6.total=_ea;}return _e6;};_e4.matches=_dd;return _e4;};});},"epi-cms/component/command/GlobalToolbarCommandProvider":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/topic","dojo/when","dijit/form/ToggleButton","dijit/layout/ContentPane","epi/dependency","epi/shell/ViewSettings","epi/shell/command/_Command","epi/shell/command/ToggleCommand","epi/shell/ViewSettings","epi/shell/widget/ExpandoButton","epi-cms/widget/ViewSettingsExpandoButton","epi-cms/widget/VisitorGroupButton","epi-cms/widget/ChannelsButton","epi-cms/widget/ViewLanguageButton","epi-cms/widget/command/CreateContentFromSelector","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_eb,_ec,_ed,_ee,_ef,_f0,_f1,_f2,_f3,_f4,_f5,_f6,_f7,_f8,_f9,_fa,_fb,_fc,_fd,_fe,_ff){var _100=_ec([_f6],{iconClass:"epi-iconTree",tooltip:_ff.toolbar.buttons.togglenavigationpane,label:_ff.toolbar.buttons.togglenavigationpane,canExecute:true,constructor:function(){_ef.subscribe("/epi/layout/pinnable/navigation/visibilitychanged",_ee.hitch(this,function(_101){this.set("active",_101);}));},_execute:function(){_ef.publish("/epi/layout/pinnable/navigation/toggle");}});var _102=_ec([_f6],{iconClass:"epi-iconFolder",tooltip:_ff.toolbar.buttons.toggleassetspane,label:_ff.toolbar.buttons.toggleassetspane,canExecute:true,constructor:function(){_ef.subscribe("/epi/layout/pinnable/tools/visibilitychanged",_ee.hitch(this,function(_103){this.set("active",_103);}));},_execute:function(){_ef.publish("/epi/layout/pinnable/tools/toggle");}});var _104=_ec([_f5],{iconClass:"epi-iconEye",canExecute:true,label:_ff.toolbar.buttons.viewsetting.viewsettingbutton,constructor:function(){_ef.subscribe("/epi/shell/action/viewchanged",_ee.hitch(this,function(view){this.set("isAvailable",typeof view!="string"||view=="epi-cms/contentediting/PageDataController");}));}});var _105=_ec([_f6],{iconClass:"epi-iconPreview",tooltip:_ff.toolbar.buttons.togglepreviewmode.label,label:_ff.toolbar.buttons.togglepreviewmode.label,canExecute:true,constructor:function(){this._profile=_f3.resolve("epi.shell.Profile");this._setPanelSettings();_ef.subscribe("/epi/cms/action/disablepreview",_ee.hitch(this,function(){this.set("active",false);this._restoreSidePanels();}));_ef.subscribe("/epi/shell/action/viewchanged",_ee.hitch(this,function(view){var _106=typeof view!="string"||view=="epi-cms/contentediting/PageDataController";if(!_106&&this.active){this.execute();}this.set("isAvailable",_106);}));},_restoreSidePanels:function(){_ef.publish("/epi/layout/pinnable/navigation/toggle",this.get("isNavigationVisible"));_ef.publish("/epi/layout/pinnable/tools/toggle",this.get("isToolsVisible"));},_hideSidePanels:function(){this._setPanelSettings();_ef.publish("/epi/layout/pinnable/navigation/toggle",false);_ef.publish("/epi/layout/pinnable/tools/toggle",false);},_setPanelSettings:function(){_f0(this._profile.get("navigation"),_ee.hitch(this,function(_107){this.set("isNavigationVisible",_107.visible);}));_f0(this._profile.get("tools"),_ee.hitch(this,function(_108){this.set("isToolsVisible",_108.visible);}));},_execute:function(){this.set("active",!this.active);if(this.active){this._hideSidePanels();_ef.publish("/epi/shell/action/changeview","view");}else{this._restoreSidePanels();_ef.publish("/epi/shell/action/changeview/back",true);}}});return _ec([_fe],{contentRepositoryDescriptors:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_f3.resolve("epi.cms.contentRepositoryDescriptors");this.viewName=this.viewName||_f4.viewName;this._addLeadingCommands();this._addCreateCommands();this._addViewCommands();this._addTrailingCommands();},_addLeadingCommands:function(){this.addToLeading(new _100(),{widget:_f1,"class":"epi-leadingToggleButton epi-mediumButton"});},_addCreateCommands:function(){var _109=this.viewName;var _10a=[];var _10b=function(view){return view==_109;};for(var _10c in this.contentRepositoryDescriptors){var _10d=this.contentRepositoryDescriptors[_10c];if(_eb.some(_10d.mainViews,_10b)){_10a.push(_10d);}}_eb.forEach(_10a,function(_10e){_eb.forEach(_10e.creatableTypes,function(type){this.addCommand(this._createCommand(type),{category:"create"});},this);},this);},_createCommand:function(type){return new _fd({creatingTypeIdentifier:type});},_addViewCommands:function(){this.addCommand(new _104(),{widget:_f9,showInGroup:true,buttons:[new _fc(),new _fa(),new _fb()],category:"view"});this.addCommand(new _105(),{widget:_f8,showInGroup:true,hasToggleableChildren:false,buttons:[new _f2({iconClass:"","class":"epi-expandoButtonActiveNode",content:"<span>"+_ff.toolbar.buttons.togglepreviewmode.message+"</span>"})],category:"view"});},_addTrailingCommands:function(){this.addToTrailing(new _102(),{widget:_f1,"class":"epi-trailingToggleButton epi-mediumButton"});}});});},"epi/shell/command/ToggleCommand":function(){define("epi/shell/command/ToggleCommand",["dojo/_base/declare","epi/shell/command/_Command"],function(_10f,_110){return _10f([_110],{property:null,active:false,_execute:function(){var name=this.property,_111=!this.active;this.model.set(name,_111);this.set("active",_111);},_onModelChange:function(){var _112=this.model,_113=_112&&_112[this.property],_114=typeof _113=="boolean";this.set("canExecute",_114);this.set("active",_114&&_113);}});});},"epi-cms/widget/ViewSettingsExpandoButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-style","dojo/topic","epi/dependency","epi/shell/widget/ExpandoButton"],function(_115,lang,_116,_117,_118,_119,_11a){return _115([_11a],{_toggleStateInitialized:null,postCreate:function(){this.inherited(arguments);var _11b=_119.resolve("epi.viewsettingsmanager");var _11c=_116.filter(_11b.viewSettingsHashValue,function(item){return item.type=="active";})[0];this.isExpand=_11c?_11c.id==="true":false;_116.forEach(this.containerNode.getChildren(),lang.hitch(this,function(_11d){this.connect(_11d.childWidget,"onResize","_onChildResize");}));},onChange:function(_11e){if(this._toggleStateInitialized){_118.publish("/epi/cms/action/eyetoggle",_11e);return;}this._toggleStateInitialized=true;},_onChildResize:function(){if(this.isExpanded()){this._expand();}}});});},"epi-cms/widget/VisitorGroupButton":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/Deferred","dojo/dom-class","dijit/DropDownMenu","dijit/form/DropDownButton","dijit/focus","epi","epi/dependency","epi-cms/widget/VisitorGroupsSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupsbutton"],function(dojo,_11f,lang,_120,_121,_122,_123,_124,_125,epi,_126,_127,_128){return _11f([_124],{_contextMenu:null,baseClass:"epi-mediumButton epi-chromelessButton",iconClass:"epi-iconUsers",contextMenuProperties:{},_visitorGroupsSelector:null,_viewSettingsManager:null,postMixInProperties:function(){this.inherited(arguments);lang.mixin(this.contextMenuProperties,{"class":"epi-DropDownMenu"});},postCreate:function(){this.inherited(arguments);this._viewSettingsManager=_126.resolve("epi.viewsettingsmanager");var _129=this._viewSettingsManager.getSettingProperty("visitorgroup");if(!this.dropDown){this.dropDown=dijit.DropDownMenu(this.contextMenuProperties);this._visitorGroupsSelector=new _127({checkedItem:_129});_120.connect(this._visitorGroupsSelector,"onItemSelected",this,this._onVisitorGroupSelected);this._addChildren(this._visitorGroupsSelector);_121.when(this._visitorGroupsSelector.isSetupFinished(),lang.hitch(this,function(_12a){this._activeButton(!this._isDefaultSelection());this._updateTooltip();}));}_120.connect(this.dropDown,"onOpen",this,function(e){_125.focus(this._visitorGroupsSelector.menuNode.domNode);});},_updateTooltip:function(){var _12b=null;if(this._isDefaultSelection()){_12b=_128.defaulttooltip;}else{var _12c=this._visitorGroupsSelector.currentSelectedItem;_12b=lang.replace(_128.tooltip,{visitorgroup:_12c.name});}this.set("title",_12b);},_isDefaultSelection:function(){return this._visitorGroupsSelector.isDefaultItemSelected();},_onVisitorGroupSelected:function(_12d){this._changeView(_12d);},_changeView:function(_12e){if(_12e){if(_12e.name==this._visitorGroupsSelector.defaultItem.name){_120.publish("/epi/cms/action/viewsettingvaluechanged",["visitorgroup",null]);}else{_120.publish("/epi/cms/action/viewsettingvaluechanged",["visitorgroup",_12e.id]);}}this._activeButton(!this._isDefaultSelection());this._updateTooltip();},_addChildren:function(item){this.dropDown.addChild(item);},_activeButton:function(_12f){if(!this.dropDown){return;}if(_12f){_122.add(this.domNode,"dijitChecked");}else{_122.remove(this.domNode,"dijitChecked");}}});});},"epi-cms/widget/VisitorGroupsSelector":function(){define(["dojo","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","epi","epi/dependency","epi-cms/widget/_ItemSelectorBase","epi-cms/widget/_DropDownWidgetItemMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(dojo,lang,_130,_131,epi,_132,_133,_134,res){return dojo.declare([_133,_134],{defaultItem:{id:-1,name:res.defaultitem},_visitorGroupsHash:{},_isFinished:null,postMixInProperties:function(){this.inherited(arguments);var _135=_132.resolve("epi.storeregistry");this._store=_135.get("epi.cms.visitorgroup");},postCreate:function(){this._isFinished=new _131();this.inherited(arguments);this.set("header",res.header);dojo.when(this._store.query(),lang.hitch(this,function(_136){this._createHashMap(_136);this.checkedItem=(this.checkedItem?this._visitorGroupsHash[this.checkedItem]:this.defaultItem.name);_136.unshift(this.defaultItem);this.set("items",_136);this._isFinished.resolve({status:true});}));},isSetupFinished:function(){return this._isFinished;},_createHashMap:function(_137){_130.forEach(_137,lang.hitch(this,function(item){this._visitorGroupsHash[item.id]=item.name;}));}});});},"epi-cms/widget/_ItemSelectorBase":function(){define(["dojo","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojox/html/entities","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Menu","epi","epi/dependency","epi/shell/widget/RadioMenuItem","dojo/text!./templates/_ItemSelector.html"],function(dojo,lang,_138,_139,_13a,_13b,_13c,_13d,Menu,epi,_13e,_13f,_140){return dojo.declare([_13b,_13c,_13d],{templateString:_140,baseClass:"epi-invertedTooltip",_store:null,currentSelectedItem:null,checkedItem:null,defaultItem:null,_items:[],isDefaultItemSelected:function(){return (this.currentSelectedItem&&this.defaultItem&&this.currentSelectedItem.name==this.defaultItem.name);},postCreate:function(){this.inherited(arguments);dojo.connect(this.menuNode,"onItemHover",this,function(item){this.menuNode.focusChild(item);});},checkItem:function(item){_138.forEach(this.menuNode.getChildren(),lang.hitch(this,function(_141){_141.set("checked",false);var _142=_141.value;if(item!=null&&_142.name==item.name){_141.set("checked",true);this.currentSelectedItem=_141.value;}}));},_setupUI:function(){_138.forEach(this.menuNode.getChildren(),lang.hitch(this,function(_143){this.menuNode.removeChild(_143);}));var _144=this.get("items");_138.forEach(_144,lang.hitch(this,function(item){this.menuNode.addChild(this._createMenuItem(item));}));},_onItemSelected:function(item){this.currentSelectedItem=item.value;this.onItemSelected(item.value);},onItemSelected:function(item){},_createMenuItem:function(item){var _145=new _13f({checked:(item.name==this.checkedItem),label:_13a.encode(item.name),value:item,onClick:lang.hitch(this,function(){this._onItemSelected(_145);})});if(_145.checked){this.currentSelectedItem=_145.value;}return _145;},_setItemsAttr:function(_146){this._set("_items",_146);this._setupUI();},_getItemsAttr:function(){return this.get("_items");},_setHeaderAttr:{node:"header",type:"innerHTML"}});});},"epi/shell/widget/RadioMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>"}});define("epi/shell/widget/RadioMenuItem",["dojo/_base/declare","dojo/_base/array","dojo/dom-class","dijit/CheckedMenuItem","dojo/text!./templates/RadioMenuItem.htm"],function(_147,_148,_149,_14a,_14b){return _147([_14a],{baseClass:"dijitMenuItem epi-radioMenuItem",iconClass:null,templateString:_14b,_onClick:function(e){this._resetState();this.inherited(arguments);},_resetState:function(){_148.forEach(this._getChildren(),function(_14c,_14d){_14c.set("checked",false);});},_getChildren:function(){return this.getParent().getChildren();},_setIconClassAttr:function(_14e){this._set("iconClass",_14e);_149.add(this.labelIconNode,_14e);}});});},"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>","url:epi-cms/widget/templates/_ItemSelector.html":"<div>\r\n    <div class=\"epi-tooltipDialogTop\">\r\n        <span data-dojo-attach-point=\"header\"></span>\r\n        <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\r\n    </div>\r\n    <div class=\"epi-dropdownMenuContainer\">\r\n        <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"menuNode\" contextMenuForWindow=\"false\" class=\"epi-DropDownMenu\"></div>\r\n    </div>\r\n</div>","epi-cms/widget/_DropDownWidgetItemMixin":function(){define(["dojo/dom-construct"],function(_14f){return dojo.declare(null,{buildRendering:function(){this.inherited(arguments);this.domNode=this._wrapItem(this);},_wrapItem:function(item){var tr=_14f.create("tr");var td=_14f.create("th",null,tr);item.placeAt(td,"first");return tr;}});});},"epi-cms/widget/ChannelsButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Deferred","dojo/dom-class","dijit/DropDownMenu","dijit/form/DropDownButton","dijit/focus","epi","epi/dependency","epi-cms/widget/ChannelSelector","epi-cms/widget/ResolutionSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.channelbutton"],function(_150,lang,_151,_152,_153,_154,_155,_156,_157,epi,_158,_159,_15a,_15b){return _150([_156],{_contextMenu:null,baseClass:"epi-mediumButton epi-chromelessButton",iconClass:"epi-iconDevice",contextMenuProperties:{},_channelSelector:null,_resolutionSelector:null,_viewSettingsManager:null,postMixInProperties:function(){this.inherited(arguments);lang.mixin(this.contextMenuProperties,{"class":"epi-DropDownMenu"});},postCreate:function(){this.inherited(arguments);this._viewSettingsManager=_158.resolve("epi.viewsettingsmanager");var _15c=this._viewSettingsManager.getSettingProperty("resolution");var _15d=this._viewSettingsManager.getSettingProperty("epichannel");if(!this.dropDown){this.dropDown=dijit.DropDownMenu(this.contextMenuProperties);this._channelSelector=new _159({checkedItem:_15d});_152.connect(this._channelSelector,"onItemSelected",this,this._onChannelSelected);this._resolutionSelector=new _15a({checkedItem:_15c});_152.connect(this._resolutionSelector,"onItemSelected",this,this._onResolutionSelected);this._addChildren(this._channelSelector);this._addChildren(this._resolutionSelector);_153.when(this._channelSelector.isSetupFinished(),lang.hitch(this,function(_15e){this._activeButton(!this._isDefaultSelection());this._updateTooltip();this._setupKeyboardNav();}));}},_setupKeyboardNav:function(){var _15f=[];_151.forEach([this._channelSelector,this._resolutionSelector],function(menu){_15f=_15f.concat(_151.map(menu.menuNode.getChildren(),function(item){return {menuItem:item,menu:menu.menuNode};}));});var _160=0;var _161=lang.hitch(this,function(_162){_160+=_162==="next"?1:-1;_160=_160>=_15f.length?0:_160;_160=_160<0?_15f.length-1:_160;var _163=_15f[_160];_163.menu.focusChild(_163.menuItem);});var _164=function(){_161("next");};var _165=function(){_161("prev");};_152.connect(this.dropDown,"onOpen",this,function(e){_157.focus(this._channelSelector.menuNode.domNode);});this._channelSelector.menuNode.focusNext=this._resolutionSelector.menuNode.focusNext=_164;this._channelSelector.menuNode.focusPrev=this._resolutionSelector.menuNode.focusPrev=_165;},_updateTooltip:function(){var _166=null;if(this._isDefaultSelection()){_166=_15b.defaulttooltip;}else{var _167=this._channelSelector.currentSelectedItem;var _168=this._resolutionSelector.currentSelectedItem;_166=lang.replace(_15b.tooltip,{channel:_167.name,resolution:_168.name});}this.set("title",_166);},_isDefaultSelection:function(){return (this._channelSelector.isDefaultItemSelected()&&this._resolutionSelector.isDefaultItemSelected());},_onChannelSelected:function(_169){var _16a=this._resolutionSelector.getDefaultResolution(_169);if(!this._resolutionSelector.currentSelectedItem||(this._resolutionSelector.currentSelectedItem&&this._resolutionSelector.currentSelectedItem.name!=_16a.name)){this._resolutionSelector.checkItem(_16a);}this._changeView(_16a,_169);},_onResolutionSelected:function(_16b){this._changeView(_16b);},_changeView:function(_16c,_16d){if(_16c){if(_16c.name==this._resolutionSelector.defaultItem.name){_152.publish("/epi/cms/action/viewsettingvaluechanged",["resolution",null]);}else{var _16e=_16c.width+"x"+_16c.height;_152.publish("/epi/cms/action/viewsettingvaluechanged",["resolution",_16e]);}}if(_16d){if(_16d.name==this._channelSelector.defaultItem.name){_152.publish("/epi/cms/action/viewsettingvaluechanged",["epichannel",null]);}else{_152.publish("/epi/cms/action/viewsettingvaluechanged",["epichannel",_16d.channelName]);}}this._activeButton(!this._isDefaultSelection());this._updateTooltip();},_addChildren:function(item){this.dropDown.addChild(item);},_activeButton:function(_16f){if(!this.dropDown){return;}if(_16f){_154.add(this.domNode,"dijitChecked");}else{_154.remove(this.domNode,"dijitChecked");}}});});},"epi-cms/widget/ChannelSelector":function(){define(["dojo","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","epi","epi/dependency","epi-cms/widget/_ItemSelectorBase","epi-cms/widget/_DropDownWidgetItemMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.channelselector"],function(dojo,lang,_170,_171,epi,_172,_173,_174,res){return dojo.declare([_173,_174],{defaultItem:{name:res.defaultitem,resolutionName:res.defaultitem},_isFinished:null,_channelHashMap:{},postMixInProperties:function(){this.inherited(arguments);var _175=_172.resolve("epi.storeregistry");this._store=_175.get("epi.cms.displaychannels");},postCreate:function(){this._isFinished=new _171();this.inherited(arguments);this.set("header",res.header);dojo.when(this._store.query({query:"getallregistered"}),lang.hitch(this,function(_176){this._createHashMap(_176);this.checkedItem=(this.checkedItem?this._channelHashMap[this.checkedItem]:this.defaultItem.name);_176.unshift(this.defaultItem);this.set("items",_176);this._isFinished.resolve({status:true});}));},isSetupFinished:function(){return this._isFinished;},_createHashMap:function(_177){_170.forEach(_177,lang.hitch(this,function(item){this._channelHashMap[item.channelName]=item.name;}));}});});},"epi-cms/widget/ResolutionSelector":function(){define(["dojo","dojo/_base/lang","dojo/_base/array","epi","epi/dependency","epi-cms/ApplicationSettings","epi-cms/widget/_ItemSelectorBase","epi-cms/widget/_DropDownWidgetItemMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.resolutionselector"],function(dojo,lang,_178,epi,_179,_17a,_17b,_17c,res){return dojo.declare([_17b,_17c],{_resolutionHash:{},defaultItem:{name:res.defaultitem,width:1,height:1},postMixInProperties:function(){this.inherited(arguments);this._availableResolutions=lang.clone(_17a.displayResolutions);this._availableResolutions.unshift(this.defaultItem);_178.forEach(this._availableResolutions,lang.hitch(this,function(_17d){var _17e=_17d.width+"x"+_17d.height;this._resolutionHash[_17e]=_17d.name;}));this.checkedItem=(this.checkedItem?this._resolutionHash[this.checkedItem]:this.defaultItem.name);},postCreate:function(){this.inherited(arguments);this.set("header",res.header);this.set("items",this._availableResolutions);},getDefaultResolution:function(_17f){var _180=this.defaultItem;var _181=dojo.filter(this._availableResolutions,function(_182){if(_182.id==_17f.resolutionId){return _182;}});if(_181!=null&&lang.isArray(_181)&&_181.length>=1){_180=_181[0];}return _180;}});});},"epi-cms/widget/ViewLanguageButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/topic","dojo/when","dojo/dom-class","dijit/DropDownMenu","dijit/form/DropDownButton","dijit/focus","epi/dependency","epi-cms/widget/ViewLanguageSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.viewlanguagebutton"],function(_183,lang,_184,_185,when,_186,_187,_188,_189,_18a,_18b,_18c){return _183([_188],{_contextMenu:null,baseClass:"epi-mediumButton epi-chromelessButton",iconClass:"",contextMenuProperties:{},_viewLanguageSelector:null,_viewSettingsManager:null,postMixInProperties:function(){this.inherited(arguments);lang.mixin(this.contextMenuProperties,{"class":"epi-DropDownMenu"});this.profile=this.profile||_18a.resolve("epi.shell.Profile");},postCreate:function(){this.inherited(arguments);when(this.profile.getContentLanguage(),lang.hitch(this,function(_18d){this._viewSettingsManager=_18a.resolve("epi.viewsettingsmanager");var _18e={languageId:_18d},_18f=this._viewSettingsManager.getSettingProperty("viewlanguage")||_18e.languageId;if(!this.dropDown){this.dropDown=_187(this.contextMenuProperties);this.own(this.dropDown);this._viewLanguageSelector=new _18b({defaultItem:_18e,checkedItem:_18f});this.own(_184.after(this._viewLanguageSelector,"onItemSelected",lang.hitch(this,"_onViewLanguageSelected"),true));this._addChildren(this._viewLanguageSelector);when(this._viewLanguageSelector.fetchData(),lang.hitch(this,function(_190){if(this._viewLanguageSelector.get("items").length===0){_186.add(this.domNode,"dijitHidden");return;}this._changeView();}));}this.own(_184.after(this.dropDown,"onOpen",lang.hitch(this,function(e){_189.focus(this._viewLanguageSelector.menuNode.domNode);}),true));this.own(_185.subscribe("/epi/cms/contentdata/updated",lang.hitch(this,function(){this._languageSettingsChanged();})));}));},_languageSettingsChanged:function(){when(this._viewLanguageSelector.fetchData(),lang.hitch(this,function(_191){var _192=this._viewLanguageSelector.get("currentSelectedItem");this._changeView(_192||this._viewLanguageSelector.defaultItem);}));},_updateButton:function(_193){var _194=_193||this._viewLanguageSelector.get("currentSelectedItem")||this._viewLanguageSelector.defaultItem;var _195=lang.replace(_18c.tooltip,{viewlanguage:_194?_194.name:null});var _196=_194&&_194.urlSegment?_194.urlSegment.toUpperCase():null;var _197=this.get("label");this.set("title",_195);this.set("label",_196);if(_197!=_196){this.onResize();}},onResize:function(){},_isDefaultSelection:function(){if(this._viewLanguageSelector.get("currentSelectedItem")){return this._viewLanguageSelector.isDefaultItemSelected();}return true;},_onViewLanguageSelected:function(_198){this._changeView(_198);this.closeDropDown();},_changeView:function(_199){if(_199){_185.publish("/epi/cms/action/viewsettingvaluechanged","viewlanguage",_199.languageId);}this._viewLanguageSelector.checkItem(_199);this._activeButton(!this._isDefaultSelection());this._updateButton(_199);},_addChildren:function(item){this.dropDown.addChild(item);},_activeButton:function(_19a){if(!this.dropDown){return;}_186.toggle(this.domNode,"dijitChecked",_19a);_186.toggle(this.domNode,"epi-expandoButtonLangSelected",_19a);}});});},"epi-cms/widget/ViewLanguageSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/Deferred","dojo/when","epi/dependency","epi-cms/widget/_ItemSelectorBase","epi-cms/widget/_DropDownWidgetItemMixin","epi-cms/component/SiteTreeModel","epi/i18n!epi/cms/nls/episerver.cms.widget.viewlanguageselector"],function(_19b,lang,_19c,_19d,when,_19e,_19f,_1a0,_1a1,_1a2){return _19b([_19f,_1a0],{_viewLanguageHash:{},_isFinished:null,_siteTreeModel:null,postCreate:function(){this.inherited(arguments);this.set("header",_1a2.header);if(!this._siteTreeModel){var _1a3=_19e.resolve("epi.storeregistry"),_1a4=_1a3.get("epi.cms.sitestructure");this._siteTreeModel=new _1a1({store:_1a4});}},fetchData:function(){var _1a5=new _19d();when(this._siteTreeModel.getCurrentSite(),lang.hitch(this,function(site){if(site){when(this._siteTreeModel.getChildren({url:site.currentSite},lang.hitch(this,function(_1a6){this._createHashMap(_1a6);if(this.defaultItem){this.defaultItem.name=this._viewLanguageHash[this.defaultItem.languageId]||this.defaultItem.name;}this.set("items",_1a6);_1a5.resolve({status:true});})));}}));return _1a5.promise;},checkItem:function(item){if(!item||!this._viewLanguageHash[item.languageId]){item=this.get("currentSelectedItem");}this.inherited(arguments);},_getCurrentSelectedItemAttr:function(){var _1a7=null;_19c.some([this.currentSelectedItem,this.checkedItem,this.defaultItem],lang.hitch(this,function(_1a8){if(_1a8&&(this._viewLanguageHash[_1a8.languageId||_1a8])){_1a7=_1a8.languageId?_1a8:{languageId:_1a8,name:this._viewLanguageHash[_1a8]};return true;}return false;}));return _1a7;},_createHashMap:function(_1a9){this._viewLanguageHash={};_19c.forEach(_1a9,lang.hitch(this,function(item){this._viewLanguageHash[item.languageId]=item.name;}));}});});},"epi-cms/component/SiteTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Deferred","dojo/when","dojo/_base/lang","dojo/_base/connect","dojo/cookie","epi/dependency","epi/string"],function(_1aa,_1ab,_1ac,_1ad,when,lang,_1ae,_1af,_1b0,_1b1){return _1ab([_1ac],{query:null,showAllLanguages:true,location:document.location,profile:null,store:null,constructor:function(){this.query={allLanguages:this.showAllLanguages};},postscript:function(){this.inherited(arguments);this.profile=this.profile||_1b0.resolve("epi.shell.Profile");_1ae.subscribe("/epi/cms/contentdata/updated",lang.hitch(this,function(){when(this.getCurrentSite(),lang.hitch(this,function(_1b2){this.onItemChildrenReload({siteUrl:_1b2.currentSite});}));}));},getRoot:function(_1b3,_1b4){_1b3({});},getIdentity:function(item){var id=this.store.getIdentity(item);if(!id&&!item.isLanguageNode){id="root";}return id;},onItemChildrenReload:function(_1b5){},mayHaveChildren:function(item){if(!item.isLanguageNode){return true;}return false;},getLabel:function(item){return item.name;},getChildren:function(_1b6,_1b7){when(this.store.query(lang.mixin({siteUrl:_1b6.url},this.query)),_1b7);},_setQuery:function(q){this.query=q;this.onItemChildrenReload({});},_showAllLanguagesSetter:function(_1b8){this.showAllLanguages=_1b8;this._setQuery({allLanguages:_1b8});},getCurrentSite:function(){var def=new _1ad();when(this.profile.getContentLanguage(),lang.hitch(this,function(_1b9){if(_1b9){when(this.store.get(),lang.hitch(this,function(_1ba){var _1bb=null;var _1bc=null;_1aa.some(_1ba,function(site){return _1aa.some(site.hosts,function(host){if(host==="*"){_1bc=site;return true;}});});var _1bd=this.location.host.toLowerCase();var _1be=_1aa.some(_1ba,function(site){return _1aa.some(site.hosts,function(host){if(_1bd==host.toLowerCase()){_1bb={currentSite:site.url,currentEditLanguageId:site.url+_1b9};return true;}});});if(!_1be&&_1bc){_1bb={currentSite:_1bc.url,currentEditLanguageId:_1bc.url+_1b9};}if(_1bb){def.resolve(_1bb);}else{def.cancel();}}),function(){def.reject(null);});}else{def.reject(null);}}));return def;},getAllLanguagesForSite:function(_1bf){var def=new _1ad();when(this.store.query({siteUrl:_1bf,allLanguages:true}),function(_1c0){def.resolve(_1c0);});return def;},getAllLanguagesForCurrentSite:function(){var def=new _1ad();when(this.getCurrentSite(),lang.hitch(this,function(_1c1){this.getAllLanguagesForSite(_1c1.currentSite).then(function(_1c2){def.resolve(_1c2);});}),function(_1c3){def.reject(_1c3);});return def;}});});},"epi-cms/widget/command/CreateContentFromSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/topic","dojo/when","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/ApplicationSettings","epi-cms/_ContentContextMixin","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/ContentSelectorDialog","epi-cms/widget/ContentForestStoreModel","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.widget.createcontentselector"],function(_1c4,_1c5,lang,_1c6,on,_1c7,when,_1c8,_1c9,_1ca,_1cb,_1cc,_1cd,_1ce,_1cf,_1d0,_1d1,_1d2,_1d3){return _1c5([_1c9,_1ce,_1cf],{canExecute:true,canSelectOwnerContent:false,showButtons:false,value:null,showRoot:false,roots:null,creatingTypeIdentifier:null,containerTypeIdentifiers:null,modelContent:null,destroyOnHide:true,confirmActionText:_1d3.buttons.confirmation,description:null,title:null,createAsLocalAsset:false,canChangeLocalAssetName:true,addToParentsAssetsFolder:false,typeDescriptorManager:null,contentRepositoryDescriptors:null,postscript:function(){this.inherited(arguments);this._initialize();},_initialize:function(){if(!this.creatingTypeIdentifier){throw "You need to specify a creatingTypeIdentifier";}if(this._initialized){return;}var _1d4=_1c8.resolve("epi.storeregistry");this.contentStore=this.contentStore||_1d4.get("epi.cms.content.light");this.contextStore=this.contextStore||_1d4.get("epi.shell.context");this.contentTypeStore=this.contentTypeStore||_1d4.get("epi.cms.contenttype");this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_1c8.resolve("epi.cms.contentRepositoryDescriptors");var _1d5,_1d6=function(type){return type==this.creatingTypeIdentifier;};for(var _1d7 in this.contentRepositoryDescriptors){var _1d8=this.contentRepositoryDescriptors[_1d7];if(_1c4.some(_1d8.containedTypes,_1d6,this)){_1d5=_1d8;break;}}if(_1d5){var _1d9=_1ca.getValue(this.creatingTypeIdentifier,"containerTypes");this.containerTypeIdentifiers=_1d9?_1d9:[this.creatingTypeIdentifier];this.roots=this.roots||_1d5.roots;}this.modelContent=new _1d1({roots:this.roots,additionalQueryOptions:{sort:[{attribute:"name",descending:false}]}});this.preventContextualContentFor=_1d5.preventContextualContentFor;this.label=this.label||_1ca.getResourceValue(this.creatingTypeIdentifier,"create");this.title=this.title||_1ca.getResourceValue(this.creatingTypeIdentifier,"selectparent");this.description=this.description||_1ca.getResourceValue(this.creatingTypeIdentifier,"createdescription");this.iconClass=this.iconClass||_1ca.getValue(this.creatingTypeIdentifier,"commandIconClass");this._initialized=true;},_execute:function(){when(this.getCurrentContent(),lang.hitch(this,function(_1da){if(!_1da){return;}when(this.contextStore.get("?uri=epi.cms.contentdata:///"+_1da.contentLink),lang.hitch(this,function(_1db){if(!_1db){return;}var _1dc=_1db.languageContext;var _1dd=!_1dc||(_1dc.hasTranslationAccess&&_1dc.isPreferredLanguageAvailable);var _1de=_1cc.compareIgnoreVersion(_1da.contentLink,_1cd.wastebasketPage);var _1df=!(_1de||_1da.isDeleted)&&_1dd&&_1d2.isActionAvailable(_1da,_1d2.action.Create,_1d2.providerCapabilities.Create,true);when(this._getAvailableContentTypes(_1da.contentLink),lang.hitch(this,function(_1e0){var _1e1=this._isContentTypeAllowedAsChildToCurrentContext(_1e0,_1da);if((!_1e1&&!this.createAsLocalAsset)||!_1df){this._createDialog();this._setDialogButtonState(this.selector.get("value"));}else{this._switchView(_1da);}}));}));}));},_getAvailableContentTypes:function(_1e2){return this.contentTypeStore.query({query:"getavailablecontenttypes",parentReference:_1e2});},_isContentTypeAllowedAsChildToCurrentContext:function(_1e3,_1e4){var _1e5=_1c4.some(_1e3,function(_1e6){return _1ca.isBaseTypeIdentifier(_1e6.typeIdentifier,this.creatingTypeIdentifier);},this);var _1e7=_1c4.some(this.containerTypeIdentifiers,function(type){return _1ca.isBaseTypeIdentifier(_1e4.typeIdentifier,type);});return _1e5&&_1e7;},_createDialog:function(){this.selector=new _1d0({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:this.showButtons,value:this.value,showRoot:this.showRoot,multiRootsMode:true,allowedTypes:this.containerTypeIdentifiers,model:this.modelContent,showContextualContent:true,preventContextualContentFor:this.preventContextualContentFor});this.dialog=new _1cb({destroyOnHide:this.destroyOnHide,confirmActionText:this.confirmActionText,description:this.description,title:this.title,content:this.selector});on(this.selector,"change",lang.hitch(this,this._setDialogButtonState));_1c6.after(this.dialog,"hide",lang.hitch(this,function(_1e8){this.hideDeferred=_1e8;}));this.dialog.on("execute",lang.hitch(this,this._onContentSelected));this.dialog.show();},_onContentSelected:function(){var _1e9=this.selector.get("value");when(this.hideDeferred,lang.hitch(this,function(){when(this.contentStore.get(_1e9),lang.hitch(this,function(_1ea){this._switchView(_1ea);}));}));},_switchView:function(_1eb){when(this.getCurrentContent(),lang.hitch(this,function(_1ec){var _1ed=this.isPseudoContextualRoot(_1eb)||this.createAsLocalAsset;_1c7.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.creatingTypeIdentifier,parent:_1ed?_1ec:_1eb,editAllPropertiesOnCreate:this.editAllPropertiesOnCreate,addToDestination:this.model,createAsLocalAsset:_1ed,canChangeLocalAssetName:this.canChangeLocalAssetName,treatAsSecondaryView:this.createAsLocalAsset,view:_1ca.getValue(this.creatingTypeIdentifier,"createView")});}));},_setDialogButtonState:function(_1ee){if(!_1ee){this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",true);return;}when(this.contentStore.get(_1ee),lang.hitch(this,function(_1ef){when(this.isPseudoContextualRoot(_1ef)?this.contextStore.get("?uri=epi.cms.contentdata:///"+this._currentContext.id):_1ef,lang.hitch(this,function(_1f0){var _1f1=_1d2.hasLanguageAccess(_1f0),_1f2=_1f1&&_1d2.hasAccess(_1ef.accessMask,_1d2.accessLevel.Create);this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",!_1f2);}));}));}});});},"epi-cms/contentediting/_ContextualContentContextMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi/shell/_ContextMixin","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/contentediting/PseudoContextualCommandDecorator","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist.roots"],function(_1f3,_1f4,lang,when,_1f5,_1f6,_1f7,_1f8,_1f9,_1fa){return _1f4([_1f5],{contextRootLabel:null,_commandDecorator:null,postscript:function(){this.inherited(arguments);this.contextRootLabel=this.contextRootLabel||_1fa.contextualroot.label;this._commandDecorator=this._commandDecorator||new _1f8();},destroy:function(){this._commandDecorator&&this._commandDecorator.destroy();this.inherited(arguments);},isTypeOfRoot:function(_1fb){var _1fc=this.inherited(arguments),_1fd=this.isContextualContent(_1fb);return _1fc!=null?!!(_1fc||_1fd):!!(_1fb&&_1fd);},isContextualContent:function(_1fe){return this.isContextualRoot(_1fe)||this.isPseudoContextualRoot(_1fe);},isContextualRoot:function(_1ff){return _1ff.parentLink==this._getPseudoContextualContent();},isPseudoContextualRoot:function(_200){var _201=_1f9.toContentReference(_200.contentLink);return !_201.providerName&&_201.id==this._getPseudoContextualContent();},hasContextual:function(_202){if(!(_202 instanceof Array)||_202.length<=0){return false;}return _1f3.some(_202,this.isContextualContent,this);},canHaveContextualContent:function(_203){var _204=_1f9.toContentReference(_203.contentLink);return !_1f3.some(this.notSupportContextualContents,function(id){return !_204.providerName&&_204.id==id;});},getContextualRoot:function(_205){if(typeof _205!=="object"){return null;}var _206=lang.clone(_205);_206.name=this.getContextualRootName(_206);if(this.isPseudoContextualRoot(_206)){_206.hasChildren=false;}return _206;},getContextualRootName:function(_207){var name=this.contextRootLabel||(this._currentContext&&this._currentContext.name)||"",_208=_207&&_207.ownerTypeIdentifier,_209=_1f6.getResourceValue(_208||(this._currentContext&&this._currentContext.dataType)||"","name",true);return _209?lang.replace(name,[_209]):name;},decoratePseudoContextualCommands:function(_20a){when(this.getCurrentContent(),lang.hitch(this,function(_20b){this._commandDecorator.decorateCommands(_20a,_20b,lang.hitch(this,this.isPseudoContextualRoot));}));},_getPseudoContextualContent:function(){return _1f7.contentAssetsFolder;}});});},"epi-cms/contentediting/PseudoContextualCommandDecorator":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_20c,_20d,lang,_20e,_20f,_210,_211){return _20d(null,{destroy:function(){this._clearContextualCommandHandlers();},decorateCommands:function(_212,_213,_214){this._clearContextualCommandHandlers();if(!(_212 instanceof Array)||_212.length<=0||typeof _213!=="object"){return;}this._decorateCommands(_212,_213,_214);},_decorateCommands:function(_215,_216,_217){_20c.forEach(_215,function(_218){if(!this._isValidCommand(_218)){return;}if(typeof _217==="function"&&!_217(this._isNormalCommand(_218)?_218.model:_218.get("selectionData"))){return;}this._onAroundCommandExecute(_218,_216);},this);},_onAroundCommandExecute:function(_219,_21a){var self=this;self._contextualCommandHandlers.push(_20e.around(_219,"execute",function(_21b){return function(){var _21c=self._decorateCommandBeforeExecute(_219,_21a);_21b.apply(_219,arguments);self._restoreCommandAfterExecute(_219,_21c);};}));},_decorateCommandBeforeExecute:function(_21d,_21e){var _21f={};lang.mixin(_21f,this._decorateCommand(_21d));if(this._isNormalCommand(_21d)){lang.mixin(_21f,this._decorateNormalCommand(_21d,_21e));return _21f;}if(_21d.isInstanceOf(_211)){lang.mixin(_21f,this._decorateSelectionCommand(_21d,_21e));}return _21f;},_decorateCommand:function(_220){var _221={"canExecute":_220.get("canExecute"),"isAvailable":_220.get("isAvailable"),"createAsLocalAsset":_220.get("createAsLocalAsset"),"canChangeLocalAssetName":_220.get("canChangeLocalAssetName")};_220.isInstanceOf(_20f)&&_220.unwatchModelChange();_220.isInstanceOf(_210)&&_220.unwatchClipboardChange();_220.isInstanceOf(_211)&&_220.unwatchSelectionChange();_220.set("canExecute",true);_220.set("isAvailable",true);_220.set("createAsLocalAsset",true);_220.set("canChangeLocalAssetName",true);return _221;},_decorateNormalCommand:function(_222,_223){var _224={"model":_222.get("model")};_222.set("model",_223);return _224;},_decorateSelectionCommand:function(_225,_226){var _227={"data":_225.get("selectionData")};var _228=_225.get("model");if(_228&&typeof _228.refreshRoots=="function"){_225.onRefreshSelection=function(){return _228.refreshRoots();};}_225.selection.set("data",[{"data":_226,"type":_225.get("selectionType")}]);return _227;},_restoreCommandAfterExecute:function(_229,_22a){this._restoreCommand(_229,_22a);if(this._isNormalCommand(_229)){this._restoreNormalCommand(_229,_22a);return;}if(_229.isInstanceOf(_211)){this._restoreSelectionCommand(_229,_22a);}},_restoreCommand:function(_22b,_22c){_22b.set("canExecute",_22c.canExecute);_22b.set("isAvailable",_22c.isAvailable);_22b.set("createAsLocalAsset",_22c.createAsLocalAsset);_22b.set("canChangeLocalAssetName",_22c.canChangeLocalAssetName);_22b.isInstanceOf(_20f)&&_22b.watchModelChange();_22b.isInstanceOf(_210)&&_22b.watchClipboardChange();_22b.isInstanceOf(_211)&&_22b.watchSelectionChange();},_restoreNormalCommand:function(_22d,_22e){_22d.set("model",_22e.model);},_restoreSelectionCommand:function(_22f,_230){_22f.selection.set("data",_230.data);},_clearContextualCommandHandlers:function(){if(this._contextualCommandHandlers instanceof Array&&this._contextualCommandHandlers.length>0){_20c.forEach(this._contextualCommandHandlers,function(_231){typeof _231.remove==="function"&&_231.remove();});}this._contextualCommandHandlers=[];},_isNormalCommand:function(_232){return !(_232.isInstanceOf(_211)||_232.isInstanceOf(_210));},_isValidCommand:function(_233){return !!(_233&&_233.isInstanceOf(_20f)&&_233.model);}});});},"epi/shell/command/_ClipboardCommandMixin":function(){define("epi/shell/command/_ClipboardCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_234,lang){return _234(null,{clipboard:null,postscript:function(){this.inherited(arguments);this.watchClipboardChange();},onRefreshClipboard:function(){},watchClipboardChange:function(){this._clipboardChangeWatcher=this.clipboard.watch("data",lang.hitch(this,this._onModelChange));},unwatchClipboardChange:function(){this._clipboardChangeWatcher&&this._clipboardChangeWatcher.unwatch();},_clipboardDataGetter:function(){return this._getClipboardData();},_clipboardTypeGetter:function(){return this._getClipboardData().type;},_getClipboardData:function(){if(!this.clipboard||!(this.clipboard.data instanceof Array)){return null;}return this.clipboard.data;}});});},"epi/shell/command/_SelectionCommandMixin":function(){define("epi/shell/command/_SelectionCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_235,lang){return _235(null,{selection:null,postscript:function(){this.inherited(arguments);this.watchSelectionChange();},onRefreshSelection:function(){},watchSelectionChange:function(){this._selectionChangeWatcher=this.selection.watch("data",lang.hitch(this,this._onModelChange));},unwatchSelectionChange:function(){this._selectionChangeWatcher&&this._selectionChangeWatcher.unwatch();},_selectionDataGetter:function(){var _236=this._getSelectionData();return _236!=null&&_236.type=="epi.cms.contentdata"?_236.data:null;},_selectionTypeGetter:function(){return this._getSelectionData().type;},_getSelectionData:function(){if(!this.selection||!(this.selection.data instanceof Array)){return null;}return this.selection.data[0];}});});},"epi-cms/widget/ContentSelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetBase","epi","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/widget/ContentTree","epi-cms/widget/ContextualContentForestStoreModel","epi/shell/widget/_ActionProviderWidget","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselectordialog"],function(_237,_238,lang,when,_239,_23a,epi,_23b,_23c,_23d,_23e,_23f,_240,_241){return _238([_23a,_239,_23f],{_contentRef:null,res:_241,roots:null,typeIdentifiers:null,showButtons:true,model:null,canSelectOwnerContent:true,multiRootsMode:false,templateString:"<div><div data-dojo-attach-point=\"_treeNode\"></div></div>",_typesToDisplay:null,showAllLanguages:false,selectedContentType:null,buildRendering:function(){this.inherited(arguments);var _242=this._getTypesToDisplay(),_243=this.model,_244=this.roots||(_243&&_243.roots);this.preventContextualContentFor=this.preventContextualContentFor||this._getSettingFromContentType();if(!_243||this.showContextualContent){_243=new _23e({roots:_244,typeIdentifiers:_242,notSupportContextualContents:this.preventContextualContentFor,showAllLanguages:this.showAllLanguages});}_243.set("view","contentselector");this.tree=new _23d({roots:_244,typeIdentifiers:_242,allowManipulation:false,model:_243,expandExtraNodeItems:_23c.startPage},this._treeNode);this.connect(this.tree,"onClick","_onTreeNodeClick");},_getSettingFromContentType:function(){if(!this.selectedContentType){return null;}var _245=this.contentRepositoryDescriptors||_240.resolve("epi.cms.contentRepositoryDescriptors");var _246,_247=function(type){return _23b.isBaseTypeIdentifier(this.selectedContentType,type);};for(var _248 in _245){var _249=_245[_248];if(_237.some(_249.containedTypes,_247,this)){_246=_249;break;}}return _246.preventContextualContentFor;},_getTypesToDisplay:function(){if(!this._typesToDisplay){var _24a=[];this._getContainerTypesRecursive(this.allowedTypes,_24a);this._typesToDisplay=_24a;}return this._typesToDisplay;},_getContainerTypesRecursive:function(_24b,_24c,_24d){if(!_24d){_24d=[];}_237.forEach(_24b,lang.hitch(this,function(type){if(_237.indexOf(_24d,type)===-1){_24d.push(type);if(_237.indexOf(_24c,type)===-1){_24c.push(type);}var _24e=_23b.getValue(type,"containerTypes");if(_24e){this._getContainerTypesRecursive(_24e,_24c,_24d);}}}));},_setValueAttr:function(_24f){if(_24f){this._contentRef=_24f;var _250=this._contentRef==="-"?null:this._contentRef;if(this.multiRootsMode){when(this.tree.onLoadDeferred,lang.hitch(this,function(){this.tree.selectContent(_250);}));}else{if(!epi.isEmpty(_250)){this.tree.selectContent(_250);}}}else{this._contentRef=null;this._clearSelectedContent();}},_getValueAttr:function(){this.inherited(arguments);if(this._contentRef){return this._contentRef.toString();}else{return "";}},_clearSelectedContent:function(){this.tree.set("selectedNodes",[]);this.tree.set("selectedItems",[]);},getActions:function(){return this.canSelectOwnerContent?[{name:"selectpage",label:_241.currentpage,settings:{type:"submit"},action:lang.hitch(this,function(){this._setValueOwnerContent();})}]:[];},_onTreeNodeClick:function(_251){var _252=_251.contentLink;var _253=_237.indexOf(this.allowedTypes,_251.typeIdentifier)!==-1;if(!_253){_253=_237.some(this.allowedTypes,function(type){return _23b.isBaseTypeIdentifier(_251.typeIdentifier,type);});}if(!_253){this.tree.lastFocused.setSelected(false);_252=null;}this.set("value",_252);this.onChange(this.get("value"));},_setValueOwnerContent:function(){this.set("value","-");},onChange:function(_254){},focus:function(){this.tree.focus();}});});},"epi-cms/widget/ContentTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/keys","dojo/promise/all","dojo/query","dojo/sniff","dojo/when","epi/dependency","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/core/ContentReference","epi-cms/widget/_ContentTreeNode","epi-cms/widget/ContentTreeModelConfirmation","epi-cms/widget/ContentForestStoreModel"],function(_255,_256,_257,lang,_258,_259,_25a,_25b,_25c,keys,_25d,_25e,_25f,when,_260,_261,_262,Tree,_263,_264,_265,_266){return _257([Tree,_25c],{roots:null,expandExtraNodeItems:null,nodeConstructor:null,typeIdentifiers:null,allowManipulation:true,persist:false,expandOnDnd:true,showRoot:false,handleSelection:false,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=this._createTreeModel();}if(this.allowManipulation){this.dndController=_261;this.dndParams.push("accept");this.accept=this.model.containedTypes||this.containedTypes;}this.checkItemAcceptance=lang.hitch(this,this.checkItemAcceptance);this.nodeConstructor=this.nodeConstructor||_264;},getItemType:function(item){return _262.getAndConcatenateValues(item.typeIdentifier,"dndTypes");},buildRendering:function(){this.model=this._wrapModel(this.model);this.inherited(arguments);},_wrapModel:function(_267){return _265(this.model);},postCreate:function(){this.inherited(arguments);this.own(this.connect(this.model,"onSelect",lang.hitch(this,this._onSelect)),_25a.before(this.model,"onToggleContentDisplay",lang.hitch(this,function(_268,_269){var _26a=this.getNodesByItem(_268)[0];if(_26a){_259.set(_26a.domNode,{"display":_269===true?"":"none"});}})));},onLoad:function(){this.inherited(arguments);return when(this._expandRootNodes(),lang.hitch(this,this._expandExtraNodes));},_expandRootNodes:function(){var _26b=this.showRoot?[this.rootNode]:this.rootNode.getChildren();return _25d(_255.map(_26b,this.tree._expandNode,this));},_expandExtraNodes:function(){if(!this.expandExtraNodeItems){return;}var _26c=this.expandExtraNodeItems instanceof Array?this.expandExtraNodeItems:[this.expandExtraNodeItems];var _26d=_255.map(_26c,function(item){return this.tree.getNodesByItem(item)[0];},this);_26d=_255.filter(_26d,Boolean);return _25d(_255.map(_26d,this.tree._expandNode,this));},checkItemAcceptance:function(_26e,_26f,_270){var _271=true;var _272=dijit.getEnclosingWidget(_26e),_273=_272&&_272.item;if(!_273){return false;}_26f.forInSelectedItems(function(item){if(!_271){return;}var data=item.data;if(data.dndData){data=data.dndData;}_271=this.model.canPaste(data,_273);},this);return _271;},_setAllowManipulationAttr:function(_274){this._set("allowManipulation",_274);if(_274){this.dndController=_261;}},_createTreeModel:function(){return new _266({roots:this.roots,typeIdentifiers:this.typeIdentifiers});},_onItemDelete:function(item,_275){function _276(node,_277){_255.forEach(node.getChildren(),function(_278){_277.push(_278.item);_276(_278,_277);});return _277;};if(_275){var _279=this._itemNodesMap[this.model.getIdentity(item)];if(_279){_255.forEach(_279,function(_27a){_255.forEach(_276(_27a,[]).reverse(),function(_27b){this._onItemDelete(_27b);},this);},this);}}this.inherited(arguments);},_setTypeIdentifiersAttr:function(_27c){this._set("typeIdentifiers",_27c);if(this.model){this.model.typeIdentifiers=_27c;}},buildNodeFromTemplate:function(args){return new this.nodeConstructor(args);},_createTreeNode:function(args){var _27d=lang.mixin({},args,{dndData:args.item});return this.buildNodeFromTemplate(_27d);},getIconClass:function(item,_27e){if(!item){return this.inherited(arguments);}var _27f=_262.getValue(item.typeIdentifier,"iconClass");if(this.model.isTypeOfRoot(item)){return this.model.getObjectIconClass(item,_27f);}var _280=_262.getValue(item.typeIdentifier,"supportsOpenCssClass");if(_27e&&!item.isSubRoot&&_280){_27f=_27f+"Open";}return _27f;},focus:function(){this.focusNode(this.get("selectedNode")||this.rootNode);},_getTargetPath:function(_281){var _282=this.model,_283=new _25b();_282.getAncestors(_281,function(_284){_284.push(_281);var _285=_255.map(_284,function(item){return _282.getIdentity(item).toString();});if(typeof _282.filterAncestors==="function"){_285=_282.filterAncestors(_285);}_283.resolve(_285);});return _283.promise;},_isValidTargetContent:function(_286){if(!_286){return false;}return !_286.isDeleted&&!_286.isWastebasket;},_onSelect:function(id,_287,_288){var _289=this.get("selectedNode");this.tree.model.set("previousContextualSelection",{"selectedContent":_289});this.selectContent(id,_287,true,_288).then(lang.hitch(this,function(){_289=this.get("selectedNode");if(_289&&_289.item&&_289.item.contentLink){this.emit("select",_289.item,_289);}}));},selectContent:function(_28a,_28b,_28c,_28d){var self=this,_28e=self.model,_28f=new _25b(),_290=function(_291){self._preparePathNodes(_291);self._setRecursivePaths(_291,_28f,_28b,_28d);};when(_28e.store.get(_28a),function(_292){if(!self._isValidTargetContent(_292)){self.set("paths",[]);_28f.resolve(null);}else{self._getTargetPath(_292).then(function(_293){self._onSetTargetPath();_290(_293);});}});return _28f.promise;},_onSetTargetPath:function(){this.model.set("handleSelection",this.handleSelection);if(!this.handleSelection){return;}var _294=this.get("selectedNode");if(_294){_294=this.getNodesByItem(_294.item)[0];if(_294){this.model.set("previousSelection",{selectedContent:_294,selectedAncestors:_294.getTreePath()});}}},_preparePathNodes:function(_295){},_setRecursivePaths:function(_296,_297,_298,_299){if(!_296||_296.length===0){return;}this.set("paths",[_296]).then(lang.hitch(this,function(){var _29a=this.get("selectedNode");if(!_29a){this._setRecursivePaths(_296.slice(0,-1),_297,_298,_299);return;}if(_298){this.focus();}if(_299){_299(_29a);}_297.resolve(_29a);},_297.reject));},_onKeyDown:function(item,e){this.inherited(arguments);if(!this.allowManipulation){return;}if(_256.isCopyKey(e)){var _29b=e.keyCode?String.fromCharCode(e.keyCode).toLowerCase():"";switch(_29b){case "c":this.emit("copyOrCut",true);break;case "x":this.emit("copyOrCut",false);break;case "v":this.emit("paste");break;default:break;}}if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey){return;}if(e.keyCode==keys.DELETE){this.emit("delete");}},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);if(_25f("ie")){_255.forEach(_25e(".dijitTreeRow.dijitTreeRowHover",this.tree.domNode),function(node){_258.remove(node,"dijitTreeRowHover");});}}});});},"epi/shell/dnd/tree/dndSource":function(){define("epi/shell/dnd/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","dojo/when","dijit/tree/dndSource","../_DndDataMixin"],function(_29c,_29d,_29e,_29f,_2a0,lang,on,_2a1,_2a2,_2a3,when,_2a4,_2a5){return _29e([_2a4,_2a5],{generateText:false,singular:true,deleteSelectedNodes:function(){},userSelect:function(node){this.inherited(arguments,[node,false,false]);},onDndDrop:function(_2a6,_2a7,copy,_2a8){if(this.containerState=="Over"){var tree=this.tree,_2a9=tree.model,_2aa=this.targetAnchor;this.isDragging=false;var _2ab;var _2ac=(_2aa&&_2aa.item)||tree.item;if(this.dropPosition=="Before"||this.dropPosition=="After"){_2ac=(_2aa.getParent()&&_2aa.getParent().item)||tree.item;_2ab=_2aa.getIndexInParent();if(this.dropPosition=="After"){_2ab=_2aa.getIndexInParent()+1;}}var _2ad=this.itemCreator(_2a7,_2aa.rowNode,_2a6,_2a8);if(_2a6==this){if(_2a9.pasteItems){_2a9.pasteItems(_2ad,_2ac,copy,_2ab);}else{_29c.forEach(_2ad,function(item){if(item.dndData){var _2ae=item.dndData.options;var _2af=_2ae?_2ae.oldParentItem:null;var _2b0=_2ae?_2ae.indexInParent:0;if(typeof _2ab=="number"){if(_2ac==_2af&&_2b0<_2ab){_2ab-=1;}}_2a9.pasteItem(item.dndData.data,_2af,_2ac,copy,_2ab);}});}}else{if(_2a9.newItems){_2a9.newItems(_2ad,_2ac,_2ab);}else{_29c.forEach(_2ad,function(item){_2a9.newItem(item,_2ac,_2ab);});}}if(!_2a6.isDragging&&!_2a8.isDragging){this.onDndEnd();}}if(_2a6!==_2a8&&!copy&&_2a6.onDndItemRemoved){var _2b1=_29c.map(_2a7,function(node){return this._getDndData(_2a6.getItem(node.id),this.accept,this===_2a6);},this);_2a6.onDndItemRemoved(_2b1,_2a6,_2a7,copy,_2a8);}this.onDndCancel();},onMouseOut:function(){this.inherited(arguments);if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}},_onDragMouse:function(e,_2b2){this.inherited(arguments);var m=_2a3.manager();if(m.canDropFlag){when(this.checkItemAcceptance(this.current.rowNode,m.source,null),function(_2b3){m.canDrop(_2b3);});}if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}if(this.tree&&this.tree.expandOnDnd===true&&this.targetAnchor){this._expandOnDndTimeout=setTimeout(lang.hitch(this,function(){this.isDragging&&this.tree._expandNode(this.targetAnchor);}),500);}},onDndEnd:function(){},onDndItemRemoved:function(_2b4,_2b5,_2b6,copy,_2b7){},itemCreator:function(_2b8,_2b9,_2ba,_2bb){return _29c.map(_2b8,function(node){return {id:node.id,name:node.textContent||node.innerText||"",dndData:this._getDndData(_2ba.getItem(node.id),this.accept,this===_2ba)};},this);},getItem:function(key){var item=this.inherited(arguments);if(this.tree.getItemType&&item&&item.data&&item.data.item){item.type=this.tree.getItemType(item.data.item);}item.options=this.getItemOptions(item);return item;},getItemOptions:function(item){var opts={};if(item.data){if(item.data.getParent){var _2bc=item.data.getParent();opts.oldParentItem=_2bc?_2bc.item:null;}if(item.data.getIndexInParent){opts.indexInParent=item.data.getIndexInParent();}}return opts;},onMouseDown:function(e){var _2bd=_29f.contains(e.target,"dojoDndContainerOver");if(_2bd){return;}this.inherited(arguments);},checkAcceptance:function(_2be,_2bf){if(this.readOnly){return false;}var _2c0=_29c.map(_2bf,function(node){return _2be.getItem(node.id);});return this._checkAcceptanceForItems(_2c0,this.accept);}});});},"dijit/tree/dndSource":function(){define("dijit/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","./_dndSelector"],function(_2c1,_2c2,_2c3,_2c4,_2c5,lang,on,_2c6,_2c7,_2c8,_2c9){var _2ca=_2c3("dijit.tree.dndSource",_2c9,{isSource:true,accept:["text","treeNode"],copyOnly:false,dragThreshold:5,betweenThreshold:0,generateText:true,constructor:function(tree,_2cb){if(!_2cb){_2cb={};}lang.mixin(this,_2cb);var type=_2cb.accept instanceof Array?_2cb.accept:["text","treeNode"];this.accept=null;if(type.length){this.accept={};for(var i=0;i<type.length;++i){this.accept[type[i]]=1;}}this.isDragging=false;this.mouseDown=false;this.targetAnchor=null;this.targetBox=null;this.dropPosition="";this._lastX=0;this._lastY=0;this.sourceState="";if(this.isSource){_2c4.add(this.node,"dojoDndSource");}this.targetState="";if(this.accept){_2c4.add(this.node,"dojoDndTarget");}this.topics=[_2c7.subscribe("/dnd/source/over",lang.hitch(this,"onDndSourceOver")),_2c7.subscribe("/dnd/start",lang.hitch(this,"onDndStart")),_2c7.subscribe("/dnd/drop",lang.hitch(this,"onDndDrop")),_2c7.subscribe("/dnd/cancel",lang.hitch(this,"onDndCancel"))];},checkAcceptance:function(){return true;},copyState:function(_2cc){return this.copyOnly||_2cc;},destroy:function(){this.inherited(arguments);var h;while(h=this.topics.pop()){h.remove();}this.targetAnchor=null;},_onDragMouse:function(e,_2cd){var m=_2c8.manager(),_2ce=this.targetAnchor,_2cf=this.current,_2d0=this.dropPosition;var _2d1="Over";if(_2cf&&this.betweenThreshold>0){if(!this.targetBox||_2ce!=_2cf){this.targetBox=_2c5.position(_2cf.rowNode,true);}if((e.pageY-this.targetBox.y)<=this.betweenThreshold){_2d1="Before";}else{if((e.pageY-this.targetBox.y)>=(this.targetBox.h-this.betweenThreshold)){_2d1="After";}}}if(_2cd||_2cf!=_2ce||_2d1!=_2d0){if(_2ce){this._removeItemClass(_2ce.rowNode,_2d0);}if(_2cf){this._addItemClass(_2cf.rowNode,_2d1);}if(!_2cf){m.canDrop(false);}else{if(_2cf==this.tree.rootNode&&_2d1!="Over"){m.canDrop(false);}else{var _2d2=false;if(m.source==this){for(var _2d3 in this.selection){var _2d4=this.selection[_2d3];if(_2d4.item===_2cf.item){_2d2=true;break;}}}if(_2d2){m.canDrop(false);}else{if(this.checkItemAcceptance(_2cf.rowNode,m.source,_2d1.toLowerCase())&&!this._isParentChildDrop(m.source,_2cf.rowNode)){m.canDrop(true);}else{m.canDrop(false);}}}}this.targetAnchor=_2cf;this.dropPosition=_2d1;}},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}this.inherited(arguments);var m=_2c8.manager();if(this.isDragging){this._onDragMouse(e);}else{if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>=this.dragThreshold||Math.abs(e.pageY-this._lastY)>=this.dragThreshold)){var _2d5=this.getSelectedTreeNodes();if(_2d5.length){if(_2d5.length>1){var seen=this.selection,i=0,r=[],n,p;nextitem:while((n=_2d5[i++])){for(p=n.getParent();p&&p!==this.tree;p=p.getParent()){if(seen[p.id]){continue nextitem;}}r.push(n);}_2d5=r;}_2d5=_2c1.map(_2d5,function(n){return n.domNode;});m.startDrag(this,_2d5,this.copyState(_2c2.isCopyKey(e)));this._onDragMouse(e,true);}}}},onMouseDown:function(e){this.mouseDown=true;this.mouseButton=e.button;this._lastX=e.pageX;this._lastY=e.pageY;this.inherited(arguments);},onMouseUp:function(e){if(this.mouseDown){this.mouseDown=false;this.inherited(arguments);}},onMouseOut:function(){this.inherited(arguments);this._unmarkTargetAnchor();},checkItemAcceptance:function(){return true;},onDndSourceOver:function(_2d6){if(this!=_2d6){this.mouseDown=false;this._unmarkTargetAnchor();}else{if(this.isDragging){var m=_2c8.manager();m.canDrop(false);}}},onDndStart:function(_2d7,_2d8,copy){if(this.isSource){this._changeState("Source",this==_2d7?(copy?"Copied":"Moved"):"");}var _2d9=this.checkAcceptance(_2d7,_2d8);this._changeState("Target",_2d9?"":"Disabled");if(this==_2d7){_2c8.manager().overSource(this);}this.isDragging=true;},itemCreator:function(_2da){return _2c1.map(_2da,function(node){return {"id":node.id,"name":node.textContent||node.innerText||""};});},onDndDrop:function(_2db,_2dc,copy){if(this.containerState=="Over"){var tree=this.tree,_2dd=tree.model,_2de=this.targetAnchor;this.isDragging=false;var _2df;var _2e0;var _2e1;_2df=(_2de&&_2de.item)||tree.item;if(this.dropPosition=="Before"||this.dropPosition=="After"){_2df=(_2de.getParent()&&_2de.getParent().item)||tree.item;_2e0=_2de.getIndexInParent();if(this.dropPosition=="After"){_2e0=_2de.getIndexInParent()+1;_2e1=_2de.getNextSibling()&&_2de.getNextSibling().item;}else{_2e1=_2de.item;}}else{_2df=(_2de&&_2de.item)||tree.item;}var _2e2;_2c1.forEach(_2dc,function(node,idx){var _2e3=_2db.getItem(node.id);if(_2c1.indexOf(_2e3.type,"treeNode")!=-1){var _2e4=_2e3.data,_2e5=_2e4.item,_2e6=_2e4.getParent().item;}if(_2db==this){if(typeof _2e0=="number"){if(_2df==_2e6&&_2e4.getIndexInParent()<_2e0){_2e0-=1;}}_2dd.pasteItem(_2e5,_2e6,_2df,copy,_2e0,_2e1);}else{if(_2dd.isItem(_2e5)){_2dd.pasteItem(_2e5,_2e6,_2df,copy,_2e0,_2e1);}else{if(!_2e2){_2e2=this.itemCreator(_2dc,_2de.rowNode,_2db);}_2dd.newItem(_2e2[idx],_2df,_2e0,_2e1);}}},this);this.tree._expandNode(_2de);}this.onDndCancel();},onDndCancel:function(){this._unmarkTargetAnchor();this.isDragging=false;this.mouseDown=false;delete this.mouseButton;this._changeState("Source","");this._changeState("Target","");},onOverEvent:function(){this.inherited(arguments);_2c8.manager().overSource(this);},onOutEvent:function(){this._unmarkTargetAnchor();var m=_2c8.manager();if(this.isDragging){m.canDrop(false);}m.outSource(this);this.inherited(arguments);},_isParentChildDrop:function(_2e7,_2e8){if(!_2e7.tree||_2e7.tree!=this.tree){return false;}var root=_2e7.tree.domNode;var ids=_2e7.selection;var node=_2e8.parentNode;while(node!=root&&!ids[node.id]){node=node.parentNode;}return node.id&&ids[node.id];},_unmarkTargetAnchor:function(){if(!this.targetAnchor){return;}this._removeItemClass(this.targetAnchor.rowNode,this.dropPosition);this.targetAnchor=null;this.targetBox=null;this.dropPosition=null;},_markDndStatus:function(copy){this._changeState("Source",copy?"Copied":"Moved");}});return _2ca;});},"epi/shell/widget/Tree":function(){define("epi/shell/widget/Tree",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom","dijit/focus","dijit/Tree"],function(_2e9,_2ea,lang,dom,_2eb,Tree){return _2ea(Tree,{postCreate:function(){this.inherited(arguments);this.connect(this.model,"onItemChildrenReload","_onChildrenReload");},_onChildrenReload:function(_2ec){var _2ed=this.model.getIdentity(_2ec),_2ee=this._itemNodesMap[_2ed];if(_2ee){if(_2e9.some(_2ee,function(node){return node.state==="LOADED";})){this.model.getChildren(_2ec,lang.hitch(this,function(_2ef){_2e9.forEach(_2ee,function(_2f0){_2f0.setChildItems(_2ef);});_2e9.forEach(_2ef,function(_2f1){this.model.onChange(_2f1);this._onChildrenReload(_2f1);},this);}));}else{_2e9.forEach(_2ee,function(node){node.isExpandable=this.model.mayHaveChildren(node.item);node._setExpando(false);},this);}}},_onItemChildrenChange:function(){var _2f2=null;if(_2eb.curNode&&dom.isDescendant(_2eb.curNode,this.domNode)){_2f2=_2eb.curNode;}this.inherited(arguments);if(_2f2){if(dom.isDescendant(_2f2,this.domNode)){_2f2.focus();}else{var node=this._getRootOrFirstNode();if(node){this.focusNode(node);}}}}});});},"epi-cms/widget/_ContentTreeNode":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/string","dijit/Tree","dijit/_TemplatedMixin","dojox/html/ellipsis","epi-cms/widget/_ContentTreeNodeMixin","dojo/text!./templates/_ContentTreeNode.html"],function(_2f3,_2f4,_2f5,_2f6,Tree,_2f7,_2f8,_2f9,_2fa){return _2f3([Tree._TreeNode,_2f7,_2f9],{templateString:_2fa,buildRendering:function(){this.inherited(arguments);_2f4.add(this.labelNode,"dojoxEllipsis");},_setItemAttr:function(item){this._set("item",item);this.set("dndData",item);if(item&&item.thumbnailUrl){var _2fb=_2f5.create("img",{src:item.thumbnailUrl+_2f6.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"});this.thumbnailNode.appendChild(_2fb);_2f4.add(this.contentNode,"epi-mediaContent");}this.inherited(arguments);}});});},"dojox/html/ellipsis":function(){define("dojox/html/ellipsis",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","dojo/colors"],function(d){if(d.isFF<7){var _2fc=1;if("dojoxFFEllipsisDelay" in d.config){_2fc=Number(d.config.dojoxFFEllipsisDelay);if(isNaN(_2fc)){_2fc=1;}}try{var _2fd=(function(){var sNS="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";var xml=document.createElementNS(sNS,"window");var _2fe=document.createElementNS(sNS,"description");_2fe.setAttribute("crop","end");xml.appendChild(_2fe);return function(n){var x=xml.cloneNode(true);x.firstChild.setAttribute("value",n.textContent);n.innerHTML="";n.appendChild(x);};})();}catch(e){}var _2ff=d.create;var dd=d.doc;var dp=d.place;var _300=_2ff("iframe",{className:"dojoxEllipsisIFrame",src:"javascript:'<html><head><script>if(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}</script></head><body></body></html>'",style:{display:"none"}});var _301=function(r,cnt){if(r.collapsed){return;}if(cnt>0){do{_301(r);cnt--;}while(cnt);return;}if(r.endContainer.nodeType==3&&r.endOffset>0){r.setEnd(r.endContainer,r.endOffset-1);}else{if(r.endContainer.nodeType==3){r.setEndBefore(r.endContainer);_301(r);return;}else{if(r.endOffset&&r.endContainer.childNodes.length>=r.endOffset){var _302=r.endContainer.childNodes[r.endOffset-1];if(_302.nodeType==3){r.setEnd(_302,_302.length-1);}else{if(_302.childNodes.length){r.setEnd(_302,_302.childNodes.length);_301(r);return;}else{r.setEndBefore(_302);_301(r);return;}}}else{r.setEndBefore(r.endContainer);_301(r);return;}}}};var _303=function(n){var c=_2ff("div",{className:"dojoxEllipsisContainer"});var e=_2ff("div",{className:"dojoxEllipsisShown",style:{display:"none"}});n.parentNode.replaceChild(c,n);c.appendChild(n);c.appendChild(e);var i=_300.cloneNode(true);var ns=n.style;var es=e.style;var _304;var _305=function(){ns.display="";es.display="none";if(n.scrollWidth<=n.offsetWidth){return;}var r=dd.createRange();r.selectNodeContents(n);ns.display="none";es.display="";var done=false;do{var _306=1;dp(r.cloneContents(),e,"only");var sw=e.scrollWidth,ow=e.offsetWidth;done=(sw<=ow);var pct=(1-((ow*1)/sw));if(pct>0){_306=Math.max(Math.round(e.textContent.length*pct)-1,1);}_301(r,_306);}while(!r.collapsed&&!done);};i.onload=function(){i.contentWindow.onresize=_305;_305();};c.appendChild(i);};var hc=d.hasClass;var doc=d.doc;var s,fn,opt;if(doc.querySelectorAll){s=doc;fn="querySelectorAll";opt=".dojoxEllipsis";}else{if(doc.getElementsByClassName){s=doc;fn="getElementsByClassName";opt="dojoxEllipsis";}else{s=d;fn="query";opt=".dojoxEllipsis";}}fx=function(){d.forEach(s[fn].apply(s,[opt]),function(n){if(!n||n._djx_ellipsis_done){return;}n._djx_ellipsis_done=true;if(_2fd&&n.textContent==n.innerHTML&&!hc(n,"dojoxEllipsisSelectable")){_2fd(n);}else{_303(n);}});};d.addOnLoad(function(){var t=null;var c=null;var _307=function(){if(c){d.disconnect(c);c=null;}if(t){clearTimeout(t);}t=setTimeout(function(){t=null;fx();c=d.connect(d.body(),"DOMSubtreeModified",_307);},_2fc);};_307();});}});},"dojo/colors":function(){define("dojo/colors",["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(dojo,lang,_308,_309){var _30a={};lang.setObject("dojo.colors",_30a);var _30b=function(m1,m2,h){if(h<0){++h;}if(h>1){--h;}var h6=6*h;if(h6<1){return m1+(m2-m1)*h6;}if(2*h<1){return m2;}if(3*h<2){return m1+(m2-m1)*(2/3-h)*6;}return m1;};dojo.colorFromRgb=_308.fromRgb=function(_30c,obj){var m=_30c.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(m){var c=m[2].split(/\s*,\s*/),l=c.length,t=m[1],a;if((t=="rgb"&&l==3)||(t=="rgba"&&l==4)){var r=c[0];if(r.charAt(r.length-1)=="%"){a=_309.map(c,function(x){return parseFloat(x)*2.56;});if(l==4){a[3]=c[3];}return _308.fromArray(a,obj);}return _308.fromArray(c,obj);}if((t=="hsl"&&l==3)||(t=="hsla"&&l==4)){var H=((parseFloat(c[0])%360)+360)%360/360,S=parseFloat(c[1])/100,L=parseFloat(c[2])/100,m2=L<=0.5?L*(S+1):L+S-L*S,m1=2*L-m2;a=[_30b(m1,m2,H+1/3)*256,_30b(m1,m2,H)*256,_30b(m1,m2,H-1/3)*256,1];if(l==4){a[3]=c[3];}return _308.fromArray(a,obj);}}return null;};var _30d=function(c,low,high){c=Number(c);return isNaN(c)?high:c<low?low:c>high?high:c;};_308.prototype.sanitize=function(){var t=this;t.r=Math.round(_30d(t.r,0,255));t.g=Math.round(_30d(t.g,0,255));t.b=Math.round(_30d(t.b,0,255));t.a=_30d(t.a,0,1);return this;};_30a.makeGrey=_308.makeGrey=function(g,a){return _308.fromArray([g,g,g,a]);};lang.mixin(_308.named,{"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"blanchedalmond":[255,235,205],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"oldlace":[253,245,230],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"whitesmoke":[245,245,245],"yellowgreen":[154,205,50]});return _308;});},"epi-cms/widget/_ContentTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","epi-cms/ContentLanguageHelper"],function(_30e,lang,when,_30f,_310,_311,_312){return _30e(null,{_missingLanguageCssClass:"epi-ct-missingLanguageRow",_updateItemClasses:function(item){this.inherited(arguments);this._updateLayout();},_updateLayout:function(){this.inherited(arguments);this._updateLanguageIndicator();this._updateIndividualLayout();},_updateIndividualLayout:function(){},_addLanguageIndicator:function(){var _313=this.item.missingLanguageBranch;if(this.iconNodeLanguage){this.iconNodeLanguage.innerHTML=_313.language||"";when(_312.getMissingLanguageMessage(this.item),lang.hitch(this,function(_314){_30f.set(this.iconNodeLanguage,"title",_314||"");}));}_310.add(this.rowNode,this._missingLanguageCssClass);},_removeLanguageIndicator:function(){if(this.iconNodeLanguage){_311.empty(this.iconNodeLanguage);_30f.remove(this.iconNodeLanguage,"title");}_310.remove(this.rowNode,this._missingLanguageCssClass);},_updateLanguageIndicator:function(){if(!this._isTypeOfRoot()&&this.item.missingLanguageBranch){this._addLanguageIndicator();}else{this._removeLanguageIndicator();}},_isTypeOfRoot:function(){if(!this.tree.model||typeof this.tree.model.isTypeOfRoot!=="function"){return false;}return this.tree.model.isTypeOfRoot(this.item);}});});},"epi-cms/ContentLanguageHelper":function(){define("epi-cms/ContentLanguageHelper",["dojo/_base/lang","dojo/_base/declare","dojo/_base/Deferred","dojo/promise/all","epi/dependency","epi/shell/TypeDescriptorManager"],function(lang,_315,_316,all,_317,_318){return {getMissingLanguageMessage:function(_319){if(!_319||!_319.missingLanguageBranch){return "";}this._languageStore=this._languageStore||_317.resolve("epi.storeregistry").get("epi.cms.language");var def=new _316();var _31a=_319.missingLanguageBranch;all([this._languageStore.get(_31a.preferredLanguage),this._languageStore.get(_31a.language)]).then(lang.hitch(this,function(_31b){var _31c=_31a.reason;var _31d="languagenotifications.";if(_31c===6){_31d+="missing";}else{if(_31c===3||_31c===5){_31d+="replacement";}else{if(_31c===4){_31d+="fallback";}}}var _31e=_318.getResourceValue(_319.typeIdentifier,_31d);_31e=lang.replace(_31e,[_31b[0].name,_31b[1].name]);def.resolve(_31e);}),function(){def.resolve("");});return def;}};});},"url:epi-cms/widget/templates/_ContentTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <a href=\"#\" tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>            \r\n            <span data-dojo-attach-point=\"thumbnailNode\" class=\"epi-thumbnailIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </a>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/ContentTreeModelConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/string","dojo/when","dojo/_base/json","dojox/html/entities","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree"],function(_31f,lang,_320,_321,_322,when,json,_323,_324,_325,_326,_327,_328,_329,_32a,res){return function(_32b){var _32c=function(_32d){return _32d&&typeof _32d=="function";};var _32e=function(_32f,_330){var _331=new _327({destroyOnHide:true,description:_325.toHTML(_32f),onAction:function(){if(_32c(_330)){_330();}}});_331.show();};var _332=function(_333,_334){var _335=new _321();when(_334,function(_336){var _337=new _328({destroyOnHide:true,description:_325.toHTML(_336),title:_333,onAction:function(_338){_338?_335.resolve():_335.cancel();}});_337.show();});return _335;};var _339=function(_33a,_33b){when(_33a,function(_33c){if(_33c&&(_33c.message||_33c.statusDescription)){var _33d=_33c.message||_33c.statusDescription;_32e(_33d,_33b);}else{if(_32c(_33b)){_33b();}}},function(e){_32e(_323.encode(json.fromJson(e.xhr.responseText)));});return _33a;};_320.around(_32b,"pasteItem",function(_33e){return function(_33f,_340,_341,copy,_342){var _343=_326.getResourceValue(_33f.typeIdentifier,"move");var _344=true;if(_341.isWastebasket){_344=_32a({contentData:_33f});}else{if(_342!==undefined&&(_341.properties.pageChildOrderRule!==_329.sortOrder.Index)){var _345=_322.substitute(res.changepeerorderconfirmation,[_32b.getLabel(_341)]);_344=_332(_343,_345);}else{if(!copy){if(!_32b.canCut(_33f)){_32e(_326.getResourceValue(_33f.typeIdentifier,"moverequiresdeleteaccess"),function(){return false;});return;}_344=_332(_343,_326.getResourceValue(_33f.typeIdentifier,"moveconfirmation"));}else{if(!_32b.canCopy(_33f)){_32e(_326.getResourceValue(_33f.typeIdentifier,"copynotsupported"));return;}}}}var _346=arguments;return when(_344,function(){return _33e.apply(_32b,_346);},function(){return false;});};});_320.after(_32b,"pasteItem",function(_347){return _347&&_339(_347);});_320.after(_32b,"remove",function(_348){return _348&&_339(_348);});return _32b;};});},"epi-cms/contentediting/ContentActionSupport":function(){define(["epi/i18n!epi/cms/nls/episerver.cms.versionstatus"],function(res){var _349=[];if(res){_349=[res.notcreated,res.rejected,res.checkedout,res.checkedin,res.published,res.previouslypublished,res.delayedpublish,res.expired];}var _34a={versionStatus:{NotCreated:0,Rejected:1,CheckedOut:2,CheckedIn:3,Published:4,PreviouslyPublished:5,DelayedPublish:6,Expired:7},versionLocalizations:_349,getVersionStatus:function(_34b){return this.versionLocalizations[_34b];},action:{Create:"Create",Edit:"Edit",Delete:"Delete",CheckIn:"CheckIn",Save:"Save",Reject:"Reject",Publish:"Publish",Administer:"Administer"},accessLevel:{NoAccess:0,Read:1,Create:2,Edit:4,CheckIn:4,Delete:8,Publish:16,Administer:32,FullAccess:63},saveAction:{None:0,Save:1,CheckIn:2,Publish:3,Reject:4,ForceNewVersion:128,ForceCurrentVersion:256,SkipValidation:512,DelayedPublish:1024},sortOrder:{None:0,CreatedDescending:1,CreatedAscending:2,Alphabetical:3,Index:4,ChangedDescending:5,Rank:6,PublishedAscending:7,PublishedDescending:8},providerCapabilities:{None:0,Create:1,Edit:2,Delete:4,Move:8,Copy:16,MultiLanguage:32,Security:64,Search:128,PageFolder:256,Wastebasket:512},isActionAvailable:function(_34c,_34d,_34e,_34f,_350){if(!_34c){return false;}if(!_34f&&_34c.capabilities&&_34c.capabilities.language&&_34c.missingLanguageBranch&&_34c.missingLanguageBranch.isTranslationNeeded){return false;}var _351=_350?_34c.accessRights:_34c.accessMask;var _352=_34a.hasAccess(_351,_34a.accessLevel[_34d])&&_34a.canPerformAction(_34c,_34d);if(_34e){_352=_352&&_34a.hasProviderCapability(_34c.providerCapabilityMask,_34e);}return _352;},canPerformAction:function(_353,_354){if(_353.status===_34a.versionStatus.DelayedPublish&&(_354===_34a.action.Edit||_354===_34a.action.Publish)){return false;}if(_354===_34a.action.Publish){return !(_353.status===_34a.versionStatus.Published||_353.status===_34a.versionStatus.Expired);}if(_354===_34a.action.CheckIn){return _353.status===_34a.versionStatus.CheckedOut||_353.status===_34a.versionStatus.Rejected;}if(_354===_34a.action.Edit){var _355=(_353.status===_34a.versionStatus.Published&&!_353.isCommonDraft)||(_353.status===_34a.versionStatus.Expired&&!_353.isCommonDraft)||_353.status===_34a.versionStatus.PreviouslyPublished||_353.status===_34a.versionStatus.CheckedIn||_353.status===_34a.versionStatus.DelayedPublish;return !(_355||_353.isDeleted||_353.isWastebasket);}return true;},hasAccess:function(_356,_357){return (_356&_357)==_357;},hasLanguageAccess:function(item){if(!item){return false;}var _358=item.languageContext||item.missingLanguageBranch||item;return !_358||(_358.hasTranslationAccess&&_358.isPreferredLanguageAvailable);},getPermissionMap:function(_359){var map={};for(var al in _34a.accessLevel){map[al]=_34a.hasAccess(_359,_34a.accessLevel[al]);}return map;},hasProviderCapability:function(_35a,_35b){return (_35a&_35b)==_35b;}};return _34a;});},"epi-cms/widget/sharedContentDialogHandler":function(){define(["dojo/_base/lang","dojo/Deferred","dojo/when","dojox/html/entities","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/DelayableStandby","epi-cms/widget/ContentReferences","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences"],function(lang,_35c,when,_35d,epi,_35e,_35f,_360,_361,_362,_363){var _364=function(_365){var _366=new _35c(),_367=_365.contentData.contentLink,_368=_35e.resolve("epi.storeregistry"),_369=_368.get("epi.cms.content.search"),_36a=new _361({target:document.body,zIndex:999}).placeAt(document.body);_36a.show(50,0);when(_369.get(_367),function(_36b){var mode=_365.mode||_364.mode.confirm,_36c=mode===_364.mode.confirm,_36d=new _362({model:{contentData:_36b,mode:mode}});var _36e=_36d.watch("numberOfReferences",function(_36f,_370,_371){_36e.remove();var _372;if(_36c){var key=_36b.hasChildren?"movetotrashwithsubcontentdescription":"movetotrashdescription";_372=_35f.getResourceValue(_36b.typeIdentifier,key);}else{_372=_35f.getResourceValue(_36b.typeIdentifier,"referencesdescription");}_372=lang.replace(_372,[_35d.encode(_36b.name)]);var _373=_365.title;if(!_373){var _374=_36c?"movetotrash":"references";_373=_35f.getResourceValue(_36b.typeIdentifier,_374);}var _375=new _360({focusActionsOnLoad:true,destroyOnHide:true,defaultActionsVisible:_36c,dialogClass:"epi-dialog-contentReferences",title:_373,description:_372,cancelActionText:epi.resources.action.cancel,confirmActionText:_371===0?_363.buttons.movetotrash:_363.buttons.movetotrashanyway,setFocusOnConfirmButton:_371===0});if(!_36c){_375.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:_375.onCancel});}_375.connect(_375,"onExecute",_366.resolve);_375.connect(_375,"onCancel",_366.cancel);_375.set("content",_36d);var _376=_36d.on("viewReference",function(){_375.hide();_376.remove();});_36a.hide();_375.show();});_36d.startup();});return _366.promise;};_364.mode={confirm:"confirm",show:"show"};return _364;});},"epi-cms/widget/ContentReferences":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/keys","dojo/when","epi-cms/dgrid/formatters","epi/shell/TypeDescriptorManager","./_GridWidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/Evented","dojo/text!./templates/ContentReferences.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","dijit/form/Button"],function(_377,lang,_378,_379,_37a,keys,when,_37b,_37c,_37d,_37e,_37f,_380,_381,_382){return _377([_37d,_37e,_37f,_380],{res:_382,templateString:_381,storeKeyName:"epi.cms.contentreferences",contextChangeEvent:"dblclick",trackActiveItem:false,ignoreVersionWhenComparingLinks:false,_setTotalLinksAttr:{node:"totalLinksNode",type:"innerText"},_setNotificationAttr:{node:"contentReferencesNotificationNode",type:"innerText"},_setNotificationBarStyleAttr:function(_383){switch(_383){case 1:_378.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorOk");break;case 2:_378.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorWarning");break;}},_setNumberOfReferencesAttr:function(_384){var _385=this.model.contentData,_386=_384>0;var _387=lang.hitch(this,function(_388,_389){var text=_37c.getResourceValue(_385.typeIdentifier,_388);this.set("notification",text);this.set("notificationBarStyle",_389);});if(_386){if(_385.hasChildren){_387("referenceswithsubcontentwarning",2);}else{_387("referenceswarning",2);}}else{if(_385.hasChildren){_387("noreferenceswithsubcontentwarning",null);}else{if(_385.publicUrl){_387("publicreferencesnote",null);}else{_387("noreferencesnote",1);}}}if(_386){var _38a=_384===1?_382.totallink:_382.totallinks;var _38b=lang.replace(_38a,[_384]);this.set("totalLinks",_38b);}this._set("numberOfReferences",_384);},_setShowToolbarAttr:function(_38c){_37a.set(this.captionPanelNode,"display",_38c?"":"none");},buildRendering:function(){var _38d=this._getLinkTemplate();var _38e=lang.mixin({columns:{name:{renderCell:lang.hitch(this,"_renderContentItem")},treePath:{className:"epi-width50",get:function(item){return item.treePath.join("<span class=\"epi-breadCrumbsSeparator\">&gt;</span>");},ellipsisNoTooltip:true},view:{className:"epi-width10",label:" ",formatter:function(){return _38d;},sortable:false}},store:this.store,query:{id:this.model.contentData.contentLink},showHeader:false},this.defaultGridMixin);this.inherited(arguments);this.grid=new this._gridClass(_38e,this.gridNode);_378.toggle(this.contentReferencesNotificationBar,"dijitHidden",this.model.mode=="show");},startup:function(){this.inherited(arguments);this.grid.on(".dgrid-column-view a:click",lang.hitch(this,"_onChangeContext"));this.grid.on("dgrid-refresh-complete",lang.hitch(this,"_afterDataFetched"));},fetchData:function(){this.grid.refresh();},_afterDataFetched:function(e){when(e.results.total,lang.hitch(this,function(_38f){this.set("numberOfReferences",_38f);this.set("showToolbar",_38f>0);_37a.set(this.grid.domNode,"visibility",(_38f>0)?"visible":"hidden");}));},_onChangeContext:function(e){var row=this.grid.row(e),_390={uri:row.data.uri};this._requestNewContext(_390,{sender:this});this.emit("viewReference");},_getLinkTemplate:function(){var node=_379.create("a",{"class":"epi-visibleLink",innerHTML:_382.view.label,title:_382.view.tooltip});return node.outerHTML;}});});},"epi-cms/dgrid/formatters":function(){define(["dojo/_base/lang","dojo/dom-class","dojo/string","epi/datetime","epi/dependency","epi/username","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport"],function(lang,_391,_392,_393,_394,_395,_396,misc,_397,_398){var _399={defaultIconClass:"epi-iconObjectUnknown",thumbnail:function(_39a){var _39b="<image src=\"{0}?{1}\" class=\"epi-floatLeft epi-thumbnail\"/>";return _39a?lang.replace(_39b,[_39a,new Date().getTime()]):"";},contentIcon:function(_39c){var _39d=_397.getValue(_39c,"iconClass");return misc.icon(_39d+" epi-objectIcon");},languageBranch:function(_39e){return _39e?"<span class=\"epi-missingLanguageIndicator\">"+_39e.language+"</span>":"";},menu:function(_39f){return lang.replace("<span class=\"dijitInline dijitIcon epi-iconContextMenu epi-floatRight\" title=\"{title}\">&nbsp;</span>",_39f);},userName:function(_3a0){return _395.toUserFriendlyHtml(_3a0);},localizedDate:function(date){return _393.toUserFriendlyHtml(date);},friendlyBoolean:function(_3a1){var _3a2=_3a1?"epi-iconCheckmark":"epi-iconStop";return "<div class=\""+_3a2+"\" />";},versionStatus:function(_3a3){return _398.getVersionStatus(_3a3);},visibleLink:function(_3a4,_3a5){if(!_3a4){return "";}var text=!_3a5?misc.htmlEncode(_3a4):_3a4;return "<span class=\"epi-visibleLink\">"+text+"</span>";},secondaryText:function(_3a6,_3a7){if(!_3a6){return "";}var text=!_3a7?misc.htmlEncode(_3a6):_3a6;return "<span class=\"epi-secondaryText\">"+text+"</span>";},contentItemFactory:function(_3a8,_3a9,_3aa,_3ab,_3ac,_3ad,_3ae){return function(_3af,_3b0,node,_3b1){var _3b2,_3b3,text,_3b4,_3b5,_3b6,_3b7;function get(name){if(typeof _3b0.get==="function"){return _3b0.get(name);}return _3b0[name];};function _3b8(_3b9){if(_3b9){if(typeof _3b9==="function"){return _3b9(_3b0);}else{return get(_3b9);}}return _3af;};_3b6=typeof _3af==="string";_3b3=_3b8(_3aa||(_3b6?false:"typeIdentifier"));text=_3b8(_3a8||(_3b6?false:"text"));_3b4=_3b8(_3a9||(_3b6?false:"title"));_3b5=(_3ad&&_3b8(_3ad))||_3b0.missingLanguageBranch;_3b7=_3ac&&_3b8(_3ac);_3b2=_399.contentItem(_3b3,_3b5,text,_3b4,_3ab,_3b7,_3ae);node.innerHTML=_3b2;if(node.nodeName!=="TD"&&_3b5){_391.add(node,"epi-ct-missingLanguageRow");}return _3b2;};},contentItem:function(_3ba,_3bb,text,_3bc,_3bd,_3be,_3bf){var menu=(_3bd&&_3bd.hasMenu)?_399.menu(_3bd.settings):"",_3c0=_399.languageBranch(_3bb);_3bf=(_3bf===null||_3bf===undefined)?true:_3bf;_3bc=_3bf?misc.attributeEncode(_3bc||text):(_3bc||text);text=_3bf?misc.htmlEncode(text):text;return (_3be?_399.thumbnail(_3be):_399.contentIcon(_3ba))+menu+_3c0+misc.ellipsis(text,_3bc);}};_396.addFormatter("contentIcon",_399.contentIcon);_396.addFormatter("userName",_399.userName);_396.addFormatter("versionStatus",_399.versionStatus);_396.addFormatter("localizedDate",_399.localizedDate);_396.addFormatter("contentItem",_399.contentItemFactory,true);return _399;});},"epi/username":function(){define("epi/username",["dojo/_base/declare","dojox/html/entities","epi/dependency"],function(_3c1,_3c2,_3c3){var _3c4={toUserFriendlyString:function(_3c5,_3c6,_3c7,_3c8){if(!_3c6){_3c6=this._getCurrentUsername();}var _3c9=_3c8?"":epi.resources.text.installer,_3ca=_3c5&&_3c6.toLowerCase()===_3c5.toLowerCase()?epi.resources.text.you:_3c5||_3c9;if(_3c7){_3ca=_3ca.charAt(0).toUpperCase()+_3ca.slice(1);}return _3ca;},toUserFriendlyHtml:function(_3cb,_3cc,_3cd,_3ce){var _3cf=this.toUserFriendlyString(_3cb,_3cc,_3cd,_3ce);if(_3cf===""){return _3cf;}return "<span class='epi-username'>"+_3c2.encode(_3cf)+"</span>";},_getCurrentUsername:function(){if(!this.currentUsername){var _3d0=_3c3.resolve("epi.shell.Profile");this.currentUsername=_3d0.get("userName");}return this.currentUsername;}};return _3c4;});},"epi/shell/dgrid/Formatter":function(){define("epi/shell/dgrid/Formatter",["dojo/_base/declare","dojo/_base/array","dojo/when","dgrid/Grid","epi/shell/dgrid/TemplateColumn"],function(_3d1,_3d2,when,Grid,_3d3){var _3d4=_3d1(null,{_isGrid:false,configStructure:function(){this.inherited(arguments);this._isGrid=this instanceof Grid;if(this._isGrid){this._setupTemplateColumns();}else{this._setupList();}},_setupTemplateColumns:function(){if(!this.subRows){return;}var _3d5;_3d2.forEach(this.subRows,function(_3d6){_3d2.forEach(_3d6,function(_3d7){_3d5=[];_3d2.forEach(_3d4.shorthands,function(_3d8){var _3d9=_3d7[_3d8],_3da=_3d4.formatters[_3d8];if(!!_3d9){if(_3da){_3d5.push(_3da.isFactory?_3da.handler(_3d9):_3da.handler);}else{throw new Error("Formatter with key "+_3d8+" not found");}}});if(_3d7.formatters){this._findFormatters(_3d7.formatters,_3d5);}if(_3d5.length>0){_3d7=_3d3(_3d7,_3d5);}},this);},this);},_setupList:function(){if(this.formatters){this._resolvedFormatters=this._findFormatters(this.formatters);}else{if(this.field){this._resolvedFormatters=[function(data,_3db,row){return data;}];}}},renderRow:function(_3dc,_3dd){if(this._isGrid){return this.inherited(arguments);}var row=this.inherited(arguments,["",_3dd]),data=this.field?_3dc[this.field]:_3dc,_3de=this._resolvedFormatters,i=-1;function _3df(_3e0){var _3e1=_3de[i],_3e2;if(_3e1){row.innerHTML=_3e0;data=_3e0;}i++;if(_3de.length>i){_3e1=_3de[i];_3e2=_3e1(data,_3dc,row);when(_3e2,_3df);}};if(_3de.length>0){_3df();}return row;},_findFormatters:function(_3e3,_3e4){_3e4=_3e4||[];_3d2.forEach(_3e3,function(_3e5){var type=typeof _3e5,item,_3e6;if(type==="string"){item=_3d4.formatters[_3e5];if(item){_3e6=item.isFactory?item.handler():item.handler;_3e6.allParameters=item.allParameters;}}else{if(type==="function"){_3e6=_3e5;}}if(_3e6){_3e4.push(_3e6);}else{throw new Error("Formatter with key "+_3e5+"not found");}});return _3e4;}});_3d4.formatters={};_3d4.shorthands=[];_3d4.addFormatter=function(name,_3e7,_3e8,_3e9){_3d4.formatters[name]={handler:_3e7,isFactory:!!_3e8};if(_3e9){_3d4.shorthands.push(name);}};return _3d4;});},"epi/shell/dgrid/TemplateColumn":function(){define("epi/shell/dgrid/TemplateColumn",["dojo/_base/array"],function(_3ea){return function(_3eb,_3ec){var _3ed=_3eb.renderCell;_3eb.formatters=_3ec||_3eb.formatters;if(_3eb.formatters&&_3eb.formatters.length>0){_3eb.renderCell=function(_3ee,_3ef,cell,_3f0){_3ea.forEach(_3eb.formatters,function(_3f1){_3ef=_3f1(_3ef,_3ee,cell,_3f0);});if(_3ef){cell.innerHTML=_3ef;}};}return _3ed?_3ed.call(_3eb,object,value,cell,options):_3eb;};});},"epi/shell/dgrid/util/misc":function(){require({cache:{"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}"}});define("epi/shell/dgrid/util/misc",["dojo/_base/declare","dojo/_base/lang","dojox/html/entities","epi/shell/dgrid/Formatter","dojo/text!dojox/html/resources/ellipsis.css"],function(_3f2,lang,_3f3,_3f4,_3f5){var _3f6={_attributeEncodeMap:[["&","amp"],["\"","quot"]],htmlEncode:function(text){return _3f3.encode(text);},attributeEncode:function(text){return _3f3.encode(text,_3f6._attributeEncodeMap);},ellipsis:function(text,_3f7){if(!_3f7||!lang.isString(_3f7)){_3f7=text;}return lang.replace("<div class=\"dojoxEllipsis\" title=\"{0}\">{1}</div>",[_3f7,text]);},ellipsisNoTooltip:function(text){return lang.replace("<div class=\"dojoxEllipsis\">{0}</div>",[text]);},icon:function(icon,text){text=text||"";return lang.replace("<span class=\"dijitInline dijitIcon {0}\"></span>{1}",[icon,text]);}};_3f4.addFormatter("htmlEncode",_3f6.htmlEncode,false,true);_3f4.addFormatter("icon",function(icon){return function(_3f8){return _3f6.icon(icon,_3f8);};},true,true);_3f4.addFormatter("ellipsis",_3f6.ellipsis,false,true);_3f4.addFormatter("ellipsisNoTooltip",_3f6.ellipsisNoTooltip,false,true);return _3f6;});},"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}","epi-cms/widget/_GridWidgetBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/keys","dojo/topic","dojo/when","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dijit/layout/_LayoutWidget","epi","epi/datetime","epi/UriParser","epi/username","epi/shell/dgrid/Formatter","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi/dependency"],function(_3f9,lang,_3fa,_3fb,keys,_3fc,when,_3fd,_3fe,_3ff,_400,epi,_401,_402,_403,_404,_405,_406,_407,DnD,_408,_409,_40a){return _3f9([_400,_406],{_gridClass:_3f9([_3fe,_404,_3ff,DnD,_3fd,_409]),storeKeyName:null,grid:null,store:null,ignoreVersionWhenComparingLinks:true,trackActiveItem:true,defaultGridMixin:null,currentItem:null,contextChangeEvent:"click",postMixInProperties:function(){this.inherited(arguments);this.defaultGridMixin={selectionMode:"single",dndParams:{creator:lang.hitch(this,this._dndNodeCreator),copyOnly:true,selfAccept:false}};if(!this.store&&this.storeKeyName){var _40b=_40a.resolve("epi.storeregistry");this.store=_40b.get(this.storeKeyName);}},startup:function(){this.inherited(arguments);if(this.contextChangeEvent){var _40c=lang.hitch(this,"_onChangeContext");this.grid.on(".dgrid-row:"+this.contextChangeEvent,_40c);if(typeof this.grid.addKeyHandler=="function"){this.grid.addKeyHandler(keys.ENTER,_40c);this.grid.addKeyHandler(keys.SPACE,_40c);}}this.grid.on("dgrid-select",lang.hitch(this,"_onSelect"));this.grid.on("dgrid-error",lang.hitch(this,"_onError"));if(this.trackActiveItem){this.own(_3fa.after(this.grid,"insertRow",lang.hitch(this,this._selectActiveItem)));}this.own(this.connect(this,"layout",lang.hitch(this,function(){this.grid.resize();})));this.grid.startup();},destroy:function(){if(this.grid){this.grid.destroy();}this.inherited(arguments);},select:function(item){this.grid.clearSelection();if(item){var _40d=(item instanceof _407?item:new _407(item.id)).createVersionUnspecificReference().toString();this.grid.select(_40d);}},_forceKeepContext:function(uri){return this._isSameAsCurrentContext(uri);},_onChangeContext:function(e){var row=this.grid.row(e),uri=row.data.uri,_40e={uri:uri};if(this._forceKeepContext(uri)){return;}this._requestNewContext(_40e,{sender:this});},_onSelect:function(e){},_onError:function(_40f){var _410=this.grid.errorMessage;if(_40f.status&&_40f.status===403){_410=epi.resources.messages.nopermissiontoviewdata;}this._showErrorMessage(_410);},_requestNewContext:function(_411,_412){_3fc.publish("/epi/shell/context/request",_411,_412);},restore:function(){this.resize();},_isActiveItem:function(row){return when(this.getCurrentContext(),lang.hitch(this,function(_413){var _414=row.data.uri;return _413&&this._compareUris(_414,_413.uri);}));},_selectActiveItem:function(node){var row=this.grid.row(node);if(!row){return node;}when(this._isActiveItem(row),lang.hitch(this,function(_415){if(_415){if(this.grid.selectionMode==="single"){this.grid.clearSelection();}this.grid.select(row,null);}}));return node;},contextChanged:function(_416,_417){this.inherited(arguments);if(_416.type!=="epi.cms.contentdata"){return;}if(!_417||_417.sender!=this){this.onContextChanged(_416);}},onContextChanged:function(_418){this.fetchData();},fetchData:function(){},_showErrorMessage:function(_419){this.grid.cleanup();this.grid.contentNode.innerHTML=_419||"";},contextChangeFailed:function(_41a,_41b,_41c){this.inherited(arguments);if(_41c&&_41c.sender===this){this._selectActiveItem();}},_renderContentItem:function(_41d,_41e,node,_41f){node.innerHTML=_408.contentItem(_41d.typeIdentifier,_41d.missingLanguageBranch,_41e);},_localizeDate:function(_420){return _408.localizedDate(_420);},_createUserFriendlyUsername:function(name){return _408.userName(name);},_dndNodeCreator:function(item,hint){var _421=_405.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_421&&this.dndTypes){_421=this.dndTypes;}var node=_3fb.create("div").appendChild(document.createTextNode(item.name));return {"node":node,"type":_421,"data":item};},_aroundInsertRow:function(_422){return lang.hitch(this,function(_423,_424,_425,i,_426){var row=_422.apply(this.grid,arguments);var _427=this.get("currentItem");if(_427){var _428=(_427 instanceof _407?_427:new _407(_427.id)).createVersionUnspecificReference().toString();if(_428===_423.contentLink){this.select(_427);}}return row;});},_getCurrentItem:function(){return when(this.getCurrentContext(),function(_429){return {"id":(new _407(_429.id)).id};});}});});},"epi-cms/dgrid/DnD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/NodeList","epi/shell/dnd/Source","dojo/dom-construct","epi/dependency","epi/shell/TypeDescriptorManager","put-selector/put"],function(_42a,lang,_42b,_42c,_42d,_42e,_42f,put){var _430=_42a(_42c,{_legalMouseDown:function(evt){var _431=this.inherited(arguments);return _431&&evt.target!=this.grid.bodyNode;},getSelectedNodes:function(){var _432=this.inherited(arguments);if(!this.grid.selection||Object.keys(this.grid.selection).length===0){this.grid.select(_432[0]);return _432;}var _433=false;var _434=new _42b();for(var id in this.grid.selection){if(this.grid.row(id).element!=_432[0]){_434.push(this.grid.row(id).element);}else{_433=true;_434.push(_432[0]);}}if(_433){return _434;}else{this.grid.clearSelection();this.grid.select(_432[0]);return _432;}}});return _42a([],{dndSourceTypes:null,dndParams:null,dndConstructor:_430,dndDisabled:false,postCreate:function(){this.inherited(arguments);if(!this.dndDisabled){this._setupDnD();}},insertRow:function(_435){var row=this.inherited(arguments);if(this.dndDisabled){return row;}put(row,".dojoDndItem");this._setupDnD();var opts={};if(this.query){opts.oldParentItem={contentLink:this.query.referenceId};}this.dndSource.setItem(row.id,{data:_435,type:this._getDndType(_435),options:opts});return row;},_getDndType:function(_436){var _437=_42f.getAndConcatenateValues(_436.typeIdentifier,"dndTypes");if((!_437||_437.length<=0)&&this.dndSourceTypes){_437=this.dndSourceTypes;}return _437;},_setupDnD:function(){if(this.dndSource){return;}if(!this.dndParams.creator){this.dndParams.creator=lang.hitch(this,this._dndNodeCreator);}this.dndSource=new (this.dndConstructor)(this.bodyNode,lang.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));this.dndSource.singular=true;},_dndNodeCreator:function(item,hint){var _438,node;if(item.typeIdentifier){_438=_42f.getAndConcatenateValues(item.typeIdentifier,"dndTypes");}if(!_438&&this.dndTypes){_438=this.dndTypes;}node=_42d.create("div").appendChild(document.createTextNode(item.name));return {"node":node,"type":_438,"data":item};}});});},"epi-cms/dgrid/WithContextMenu":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi/shell/widget/ContextMenu","epi/shell/DestroyableByKey"],function(_439,lang,_43a,_43b,_43c){return _439([_43c],{contextMenu:null,postCreate:function(){this.inherited(arguments);this.contextMenu=this.contextMenu||new _43b({category:"context"});this.ownByKey(this.contextMenu,this.contextMenu);this._setupGridEvents();},startup:function(){this.inherited(arguments);this.contextMenu.startup();},_setupGridEvents:function(){this.ownByKey("contextMenuClick",this.on(".epi-iconContextMenu:click",lang.hitch(this,this.onContextMenuClick)));},onContextMenuClick:function(e){this.contextMenu.scheduleOpen(this,null,{x:e.pageX,y:e.pageY});}});});},"epi/shell/widget/ContextMenu":function(){define("epi/shell/widget/ContextMenu",["dojo/_base/declare","dijit/Menu","epi/shell/command/_CommandConsumerMixin","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuWithSeparatorBuilder"],function(_43d,Menu,_43e,_43f,_440,_441){return _43d([Menu,_43e],{category:null,leftClickToOpen:true,postCreate:function(){this.inherited(arguments);var _442={builder:new _440(),target:this,category:this.category},_443,_444;_443=[_442,{builder:new _441(),target:this,category:"menuWithSeparator"},{builder:new _440(),target:this,category:"popup"}],_444=new _43f({configuration:_443,commandSource:this});_444.build();},scheduleOpen:function(_445,_446,_447){this._scheduleOpen(_445,_446,_447);}});});},"epi/shell/command/builder/MenuWithSeparatorBuilder":function(){define("epi/shell/command/builder/MenuWithSeparatorBuilder",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/MenuSeparator","./MenuBuilder"],function(_448,_449,lang,on,_44a,_44b){return _449([_44b],{_addToContainer:function(_44c,_44d){var _44e=new _44a();_44d.addChild(_44c);_44d.addChild(_44e);}});});},"url:epi-cms/widget/templates/ContentReferences.html":"<div class=\"epi-contentReferences\">\r\n    <div data-dojo-attach-point=\"contentReferencesNotificationBar\" class=\"epi-notificationBar epi-notificationBarWithBorders epi-notificationBarItem\">\r\n        <div data-dojo-attach-point=\"contentReferencesNotificationNode\" class=\"epi-notificationBarText\" ></div>\r\n    </div>\r\n    <div class=\"epi-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\r\n        <strong data-dojo-attach-point=\"totalLinksNode\"></strong>\r\n        <div class=\"epi-floatRight\">\r\n            <button class=\"epi-chromelessButton\"\r\n                    data-dojo-type=\"dijit/form/Button\"\r\n                    data-dojo-attach-event=\"onClick:fetchData\"\r\n                    data-dojo-props=\"iconClass:'epi-iconReload'\">${res.buttons.refresh}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>\r\n","epi-cms/widget/ContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi-cms/widget/ContentTreeStoreModel"],function(_44f,_450,lang,_451,when,_452){return _450([_452],{root:null,constructor:function(){this.root={id:"0",name:"ROOT"};},isRoot:function(_453){var _454=this.inherited(arguments);return _454||!!(_453&&this.roots&&(_44f.indexOf(this.roots,this.getIdentity(_453))>=0));},getRoot:function(_455){_455(this.root);},mayHaveChildren:function(item){return item===this.root||this.inherited(arguments);},getChildren:function(_456,_457,_458){if(_456===this.root){var _459=_44f.map(this.roots,function(item){return this.store.get(item);},this);when(_451(_459),_457,_458);}else{this.inherited(arguments);}},getAncestors:function(item,_45a){if(this.roots.some(function(_45b){return this.getIdentity(item)===_45b;},this)){_45a([this.root]);return;}var root=this.root,_45c=lang.hitch(this,function(_45d){if(_44f.some(this.roots,function(_45e){return this.getIdentity(_45d[0])===_45e;},this)){_45d.unshift(root);}_45a(_45d);});this.inherited(arguments,[item,_45c]);},getIdentity:function(item){return (item===this.root)?this.root.id:this.inherited(arguments);},canCopy:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canCut:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canDelete:function(item){return !this.isTypeOfRoot(item)&&this.inherited(arguments);},canEdit:function(item){return !this.isRoot(item)&&this.inherited(arguments);}});});},"epi-cms/widget/ContentTreeStoreModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/when","dojo/topic","epi/dependency","epi/shell/_StatefulGetterSetterMixin","epi/shell/TypeDescriptorManager","epi/shell/_ContextMixin","epi/shell/ViewSettings","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_HierarchicalModelMixin","epi-cms/widget/viewmodel/_UpdateableStoreModelMixin"],function(_45f,_460,_461,lang,_462,_463,_464,when,_465,_466,_467,_468,_469,_46a,_46b,_46c,_46d,_46e,_46f){return _461([_467,_46e,_46f,_469],{store:null,root:null,notAllowToDelete:null,notAllowToCopy:null,typeIdentifiers:null,showAllLanguages:true,getChildrenQuery:"getchildren",getRootChildrenQuery:null,_observers:null,_defaultDataStoreName:"epi.cms.content.light",additionalQueryOptions:{},createAsLocalAsset:false,constructor:function(args){_461.safeMixin(this,args);this._observers={};this.store=this.store||_466.resolve("epi.storeregistry").get(this._defaultDataStoreName);this._queryOptions=lang.mixin({ignore:["query"],comparers:{"typeIdentifiers":lang.hitch(this,function(_470,_471){return _45f.some(_470,lang.hitch(this,function(item){return item===_471.typeIdentifier||_468.isBaseTypeIdentifier(_471.typeIdentifier,item);}));}),"referenceId":function(_472,_473){return _46d.compareIgnoreVersion(_472,_473.parentLink);},"allLanguages":function(_474,_475){if(_474||!_475.currentLanguageBranch){return true;}return epi.areEqual(_46b.currentContentLanguage,_475.currentLanguageBranch.languageId);}},sort:this._getSortSettings(this.typeIdentifiers)},this.additionalQueryOptions);var _476=_460.subscribe("/epi/cms/contentdata/updated",this,function(_477){this.store.refresh(_477.contentLink).then(lang.hitch(this,function(){if(_477.recursive){this.onItemChildrenReload(_477);}}));});var _478=_460.subscribe("/epi/cms/contentdata/childrenchanged",lang.hitch(this,this._childrenChanged));var _479=_460.subscribe("/epi/cms/contentdata/restored",this,function(_47a){this._childrenChanged(_47a);});var _47b=_462.after(this.store,"onItemChanged",lang.hitch(this,function(id,item){this.onChange(item);}),true);this._handles=[_476,_478,_479,_47b];},destroy:function(){for(var id in this._observers){this._observers[id].cancel();this._observers[id]=null;}if(this._handles){_45f.forEach(this._handles,function(_47c){_47c.remove();});this._handles=null;}},isSupportedType:function(_47d){return _45f.some(this.typeIdentifiers,function(type){return type===_47d||_468.isBaseTypeIdentifier(_47d,type);});},_setShowAllLanguagesAttr:function(_47e){this._set("showAllLanguages",_47e);this.onItemChildrenReload(this.root);},getRoot:function(_47f,_480){if(lang.isArray(this.root)){_47f({});}else{when(this.store.get(this.root),_47f,_480);}},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_481,_482){var id=this.getIdentity(_481),_483=id==this.root,_484=_483&&this.getRootChildrenQuery?this.getRootChildrenQuery:this.getChildrenQuery,_485=this._createQuery({referenceId:id,query:_484}),_486=this.store.query(_485,this._queryOptions),_487=lang.hitch(this,function(item){this.onChange(item);when(this.store.query(_485,this._queryOptions),lang.hitch(this,function(_488){this.onChildrenChange(_481,_488);}));});var _489=this._observers[id];if(_489){_489.cancel();delete this._observers[id];}this._observers[id]=_486.observe(_487,true);when(_486,_482);},_getSortSettings:function(_48a){if(!_48a){return {};}if(_48a instanceof String){_48a=[_48a];}var self=this,_48b,_48c=[];_48a.map(function(type){_48b=_468.getValue(type,"sortKey");if(_48b){_48c.push(_48b.sortDescending?{attribute:_48b.columnName,descending:true}:{attribute:_48b.columnName});}});return _48c;},_createQuery:function(_48d,_48e){var _48f=this.typeIdentifiers&&(lang.isArray(this.typeIdentifiers)?this.typeIdentifiers:this.typeIdentifiers.split(","));var _490=this.showAllLanguages?{allLanguages:true}:{},_491=_48e?{}:{typeIdentifiers:_48f};var _492=lang.mixin(_48d,_491,_490);return _492;},_createChildrenQuery:function(_493,_494){var _495=lang.mixin(_493,{query:"getchildren"});return this._createQuery(_495,_494);},move:function(_496,_497){if(!_497.contentLink){_497=this.store.get(_497);}var _498=_45f.map(_496,function(item){return when(this.store.get(item.data.parentLink),lang.hitch(this,function(_499){return this.pasteItem(item.data,_499,_497,false);}));},this);return _464(_498).then(lang.hitch(this,function(_49a){if(_497.contentLink===_46b.wastebasketPage){var _49b=_496.filter(function(i,_49c){return !!_49a[_49c];});if(_49b.length){this.onDeleted(_49b);}}}));},remove:function(_49d){var _49e=_49d.map(function(item){return this.store.remove(item.data.contentLink);},this);return _464(_49e).then(lang.hitch(this,function(){this.onDeleted(_49d);}));},copy:function(_49f,_4a0){var _4a1=_45f.map(_49f,function(item){return when(this.store.get(item.data.parentLink),lang.hitch(this,function(_4a2){return this.pasteItem(item.data,_4a2,_4a0,true);}));},this);return _464(_4a1);},pasteItem:function(_4a3,_4a4,_4a5,copy,_4a6){var id=this.getIdentity(_4a3),_4a7=_4a5&&_4a5.isWastebasket,_4a8=copy?this.store.copy:this.store.move,_4a9={targetId:this.getIdentity(_4a5),createAsLocalAsset:this.createAsLocalAsset,sortIndex:_4a6};return _4a8.call(this.store,id,_4a9).then(lang.hitch(this,function(_4aa){if(_4a7){this.onDelete(_4a3,true);}else{_465.publish("/epi/cms/contentdata/childrenchanged",_4a5.contentLink);}var _4ab=copy?_4aa.extraInformation:_4a3.contentLink;var _4ac=_46d.toContentReference(_4ab).createVersionUnspecificReference().toString();return when(this.store.refresh(_4ac),lang.hitch(this,function(item){this._onPasteComplete(item,copy,_4a7,_4a4,_4a5);return _4aa;}));}));},onPasteComplete:function(){},_onPasteComplete:function(item,copy,_4ad,_4ae,_4af){this.onPasteComplete();this._selectItemOnPasteComplete(item,copy,_4ad,_4ae,_4af);this.inherited(arguments);},_selectItemOnPasteComplete:function(item,copy,_4b0,_4b1,_4b2){if(item&&item.contentLink&&!_4b0){this.onSelect(item.contentLink,true);}},newItem:function(args,_4b3){if(args.dndData&&args.dndData.data){var _4b4=this.getParentItem(args.dndData);this._pasteNewItem(args.dndData.data,_4b4,_4b3);}},getParentItem:function(_4b5){if(_4b5&&_4b5.data){var _4b6=_4b5.data["parentLink"];if(_4b6){_4b6=new _46d(_4b6).createVersionUnspecificReference().toString();}return {contentLink:_4b6};}},_pasteNewItem:function(_4b7,_4b8,_4b9){this.pasteItem(_4b7,_4b8,_4b9,false);},_updateItemChanged:function(_4ba){when(this.store.refresh(_4ba),lang.hitch(this,function(_4bb){this._childrenChanged(_4bb);}));},_childrenChanged:function(_4bc){var dfd=new _463();this.getChildren(_4bc,lang.hitch(this,function(_4bd){this.onChildrenChange(_4bc,_4bd);dfd.resolve(_4bd);}));return dfd;},getIdentity:function(item){if(lang.isObject(item)){return this.store.getIdentity(item);}return item;},getObjectIconClass:function(item,_4be){var _4bf=_468.getValue(item.typeIdentifier,"iconClass");if(!_4bf){return _4be;}var _4c0="";switch(parseInt(item.contentLink,10)){case _46b.globalAssetsFolder:_4c0="AllSites";break;case _46b.siteAssetsFolder:_4c0="ThisSite";break;default:break;}return (_4c0===""&&_4bf===_4be)?_4bf:(_4be+" "+_4bf+_4c0);},getLabel:function(item){return item.name;},canExpandTo:function(item){var _4c1=new _463();this.getAncestors(item,lang.hitch(this,function(_4c2){_4c1.resolve(this.getIdentity(_4c2[0])===this.root.id);}));return _4c1.promise;},canCopy:function(item){if(!item){return false;}var _4c3=item.contentLink,_4c4=_4c3===this.root||(_45f.indexOf(this.notAllowToCopy,_4c3)>=0);return !_4c4&&_46c.hasAccess(item.accessMask,_46c.accessLevel.Read)&&_46c.hasProviderCapability(item.providerCapabilityMask,_46c.providerCapabilities.Copy);},canCut:function(item){if(!item){return false;}var _4c5=item.contentLink,_4c6=_4c5===this.root||(_45f.indexOf(this.notAllowToDelete,_4c5)>=0);return !_4c6&&_46c.isActionAvailable(item,_46c.action.Delete,_46c.providerCapabilities.Move,true);},canDelete:function(item){if(!item){return false;}var _4c7=item.contentLink,_4c8=_4c7===this.root||(_45f.indexOf(this.notAllowToDelete,_4c7)>=0);return !_4c8&&_46c.isActionAvailable(item,_46c.action.Delete,_46c.providerCapabilities.Delete,true);},canPaste:function(item,_4c9,_4ca){if(!item||!_4c9){return false;}var _4cb=_4ca&&_4c9.isWastebasket,_4cc=!_4ca&&(this.getIdentity(item)===this.getIdentity(_4c9)),_4cd=!_4ca&&(item.parentLink===this.getIdentity(_4c9)),_4ce=_46c.isActionAvailable(_4c9,_46c.action.Create,_46c.providerCapabilities.Create,true);return !_4c9.isDeleted&&!_4cb&&!_4cc&&!_4cd&&_4ce;},canEdit:function(item){if(!item){return false;}var _4cf=item.contentLink,_4d0=_4cf===this.root;return !_4d0&&_46c.hasAccess(item.accessMask,_46c.accessLevel.Edit);},onItemChildrenReload:function(_4d1){},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onDeleted:function(_4d2){var item=_4d2[0].data;if(item){when(this.getCurrentContext(),lang.hitch(this,function(ctx){var _4d3=item.capabilities.isPage,_4d4=_46d.compareIgnoreVersion(item.contentLink,ctx.id);if(_4d3&&!_4d4){return;}if(!_4d3&&_4d4){_465.publish("/epi/shell/context/request",{uri:_46a.settings.defaultContext});return;}this.onSelect(item.parentLink,true);}));}},onSelect:function(item,_4d5,_4d6){}});});},"epi-cms/widget/_HierarchicalModelMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/_HierarchicalModelMixin"],function(_4d7,lang,_4d8){return _4d7([_4d8],{isTypeOfRoot:function(_4d9){return !!(_4d9&&(this.isRoot(_4d9)||_4d9.isSubRoot));},isRoot:function(_4da){return !!(_4da&&this.root&&_4da===this.root);}});});},"epi/shell/_HierarchicalModelMixin":function(){define("epi/shell/_HierarchicalModelMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when"],function(_4db,_4dc,lang,_4dd,all,when){return _4dc([],{parentProperty:"parentLink",store:null,constructor:function(_4de){_4dc.safeMixin(this,_4de);},getParentIdentity:function(item){return lang.getObject(this.parentProperty,false,item);},isAncestor:function(_4df,_4e0){var _4e1=this.store.getIdentity(_4df),_4e2=this.store.getIdentity(_4e0),_4e3=this.getParentIdentity(_4e0);if(_4e1==_4e2||(_4e0.parentLink&&_4df.contentLink==_4e0.parentLink)){return true;}if(_4e3){return false;}return when(this.store.get(_4e3),lang.hitch(this,function(_4e4){return this.isAncestor(_4df,_4e4);}));},getAncestors:function(item,_4e5){if(!this.store){_4e5([]);return;}var obj=typeof item==="object"?item:this.store.get(item);when(obj,lang.hitch(this,function(_4e6){when(this._getAncestors([_4e6]),_4e5);}));},_getAncestors:function(_4e7){if(this._hasRoot(_4e7)){return _4e7.slice(0,-1);}var _4e8=this.getParentIdentity(_4e7[0]);if(!_4e8){return _4e7.slice(0,-1);}return when(this.store.get(_4e8),lang.hitch(this,function(_4e9){if(_4e9){_4e7.unshift(_4e9);return this._getAncestors(_4e7);}return _4e7.slice(0,-1);}));},_hasRoot:function(_4ea){var _4eb=this.roots||[this.root];if(!_4ea.length||!_4eb.length||typeof this.getIdentity!=="function"){return false;}var _4ec=this.getIdentity(_4ea[0]);return _4db.some(_4eb,function(root){return root==_4ec;},this);},refreshAncestors:function(item,_4ed){var _4ee=this.store,_4ef=new _4dd(),_4f0=[],_4f1=[];this.getAncestors(item,function(_4f2){_4db.forEach(_4f2,function(_4f3){if(!_4ed||_4ed(_4f3)){_4f0.push(when(_4ee.refresh(_4ee.getIdentity(_4f3)),function(item){_4f1.push(item);}));}});all(_4f0).then(function(){_4ef.resolve(_4f1);});});return _4ef.promise;}});});},"epi-cms/widget/viewmodel/_UpdateableStoreModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/Evented","dojo/json","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference"],function(_4f4,_4f5,lang,_4f6,_4f7,json,_4f8,when,_4f9,_4fa,_4fb,_4fc){return _4f5(_4f7,{updateableStore:null,updateableStoreKey:"epi.cms.contentdata",currentContentService:null,propertyNames:{name:"icontent_name",nameInUrl:"iroutable_routesegment"},refreshTranslatedAncestors:true,onAddDelegate:null,postscript:function(){this._setupStore();this.currentContentService=new _4fb();},_setupStore:function(){if(!this.updateableStore&&this.updateableStoreKey){this.updateableStore=_4f9.resolve("epi.storeregistry").get(this.updateableStoreKey);}},rename:function(id,name){var self=this,_4fd=new _4f6();when(self.patch(id,{name:name,nameInUrl:null}),function(item){when(self.refreshTranslated(id),function(){_4fd.resolve(item);},function(e){_4fd.reject(e);});},function(e){_4fd.reject(e);});return _4fd;},translate:function(item){var self=this,id=self.getIdentity(item),_4fe={masterLanguageVersionId:id,name:item.name,contentTypeId:item.contentTypeID};return when(self.updateableStore.put(_4fe),function(){when(self.store.refresh(id),function(){when(self.refreshTranslated(id),function(){self.onSelect(id,true,self.onAddDelegate);});});});},add:function(item,_4ff){var self=this;var def=new _4f6();when(self.updateableStore.add(item),function(_500){var id=self.getContentId(_500),_501=self.getParentIdentity(item),_502=null;when(self.updateableStore.get(id),function(_503){if(self.getParentIdentity(_503)!=_501){_502=typeof _4ff=="function"&&_4ff();}when(_502,function(){when(self._childrenChanged(_501),function(){when(self.refreshTranslated(id),function(){self.onSelect(id,true,self.onAddDelegate);def.resolve(_503);});});});});});return def.promise;},patch:function(id,_504){var self=this,_505=new _4f6(),_506={id:id,properties:{}};for(var key in _504){if(_504.hasOwnProperty(key)){_506.properties[this._convertPropertyName(key)]=json.stringify(_504[key]);}}when(self.updateableStore.patch(_506,{id:_506.id}),function(item){if(item&&item.successful){var _507={contentLink:id,properties:_506.properties,capabilities:{supportsVersions:false}};lang.mixin(_507,_504);when(self.updateableStore.patchCache(_507),_505.resolve,_505.reject);}else{return _505.reject(item&&item.validationErrors);}});return _505;},_convertPropertyName:function(name){return this.propertyNames[name]||name;},refreshTranslated:function(_508){var self=this,_509=new _4f6(),_50a;function _50b(item){var id=self.getIdentity(item),_50c=self.getParentIdentity(item);if(_50c==self.root||id==self.root||!item.missingLanguageBranch){return false;}return true;};if(!self.refreshTranslatedAncestors){return _509.resolve();}when(self.refreshAncestors(_508,_50b),function(_50d){if(!(_50d instanceof Array)||_50d.length===0){_509.resolve();return;}_50d.reverse();var _50e=_4f4.some(_50d,function(item){if(!!item.missingLanguageBranch){_50a=self.getLabel(item);return true;}return false;});when(self.store.get(_508),function(_50f){if(_50e&&_50f&&!_50f.missingLanguageBranch){self.emit("translationFailed",_50a);}_509.resolve();});});return _509;},getContentId:function(_510){return _4fc.toContentReference(_510).id.toString();},_onPasteComplete:function(item,copy,_511,_512,_513){if(!item){return;}if(!_511){this.refreshTranslated(this.getIdentity(item));}else{this.currentContentService.getCurrentContent().then(lang.hitch(this,function(_514){var _515=_4fc.compareIgnoreVersion(item,_514)&&_514.isDeleted;if(!_515){return;}var _516=this._createQuery({referenceId:this.getIdentity(_512),query:this.getChildrenQuery},true);when(this.store.query(_516,this._queryOptions),lang.hitch(this,function(_517){var _518=_512?_512.contentLink:null;if(!_517||!(_517 instanceof Array)||_517.length<=0){_518=_4fa.startPage;}if(_518){var _519={uri:"epi.cms.contentdata:///"+_518};_4f8.publish("/epi/shell/context/request",_519);}}));}));}}});});},"epi-cms/widget/ContextualContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel"],function(_51a,_51b,lang,_51c,_51d,_51e,_51f,when,_520,_521,_522,_523,_524){return _51b([_524,_521,_522],{handleSelection:null,previousSelection:null,postscript:function(){this.inherited(arguments);this._handles.push(_51f.subscribe("/epi/cms/action/createlocalasset",lang.hitch(this,this.refreshRoots)));this._handles.push(_51f.subscribe("/epi/cms/action/togglecreatemode",lang.hitch(this,this._toggleContextualContent)));this._handles.push(_51c.around(this,"pasteItem",lang.hitch(this,this._aroundPasteItem)));this._handles.push(_51c.after(this.store,"get",lang.hitch(this,this._afterStoreGet)));},contentContextChanged:function(_525,_526){this.inherited(arguments);this.refreshRoots();},getChildren:function(_527,_528,_529){if(_527===this.root){when(this._getRootItems(),_528,_529);}else{if(this.isPseudoContextualRoot(_527)){_528([]);return;}this.inherited(arguments);}},getAncestors:function(item,_52a){var _52b=this.getInherited(arguments);when(this.getCurrentContent(),lang.hitch(this,function(_52c){var _52d=this.roots.concat(_52c.assetsFolderLink),_52e=lang.hitch(this,function(_52f){var _530;for(var i=_52f.length-1;i>=0;i--){_530=_52f[i];if(this.isContextualRoot(_530)){_52f[i]=this.getContextualRoot(_530);}if(_51a.indexOf(_52d,this.getIdentity(_530))>=0){_52f=_52f.slice(i);_52f.unshift(this.root);_52a(_52f);return;}}_52a([this.root]);});if(_51a.indexOf(_52d,this.getIdentity(item))>=0){_52a([this.root]);}_52b.apply(this,[item,_52e]);}));},getObjectIconClass:function(_531,_532){var _533=this._currentContext&&this._currentContext.dataType;if(!_533){return this.inherited(arguments);}var _534=_520.getValue(_533,"iconClass");return this.isContextualContent(_531)?(_534?_532+" "+_534+"Contextual":_532):this.inherited(arguments);},onToggleContentDisplay:function(_535,_536){},onRefreshRoots:function(_537){},refreshRoots:function(_538){if(_538===this){return true;}var self=this;return self._refreshPromise=when(self._refreshPromise,function(){return when(self._getRootItems(),function(_539){self.onChildrenChange(self.root,_539);if(self.get("handleSelection")===true){return self._setSelection(lang.clone(_539).pop());}});});},canCopy:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canCut:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canPaste:function(item,_53a,_53b){var self=this,_53c=self.getInherited(arguments),_53d=new _51d();if(_53b){_53d.resolve(_53c.apply(self,[item,_53a,_53b]));}else{when(self.getCurrentContent(),function(_53e){self.getAncestors(_53a,function(_53f){var _540=self.isContextualContent(_53a)||self.hasContextual(_53f);if(_540){if(_523.compareIgnoreVersion(item.contentLink,_53e.contentLink)){_53d.resolve(false);}else{self.getAncestors(_53e.contentLink,function(_541){_53d.resolve(_51a.some(_541,function(_542){return item.contentLink===_542.contentLink;},this)?false:_53c.apply(self,[item,_53a,_53b]));});}}else{_53d.resolve(_53c.apply(self,[item,_53a,_53b]));}});});}return _53d;},filterAncestors:function(_543){if(!(_543 instanceof Array)){return _543;}var _544=_543.indexOf(this._getPseudoContextualContent().toString());if(_544!==-1&&_544<_543.length-1){_543.splice(_544,1);}return _543;},_toggleContextualContent:function(_545){when(this.getCurrentContent(),lang.hitch(this,function(_546){this.onToggleContentDisplay(_546.assetsFolderLink,!_545);this._setSelection(null);}));},_setSelection:function(_547){var _548=this.roots[0].toString(),_549=_547!=null?_547.contentLink:_548,_54a=this.get("previousSelection"),_54b=this.get("previousContextualSelection"),_54c=new _51d();if(!(_549&&_54a)){_54c.resolve();return _54c;}var _54d=false,_54e=_54a.selectedContent,_54f=_54a.selectedAncestors,_550=_54e.item&&!_54e.item.contentLink;var _551=function(_552){_54c.resolve();};if(_550||this.hasContextual(_54f)){this.onSelect(_549,_54d,_551);}else{if(_54e.item.contentLink==_548&&_54b&&_54b.selectedContent&&_54b.selectedContent.item&&_54b.selectedContent.item.contentLink){this.onSelect(_54b.selectedContent.item.contentLink,_54d,_551);}else{_54c.resolve();}}return _54c;},_getRootItems:function(){var self=this,_553=self.store,_554=_51a.map(self.roots,function(item){return _553.get(item);});var _555=when(_51e([self.getCurrentContent(),self.getCurrentContext()]),function(_556){var _557=_556[0],_558=_556.length>1?_556[1]:null;var _559=new _523(_557.contentLink).createVersionUnspecificReference().toString();return when(_553.get(_559),function(_55a){var _55b=_558&&_558.currentMode==="create";if((_55b&&self.get("view")==="contentselector")||!self.canHaveContextualContent(_55a)){return null;}var _55c=_55a.assetsFolderLink;if(_55c){var _55d=function(_55e){return when(_553.get(_55e),function(_55f){var _560={"id":_55f.contentLink,"typeIdentifiers":self.typeIdentifiers,"allLanguages":self.showAllLanguages};return when(_553.query(_560),function(_561){if(typeof self.isSupportedType==="function"&&!self.isSupportedType(_561.typeIdentifier)){return null;}if(!self.isPseudoContextualRoot(_561)){return self.getContextualRoot(_561);}else{return when(self.onRefreshRoots(_561),function(){return self._modifyContentAccess(_561,_55a);});}});});};if(_55c==self._getPseudoContextualContent()){return when(_553.refresh(_559),function(_562){return _55d(_562.assetsFolderLink);});}else{return _55d(_55c);}}return null;});},function(_563){return null;});_554.push(_555);return when(_51e(_554),function(_564){return _51a.filter(_564,Boolean);});},_aroundPasteItem:function(_565){var self=this;return function(_566,_567,_568,copy,_569){var _56a=_568,_56b=self.get("createAsLocalAsset");return when(self.getCurrentContent(),function(_56c){if(!_56b){_56b=self.isPseudoContextualRoot(_56a);self.set("createAsLocalAsset",_56b);}_56b&&(_56a=_56c);return when(_565.apply(self,[_566,_567,_56a,copy,_569]),function(_56d){if(_56b){self.set("createAsLocalAsset",false);return when(self.refreshRoots(),function(){_51f.publish("/epi/cms/action/createlocalasset",self);return _56d;});}else{return _56d;}});});};},_afterStoreGet:function(_56e){var self=this;return when(_56e,function(_56f){return when(self.getCurrentContent(),function(_570){return self._modifyContentAccess(_56f,_570);},function(_571){return _56f;});});},_modifyContentAccess:function(_572,_573){if(this.isContextualContent(_572)){var _574=this.getContextualRoot(_572);return this.isPseudoContextualRoot(_572)?lang.mixin(_574,{isPreferredLanguageAvailable:_573.isPreferredLanguageAvailable,accessMask:_573.accessRights}):_574;}return _572;}});});},"epi-cms/component/command/_GlobalToolbarCommandProvider":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/form/Button","epi/shell/command/_CommandProviderMixin"],function(_575,lang,_576,_577){return _575([_577],{addToLeading:function(_578,_579){this.addCommand(_578,_579);},addToCenter:function(_57a,_57b){_57b=lang.mixin({category:"center"},_57b);this.addCommand(_57a,_57b);},addToTrailing:function(_57c,_57d){_57d=lang.mixin({category:"trailing"},_57d);this.addCommand(_57c,_57d);},addCommand:function(_57e,_57f){_57f=lang.mixin({"class":"epi-mediumButton",iconClass:_57e.iconClass,category:"leading",label:_57e.label,tooltip:_57e.tooltip,showLabel:false,widget:_576,model:_57e},_57f);_57e=lang.delegate(_57e,{settings:_57f});this.add("commands",_57e);}});});},"epi-cms/contentediting/EditorFactory":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","epi/string"],function(_580,_581,lang,_582){return _580(null,{defaultWrapperType:"flyout",_registeredEditorWrappers:null,onEditorCreated:function(_583){},onEditorResolved:function(data,_584){},constructor:function(){this._registeredEditorWrappers={};},registerEditorWrapper:function(_585,_586,_587){this._registeredEditorWrappers[_585]={wrapperClassType:_586,initializer:_587};},_getWrapperAndEditor:function(_588){var type=_588.type;var name=_588.name;var _589=_588.wrapperType;var _58a=_588.editorParams||{};var _58b=_588.editorWidgetType;if(!_589){if(_588.metadata.customEditorSettings&&_588.metadata.customEditorSettings.uiWrapperType){_589=_588.metadata.customEditorSettings.uiWrapperType;}else{_589=this.defaultWrapperType;}}if(!_58b){if(_588.metadata.customEditorSettings&&_588.metadata.customEditorSettings.uiType){_58b=_588.metadata.customEditorSettings.uiType;}else{if(_588.metadata.uiType){_58b=_588.metadata.uiType;}else{_58b="epi/shell/widget/FormContainer";lang.mixin(_58a,{metadata:_588.metadata,onFieldCreated:function(_58c,_58d){}});}}}if(!_58b){throw ("Could not resolve editor widget for property: "+_588.name);}if(_588.metadata.customEditorSettings&&_588.metadata.customEditorSettings.uiParams){lang.mixin(_58a,_588.metadata.customEditorSettings.uiParams);}var _58e=this._registeredEditorWrappers[_589];if(!_58e){throw ("No suitable editor wrapper found for type: "+_589);}var data={wrapperInitializer:_58e.initializer,wrapperType:_58e.wrapperClassType,editorWidgetType:_58b,editorParams:_58a};this.onEditorResolved(data,_588);if(_589){return data;}throw ("No suitable editor found");},createEditor:function(_58f,node,_590,_591){var def=new _581();var _592=this._getWrapperAndEditor(_58f);var _593=_582.slashName(_592.wrapperType);var _594=_582.slashName(_592.editorWidgetType);require([_593,_594],lang.hitch(this,function(_595){var _596=_591||{};if(_58f.metadata){lang.mixin(_596,_58f.metadata.settings);lang.mixin(_596,_592.editorParams);_596.selections=_58f.metadata.selections;}var _597={wrapperType:_592.wrapperType,editorWidgetType:_592.editorWidgetType,editorParams:_596,blockDisplayNode:node,overlayItem:_596.overlayItem,property:_58f,propertyName:_58f.name,propertyDisplayName:_58f.metadata.displayName,value:_590,contentModel:_58f.contentModel};var _598=new _595(_597);var _599=_592.wrapperInitializer;if(_599){lang.mixin(_597.editorParams,{parent:_598});_599(_598,_597);}this.onEditorCreated(_598.getEditorWidget());def.resolve(_598);}));return def;}});});},"epi-cms/contentediting/InUseNotificationManager":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/when","dojo/date","dojo/aspect","epi","epi/dependency","epi/datetime","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(lang,_59a,_59b,when,_59c,_59d,epi,_59e,_59f,_5a0,_5a1,res){return _59b([],{contextTypeName:"",_postFlag:false,_inUseNotificationStore:null,_currentUsername:null,_messageService:null,currentModel:null,_eventHandlers:null,ignoreOthersNotifications:null,constructor:function(_5a2){this.inherited(arguments);lang.mixin(this,_5a2);this._inUseNotificationStore=this.store||_59e.resolve("epi.storeregistry").get("epi.cms.inusenotification");this._currentUsername=this.username||_5a0.userName;this._messageService=this.messageService||_59e.resolve("epi.shell.MessageService");this._eventHandlers=[];},updateCommandModel:function(_5a3){this.inherited(arguments);if(this.currentModel&&!_5a1.compareIgnoreVersion(this.currentModel.contentData.contentLink,_5a3.contentData.contentLink)){this.ignoreOthersNotifications=false;}this.currentModel=_5a3;_59a.forEach(this._eventHandlers,function(_5a4){_5a4.remove();});this.updateMessageService(this.currentModel.contentData);this._eventHandlers=[_59d.after(_5a3,"suspend",lang.hitch(this,this._onViewModelSuspended)),_59d.after(_5a3,"destroyed",lang.hitch(this,this._onViewModelSuspended)),_59d.after(_5a3,"onPropertyEdited",lang.hitch(this,this._onPropertyEdited)),_59d.around(_5a3,"canChangeContent",lang.hitch(this,this._canChangeContentAdvisor))];},_canChangeContentAdvisor:function(_5a5){return lang.hitch(this,function(){if(!this.ignoreOthersNotifications){var _5a6=this.getOtherUsersInUseNotifications(this.currentModel.contentData.inUseNotifications);if(_5a6&&_5a6.length){return false;}}return _5a5.apply(this.currentModel,arguments);});},_onViewModelSuspended:function(){var _5a7=this.currentModel.contentData;this.removeAutomaticInUseNotification(_5a7);},_onPropertyEdited:function(){var _5a8=this.currentModel.contentData;this.ensureAutomaticInUseNotification(_5a8);},ensureAutomaticInUseNotification:function(_5a9){var _5aa;_59a.some(_5a9.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_5aa=item;return true;}},this);if(!_5aa){return this.put(this._createNotification(_5a9,false),_5a9.inUseNotifications);}else{if(_5aa.addedManually){return;}else{var _5ab=_59f.deserialize(_5aa.modified);if(_59c.difference(_5ab,new Date(),"minute")>30){return this.put(_5aa,_5a9.inUseNotifications);}}}},removeAutomaticInUseNotification:function(_5ac){_59a.forEach(_5ac.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&!item.addedManually){this.remove(item,_5ac.inUseNotifications);}},this);},_createNotification:function(_5ad,_5ae){var _5af=_59f.serialize(new Date());return {userName:this._currentUsername,contentLink:_5ad.contentLink,languageBranch:_5ad.currentLanguageBranch&&_5ad.currentLanguageBranch.languageId,addedManually:_5ae,created:_5af,modified:_5af};},put:function(_5b0,_5b1){_5b0.modified=_59f.serialize(new Date());if(!this._postFlag){this._postFlag=true;return when(this._inUseNotificationStore.put(_5b0),lang.hitch(this,function(_5b2){var _5b3=_59a.indexOf(_5b1,_5b0);if(_5b3>=0){_5b1[_5b3]=_5b0;}else{_5b1.push(_5b0);}this._updateDependentStores(_5b0.contentLink,_5b1);this._postFlag=false;}));}},remove:function(_5b4,_5b5){return when(this._inUseNotificationStore.remove(_5b4.id),lang.hitch(this,function(){var _5b6=_59a.indexOf(_5b5,_5b4);_5b5.splice(_5b6,1);this._updateDependentStores(_5b4.contentLink,_5b5);}));},_updateDependentStores:function(_5b7,_5b8){var _5b9={contentLink:_5b7,inUseNotifications:_5b8};this._inUseNotificationStore.updateDependentStores(_5b9);},togglePermanentEditIndication:function(_5ba,_5bb){var _5bc;var _5bd=_59a.some(_5ba.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_5bc=item;if(item.addedManually){return true;}}},this);if(_5bd){if(_5bb&&_5bc.convertedFromAutomaticNotification){_5bc.addedManually=false;return this.put(_5bc,_5ba.inUseNotifications);}else{return this.remove(_5bc,_5ba.inUseNotifications);}}else{if(_5bc&&_5bb){_5bc.convertedFromAutomaticNotification=true;_5bc.addedManually=true;}else{_5bc=this._createNotification(_5ba,true);}return this.put(_5bc,_5ba.inUseNotifications);}},updateMessageService:function(_5be){var _5bf=_5be.contentLink+"_permanentEdit";this._messageService.remove({externalItemId:_5bf});var _5c0=this._getManualInUseNotification(_5be.inUseNotifications);if(_5c0){this._notificationHandlerId=this._messageService.put("note",res.permanenteditison,this.contextTypeName,_5be.contentLink,_5bf,null);}},_getManualInUseNotification:function(_5c1){var _5c2;var _5c3=_59a.forEach(_5c1,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&item.addedManually){_5c2=item;}},this);return _5c2;},currentUserHasInUseNotification:function(_5c4,_5c5){return _59a.some(_5c4,function(item){return item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&(!_5c5||item.addedManually);},this);},getOtherUsersInUseNotifications:function(_5c6){var _5c7=[];_59a.forEach(_5c6,function(item){if(item.userName.toLowerCase()!==this._currentUsername.toLowerCase()){_5c7.push(item.userName);}},this);return _5c7;},hasInUseNotificationWarning:function(_5c8){if(this.ignoreOthersNotifications){return false;}return this.getOtherUsersInUseNotifications(_5c8).length;}});});},"epi-cms/contentediting/ViewSettingsManager":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/topic","dojo/Stateful","epi/epi","epi/dependency","epi/UriParser"],function(_5c9,_5ca,lang,_5cb,_5cc,epi,_5cd,_5ce){return _5c9([_5cc],{_hashWrapper:null,viewSettings:null,_viewSettingsMap:null,viewSettingsHashValue:[],_activeKey:"active",enabled:false,previewParams:null,postscript:function(){this.inherited(arguments);this._hashWrapper=_5cd.resolve("epi.shell.HashWrapper");this.previewParams={};this._viewSettingsMap={};_5ca.forEach(this.viewSettings,lang.hitch(this,function(_5cf){if(!this._viewSettingsMap[_5cf.key]){this._viewSettingsMap[_5cf.key]=_5cf;}else{throw "Duplicated view settings key.";}}));_5cb.subscribe("/epi/cms/action/viewsettingvaluechanged",lang.hitch(this,this._viewSettingChanged));_5cb.subscribe("/epi/cms/action/eyetoggle",lang.hitch(this,this._viewSettingEnabledChanged));var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){this.viewSettingsHashValue=this._toObjects(obj.viewsetting);}this.enabled=this._loadProperty(this._activeKey)==="true";_5ca.forEach(this.viewSettingsHashValue,lang.hitch(this,function(item){var _5d0=this._viewSettingsMap[item.type];if(_5d0){_5d0.set("enabled",this.get("enabled"));_5d0.value=item.id;_5d0.beforePreviewLoad(this.previewParams,this.get("enabled"));}}));},onPreviewReady:function(_5d1){this._preview=_5d1;_5ca.forEach(this.viewSettings,lang.hitch(this,function(_5d2){_5d2.afterPreviewLoad(_5d1,this.get("enabled"));}));},getSettingProperty:function(_5d3){var _5d4=_5ca.filter(this.viewSettingsHashValue,function(_5d5){return _5d5.type==_5d3;});return _5d4.length>0?_5d4[0].id:null;},hasVisitorGroup:function(){return this.getSettingProperty("visitorgroup")!==null&&this.getSettingProperty("visitorgroup").id!==null;},_enabledGetter:function(){return this.enabled;},_enabledSetter:function(_5d6){this.enabled=_5d6;var _5d7={};_5ca.forEach(this.viewSettings,lang.hitch(this,function(_5d8){_5d8.set("enabled",_5d6);_5d8.beforePreviewLoad(_5d7,_5d6);}));if(!epi.areEqual(this.previewParams,_5d7)){this.previewParams=_5d7;}else{_5ca.forEach(this.viewSettings,lang.hitch(this,function(_5d9){_5d9.afterPreviewLoad(this._preview,_5d6);}));}},_applyViewSettingValue:function(key,_5da){var _5db,_5dc=this._viewSettingsMap[key];if(_5dc){_5db=lang.clone(this.previewParams);_5dc.value=_5da;_5dc.beforePreviewLoad(_5db,true);if(!epi.areEqual(this.previewParams,_5db)){this.previewParams=_5db;}else{_5dc.afterPreviewLoad(this._preview,true);}}},_viewSettingChanged:function(key,_5dd){this._saveProperty(key,_5dd);this._applyViewSettingValue(key,_5dd);},_viewSettingEnabledChanged:function(_5de){var _5df=this._hasSetting();if(_5de){this._saveProperty(this._activeKey,"true");}else{this._saveProperty(this._activeKey,_5df?false:null);}this.set("enabled",_5de);},_addProperty:function(_5e0,_5e1){this.viewSettingsHashValue.push({type:_5e0,id:_5e1});},_updateProperty:function(_5e2,_5e3){var _5e4=-1;_5ca.forEach(this.viewSettingsHashValue,function(item,_5e5){if(item.type==_5e2){_5e4=_5e5;return;}});if(_5e4>-1){this.viewSettingsHashValue[_5e4].id=_5e3;}else{this._addProperty(_5e2,_5e3);}},_toObjects:function(url){var _5e6=[];_5ca.forEach(url.split("|"),function(item,_5e7){var uri=new _5ce(item);_5e6.push({type:uri.getType(),id:uri.getId()});});return _5e6;},_deleteProperty:function(_5e8){var _5e9=-1;_5ca.forEach(this.viewSettingsHashValue,function(item,_5ea){if(item.type==_5e8){_5e9=_5ea;return;}});if(_5e9>-1){this.viewSettingsHashValue.splice(_5e9,1);}},_updateHash:function(){var obj=this._hashWrapper.getHash();var _5eb=[];_5ca.forEach(this.viewSettingsHashValue,function(item,_5ec){_5eb.push(item.type+":///"+item.id);});if(_5eb.length>0){obj.viewsetting=_5eb.join("|");}else{delete obj.viewsetting;}this._hashWrapper.setHash(obj);},_saveProperty:function(_5ed,_5ee){var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){this.viewSettingsHashValue=this._toObjects(obj.viewsetting);if(_5ee!=null){this._updateProperty(_5ed,_5ee);}else{this._deleteProperty(_5ed);}this._updateHash();}else{if(_5ee!=null){this._updateProperty(_5ed,_5ee);this._updateHash();}}},_loadProperty:function(_5ef){var obj=this._hashWrapper.getHash();var _5f0=null;if(obj&&obj.viewsetting){var _5f1=this._toObjects(obj.viewsetting);var _5f2=_5ca.filter(_5f1,function(item){return item.type==_5ef;})[0];if(_5f2){_5f0=_5f2.id;}}return _5f0;},_hasSetting:function(){var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){if(obj.viewsetting.split("|").length>1){return true;}}return false;},getRenderingViewSettings:function(){return _5ca.filter(this.viewSettings,lang.hitch(this,function(_5f3){return _5f3.usedForRendering;}));}});});},"epi-cms/contentediting/command/Editing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi","epi/shell/_StatefulGetterSetterMixin","epi-cms/command/TranslateContent","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/Reject","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ManageExpiration"],function(_5f4,lang,_5f5,epi,_5f6,_5f7,_5f8,_5f9,_5fa,_5fb,_5fc,_5fd,_5fe){var _5ff=_5f4([_5f5,_5f6],{model:null,revertToPublished:null,reject:null,translate:null,createDraft:null,sendForReview:null,publish:null,withdraw:null,manageExpiration:null,constructor:function(_600){lang.mixin(this,_600);this.revertToPublished=new _5f8();this.reject=new _5f9();this.translate=new _5f7();this.createDraft=new _5fc();this.sendForReview=new _5fa();this.publish=new _5fb();this.withdraw=new _5fd();this.manageExpiration=new _5fe();},_setModelAttr:function(_601){this._set("model",_601);this.revertToPublished.set("model",_601);this.reject.set("model",_601);this.translate.set("model",_601);this.createDraft.set("model",_601);this.sendForReview.set("model",_601);this.publish.set("model",_601);this.withdraw.set("model",_601);this.manageExpiration.set("model",_601);}});return new _5ff();});},"epi-cms/command/TranslateContent":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.translate","epi/shell/command/_Command"],function(_602,_603,_604,_605){return _602([_605],{label:_604.label,executingLabel:_604.executinglabel,tooltip:_604.title,category:"context",_execute:function(){var _606=this._getNormalizedModel();if(typeof this.executeDelegate==="function"){this.executeDelegate(this.model);}else{var data={contentData:_606.content,languageBranch:_606.language.preferredLanguage};_603.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateLanguageBranch",null,data);}},_onModelChange:function(){var _607=this._getNormalizedModel(),_608=_607&&_607.language,_609=_607&&_607.content.isDeleted,_60a=_608&&_608.isTranslationNeeded&&!_609,_60b=_60a&&_608.hasTranslationAccess&&_608.isPreferredLanguageAvailable;if(_607&&typeof _607.content.canTranslateContent==="function"){var _60c=_607.content.canTranslateContent();_60a=_60a&&_60c;_60b=_60b&&_60c;}this.set("isAvailable",!!_60a);this.set("canExecute",!!_60b);},_getNormalizedModel:function(){var _60d=this.model;if(_60d){return {content:_60d.contentData||_60d,language:_60d.languageContext||_60d.missingLanguageBranch};}}});});},"epi-cms/contentediting/command/RevertToPublished":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_60e,lang,_60f,_610,_611){return _60e([_60f],{name:"reverttopublished",tooltip:_611.reverttopublished.title,label:_611.reverttopublished.label,iconClass:"epi-iconRevert",_hasPendingChangeWatch:null,_execute:function(){this.model.revertToPublished();},_onModelChange:function(){this.inherited(arguments);var _612=this.model.contentData,_613=_612.status,_614=_610.versionStatus;var _615=(_613===_614.CheckedOut)||(_613===_614.Rejected)||((_613===_614.Published||_613===_614.Expired)&&_612.isCommonDraft);this.set("isAvailable",_615);if(this._hasPendingChangeWatch){this._hasPendingChangeWatch.unwatch();}this._hasPendingChangeWatch=this.model.watch("hasPendingChanges",lang.hitch(this,function(name,_616,_617){var _618=this._getCanExecute(_612,_614);this.set("canExecute",!_617&&_618);}));this.set("canExecute",_615&&this._getCanExecute(_612,_614));},_getCanExecute:function(_619,_61a){return _619.publishedBy!==null&&_619.publishedBy!==undefined&&_619.status!==_61a.Published&&_619.status!==_61a.Expired&&this.model.canChangeContent()&&_610.hasAccess(_619.accessMask,_610.accessLevel.Delete);}});});},"epi-cms/contentediting/command/_ContentCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command"],function(_61b,lang,_61c){return _61b([_61c],{_isChangingContentStatusHandle:null,checkDeleted:true,destroy:function(){if(this._isChangingContentStatusHandle){this._isChangingContentStatusHandle.unwatch();}this.inherited(arguments);},_canExecuteGetter:function(){if(!this.model||!this.model.contentData){return false;}var _61d=this.model.contentData;return this.canExecute&&(!this.checkDeleted||(_61d&&!_61d.isDeleted));},_onModelChange:function(){this.inherited(arguments);if(this._isChangingContentStatusHandle){this._isChangingContentStatusHandle.unwatch();}var _61e;this._isChangingContentStatusHandle=this.model.watch("isChangingContentStatus",lang.hitch(this,function(name,_61f,_620){if(_620){_61e=this.canExecute;this.set("canExecute",false);}else{this.set("canExecute",_61e);}}));}});});},"epi-cms/contentediting/command/Reject":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_621,_622,_623,_624,_625){return _621([_624],{name:"reject",label:_625.reject.label,tooltip:_625.reject.title,iconClass:"epi-iconStop",action:_623.action.Reject,_execute:function(){return this.inherited(arguments);},_onModelChange:function(){this.inherited(arguments);var _626=this.model.contentData,_627=_626.status,_628=_623.versionStatus,_629=(_627==_628.CheckedIn)&&this.model.canChangeContent(_623.action.Publish);this.set("canExecute",_629);this.set("isAvailable",_629);}});});},"epi-cms/contentediting/command/_ChangeContentStatus":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/topic","epi-cms/core/ContentReference","epi-cms/contentediting/command/_ContentCommandBase"],function(_62a,lang,_62b,_62c,_62d,_62e){return _62a([_62e],{action:null,viewName:null,_execute:function(){return this._changeContentStatus();},_changeContentStatus:function(){var def=new _62b(),_62f=lang.hitch(this,function(_630){this._requestContextChange(_630.id,true);def.resolve(_630);}),_631=function(){def.cancel();};_62b.when(this.model.changeContentStatus(this.action),_62f,_631);return def;},_requestContextChange:function(id,_632){id=new _62d(id).createVersionUnspecificReference().toString();var _633={uri:"epi.cms.contentdata:///"+id};var _634={sender:this,trigger:"internal",forceContextChange:_632};if(this.viewName){lang.mixin(_634,{viewName:this.viewName});}_62c.publish("/epi/shell/context/request",_633,_634);}});});},"epi-cms/contentediting/command/SendForReview":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_635,_636,_637,_638,_639){return _635([_638],{name:"sendforreview",label:_639.sendforreview.label,executingLabel:_639.sendforreview.executinglabel,tooltip:_639.sendforreview.title,iconClass:"epi-iconCheckmark",action:_637.action.CheckIn,_execute:function(){_636.publish("/epi/cms/action/disableundoredoactions");return this.inherited(arguments);},_onModelChange:function(){this.inherited(arguments);var _63a=this.model.contentData,_63b=((_63a.status===_637.versionStatus.CheckedOut)||(_63a.status===_637.versionStatus.Rejected)||(_63a.status===_637.versionStatus.Published&&_63a.isCommonDraft))&&this.model.canChangeContent(this.action),_63c=_63b&&(_63a.status!==_637.versionStatus.Published);this.set("canExecute",_63c);this.set("isAvailable",_63b);}});});},"epi-cms/contentediting/command/Publish":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/topic","epi/datetime","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_63d,_63e,_63f,_640,_641,_642,_643,_644,_645,_646){return _63d([_645],{name:"publish",label:_646.publish.label,executingLabel:_646.publish.executinglabel,tooltip:_646.publish.title,action:_644.action.Publish,_execute:function(){var def=new _63e();_63e.when(this.inherited(arguments),function(_647){var _648=new _643(_647.oldId).createVersionUnspecificReference().toString();_63f.publish("/epi/cms/contentdata/childrenchanged",_648);def.resolve();},function(){def.reject();});return def;},_onModelChange:function(){this.inherited(arguments);var _649=this.model.contentData,_64a=_649.status,_64b=this.model.canChangeContent(_644.action.Publish),_64c=_64b&&!(_64a===_644.versionStatus.Published&&!_649.isCommonDraft),res=null;switch(_64a){case _644.versionStatus.CheckedIn:res=_646.approveandpublish;break;case _644.versionStatus.PreviouslyPublished:res=_646.republish;break;case _644.versionStatus.CheckedOut:if(_649.isMasterVersion){res=_646.publish;}else{res=_646.publishchanges;}break;default:res=_646.publishchanges;}var _64d=_642.getValue(_649.typeIdentifier,"publishView");this.set("label",res.label);this.set("title",res.title);this.set("executingLabel",res.executinglabel);this.set("canExecute",_64c);this.set("isAvailable",_64b);this.set("viewName",_64d);}});});},"epi-cms/contentediting/command/CreateDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_64e,_64f,_650,_651){return _64e([_64f],{name:"createdraft",label:_651.createdraft.label,tooltip:_651.createdraft.title,iconClass:"epi-iconPage",contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_650;},_execute:function(){this.model.createDraft();},_onModelChange:function(){this.inherited(arguments);var _652=this.model.contentData,_653=_652.status,_654=_650.versionStatus,_655=this.contentActionSupport.isActionAvailable(_652,_650.action.Create,_650.providerCapabilities.Create)&&this.contentActionSupport.hasAccess(_652.accessMask,_650.accessLevel[_650.action.Edit]);var _656=_655&&(((_653==_654.Published||_653==_654.PreviouslyPublished)&&!_652.isCommonDraft)||_653==_654.DelayedPublish);this.set("canExecute",_656);this.set("isAvailable",_656);}});});},"epi-cms/contentediting/command/Withdraw":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_657,_658,_659,_65a){return _657([_659],{name:"withdraw",label:_65a.withdraw.label,tooltip:_65a.withdraw.title,iconClass:"epi-iconPen",action:_658.action.Save,contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_658;},_execute:function(){return this.inherited(arguments);},_onModelChange:function(){this.inherited(arguments);var _65b=this.model.contentData,_65c=_65b.status,_65d=_658.versionStatus,_65e=this.contentActionSupport.isActionAvailable(_65b,_658.action.Create)&&!this.contentActionSupport.isActionAvailable(_65b,_658.action.Publish),_65f=_65e&&(_65c==_65d.CheckedIn);this.set("canExecute",_65f);this.set("isAvailable",_65f);}});});},"epi-cms/contentediting/command/ManageExpiration":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","epi","epi/datetime","epi-cms/contentediting/ExpirationDialog","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/shell/command/_Command","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_660,_661,_662,lang,epi,_663,_664,_665,_666,_667,_668,_669,_66a,_66b){return _661([_668],{label:_66a.dialogtitle,tooltip:_66a.dialogtitle,viewModel:null,cssClass:"epi-chromelessButton epi-visibleLink",constructor:function(){this._metadataManager=_667.resolve("epi.shell.MetadataManager");},_execute:function(){if(!this._metadata){return;}var _66c=this.get("viewModel");var _66d=new _664({metadata:this._metadata,value:_66c.get("value"),model:_66c});var _66e=new _669({destroyOnHide:true,defaultActionsVisible:false,confirmActionText:_66b.action.save,content:_66d,title:_66a.dialogtitle});_66e.connect(_66e,"onExecute",lang.hitch(this,function(){this._onSave(_66e);}));_66e.connect(_66e,"onCancel",lang.hitch(this,function(){this._onCancel(_66e);}));_66e.show();},_onModelChange:function(){var _66f=this.get("model");if(!_66f||!_66f.contentData){this.set("canExecute",false);return;}var _670=_66f.contentData.properties,_671=_670.iversionable_expire;this.set("viewModel",new _665({contentLink:_66f.contentLink,contentName:_66f.contentData.name,value:_671,minimumExpireDate:_670.iversionable_startpublish}));var _672=_66f.canChangeContent()&&_666.hasAccess(_66f.contentData.accessMask,_666.accessLevel.Publish);_662.when(_66f.getPropertyMetaData("iversionable_expire"),lang.hitch(this,function(_673){this._metadata=_673;}));this.set("canExecute",_672);},_onSave:function(_674){var _675=_674.content.model,_676=_675.get("intermediateValue");_675.set("value",_676);var _677=this.get("model");_677.publishProperty("iversionable_expire",_676);},_onCancel:function(_678){var _679=_678.content.model;_679.set("intermediateValue",_679.get("value"));}});});},"epi-cms/contentediting/ExpirationDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dijit/_CssStateMixin","epi-cms/widget/Breadcrumb","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ExpirationDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_67a,lang,_67b,_67c,_67d,_67e,_67f,_680,_681,_682,res,_683){return _67a([_67f,_681,_67e,_67c,_680],{templateString:_682,res:res,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",modelBindingMap:{"contentLink":["contentLink"],"contentName":["contentName"],"infoText":["infoText"],"state":["state"],"enableSaveButton":["enableSaveButton"],"showRemoveButton":["showRemoveButton"]},postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;},_archiveLinkSelector:null,_setContentLinkAttr:function(_684){this.breadcrumb.set("contentLink",_684);},_setContentNameAttr:{node:"contentNameNode",type:"innerText"},_setInfoTextAttr:{node:"infoTextNode",type:"innerText"},_setEnableSaveButtonAttr:function(_685){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_685);}},_setShowRemoveButtonAttr:function(_686){_67b.set(this.removeButton.domNode,"display",_686?"":"none");},_onRemoveButtonClick:function(){var _687={stopPublish:null,archiveLink:null};this.set("value",_687);this.onChange(_687);},onFieldCreated:function(_688,_689){if(_688==="stopPublish"){_689.set("minimumValue",this.model.get("minimumExpireDate"));_689.set("minimumValueMessage",this.model.get("minimumExpireDateMessage"));}else{if(_688==="archiveLink"){this._archiveLinkSelector=_689;if(this._archiveLinkSelector.readOnly){this._archiveLinkSelector._keepReadOnly=true;}this._archiveLinkSelector.set("contentLink",this.model.get("contentLink"));}}},onChange:function(_68a){this.inherited(arguments);this.model.set("intermediateValue",_68a);},getActions:function(){this._actions=[{name:"save",label:_683.action.save,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog();}})},{name:"cancel",label:_683.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"epi-cms/widget/Breadcrumb":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/when","dojo/query","dojo/NodeList-manipulate","dojo/topic","dijit/_Widget","dijit/layout/_LayoutWidget","epi/dependency","epi-cms/core/ContentReference","epi-cms/_ContentContextMixin","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/_HierarchicalModelMixin"],function(_68b,_68c,lang,_68d,_68e,_68f,_690,_691,_692,on,when,_693,_694,_695,_696,_697,_698,_699,_69a,_69b,_69c){return _68c([_697,_69c,_69a,_69b],{contentLink:null,store:null,showCurrentNode:true,showLastBracket:false,displayAsText:true,minimumItemCount:null,baseClass:"epi-breadCrumbs",_resizeListener:null,_visibleItems:[],_currentContent:null,_ancestors:null,postMixInProperties:function(){var _69d=_698.resolve("epi.storeregistry");this.store=this.store||_69d.get("epi.cms.content.light");this.minimumItemCount=this.minimumItemCount||2;},buildRendering:function(){this.domNode=this.ownerDocument.createElement("ul");this.inherited(arguments);},startup:function(){this._addResizeListener();},destroy:function(){if(this._resizeListener){this._resizeListener.remove();}this.destroyDescendants();this.inherited(arguments);},_addResizeListener:function(){if(this._resizeListener){return;}var _69e=this.getParent(),_69f=_69e;while(_69f&&!_69f.isLayoutContainer&&_69f.getParent()){_69f=_69f.getParent();}if(_69f&&_69f!==_69e){this._resizeListener=_68d.after(_69f,"resize",lang.hitch(this,function(){var _6a0=_691.getMarginBox(this.domNode);this.resize(_6a0);}));}},resize:function(_6a1){if(!_6a1&&this._resizeListener){return;}else{this.layout();}},layout:function(){this._visibleItems=[];when(this._buildPath(),lang.hitch(this,function(){var _6a2=_691.getContentBox(this.domNode).w;if(_6a2>this._availableWidth){var _6a3=this._leadingItem?_691.getMarginBox(this._leadingItem.domNode).w:0;var _6a4=this._availableWidth-_6a3;this._ellipsisize(0,_6a4);}}));},_setContentLinkAttr:function(_6a5){this._set("contentLink",_6a5);this._currentContent=null;this._ancestors=null;this.layout();},_buildPath:function(){var _6a6=this.get("contentLink"),def=new _68e(),path="";if(this._currentContent&&this._ancestors){this._createAllItems();def.resolve(path);}else{if(_6a6){var _6a7=new _699(_6a6);var _6a8=_6a7.createVersionUnspecificReference().toString();when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this.store.get(_6a8),lang.hitch(this,function(_6a9){this.getAncestors(_6a8,lang.hitch(this,function(_6aa){this._currentContent=_6a9;this._ancestors=_6aa;this._createAllItems();def.resolve(path);}));}));}));}else{def.resolve(path);}}return def.promise;},_createAllItems:function(){this._cleanUp();if(!this.isTypeOfRoot(this._currentContent)){var _6ab=[],_6ac=null;for(var i=this._ancestors.length-1;i>=0;i--){_6ac=this._ancestors[i];if(!_6ac.parentLink){continue;}_6ab.push(_6ac);if(this.isTypeOfRoot(_6ac)){break;}}_6ab.reverse();var _6ad=_691.getContentBox(this.domNode).w;this._availableWidth=_6ad>=0?_6ad:0;_68b.forEach(_6ab,lang.hitch(this,function(_6ae){this._createItem(_6ae,true);}));}if(this.showCurrentNode){this._createItem(this._currentContent,this.showLastBracket);}},_cleanUp:function(){this.destroyDescendants();this._leadingItem=null;this._visibleItems=[];},_createItem:function(_6af,_6b0){var node,_6b1=_690.create("li"),_6b2=this.displayAsText||!_6af.hasTemplate;if(_6b2){node=_690.create("span",null,_6b1);}else{node=_690.create("a",{href:"#"},_6b1);this.own(on(node,"click",lang.hitch(this,function(e){this.onNodeClick(e,_6af);})));}node.textContent=this.isContextualContent(_6af)?this.getContextualRootName(_6af):_6af.name;if(_6b0){_690.create("span",{innerHTML:"&gt;","class":"epi-breadCrumbsSeparator"},_6b1);}this._addAndLayout(_6b1);},onNodeClick:function(e,_6b3){e.preventDefault();_695.publish("/epi/shell/context/request",{uri:_6b3.uri},{sender:this});},_addAndLayout:function(node){var _6b4=new _696({},node);this._visibleItems.push(_6b4);this.addChild(_6b4);var _6b5=this._getTotalVisibleItemsSize();if(_6b5>this._availableWidth){this._ensureLeadingItem();while(_6b5>this._availableWidth&&this._visibleItems.length>this.minimumItemCount){var _6b6=this._visibleItems.splice(0,1)[0];_692.set(_6b6.domNode,"display","none");_6b5=this._getTotalVisibleItemsSize();}}},_getTotalVisibleItemsSize:function(){var _6b7=0;if(this._leadingItem){_6b7+=_691.getMarginBox(this._leadingItem.domNode).w;}_68b.forEach(this._visibleItems,function(item){_6b7+=_691.getMarginBox(item.domNode).w;});return _6b7;},_ensureLeadingItem:function(){if(this._leadingItem){return;}var _6b8=_690.create("li"),_6b9=_690.create("span",{innerHTML:"..."}),_6ba=_690.create("span",{innerHTML:" &gt; ","class":"epi-breadCrumbsSeparator"});_690.place(_6b9,_6b8,"last");_690.place(_6ba,_6b8,"last");this._leadingItem=new _696({},_6b8);this.addChild(this._leadingItem,0);},_ellipsisize:function(_6bb,_6bc){if(_6bb>=this._visibleItems.length){return;}var _6bd=this._visibleItems.length-_6bb,_6be=Math.floor(_6bc/_6bd),item=this._visibleItems[_6bb],_6bf=_691.getMarginBox(item.domNode).w;if(_6bf<=_6be){this._ellipsisize(_6bb+1,_6bc-_6bf);}else{var _6c0=_693(this.displayAsText?"span":"a",item.domNode)[0],_6c1=_693("span.epi-breadCrumbsSeparator",item.domNode)[0],_6c2=_6be-_691.getMarginBox(_6c1).w;if(_6c2<0){_6c2=0;}_692.set(_6c0,"width",_6c2+"px");_68f.add(_6c0,"dojoxEllipsis");this._ellipsisize(_6bb+1,_6bc-_6be);}}});});},"dojo/NodeList-manipulate":function(){define("dojo/NodeList-manipulate",["./query","./_base/lang","./_base/array","./dom-construct","./NodeList-dom"],function(_6c3,lang,_6c4,_6c5){var _6c6=_6c3.NodeList;function _6c7(node){var text="",ch=node.childNodes;for(var i=0,n;n=ch[i];i++){if(n.nodeType!=8){if(n.nodeType==1){text+=_6c7(n);}else{text+=n.nodeValue;}}}return text;};function _6c8(node){while(node.childNodes[0]&&node.childNodes[0].nodeType==1){node=node.childNodes[0];}return node;};function _6c9(html,_6ca){if(typeof html=="string"){html=_6c5.toDom(html,(_6ca&&_6ca.ownerDocument));if(html.nodeType==11){html=html.childNodes[0];}}else{if(html.nodeType==1&&html.parentNode){html=html.cloneNode(false);}}return html;};lang.extend(_6c6,{_placeMultiple:function(_6cb,_6cc){var nl2=typeof _6cb=="string"||_6cb.nodeType?_6c3(_6cb):_6cb;var _6cd=[];for(var i=0;i<nl2.length;i++){var _6ce=nl2[i];var _6cf=this.length;for(var j=_6cf-1,item;item=this[j];j--){if(i>0){item=this._cloneNode(item);_6cd.unshift(item);}if(j==_6cf-1){_6c5.place(item,_6ce,_6cc);}else{_6ce.parentNode.insertBefore(item,_6ce);}_6ce=item;}}if(_6cd.length){_6cd.unshift(0);_6cd.unshift(this.length-1);Array.prototype.splice.apply(this,_6cd);}return this;},innerHTML:function(_6d0){if(arguments.length){return this.addContent(_6d0,"only");}else{return this[0].innerHTML;}},text:function(_6d1){if(arguments.length){for(var i=0,node;node=this[i];i++){if(node.nodeType==1){_6c5.empty(node);node.appendChild(node.ownerDocument.createTextNode(_6d1));}}return this;}else{var _6d2="";for(i=0;node=this[i];i++){_6d2+=_6c7(node);}return _6d2;}},val:function(_6d3){if(arguments.length){var _6d4=lang.isArray(_6d3);for(var _6d5=0,node;node=this[_6d5];_6d5++){var name=node.nodeName.toUpperCase();var type=node.type;var _6d6=_6d4?_6d3[_6d5]:_6d3;if(name=="SELECT"){var opts=node.options;for(var i=0;i<opts.length;i++){var opt=opts[i];if(node.multiple){opt.selected=(_6c4.indexOf(_6d3,opt.value)!=-1);}else{opt.selected=(opt.value==_6d6);}}}else{if(type=="checkbox"||type=="radio"){node.checked=(node.value==_6d6);}else{node.value=_6d6;}}}return this;}else{node=this[0];if(!node||node.nodeType!=1){return undefined;}_6d3=node.value||"";if(node.nodeName.toUpperCase()=="SELECT"&&node.multiple){_6d3=[];opts=node.options;for(i=0;i<opts.length;i++){opt=opts[i];if(opt.selected){_6d3.push(opt.value);}}if(!_6d3.length){_6d3=null;}}return _6d3;}},append:function(_6d7){return this.addContent(_6d7,"last");},appendTo:function(_6d8){return this._placeMultiple(_6d8,"last");},prepend:function(_6d9){return this.addContent(_6d9,"first");},prependTo:function(_6da){return this._placeMultiple(_6da,"first");},after:function(_6db){return this.addContent(_6db,"after");},insertAfter:function(_6dc){return this._placeMultiple(_6dc,"after");},before:function(_6dd){return this.addContent(_6dd,"before");},insertBefore:function(_6de){return this._placeMultiple(_6de,"before");},remove:_6c6.prototype.orphan,wrap:function(html){if(this[0]){html=_6c9(html,this[0]);for(var i=0,node;node=this[i];i++){var _6df=this._cloneNode(html);if(node.parentNode){node.parentNode.replaceChild(_6df,node);}var _6e0=_6c8(_6df);_6e0.appendChild(node);}}return this;},wrapAll:function(html){if(this[0]){html=_6c9(html,this[0]);this[0].parentNode.replaceChild(html,this[0]);var _6e1=_6c8(html);for(var i=0,node;node=this[i];i++){_6e1.appendChild(node);}}return this;},wrapInner:function(html){if(this[0]){html=_6c9(html,this[0]);for(var i=0;i<this.length;i++){var _6e2=this._cloneNode(html);this._wrap(lang._toArray(this[i].childNodes),null,this._NodeListCtor).wrapAll(_6e2);}}return this;},replaceWith:function(_6e3){_6e3=this._normalize(_6e3,this[0]);for(var i=0,node;node=this[i];i++){this._place(_6e3,node,"before",i>0);node.parentNode.removeChild(node);}return this;},replaceAll:function(_6e4){var nl=_6c3(_6e4);var _6e5=this._normalize(this,this[0]);for(var i=0,node;node=nl[i];i++){this._place(_6e5,node,"before",i>0);node.parentNode.removeChild(node);}return this;},clone:function(){var ary=[];for(var i=0;i<this.length;i++){ary.push(this._cloneNode(this[i]));}return this._wrap(ary,this,this._NodeListCtor);}});if(!_6c6.prototype.html){_6c6.prototype.html=_6c6.prototype.innerHTML;}return _6c6;});},"epi/shell/widget/dialog/_DialogContentMixin":function(){define("epi/shell/widget/dialog/_DialogContentMixin",["dojo/_base/declare"],function(_6e6){return dojo.declare(null,{executeDialog:function(){},cancelDialog:function(){}});});},"url:epi-cms/contentediting/templates/ExpirationDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-attach-point=\"stateNode\" class=\"epi-notificationBar epi-notificationBarItem\">\r\n        <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"infoTextNode\"></div>\r\n        <div class=\"epi-notificationBarButtonContainer\">\r\n            <button data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"removeButton\" data-dojo-attach-event=\"onClick: _onRemoveButtonClick\">${res.removebutton}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Form\" class=\"epi-formArea\" data-dojo-attach-point=\"form\"></div>\r\n</div>","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/epi","epi/datetime","epi/shell/_StatefulGetterSetterMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_6e7,_6e8,_6e9,epi,_6ea,_6eb,_6ec,_6ed){return _6e7([_6e8,_6eb],{value:null,intermediateValue:null,contentLink:null,contentName:null,enableSaveButton:null,showRemoveButton:null,infoText:null,state:null,postscript:function(){this.inherited(arguments);this.set("intermediateValue",this.value);this.set("minimumExpireDate",this.minimumExpireDate);},_setIntermediateValueAttr:function(_6ee){this._set("intermediateValue",_6ee);this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.value));if(_6ee&&_6ee.stopPublish){var _6ef=_6ee.stopPublish instanceof Date?_6ee.stopPublish:_6ea.deserialize(_6ee.stopPublish);this.set("showRemoveButton",true);this.set("infoText",_6ef<_6ea.serverTime()?_6ed.expired:_6e9.substitute(_6ec.expiretimetext,[_6ea.timeToGo(_6ef)]));this.set("state","Expiring");}else{this.set("showRemoveButton",false);this.set("infoText",_6ec.neverexpiretext);this.set("state","NotExpiring");}},_setValueAttr:function(_6f0){this._set("value",_6f0);this.set("enableSaveButton",false);},_setMinimumExpireDateAttr:function(_6f1){var date=new Date(_6f1);this._set("minimumExpireDate",_6ea.isDateValid(date)?date:null);this._set("minimumExpireDateMessage",_6ec.minimumdatevalidation);},save:function(){this.set("value",this.intermediateValue);}});});},"epi-cms/contentediting/commandproviders/ContentDetails":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","../command/PermanentInUseToggle","../command/StartWorkflow"],function(dojo,_6f2,_6f3,_6f4,_6f5){return _6f2([_6f3],{constructor:function(){this.inherited(arguments);this.add("commands",new _6f4());this.add("commands",new _6f5());}});});},"epi-cms/contentediting/command/PermanentInUseToggle":function(){define(["dojo/_base/declare","epi/dependency","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(_6f6,_6f7,_6f8,_6f9){return _6f6([_6f8],{name:"PermanentInUseNotification",label:_6f9.title,tooltip:_6f9.tooltip,inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_6f7.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inherited(arguments);var _6fa=this.model.contentData;this.inUseNotificationManager.togglePermanentEditIndication(_6fa,true);this._updateCanExecute();},_onModelChange:function(){var _6fb=this.model.contentData,_6fc=this.model.canChangeContent(),_6fd=this.inUseNotificationManager.currentUserHasInUseNotification(_6fb.inUseNotifications,true);this.set("active",_6fd);this._updateCanExecute();},_updateCanExecute:function(){this.set("canExecute",this.active||this.model.canChangeContent());}});});},"epi-cms/contentediting/command/StartWorkflow":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.command.startworkflow"],function(_6fe,lang,_6ff,_700,_701){return _6fe([_700],{label:_701.label,dialogPath:"Edit/StartWorkflow.aspx",raiseCloseEvent:true,getRouteParams:function(){return lang.mixin(this.inherited(arguments),{"id":this.getContentReference(true)});},_onModelChange:function(){var _702=lang.getObject("model.contentData.capabilities.isPage",false,this);this.set("canExecute",!!_702);},getDialogParams:function(){return {dialogTitle:_701.label,legacyButtonQuery:"div.epi-buttonContainer span.epi-cmsButton, span.epi-cmsButton>input.epi-cmsButton-Cancel",onMapDialogButton:function(_703){return !(_703&&_6ff.contains(_703,"epi-cmsButton-Cancel"));},showCloseButton:true};}});});},"epi-cms/contentediting/command/_LegacyDialogCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","epi/routes","epi/shell/command/_Command","epi/UriParser","epi-cms/core/ContentReference","epi-cms/legacy/LegacyDialogPopup"],function(_704,lang,_705,_706,_707,_708,_709,_70a,_70b){return _704([_708],{dialogPath:null,raiseCloseEvent:null,routeParams:null,dialogParams:null,canExecute:true,getContentReference:function(_70c){var _70d=lang.getObject("model.contentData.contentLink",false,this),_70e=_70d?new _70a(_70d):null;if(_70e){_70e=_70c?_70e.toString():_70e.createVersionUnspecificReference().toString();}return _70e;},getRouteParams:function(){return {"id":this.getContentReference(),path:this.dialogPath,moduleArea:"LegacyCMS",IsInLegacyWrapper:true};},getDialogParams:function(){return {};},_createDialog:function(_70f,_710){var _711={url:_707.getActionPath(_710),dialogArguments:window.document,autoFit:true,destroyOnHide:true,onClose:lang.hitch(this,function(){var _712=this.getContentReference();if(this.raiseCloseEvent&&_712){_706.publish("/epi/cms/contentdata/updated",{contentLink:_712,recursive:true});}})};return new _70b(lang.mixin({},_711,_70f));},_execute:function(){_705([this.getDialogParams(),this.getRouteParams()]).then(lang.hitch(this,function(_713){var _714=this._createDialog.apply(this,_713);_714.show();}));}});});},"epi-cms/legacy/LegacyDialogPopup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/DeferredList","epi","epi/shell/widget/dialog/Dialog"],function(_715,lang,_716,_717,_718,_719,epi,_71a){return _715([_71a],{url:null,dialogArguments:null,callbackArguments:null,features:null,autoFit:false,showLoadingOverlay:false,legacyDialogObject:null,defaultActionsVisible:false,legacyButtonQuery:null,contentClass:"epi-dialog-fullWidth",dialogClass:"",dialogTitle:null,_legacyDialogContainer:null,_legacyDialogLoadDeferred:null,wrapper:null,buildRendering:function(){this.inherited(arguments);_716.add(this.domNode,"epi-legacyDialog");},postCreate:function(){this.inherited(arguments);this._legacyDialogContainer=_717.create("div");this.set("content",this._legacyDialogContainer);},onCallback:function(_71b,_71c){},onClose:function(){},onLoad:function(_71d){},onMapDialogButton:function(_71e){return true;},onBeforePerformAction:function(_71f){},show:function(){var _720=new _719([this._loadLegacyDialog(),this.inherited(arguments)]);return _720.then(lang.hitch(this,function(_721){var _722=_721[1];if(this.features&&this.features.left&&this.features.top){this.dialog._relativePosition={x:this.features.left,y:this.features.top};}return _722;}));},_loadLegacyDialog:function(){if(this._legacyDialogLoadDeferred){return this._legacyDialogLoadDeferred;}this._legacyDialogLoadDeferred=new _718();require(["epi-cms/legacy/LegacyDialogWrapper"],lang.hitch(this,function(_723){var _724=new _723({url:this.url,dialogArguments:this.dialogArguments,callbackArguments:this.callbackArguments,features:this.features,autoFit:this.autoFit,showLoadingOverlay:this.showLoadingOverlay,dialogTitle:this.dialogTitle,legacyButtonQuery:this.legacyButtonQuery,showCloseButton:this.showCloseButton},this._legacyDialogContainer);if(this._started&&!_724._started){_724.startup();}this.legacyDialogObject=_724.getLegacyDialog();this.connect(_724,"onMapDialogButton",this.onMapDialogButton);this.connect(_724,"onBeforePerformAction",this.onBeforePerformAction);this.connect(_724,"onCallback",function(_725,_726){this.onCallback(_725,_726);setTimeout(lang.hitch(this,function(){this.hide();}),1);});this.connect(_724,"onLoad",function(){this.set("title",_724.title);this.onLoad(_724);});this.connect(_724,"onCancel",function(){this.hide();});this.connect(_724,"onResize",function(){this.resize();});this.connect(this,"onHide",function(){this.onClose();});this.wrapper=_724;this._legacyDialogLoadDeferred.resolve();}));return this._legacyDialogLoadDeferred;}});});},"epi-cms/contentediting/commandproviders/PublishMenu":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/IgnoreInUseNotification"],function(dojo,_727,_728,_729,_72a){return _727([_728],{constructor:function(){this.inherited(arguments);this.add("commands",_729(new _72a(),{priority:10000}));}});});},"epi-cms/contentediting/command/ForPublishMenu":function(){define(["dojo/_base/lang"],function(lang){return function(_72b,_72c){_72c=lang.mixin({isMain:false,priority:0,resetLabelAfterExecution:true,mainButtonClass:null,keepMenuOpen:false,successStatus:null},_72c);_72b.options=_72c;return _72b;};});},"epi-cms/contentediting/command/IgnoreInUseNotification":function(){define(["dojo/_base/declare","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_72d,_72e,_72f,_730){return _72d([_72f],{name:"IgnoreInUseNotification",label:_730.ignoreinusenotification.label,tooltip:_730.ignoreinusenotification.title,iconClass:"epi-iconPen",inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_72e.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inUseNotificationManager.ignoreOthersNotifications=true;this.model.viewName=null;this._requestContextChange(this.model.contentData.uri,true);},_onModelChange:function(){var _731=this.model.contentData,_732=this.inUseNotificationManager.hasInUseNotificationWarning(_731.inUseNotifications),_733,_734;_733=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_734=this.model.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_733;this.set("isAvailable",_732&&_734);},_requestContextChange:function(uri,_735){var _736={uri:uri};var _737={sender:this,forceContextChange:_735};dojo.publish("/epi/shell/context/request",[_736,_737]);}});});},"epi-cms/contentediting/commandproviders/PublishMenuGlobal":function(){define(["dojo","dojo/_base/declare","epi/shell/command/withConfirmation","epi/shell/command/_CommandProviderMixin","epi-cms/command/TranslateContent","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/Reject","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/EditCommonDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ScheduleForPublish","epi-cms/contentediting/command/CancelAndEdit","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(dojo,_738,_739,_73a,_73b,_73c,_73d,_73e,_73f,_740,_741,_742,_743,_744,_745,res){return _738([_73a],{constructor:function(){this.inherited(arguments);this.add("commands",_73c(new _740(),{resetLabelAfterExecution:true,isMain:true,priority:9000,mainButtonClass:"Sweet",keepMenuOpen:true,successStatus:res.successfullypublished}));this.add("commands",_73c(new _73b(),{isMain:true,priority:10000,mainButtonClass:"Salt"}));this.add("commands",_73c(new _744()));this.add("commands",_73c(new _745()));this.add("commands",_73c(new _73f(),{isMain:true,priority:8000,mainButtonClass:"Sweet",keepMenuOpen:true}));this.add("commands",_73c(new _73e(),{resetLabelAfterExecution:false,keepMenuOpen:true}));this.add("commands",_73c(new _743(),{resetLabelAfterExecution:false,keepMenuOpen:true}));this.add("commands",_73c(new _742()));this.add("commands",_73c(new _741()));this.add("commands",_73c(_739(new _73d(),null,{title:res.reverttopublishconfirmation.dialogtitle,heading:res.reverttopublishconfirmation.confirmquestion,description:res.reverttopublishconfirmation.description})));}});});},"epi/shell/command/withConfirmation":function(){define("epi/shell/command/withConfirmation",["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","epi/shell/widget/dialog/Confirmation"],function(_746,lang,_747,_748){function _749(_74a){var _74b=new _747(),_74c=new _748(_74a);_74c.connect(_74c,"onAction",function(_74d){if(_74d){_74b.resolve();}else{_74b.cancel();}});_74c.show();return _74b;};return function(_74e,_74f,_750){var _751=_74e._execute;_74e._execute=function(){function _752(){_747.when(_751.apply(_74e,arguments),_753.resolve,_753.cancel);};var _753=new _747();_74f=_74f||_749;_747.when(_74f(_750),_752,_753.cancel);return _753;};return _74e;};});},"epi-cms/contentediting/command/EditCommonDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_754,_755,_756,_757){return _754([_755],{name:"editcommondraft",label:_757.editcommondraft.label,tooltip:_757.editcommondraft.title,iconClass:"epi-iconPen",contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_756;},_execute:function(){this.model.editCommonDraft();},_onModelChange:function(){this.inherited(arguments);var _758=this.model.contentData,_759=_758.status,_75a=_756.versionStatus,_75b=this.contentActionSupport.hasAccess(_758.accessMask,_756.accessLevel.Edit),_75c=(_759==_75a.Published||_759==_75a.PreviouslyPublished)&&!_758.isCommonDraft&&_75b&&this.contentActionSupport.hasProviderCapability(_758.providerCapabilityMask,_756.providerCapabilities.Edit);this.set("canExecute",_75c&&this.model.canEditCurrentLanguage());this.set("isAvailable",_75c);}});});},"epi-cms/contentediting/command/ScheduleForPublish":function(){define(["dojo/_base/declare","dojo/aspect","dojo/on","dojo/topic","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/command/_ChangeContentStatus","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/ScheduledPublishSelector","epi-cms/contentediting/ScheduledPublishSelectorViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_75d,_75e,on,_75f,_760,_761,_762,_763,_764,_765,_766){return _75d([_761],{name:"reject",label:_765.scheduleforpublish.label,tooltip:_765.scheduleforpublish.title,iconClass:"epi-iconClock",_execute:function(){var _767=new _764();_767.set("contentData",this.model.contentData);var _768=new _763({model:_767});var self=this,_769=_762.saveAction;self.set("action",_769.CheckIn|_769.DelayedPublish|_769.ForceCurrentVersion);var _76a=new _760({content:_768,title:_766.title,defaultActionsVisible:false});on(_76a,"execute",function(){self.model.setProperty("iversionable_startpublish",_767.dateValue);self._changeContentStatus();});_76a.show(true);_75e.after(_76a,"_onSubmit",function(){_75f.publish("/epi/cms/action/disableundoredoactions");});},_onModelChange:function(){this.inherited(arguments);var _76b=this.model.contentData,_76c=(_76b.status===_762.versionStatus.CheckedOut)||(_76b.status===_762.versionStatus.Rejected)||(_76b.status===_762.versionStatus.Published&&_76b.isCommonDraft),_76d=_76c&&this.model.canChangeContent(_762.action.Publish);this.set("canExecute",_76d);this.set("isAvailable",_76c);}});});},"epi-cms/contentediting/ScheduledPublishSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/DateTimeSelectorDropDown","epi/shell/widget/dialog/_DialogContentMixin","epi-cms/widget/Breadcrumb","./ScheduledPublishSelectorViewModel","dojo/text!./templates/ScheduledPublishSelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector","epi/i18n!epi/nls/episerver.shared"],function(_76e,lang,_76f,_770,_771,_772,_773,_774,_775,_776,_777,_778,_779,_77a){return _76e([_76f,_770,_771,_773,_772,_775],{templateString:_778,modelData:null,_setTitleAttr:{node:"contentNameNode",type:"innerText"},_setDateLabelAttr:{node:"publishChangesCaptionNode",type:"innerHTML"},_setDateValueAttr:function(date){this.dateTimeSelector.set("value",date);},_setBreadcrumbModelAttr:function(_77b){this.breadcrumbNode.set("contentLink",_77b);},_setScheduleButtonEnabledAttr:function(_77c){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_77c);}},modelBindingMap:{"title":["title"],"dateLabel":["dateLabel"],"dateValue":["dateValue"],"breadcrumbModel":["breadcrumbModel"],"scheduleButtonEnabled":["scheduleButtonEnabled"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _777(this.modelData);},postCreate:function(){this.inherited(arguments);this.connect(this.dateTimeSelector,"onChange","dateTimeSelectorChanged");},dateTimeSelectorChanged:function(_77d){this.model.set("dateValue",_77d);},getActions:function(){this._actions=[{name:"save",label:_779.confirmtext,settings:{type:"button","class":"Salt",disabled:true},action:lang.hitch(this,function(){if(this.dateTimeSelector.validate()){this.executeDialog();}})},{name:"cancel",label:_77a.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"epi-cms/contentediting/ScheduledPublishSelectorViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_77e,_77f,_780,_781){return _77e([_77f,_780],{breadcrumbModel:null,title:"",dateLabel:"",dateValue:null,scheduleButtonEnabled:false,constructor:function(){var _782=new Date();_782.setDate(_782.getDate()+1);_782.setHours(12,0,0,0);this.set("dateValue",_782);},_setIsPublishedAttr:function(_783){this.set("dateLabel",_783?_781.publishchangeson:_781.publishon);},_setContentDataAttr:function(_784){this.set("title",_784.name);this.set("isPublished",!_784.isPendingPublish);this.set("breadcrumbModel",_784.contentLink);},_setDateValueAttr:function(_785){this._set("dateValue",_785);this.set("scheduleButtonEnabled",!!_785);}});});},"url:epi-cms/contentediting/templates/ScheduledPublishSelector.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumbNode\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-attach-point=\"publishChangesCaptionNode\"></div>\r\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\" data-dojo-props=\"required:true\"></div>\r\n</div>","epi-cms/contentediting/command/CancelAndEdit":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/date","epi/shell/command/_Command","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.cancelandedit"],function(_786,_787,lang,_788,_789,_78a,_78b,_78c,_78d){return _786([_78c],{name:"cancelAndEdit",label:_78d.label,tooltip:_78d.title,iconClass:"epi-iconPen",action:_78b.action.Reject,_execute:function(){this.inherited(arguments).then(lang.hitch(this,function(){var _78e=this.model.contentData;this.model.setProperty("iversionable_startpublish",_78e.isPendingPublish?_78e.created:_78e.lastPublished);}));},_onModelChange:function(){this.inherited(arguments);var _78f=this.model.contentData,_790=_78f.status,_791=_78b.hasAccess(_78f.accessMask,_78b.accessLevel.Edit),_792=_791&&(_790===_78b.versionStatus.DelayedPublish);this.set("canExecute",_792);this.set("isAvailable",_792);}});});},"epi-cms/contentediting/viewsettings/ChannelViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_793,lang,_794){return _793([_794],{key:"epichannel",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_795,_796){this.inherited(arguments);if(_796&&this.value){_795.epichannel=this.value;}else{delete _795.epichannel;}}});});},"epi-cms/contentediting/_ViewSetting":function(){define(["dojo/_base/declare","epi/shell/_StatefulGetterSetterMixin"],function(_797,_798){return _797(_798,{key:null,value:null,enabled:null,beforePreviewLoad:function(_799,_79a){},afterPreviewLoad:function(_79b,_79c){}});});},"epi-cms/contentediting/viewsettings/ResolutionViewSetting":function(){define(["dojo/_base/declare","epi-cms/contentediting/_ViewSetting"],function(_79d,_79e){return _79d([_79e],{key:"resolution",usedForRendering:false,afterPreviewLoad:function(_79f,_7a0){this.inherited(arguments);if(_79f){var size=_7a0?this._getPreviewResolution():null;_79f.set("previewSize",size);_79f.set("devicePreviewClass",this.value?"epi-editorViewport--device-preview epi-viewPort-"+this.value:"");}return null;},_getPreviewResolution:function(){var size=null;var _7a1=this.value;if(_7a1){var _7a2=_7a1.split("x");if(_7a2.length==2){size={"w":_7a2[0],"h":_7a2[1]};}}return size;}});});},"epi-cms/contentediting/viewsettings/ViewLanguageViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","epi-cms/contentediting/_ViewSetting"],function(_7a3,lang,_7a4,_7a5){return _7a3([_7a5],{key:"viewlanguage",usedForRendering:true,isTagItem:false,initialize:function(_7a6){_7a6.registerRequestInterceptor(lang.hitch(this,this._onContextChange));},_onContextChange:function(_7a7,_7a8){var dfd=new _7a4();dfd.resolve();if(this.get("enabled")&&this.value){_7a7.epslanguage=this.value;}return dfd;}});});},"epi-cms/contentediting/viewsettings/VisitorGroupViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_7a9,lang,_7aa){return _7a9([_7aa],{key:"visitorgroup",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_7ab,_7ac){this.inherited(arguments);if(_7ac&&this.value){_7ab.visitorgroupsByID=this.value;}else{delete _7ab.visitorgroupsByID;}}});});},"epi-cms/Profile":function(){define("epi-cms/Profile",["dojo/_base/lang","dojo/Deferred","dojo/when","epi/dependency","epi/shell/Profile","epi-cms/ApplicationSettings"],function(lang,_7ad,when,_7ae,_7af,_7b0){var _7b1=function(host){return "editlanguage_"+host.replace(":","");};lang.extend(_7af,{getContentLanguage:function(host){host=host||window.location.host;return when(this.get(_7b1(host)),function(_7b2){return _7b2||_7b0.currentContentLanguage;});},setContentLanguage:function(_7b3,host){return this.set(_7b1(host),_7b3,{location:"server"});}});return _7af;});},"epi-cms/component/ContextHistory":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/dependency","epi/UriParser","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase"],function(_7b4,_7b5,lang,_7b6,_7b7,_7b8,_7b9,_7ba,_7bb){return _7b5([_7bb],{ignoreVersionWhenComparingLinks:false,postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_7b7.resolve("epi.shell.ContextHistory").store;},buildRendering:function(){this.inherited(arguments);var _7bc=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)}},store:this.store,selectionMode:"single"},this.defaultGridMixin);this.grid=new this._gridClass(_7bc,this.domNode);this.grid.set("showHeader",false);},postCreate:function(){this.inherited(arguments);_7b6.subscribe("/epi/cms/trash/empty",lang.hitch(this,function(_7bd){if(_7bd){_7bd.forEach(function(_7be){this.store.remove("epi.cms.contentdata:///"+_7be);},this);}}));},startup:function(){this.inherited(arguments);this.fetchData();},_dndNodeCreator:function(item,hint){var _7bf=this.inherited(arguments);_7bf.data.contentLink=new _7b8(_7bf.data.uri).getId();return _7bf;},contextChanged:function(){this.inherited(arguments);this.grid.set("sort","dateAdded",true);},fetchData:function(){var _7c0=_7b9.wastebasketPage;this.grid.set("query",{uri:new RegExp("epi\\.cms\\.contentdata:///([^"+_7c0+"]|\\d{2,})")});this.grid.set("sort","dateAdded",true);}});});},"epi-cms/component/GlobalToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/store/Memory","dijit/registry","dijit/Toolbar","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/_WidgetCommandConsumerMixin","epi/shell/command/builder/_Builder","epi/shell/command/builder/GroupedButtonBuilder","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/DropDownButtonBuilder","dojo/text!./templates/GlobalToolbar.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_7c1,lang,_7c2,_7c3,_7c4,_7c5,_7c6,_7c7,_7c8,_7c9,_7ca,_7cb,_7cc,_7cd){var _7ce=_7c1([_7c8],{_create:function(_7cf){var _7d0=_7c1([_7cf.settings.widget,_7c6]),_7d1=new _7d0(_7cf.settings);return _7d1;},_addToContainer:function(_7d2,_7d3){_7d2.placeAt(_7d3);_7d2.startup();}});var _7d4=_7c1([_7ca],{_getBuildInfo:function(_7d5){if(_7d5.settings.category){var i=this.configuration.length-1;for(;i>0;i--){if(this.configuration[i].category==_7d5.settings.category){return this.configuration[i];}}}return this.configuration[0];}});return _7c1([_7c5,_7c7],{templateString:_7cc,commandKey:"epi.cms.globalToolbar",postCreate:function(){this.inherited(arguments);var _7d6=new _7ce();var _7d7=new _7cb({settings:{title:_7cd.createcontent.title,"class":"epi-mediumButton epi-disabledDropdownArrow",iconClass:"epi-iconPlus",showLabel:false}});var _7d8=new _7c9({settings:{baseClass:"epi-mediumButton epi-expandoButton"}});var _7d9=[{category:"leading",builder:_7d6,target:this.leadingContainerNode},{category:"view",builder:_7d8,target:this.leadingContainerNode},{category:"center",builder:_7d6,target:this.centerContainerNode},{category:"trailing",builder:_7d6,target:this.trailingContainerNode},{category:"create",builder:_7d7,target:this.leadingContainerNode}];var _7da=new _7d4({configuration:_7d9,commandSource:this});_7da.build();},_getNextFocusableChild:function(_7db,dir){var _7dc=this.getChildren();var _7dd=_7dc.indexOf(_7db);_7dd=(dir>0)?_7dd+1:_7dd-1;if(_7dd<0){_7dd=_7dc.length-1;}else{if(_7dd>=_7dc.length){_7dd=0;}}return _7dc[_7dd];}});});},"epi/shell/command/_WidgetCommandConsumerMixin":function(){define("epi/shell/command/_WidgetCommandConsumerMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_WidgetCommandProviderMixin"],function(_7de,_7df,_7e0){return _7de([_7df,_7e0],{});});},"epi/shell/command/_WidgetCommandProviderMixin":function(){define("epi/shell/command/_WidgetCommandProviderMixin",["dojo/_base/declare","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/command/_GlobalCommandProviderMixin"],function(_7e1,_7e2,_7e3){return _7e1([_7e3,_7e2],{postMixInProperties:function(){this.inherited(arguments);this.commandProvider=this.commandProvider||this;}});});},"epi/shell/command/_WidgetCommandBinderMixin":function(){define("epi/shell/command/_WidgetCommandBinderMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin"],function(_7e4,_7e5){return _7e4(null,{commandProvider:null,_consumerHandle:null,startup:function(){if(this._started){return;}this.inherited(arguments);var _7e6=this.getConsumer();if(!_7e6){return;}this._consumerHandle=_7e6.addProvider(this.commandProvider||this);this.commandProvider.initializeCommandProviders&&this.commandProvider.initializeCommandProviders();},getConsumer:function(){if(this.isInstanceOf(_7e5)){return this;}var _7e7=this.getParent();while(_7e7){if(_7e7.isInstanceOf(_7e5)){return _7e7;}_7e7=_7e7.getParent();}},destroy:function(){this._consumerHandle&&this._consumerHandle.removeProvider();this.inherited(arguments);}});});},"epi/shell/command/_GlobalCommandProviderMixin":function(){define("epi/shell/command/_GlobalCommandProviderMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/shell/command/_CommandProviderMixin","epi/dependency"],function(_7e8,_7e9,lang,_7ea,_7eb){return _7e9([_7ea],{commandKey:null,commandProviders:null,_consumer:null,_currentCommandModel:null,_providerWatch:null,_initialized:false,initializeCommandProviders:function(){if(this.initialized||!this.commandKey||!this.getConsumer){return;}this._consumer=this.getConsumer();if(!this._consumer){return;}this.commandRegistry=this.commandRegistry||_7eb.resolve("epi.globalcommandregistry");this.commandProviders=this.commandRegistry.get(this.commandKey,true);_7e8.forEach(this.commandProviders.providers,function(_7ec){this._consumer.addProvider(_7ec);},this);this._providerWatch=this.commandProviders.watch("providers",lang.hitch(this,this.onProvidersChanged));this.initialized=true;},updateCommandModel:function(_7ed){this._currentCommandModel=_7ed;_7e8.forEach(this.commandProviders.providers,function(_7ee){if(_7ee.updateCommandModel){_7ee.updateCommandModel(_7ed);}},this);},onProvidersChanged:function(name,_7ef,_7f0){if(_7ef){_7e8.forEach(_7ef,this._consumer.removeProvider,this._consumer);}if(_7f0){_7e8.forEach(_7f0,function(item){this._consumer.addProvider(item);if(item.updateCommandModel){item.updateCommandModel(this._currentCommandModel);}},this);}},destroy:function(){if(this._consumer&&this.commandProviders){_7e8.forEach(this.commandProviders.providers,this._consumer.removeProvider,this);}this._providerWatch&&this._providerWatch.unwatch();this.inherited(arguments);}});});},"epi/shell/command/builder/GroupedButtonBuilder":function(){define("epi/shell/command/builder/GroupedButtonBuilder",["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/builder/_Builder","epi/shell/widget/ListContainer","epi/shell/widget/ExpandoButton"],function(_7f1,lang,_7f2,_7f3,_7f4,_7f5,_7f6){return _7f1([_7f4],{_create:function(_7f7){var d={declare:_7f1};var _7f8=d["declare"]([_7f7.settings.widget,_7f3]),_7f9=new _7f8(lang.mixin(_7f7.settings,this.itemSettings));return _7f9;},_addToContainer:function(_7fa,_7fb){this._createListContainer(_7fa,_7fb);if(this._containerAdded){if(_7fa.model){_7fa.model.watch("isAvailable",lang.hitch(this,function(){if(this._listContainer.updateVisibility){this._listContainer.updateVisibility();}}));}}this.inherited(arguments,[_7fa,this._listContainer]);if(this._listContainer.getChildren().length>1){_7f2.add(_7fa.getParent().domNode,"epi-leftSeparator");}},_createListContainer:function(_7fc,_7fd){if(this._containerAdded){return;}this._listContainer=new _7f5(this.settings);this._listContainer._commandCategory=_7fc._commandCategory;if(_7fd.addChild){_7fd.addChild(this._listContainer);}else{this._listContainer.placeAt(_7fd);this._listContainer.startup();}this._containerAdded=true;}});});},"url:epi-cms/component/templates/GlobalToolbar.html":"<div class=\"dijit epi-globalToolbar\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">\r\n    <div class=\"epi-toolbarGroupContainer\">\r\n        <div data-dojo-attach-point=\"leadingContainerNode\" class=\"epi-toolbarLeading epi-toolbarGroup\"></div>\r\n        <div data-dojo-attach-point=\"centerContainerNode\" class=\"epi-toolbarCenter epi-toolbarGroup\"></div>\r\n        <div data-dojo-attach-point=\"trailingContainerNode\" class=\"epi-toolbarTrailing epi-toolbarGroup\"></div>\r\n    </div>\r\n</div>","epi-cms/component/MainNavigationComponent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/dependency","epi-cms/widget/SearchBox"],function(_7fe,_7ff,lang,_800,_801,_802,_803,_804,_805,_806){return _7ff([_801,_802,_803],{templateString:"<div>                            <div data-dojo-type=\"epi-cms/widget/SearchBox\" data-dojo-attach-point=\"search\" class=\"epi-gadgetInnerToolbar\"></div>                            <div data-dojo-attach-point=\"navigation\" style=\"overflow:auto;\">                            </div>                        </div>",contentRepositoryDescriptors:null,postCreate:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_804.resolve("epi.cms.contentRepositoryDescriptors");var _807=this.contentRepositoryDescriptors[this.repositoryKey];var _808=this.roots?this.roots:_807.roots;this.search.set("area",_807.searchArea);this.search.set("searchRoots",_808);var _809=_807.customNavigationWidget||"epi-cms/component/ContentNavigationTree";require([_809],lang.hitch(this,function(_80a){var _80b=new _80a({typeIdentifiers:_807.mainNavigationTypes?_807.mainNavigationTypes:_807.containedTypes,containedTypes:_807.containedTypes,settings:_807,roots:_808,repositoryKey:this.repositoryKey});_80b.placeAt(this.navigation);this.tree=_80b;this.own(this.tree.watch("showAllLanguages",lang.hitch(this,function(){this.search.set("filterOnCulture",!this.tree.get("showAllLanguages"));})));}));},layout:function(){var cb=this._contentBox,sb=_800.getMarginBox(this.search.domNode);_800.setMarginBox(this.navigation,{w:cb.w,h:cb.h-sb.h});if(this.tree){this.tree.resize();}}});});},"epi-cms/widget/SearchBox":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/connect","dojo/_base/json","dojo/_base/lang","dojo/dom-construct","dijit/_Widget","epi/shell/SearchManager","epi-cms/widget/ContentSearchBox"],function(_80c,_80d,_80e,json,lang,_80f,_810,_811,_812){return _80c([_810],{area:null,searchRoots:null,filterOnCulture:null,triggerContextChange:true,_searchBox:null,_searchManager:null,postCreate:function(){this.inherited(arguments);this._searchManager=new _811();_80d.when(this._searchManager.getStore(),lang.hitch(this,function(_813){this._searchBox=new _812({"searchAttr":"searchQuery","store":_813});var _814={filterOnDeleted:true};lang.mixin(this._searchBox.query,{parameters:json.toJson(_814)});this._searchBox.on("select",lang.hitch(this,function(_815){this._searchBox.set("value","");this._searchBox.focus();this._searchBox.toggleClearButton();this.onItemAction(_815);}));this.set("filterOnCulture",false);_80f.place(this._searchBox.domNode,this.domNode);}));},_setAreaAttr:function(_816){this._set("area",_816);if(this._searchBox){_80d.when(this._searchManager.getProviderQuery(_816),lang.hitch(this,function(_817){lang.mixin(this._searchBox.query,_817);}));}},_setSearchRootsAttr:function(_818){this._set("searchRoots",_818);if(this._searchBox){lang.mixin(this._searchBox.query,{searchRoots:_818});}},_setFilterOnCultureAttr:function(_819){this._set("filterOnCulture",_819);if(this._searchBox){lang.mixin(this._searchBox.query,{filterOnCulture:_819});}},onItemAction:function(item){if(this.triggerContextChange){var _81a={uri:"epi.cms.contentdata:///"+item.metadata.id};if(item.metadata.isUntranslatedContent=="false"){_81a.epslanguage=item.metadata.languageBranch;}_80e.publish("/epi/shell/context/request",[_81a,{sender:null}]);}}});});},"epi/shell/SearchManager":function(){define("epi/shell/SearchManager",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/array","dojo/_base/lang","dojo/DeferredList","epi/dependency"],function(_81b,_81c,_81d,lang,_81e,_81f){return _81b(null,{_providersStore:null,_resultsStore:null,constructor:function(){this._setupStores();},getProviderQuery:function(area){var _820=new _81c();_81c.when(this.getProviders(area),dojo.hitch(this,function(_821){if(_821&&_821.length>0){_820.resolve(this._getQuery(_821[0],{}));}else{_820.resolve();}}));return _820;},getProviders:function(area){var _822=new _81c();_81c.when(this._providersStore.query({searchArea:area}),function(_823){if(_823&&_823.length>0){_822.resolve(_823);}else{_822.resolve();}});return _822;},getStore:function(){return this._resultsStore;},search:function(area,_824){var _825=new _81c();_81c.when(this.getProviders(area),lang.hitch(this,function(_826){if(_826&&_826.length>0){var _827=[];_81d.forEach(_826,function(_828,_829){_827.push(this._getData(_828,_824));},this);var _82a=new _81e(_827),data=[];_82a.then(function(_82b){_81d.forEach(_82b,function(item){if(lang.isArray(item[1])){data=data.concat(item[1]);}});_825.resolve(data);});}}));return _825;},_setupStores:function(){var _82c=_81f.resolve("epi.storeregistry");this._providersStore=_82c.get("epi.shell.searchproviders");this._resultsStore=_82c.get("epi.shell.searchresults");},_getQuery:function(_82d,_82e){var _82f={providerId:_82d.id};lang.mixin(_82f,_82e||{});return _82f;},_getData:function(_830,_831){var _832=new _81c();_81c.when(this._resultsStore.query(this._getQuery(_830,_831)),function(_833){if(_833&&_833.length>0){_832.resolve(_833);}else{_832.resolve();}});return _832;}});});},"epi-cms/widget/ContentSearchBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/Evented","dojo/keys","dojo/dom-attr","dojo/dom-style","epi/shell/widget/SuggestionBox","epi-cms/widget/SearchResultList","epi/i18n!epi/cms/nls/episerver.cms.widget.contentlist"],function(_834,lang,_835,_836,_837,keys,_838,_839,_83a,_83b,_83c){return _834([_83a,_837],{res:_83c,autoComplete:false,dropDownClass:_83b,queryExpr:"${0}",minimumNumberOfChar:1,postCreate:function(){this.inherited(arguments);this.searchDelay=this.defaultDelay;this.on("beforeSearch",lang.hitch(this,function(){if(this.dropDown){this.dropDown.showStandby(true);}}));this.on("searchComplete",lang.hitch(this,function(_83d){if(this.dropDown){this.dropDown.showStandby(false);}}));_836.before(this,"_startSearch",function(_83e,args){this.emit("beforeSearch",{});return [_83e,args];});},_openResultList:function(_83f,_840,_841){this.emit("searchComplete",_83f);this._fetchHandle=null;this.dropDown.clearResultList();var _842=_83f.length>0||_841.start!==0;this.dropDown.showErrorMessage(!_842,this.res.contentnotfound);this.dropDown.showGrid(_842);if(_842){this.dropDown.createOptions(_83f,_841,lang.hitch(this,"_getMenuLabelFromItem"));}this._showResultList();},_onDropDownMouseDown:function(e){e.stopPropagation();},_onKey:function(evt){switch(evt.keyCode){case keys.ENTER:if(this.dropDown&&this.dropDown.selected){this.dropDown.handleKey(evt);this.closeDropDown();}else{if(!this._fetchHandle){this._startSearchFromInput();_835.stop(evt);}}break;case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:if(this.dropDown){this.dropDown.handleKey(evt);}_835.stop(evt);break;case keys.LEFT_ARROW:case keys.RIGHT_ARROW:break;default:this.inherited(arguments);}},_startSearchFromInput:function(){var key=this.focusNode.value;if(!key||key.length<this.minimumNumberOfChar){this.closeDropDown();return;}if(!this.dropDown){var _843=this.id+"_popup",_844=lang.isString(this.dropDownClass)?lang.getObject(this.dropDownClass,false):this.dropDownClass;this.dropDown=new _844({id:_843,dir:this.dir,textDir:this.textDir});_838.remove(this.textbox,"aria-activedescendant");_838.set(this.textbox,"area-owns",_843);this.dropDown.on("select",lang.hitch(this,function(_845){this.closeDropDown();this.emit("select",_845);}));_839.set(this.dropDown.domNode,"width",this.textbox.clientWidth+"px");}this._showResultList();var _846=key.replace(new RegExp("\\W+"),"").length===0;this.dropDown.showErrorMessage(_846,this.res.notsearchspecialcharacter);if(!_846){this._startSearch(key);}},_startSearchAll:function(){}});});},"epi/shell/widget/SuggestionBox":function(){define("epi/shell/widget/SuggestionBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dijit/_HasDropDown","dijit/form/_ComboBoxMenu","dijit/form/_AutoCompleterMixin","epi/shell/widget/SearchBox"],function(_847,lang,_848,_849,_84a,_84b,_84c){return _847([_84c,_849,_84b],{dropDownClass:_84a,buildRendering:function(){this.inherited(arguments);_848.set(this.textbox,"autocomplete","off");_848.set(this.textbox,"aria-haspopup","true");},postCreate:function(){this.inherited(arguments);this.connect(this.clearButton,"onclick",lang.hitch(this,function(){this.closeDropDown();}));}});});},"dijit/form/_ComboBoxMenu":function(){define("dijit/form/_ComboBoxMenu",["dojo/_base/declare","dojo/dom-class","dojo/dom-style","dojo/keys","../_WidgetBase","../_TemplatedMixin","./_ComboBoxMenuMixin","./_ListMouseMixin"],function(_84d,_84e,_84f,keys,_850,_851,_852,_853){return _84d("dijit.form._ComboBoxMenu",[_850,_851,_853,_852],{templateString:"<div class='dijitReset dijitMenu' data-dojo-attach-point='containerNode' style='overflow: auto; overflow-x: hidden;' role='listbox'>"+"<div class='dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point='previousButton' role='option'></div>"+"<div class='dijitMenuItem dijitMenuNextButton' data-dojo-attach-point='nextButton' role='option'></div>"+"</div>",baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);if(!this.isLeftToRight()){_84e.add(this.previousButton,"dijitMenuItemRtl");_84e.add(this.nextButton,"dijitMenuItemRtl");}},_createMenuItem:function(){var item=this.ownerDocument.createElement("div");item.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");item.setAttribute("role","option");return item;},onHover:function(node){_84e.add(node,"dijitMenuItemHover");},onUnhover:function(node){_84e.remove(node,"dijitMenuItemHover");},onSelect:function(node){_84e.add(node,"dijitMenuItemSelected");},onDeselect:function(node){_84e.remove(node,"dijitMenuItemSelected");},_page:function(up){var _854=0;var _855=this.domNode.scrollTop;var _856=_84f.get(this.domNode,"height");if(!this.getHighlightedOption()){this.selectNextNode();}while(_854<_856){var _857=this.getHighlightedOption();if(up){if(!_857.previousSibling||_857.previousSibling.style.display=="none"){break;}this.selectPreviousNode();}else{if(!_857.nextSibling||_857.nextSibling.style.display=="none"){break;}this.selectNextNode();}var _858=this.domNode.scrollTop;_854+=(_858-_855)*(up?-1:1);_855=_858;}},handleKey:function(evt){switch(evt.keyCode){case keys.DOWN_ARROW:this.selectNextNode();return false;case keys.PAGE_DOWN:this._page(false);return false;case keys.UP_ARROW:this.selectPreviousNode();return false;case keys.PAGE_UP:this._page(true);return false;default:return true;}}});});},"dijit/form/_ComboBoxMenuMixin":function(){define("dijit/form/_ComboBoxMenuMixin",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/i18n","dojo/i18n!./nls/ComboBox"],function(_859,_85a,_85b,i18n){return _85a("dijit.form._ComboBoxMenuMixin",null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=i18n.getLocalization("dijit.form","ComboBox",this.lang);},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages["previousMessage"];this.nextButton.innerHTML=this._messages["nextMessage"];},_setValueAttr:function(_85c){this.value=_85c;this.onChange(_85c);},onClick:function(node){if(node==this.previousButton){this._setSelectedAttr(null);this.onPage(-1);}else{if(node==this.nextButton){this._setSelectedAttr(null);this.onPage(1);}else{this.onChange(node);}}},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null);},_createOption:function(item,_85d){var _85e=this._createMenuItem();var _85f=_85d(item);if(_85f.html){_85e.innerHTML=_85f.label;}else{_85e.appendChild(_85e.ownerDocument.createTextNode(_85f.label));}if(_85e.innerHTML==""){_85e.innerHTML="&#160;";}this.applyTextDir(_85e,(_85e.innerText||_85e.textContent||""));return _85e;},createOptions:function(_860,_861,_862){this.items=_860;this.previousButton.style.display=(_861.start==0)?"none":"";_85b.set(this.previousButton,"id",this.id+"_prev");_859.forEach(_860,function(item,i){var _863=this._createOption(item,_862);_863.setAttribute("item",i);_85b.set(_863,"id",this.id+i);this.nextButton.parentNode.insertBefore(_863,this.nextButton);},this);var _864=false;if(_860.total&&!_860.total.then&&_860.total!=-1){if((_861.start+_861.count)<_860.total){_864=true;}else{if((_861.start+_861.count)>_860.total&&_861.count==_860.length){_864=true;}}}else{if(_861.count==_860.length){_864=true;}}this.nextButton.style.display=_864?"":"none";_85b.set(this.nextButton,"id",this.id+"_next");},clearResultList:function(){var _865=this.containerNode;while(_865.childNodes.length>2){_865.removeChild(_865.childNodes[_865.childNodes.length-2]);}this._setSelectedAttr(null);},highlightFirstOption:function(){this.selectFirstNode();},highlightLastOption:function(){this.selectLastNode();},selectFirstNode:function(){this.inherited(arguments);if(this.getHighlightedOption()==this.previousButton){this.selectNextNode();}},selectLastNode:function(){this.inherited(arguments);if(this.getHighlightedOption()==this.nextButton){this.selectPreviousNode();}},getHighlightedOption:function(){return this.selected;}});});},"dijit/form/_ListMouseMixin":function(){define("dijit/form/_ListMouseMixin",["dojo/_base/declare","dojo/mouse","dojo/on","dojo/touch","./_ListBase"],function(_866,_867,on,_868,_869){return _866("dijit.form._ListMouseMixin",_869,{postCreate:function(){this.inherited(arguments);this.own(on(this.domNode,_868.press,function(evt){evt.preventDefault();}));this._listConnect(_868.press,"_onMouseDown");this._listConnect(_868.release,"_onMouseUp");this._listConnect(_867.enter,"_onMouseOver");this._listConnect(_867.leave,"_onMouseOut");},_onMouseDown:function(evt,_86a){if(this._hoveredNode){this.onUnhover(this._hoveredNode);this._hoveredNode=null;}this._isDragging=true;this._setSelectedAttr(_86a);},_onMouseUp:function(evt,_86b){this._isDragging=false;var _86c=this.selected;var _86d=this._hoveredNode;if(_86c&&_86b==_86c){this.onClick(_86c);}else{if(_86d&&_86b==_86d){this._setSelectedAttr(_86d);this.onClick(_86d);}}},_onMouseOut:function(evt,_86e){if(this._hoveredNode){this.onUnhover(this._hoveredNode);this._hoveredNode=null;}if(this._isDragging){this._cancelDrag=(new Date()).getTime()+1000;}},_onMouseOver:function(evt,_86f){if(this._cancelDrag){var time=(new Date()).getTime();if(time>this._cancelDrag){this._isDragging=false;}this._cancelDrag=null;}this._hoveredNode=_86f;this.onHover(_86f);if(this._isDragging){this._setSelectedAttr(_86f);}}});});},"dijit/form/_ListBase":function(){define("dijit/form/_ListBase",["dojo/_base/declare","dojo/on","dojo/window"],function(_870,on,_871){return _870("dijit.form._ListBase",null,{selected:null,_listConnect:function(_872,_873){var self=this;return self.own(on(self.containerNode,on.selector(function(_874,_875,_876){return _874.parentNode==_876;},_872),function(evt){evt.preventDefault();self[_873](evt,this);}));},selectFirstNode:function(){var _877=this.containerNode.firstChild;while(_877&&_877.style.display=="none"){_877=_877.nextSibling;}this._setSelectedAttr(_877);},selectLastNode:function(){var last=this.containerNode.lastChild;while(last&&last.style.display=="none"){last=last.previousSibling;}this._setSelectedAttr(last);},selectNextNode:function(){var _878=this.selected;if(!_878){this.selectFirstNode();}else{var next=_878.nextSibling;while(next&&next.style.display=="none"){next=next.nextSibling;}if(!next){this.selectFirstNode();}else{this._setSelectedAttr(next);}}},selectPreviousNode:function(){var _879=this.selected;if(!_879){this.selectLastNode();}else{var prev=_879.previousSibling;while(prev&&prev.style.display=="none"){prev=prev.previousSibling;}if(!prev){this.selectLastNode();}else{this._setSelectedAttr(prev);}}},_setSelectedAttr:function(node){if(this.selected!=node){var _87a=this.selected;if(_87a){this.onDeselect(_87a);this.selected=null;}if(node){this.selected=node;_871.scrollIntoView(node);this.onSelect(node);}}else{if(node){this.onSelect(node);}}}});});},"dijit/form/_AutoCompleterMixin":function(){define("dijit/form/_AutoCompleterMixin",["dojo/data/util/filter","dojo/_base/declare","dojo/dom-attr","dojo/_base/event","dojo/keys","dojo/_base/lang","dojo/query","dojo/regexp","dojo/sniff","dojo/string","./DataList","../registry","./_TextBoxMixin","./_SearchMixin"],function(_87b,_87c,_87d,_87e,keys,lang,_87f,_880,has,_881,_882,_883,_884,_885){return _87c("dijit.form._AutoCompleterMixin",_885,{item:null,autoComplete:true,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:false,_getCaretPos:function(_886){var pos=0;if(typeof (_886.selectionStart)=="number"){pos=_886.selectionStart;}else{if(has("ie")){var tr=_886.ownerDocument.selection.createRange().duplicate();var ntr=_886.createTextRange();tr.move("character",0);ntr.move("character",0);try{ntr.setEndPoint("EndToEnd",tr);pos=String(ntr.text).replace(/\r/g,"").length;}catch(e){}}}return pos;},_setCaretPos:function(_887,_888){_888=parseInt(_888);_884.selectInputText(_887,_888,_888);},_setDisabledAttr:function(_889){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",_889?"true":"false");},_onKey:function(evt){if(evt.charCode>=32){return;}var key=evt.charCode||evt.keyCode;if(key==keys.ALT||key==keys.CTRL||key==keys.META||key==keys.SHIFT){return;}var pw=this.dropDown;var _88a=null;this._abortQuery();this.inherited(arguments);if(evt.altKey||evt.ctrlKey||evt.metaKey){return;}if(this._opened){_88a=pw.getHighlightedOption();}switch(key){case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:if(this._opened){this._announceOption(_88a);}_87e.stop(evt);break;case keys.ENTER:if(_88a){if(_88a==pw.nextButton){this._nextSearch(1);_87e.stop(evt);break;}else{if(_88a==pw.previousButton){this._nextSearch(-1);_87e.stop(evt);break;}}_87e.stop(evt);}else{this._setBlurValue();this._setCaretPos(this.focusNode,this.focusNode.value.length);}case keys.TAB:var _88b=this.get("displayedValue");if(pw&&(_88b==pw._messages["previousMessage"]||_88b==pw._messages["nextMessage"])){break;}if(_88a){this._selectOption(_88a);}case keys.ESCAPE:if(this._opened){this._lastQuery=null;this.closeDropDown();}break;}},_autoCompleteText:function(text){var fn=this.focusNode;_884.selectInputText(fn,fn.value.length);var _88c=this.ignoreCase?"toLowerCase":"substr";if(text[_88c](0).indexOf(this.focusNode.value[_88c](0))==0){var cpos=this.autoComplete?this._getCaretPos(fn):fn.value.length;if((cpos+1)>fn.value.length){fn.value=text;_884.selectInputText(fn,cpos);}}else{fn.value=text;_884.selectInputText(fn);}},_openResultList:function(_88d,_88e,_88f){var _890=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();if(!_88d.length&&_88f.start==0){this.closeDropDown();return;}this._nextSearch=this.dropDown.onPage=lang.hitch(this,function(_891){_88d.nextPage(_891!==-1);this.focus();});this.dropDown.createOptions(_88d,_88f,lang.hitch(this,"_getMenuLabelFromItem"));this._showResultList();if("direction" in _88f){if(_88f.direction){this.dropDown.highlightFirstOption();}else{if(!_88f.direction){this.dropDown.highlightLastOption();}}if(_890){this._announceOption(this.dropDown.getHighlightedOption());}}else{if(this.autoComplete&&!this._prev_key_backspace&&!/^[*]+$/.test(_88e[this.searchAttr].toString())){this._announceOption(this.dropDown.containerNode.firstChild.nextSibling);}}},_showResultList:function(){this.closeDropDown(true);this.openDropDown();this.domNode.setAttribute("aria-expanded","true");},loadDropDown:function(){this._startSearchAll();},isLoaded:function(){return false;},closeDropDown:function(){this._abortQuery();if(this._opened){this.inherited(arguments);this.domNode.setAttribute("aria-expanded","false");this.focusNode.removeAttribute("aria-activedescendant");}},_setBlurValue:function(){var _892=this.get("displayedValue");var pw=this.dropDown;if(pw&&(_892==pw._messages["previousMessage"]||_892==pw._messages["nextMessage"])){this._setValueAttr(this._lastValueReported,true);}else{if(typeof this.item=="undefined"){this.item=null;this.set("displayedValue",_892);}else{if(this.value!=this._lastValueReported){this._handleOnChange(this.value,true);}this._refreshState();}}},_setItemAttr:function(item,_893,_894){var _895="";if(item){if(!_894){_894=this.store._oldAPI?this.store.getValue(item,this.searchAttr):item[this.searchAttr];}_895=this._getValueField()!=this.searchAttr?this.store.getIdentity(item):_894;}this.set("value",_895,_893,_894,item);},_announceOption:function(node){if(!node){return;}var _896;if(node==this.dropDown.nextButton||node==this.dropDown.previousButton){_896=node.innerHTML;this.item=undefined;this.value="";}else{var item=this.dropDown.items[node.getAttribute("item")];_896=(this.store._oldAPI?this.store.getValue(item,this.searchAttr):item[this.searchAttr]).toString();this.set("item",item,false,_896);}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",_87d.get(node,"id"));this._autoCompleteText(_896);},_selectOption:function(_897){this.closeDropDown();if(_897){this._announceOption(_897);}this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,true);},_startSearchAll:function(){this._startSearch("");},_startSearchFromInput:function(){this.item=undefined;this.inherited(arguments);},_startSearch:function(key){if(!this.dropDown){var _898=this.id+"_popup",_899=lang.isString(this.dropDownClass)?lang.getObject(this.dropDownClass,false):this.dropDownClass;this.dropDown=new _899({onChange:lang.hitch(this,this._selectOption),id:_898,dir:this.dir,textDir:this.textDir});this.focusNode.removeAttribute("aria-activedescendant");this.textbox.setAttribute("aria-owns",_898);}this._lastInput=key;this.inherited(arguments);},_getValueField:function(){return this.searchAttr;},postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _89a=this.srcNodeRef;this.store=new _882({},_89a);if(!("value" in this.params)){var item=(this.item=this.store.fetchSelectedItem());if(item){var _89b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(item,_89b):item[_89b];}}}},postCreate:function(){var _89c=_87f("label[for=\""+this.id+"\"]");if(_89c.length){if(!_89c[0].id){_89c[0].id=this.id+"_label";}this.domNode.setAttribute("aria-labelledby",_89c[0].id);}this.inherited(arguments);this.connect(this,"onSearch","_openResultList");},_getMenuLabelFromItem:function(item){var _89d=this.labelFunc(item,this.store),_89e=this.labelType;if(this.highlightMatch!="none"&&this.labelType=="text"&&this._lastInput){_89d=this.doHighlight(_89d,this._lastInput);_89e="html";}return {html:_89e=="html",label:_89d};},doHighlight:function(_89f,find){var _8a0=(this.ignoreCase?"i":"")+(this.highlightMatch=="all"?"g":""),i=this.queryExpr.indexOf("${0}");find=_880.escapeString(find);return this._escapeHtml(_89f.replace(new RegExp((i==0?"^":"")+"("+find+")"+(i==(this.queryExpr.length-4)?"$":""),_8a0),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,"<span class=\"dijitComboBoxHighlightMatch\">$1</span>");},_escapeHtml:function(str){str=String(str).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");return str;},reset:function(){this.item=null;this.inherited(arguments);},labelFunc:function(item,_8a1){return (_8a1._oldAPI?_8a1.getValue(item,this.labelAttr||this.searchAttr):item[this.labelAttr||this.searchAttr]).toString();},_setValueAttr:function(_8a2,_8a3,_8a4,item){this._set("item",item||null);if(_8a2==null){_8a2="";}this.inherited(arguments);},_setTextDirAttr:function(_8a5){this.inherited(arguments);if(this.dropDown){this.dropDown._set("textDir",_8a5);}}});});},"dojo/data/util/filter":function(){define("dojo/data/util/filter",["../../_base/lang"],function(lang){var _8a6={};lang.setObject("dojo.data.util.filter",_8a6);_8a6.patternToRegExp=function(_8a7,_8a8){var rxp="^";var c=null;for(var i=0;i<_8a7.length;i++){c=_8a7.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_8a7.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_8a8){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};return _8a6;});},"dijit/form/DataList":function(){define("dijit/form/DataList",["dojo/_base/declare","dojo/dom","dojo/_base/lang","dojo/query","dojo/store/Memory","../registry"],function(_8a9,dom,lang,_8aa,_8ab,_8ac){function _8ad(_8ae){return {id:_8ae.value,value:_8ae.value,name:lang.trim(_8ae.innerText||_8ae.textContent||"")};};return _8a9("dijit.form.DataList",_8ab,{constructor:function(_8af,_8b0){this.domNode=dom.byId(_8b0);lang.mixin(this,_8af);if(this.id){_8ac.add(this);}this.domNode.style.display="none";this.inherited(arguments,[{data:_8aa("option",this.domNode).map(_8ad)}]);},destroy:function(){_8ac.remove(this.id);},fetchSelectedItem:function(){var _8b1=_8aa("> option[selected]",this.domNode)[0]||_8aa("> option",this.domNode)[0];return _8b1&&_8ad(_8b1);}});});},"dijit/form/_SearchMixin":function(){define("dijit/form/_SearchMixin",["dojo/data/util/filter","dojo/_base/declare","dojo/_base/event","dojo/keys","dojo/_base/lang","dojo/query","dojo/sniff","dojo/string","dojo/when","../registry"],function(_8b2,_8b3,_8b4,keys,lang,_8b5,has,_8b6,when,_8b7){return _8b3("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:true,_abortQuery:function(){if(this.searchTimer){this.searchTimer=this.searchTimer.remove();}if(this._queryDeferHandle){this._queryDeferHandle=this._queryDeferHandle.remove();}if(this._fetchHandle){if(this._fetchHandle.abort){this._cancelingQuery=true;this._fetchHandle.abort();this._cancelingQuery=false;}if(this._fetchHandle.cancel){this._cancelingQuery=true;this._fetchHandle.cancel();this._cancelingQuery=false;}this._fetchHandle=null;}},_processInput:function(evt){if(this.disabled||this.readOnly){return;}var key=evt.charOrCode;if(evt.altKey||((evt.ctrlKey||evt.metaKey)&&(key!="x"&&key!="v"))||key==keys.SHIFT){return;}var _8b8=false;this._prev_key_backspace=false;switch(key){case keys.DELETE:case keys.BACKSPACE:this._prev_key_backspace=true;this._maskValidSubsetError=true;_8b8=true;break;default:_8b8=typeof key=="string"||key==229;}if(_8b8){if(!this.store){this.onSearch();}else{this.searchTimer=this.defer("_startSearchFromInput",1);}}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value.replace(/([\\\*\?])/g,"\\$1"));},_startSearch:function(text){this._abortQuery();var _8b9=this,_8b5=lang.clone(this.query),_8ba={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:true}},qs=_8b6.substitute(this.queryExpr,[text]),q,_8bb=function(){var _8bc=_8b9._fetchHandle=_8b9.store.query(_8b5,_8ba);if(_8b9.disabled||_8b9.readOnly||(q!==_8b9._lastQuery)){return;}when(_8bc,function(res){_8b9._fetchHandle=null;if(!_8b9.disabled&&!_8b9.readOnly&&(q===_8b9._lastQuery)){when(_8bc.total,function(_8bd){res.total=_8bd;var _8be=_8b9.pageSize;if(isNaN(_8be)||_8be>res.total){_8be=res.total;}res.nextPage=function(_8bf){_8ba.direction=_8bf=_8bf!==false;_8ba.count=_8be;if(_8bf){_8ba.start+=res.length;if(_8ba.start>=res.total){_8ba.count=0;}}else{_8ba.start-=_8be;if(_8ba.start<0){_8ba.count=Math.max(_8be+_8ba.start,0);_8ba.start=0;}}if(_8ba.count<=0){res.length=0;_8b9.onSearch(res,_8b5,_8ba);}else{_8bb();}};_8b9.onSearch(res,_8b5,_8ba);});}},function(err){_8b9._fetchHandle=null;if(!_8b9._cancelingQuery){console.error(_8b9.declaredClass+" "+err.toString());}});};lang.mixin(_8ba,this.fetchProperties);if(this.store._oldAPI){q=qs;}else{q=_8b2.patternToRegExp(qs,this.ignoreCase);q.toString=function(){return qs;};}this._lastQuery=_8b5[this.searchAttr]=q;this._queryDeferHandle=this.defer(_8bb,this.searchDelay);},constructor:function(){this.query={};this.fetchProperties={};},postMixInProperties:function(){if(!this.store){var list=this.list;if(list){this.store=_8b7.byId(list);}}this.inherited(arguments);}});});},"epi/shell/widget/SearchBox":function(){require({cache:{"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\r\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\r\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\r\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\r\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\r\n    </div>\r\n</div>"}});define("epi/shell/widget/SearchBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/Evented","dojo/keys","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/form/TextBox","dojox/html/entities","dgrid/util/misc","dojo/text!./templates/SearchBox.html","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.SearchBox"],function(_8c0,lang,_8c1,_8c2,_8c3,_8c4,keys,_8c5,_8c6,_8c7,_8c8,_8c9,_8ca,_8cb,_8cc,_8cd){return _8c0([_8c9,_8c4],{templateString:_8cc,placeHolder:epi.resources.action.search,commonRes:epi.resources,defaultDelay:500,encodeSearchText:false,postCreate:function(){this.inherited(arguments);_8c1.set(this.clearButton,"title",_8cd.clear);this.connect(this.clearButton,"onclick",lang.hitch(this,function(){this.set("value","");this.focus();this.toggleClearButton();this._valueChanged();}));this.toggleClearButton();this.connect(this,"_onInput",_8cb.debounce(lang.hitch(this,function(_8ce){this.toggleClearButton();this._valueChanged(_8ce);}),null,this.defaultDelay));},toggleClearButton:function(){_8c3.set(this.clearButton,"visibility",this.textbox.value?"visible":"hidden");},focus:function(){_8c8.focus(this.textbox);},_setValueAttr:function(_8cf){this.textbox.value=_8cf;},_valueChanged:function(_8d0){if(_8d0&&_8d0.keyCode){switch(_8d0.keyCode){case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:case keys.LEFT_ARROW:case keys.RIGHT_ARROW:return;}}this.emit("searchBoxChange",this.encodeSearchText?_8ca.encode(this.textbox.value):this.textbox.value);}});});},"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\r\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\r\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\r\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\r\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\r\n    </div>\r\n</div>","epi-cms/widget/SearchResultList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/widget/Standby","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/form/_ListMouseMixin","dijit/form/_ComboBoxMenuMixin","epi/dependency","epi-cms/widget/_ContentListKeyMixin","epi-cms/widget/_ContentListMouseMixin","epi-cms/dgrid/formatters","epi/shell/dgrid/Formatter","dgrid/OnDemandList","dgrid/Selection","dgrid/Keyboard","dojo/text!./templates/SearchResultList.html"],function(_8d1,lang,_8d2,_8d3,_8d4,_8d5,_8d6,_8d7,_8d8,_8d9,_8da,_8db,_8dc,_8dd,_8de,_8df,_8e0,_8e1,_8e2,_8e3){return _8d1([_8d7,_8d8,_8d2,_8d9,_8da,_8dc,_8dd],{templateString:_8e3,_standby:null,_messages:{nextMessage:"",previousMessage:""},postCreate:function(){this.inherited(arguments);var self=this,_8e4=_8db.resolve("epi.shell.Profile"),_8e5=_8d1([_8e0,_8e1,_8e2,_8df]),_8e6=function(item){return item.title;},_8e7=function(item){return item.metadata.typeIdentifier;},_8e8=function(item){var _8e9=self.grid.domNode,_8ea="epi-thumbnailContentList";(item.metadata.thumbnailUrl&&!_8d4.contains(_8e9,_8ea))&&_8d4.add(_8e9,_8ea);return item.metadata.thumbnailUrl;},_8eb=function(item){if(item.metadata&&item.metadata.languageBranch!=_8e4.contentLanguage){return {language:item.metadata.languageBranch};}};this.grid=new _8e5({formatters:[_8de.contentItemFactory("title",_8e6,_8e7,null,_8e8,_8eb,false)],selectionMode:"single",cellNavigation:false});this.grid.set("showHeader",false);_8d3.place(this.grid.domNode,this.containerNode);this.grid.on(".dgrid-row:click",lang.hitch(this,function(_8ec){var row=this.grid.row(_8ec);if(row){this._onSelect(row.data);}}));this._standby=new _8d6({target:this.domNode,color:"#fff"}).placeAt(document.body);this.own(this._standby);this.containerNode=this._getGridContainer();},startup:function(){this.inherited(arguments);this._standby.startup();},showStandby:function(show){if(!this._standby){return;}if(show){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},showGrid:function(show){_8d5.set(this.grid.domNode,"display",show?"block":"none");},_onSelect:function(_8ed){this.emit("select",_8ed);},_getGridContainer:function(){return this.grid.contentNode;},createOptions:function(_8ee,_8ef,_8f0){this.grid.renderArray(_8ee);return this.containerNode.childNodes;},clearResultList:function(){this.grid.refresh();},getHighlightedOption:function(){return null;},showErrorMessage:function(show,_8f1){this.clearResultList();this.showStandby(false);if(show&&_8f1){this.errorMessage.innerHTML=_8f1;}_8d5.set(this.errorMessage,"display",show?"block":"none");}});});},"epi-cms/widget/_ContentListKeyMixin":function(){define(["dojo/_base/declare","dojo/keys"],function(_8f2,keys){return _8f2(null,{handleKey:function(evt){switch(evt.keyCode){case keys.DOWN_ARROW:this.selectNextNode();return false;case keys.UP_ARROW:this.selectPreviousNode();return false;case keys.ENTER:if(this.selected&&this.grid.row(this.selected)){this._onSelect(this.grid.row(this.selected).data);}return false;default:return true;}}});});},"epi-cms/widget/_ContentListMouseMixin":function(){define(["dojo/_base/declare","dojo/dom-class"],function(_8f3,_8f4){return _8f3(null,{onHover:function(node){},onUnhover:function(node){},onSelect:function(node){_8f4.add(node,"dgrid-selected ui-state-active dgrid-focus");},onDeselect:function(node){_8f4.remove(node,"dgrid-selected ui-state-active dgrid-focus");}});});},"url:epi-cms/widget/templates/SearchResultList.html":"<div class=\"epi-searchResultList\">\r\n    <div data-dojo-attach-point=\"containerNode\">\r\n        <div data-dojo-attach-point=\"errorMessage\" class=\"epi-searchResultListEmptyMessage\"></div>\r\n    </div>\r\n    <div class=\"dijitReset epi-searchResultListNavigation\">\r\n        <div data-dojo-attach-point=\"previousButton\" role=\"option\"></div>\r\n        <div data-dojo-attach-point=\"nextButton\" role=\"option\"></div>\r\n    </div>\r\n</div>","epi-cms/component/Media":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/on","dojo/topic","epi-cms/component/MediaViewModel","epi-cms/widget/HierarchicalList","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(_8f5,lang,_8f6,_8f7,on,_8f8,_8f9,_8fa,_8fb,_8fc){return _8f5([_8fa],{res:_8fc,enableDndFileDropZone:true,showCreateContentArea:true,modelClassName:_8f9,noDataMessage:_8fc.nocontent,hierarchicalListClass:"epi-mediaList",createContentText:_8fc.dropareatitle,postCreate:function(){this.inherited(arguments);this.list.set("noDataMessage",this.res.nocontent);this.own(this.model.getCommand("upload").watch("canExecute",lang.hitch(this,function(name,_8fd,_8fe){this._toggleCreateContentArea(_8fe);})));},_setupList:function(){this.inherited(arguments);_8f6.add(this.list.grid.domNode,"epi-thumbnailContentList");this.own(on(this.list,"createItemAction",lang.hitch(this,function(){this.model._commandRegistry.uploadDefault.command.execute();})),on(this.list,"itemAction",lang.hitch(this,function(item){_8f8.publish("/epi/shell/context/request",{uri:item.uri},{sender:this});})));}});});},"epi-cms/component/MediaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/when","epi","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/viewmodel/HierarchicalListViewModel","epi-cms/widget/viewmodel/MultipleFileUploadViewModel","epi-cms/widget/MultipleFileUpload","epi-cms/widget/UploadUtil","epi-cms/command/UploadContent","epi-cms/command/EditImage","epi-cms/command/DownloadMedia","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(_8ff,_900,lang,_901,when,epi,_902,_903,_904,_905,_906,_907,_908,_909,_90a,_90b,_90c){return _900([_905],{treeStoreModelClass:_904,_dialog:null,_getTypesToCreate:function(){return [];},_setupCommands:function(){this.inherited(arguments);var _90d={selection:this.selection,model:this};var _90e={uploadDefault:{command:new _909(lang.mixin({iconClass:"epi-iconPlus",label:_90c.command.label,resources:_90c,viewModel:this},_90d))},upload:{command:new _909(lang.mixin({category:"context",iconClass:"epi-iconUpload",label:_90c.linktocreateitem,viewModel:this},_90d)),isAvailable:this.menuType.ROOT|this.menuType.TREE,order:2},editImage:{command:new _90a(lang.mixin({category:"context",forceContextChange:true,label:_90c.command.openineditor},_90d)),isAvailable:this.menuType.LIST,order:3},download:{command:new _90b(lang.mixin({category:"context",label:_90c.command.download},_90d)),isAvailable:this.menuType.LIST,order:4}};this._commandRegistry=lang.mixin(this._commandRegistry,_90e);this.pseudoContextualCommands.push(this._commandRegistry.uploadDefault.command);this.pseudoContextualCommands.push(this._commandRegistry.upload.command);},_updateTreeContextCommandModels:function(_90f){this.inherited(arguments);this._commandRegistry.uploadDefault.command.set("model",_90f);this._commandRegistry.upload.command.set("model",_90f);},upload:function(_910,_911,_912){var _913=new _907({model:new _906({store:this.get("store"),query:this.get("listQuery")})});_913.on("beforeUploaderChange",lang.hitch(this,function(){this._uploading=true;}));_913.on("close",lang.hitch(this,function(_914){this._dialog&&(_914?this._dialog.hide():this._dialog.destroy());}));_913.on("uploadComplete",lang.hitch(this,function(_915){if(_913.createAsLocalAsset){when(this.treeStoreModel&&typeof this.treeStoreModel.refreshRoots==="function"&&this.treeStoreModel.refreshRoots(this),lang.hitch(this,function(){_913.set("createAsLocalAsset",false);_913.set("uploadDirectory",this.get("currentTreeItem").id);_913.model.set("query",this.get("listQuery"));}));}else{this.onListItemUpdated(_915);this.set("currentTreeItem",this.get("currentTreeItem"));}if(this._dialog&&!this._dialog.open){this._dialog.destroy();}this._uploading=false;}));this._dialog=new _902({title:_90c.linktocreateitem,content:_913,autofocus:_908.supportNativeDndFiles(),defaultActionsVisible:false,closeIconVisible:false});_901.add(this._dialog.domNode,"epi-multiFileUploadDialog");this._dialog.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:function(){_913.close();}});this._dialog.resize({w:700});this._dialog.show();var _916=_912?this.selection.data[0].data:this.store.get(_911);when(_916,lang.hitch(this,function(_917){this._buildBreadcrumb(_917,_913);_913.set("uploadDirectory",_911||this.get("currentTreeItem").id);_913.set("createAsLocalAsset",_912);_913.upload(_910);}));},onListItemUpdated:function(_918){var _919=this.store;return when(this.getCurrentContext(),function(_91a){var _91b=(new _903(_91a.id)).createVersionUnspecificReference().toString();return when(_919.get(_91b),function(_91c){var _91d=_8ff.filter(_918,function(_91e){return _91c.name.toLowerCase()===_91e.fileName.toLowerCase();})[0];return _91d?_91c:null;});});},_buildBreadcrumb:function(_91f,_920){if(!_920){return;}if(this.treeStoreModel.isTypeOfRoot(_91f)){_920.set("breadcrumb",[_91f]);return;}this.treeStoreModel.getAncestors(_91f.contentLink,lang.hitch(this,function(_921){var _922,_923=[_91f];for(var i=_921.length-1;i>=0;i--){_922=_921[i];_923.unshift(_922);if(this.treeStoreModel.isTypeOfRoot(_922)){break;}}_920.set("breadcrumb",_923);}));}});});},"epi-cms/widget/viewmodel/HierarchicalListViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","epi","epi/dependency","epi/shell/ClipboardManager","epi/shell/command/_CommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/_MultilingualMixin","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel","epi-cms/widget/command/NewFolder","epi-cms/command/RenameFolder","epi-cms/widget/CreateCommandsMixin","epi-cms/command/NewContent","epi-cms/command/CopyContent","epi-cms/command/CutContent","epi-cms/command/DeleteContent","epi-cms/command/PasteContent","epi-cms/command/TranslateContent","epi-cms/component/command/ViewTrash","epi-cms/component/command/ChangeContext"],function(_924,_925,lang,_926,_927,when,epi,_928,_929,_92a,_92b,_92c,_92d,_92e,_92f,_930,_931,_932,_933,_934,_935,_936,_937,_938,_939,_93a,_93b,_93c){return _925([_927,_92d,_92f,_92e,_934],{menuType:{ROOT:1,TREE:2,LIST:4},searchArea:"",searchRoots:"",clipboardManager:null,selection:null,commands:null,createCommands:null,createHierarchyCommands:null,pseudoContextualCommands:null,currentTreeItem:null,currentListItem:null,listQuery:null,listQueryOptions:null,showAllLanguages:true,treeStoreModelClass:_931,treeStoreModel:null,store:null,storeKey:"epi.cms.content.light",mainNavigationTypes:null,containedTypes:null,_showAllLanguagesSetter:function(_93d){this.showAllLanguages=_93d;this._updateListQuery(this.currentTreeItem);this.treeStoreModel.set("showAllLanguages",_93d);},_currentTreeItemSetter:function(_93e){this.currentTreeItem=_93e;this._updateListQuery(_93e);},postscript:function(args){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_928.resolve("epi.cms.contentRepositoryDescriptors");_925.safeMixin(this,this.contentRepositoryDescriptors[args.repositoryKey]);this.clipboardManager=this.clipboardManager||new _929();this.selection=this.selection||new _92b();this.store=this.store||_928.resolve("epi.storeregistry").get(this.storeKey);this._setupTreeStoreModel();this._setupCommands();this.set("commands",this._commandRegistry.toArray());this._setupSearchRoots();this.set("listQueryOptions",this.treeStoreModel._queryOptions);},startup:function(){this.inherited(arguments);this._setupSelection();},getCommand:function(_93f){return this._commandRegistry[_93f]?this._commandRegistry[_93f].command:null;},contentContextChanged:function(_940,_941){this._setupSearchRoots();if(!this._isSupportedContent(_940)){return;}var self=this,_942=self.get("currentListItem"),_943=self.treeStoreModel.get("previousSelection"),_944=_930.toContentReference(_940.id);when(self.store.get(_944.createVersionUnspecificReference()),function(_945){var _946=_943&&self.hasContextual(_943.selectedAncestors)?_945.assetsFolderLink:_940.parentLink,_947=_930.toContentReference(_943?_946:self.roots[0]);self.set("editingListItem",_944);if(_941&&_941.forceReload||!_930.compareIgnoreVersion(_942,_944)){when(self.store.get(_947.createVersionUnspecificReference()),function(_948){self.treeStoreModel&&when(self.treeStoreModel.canExpandTo(_948),function(_949){if(_949){self.set("currentTreeItem",_947);self.set("currentListItem",_944);self._updateCommands(_948,self.menuType.LIST);}});});}});},onSearch:function(_94a){when(this.store.get(_94a.id),lang.hitch(this,function(_94b){var _94c=_930.toContentReference(_94b.contentLink);this.set("editingListItem",_94c);this.set("currentListItem",_94c);this.set("currentTreeItem",_930.toContentReference(_94b.parentLink));this._updateCommands(_94b,this.menuType.LIST);}));},onTreeItemSelected:function(_94d,_94e){var _94f=this.get("currentTreeItem"),_950=_930.toContentReference(_94d.contentLink),_951=_94e?this.menuType.ROOT:this.menuType.TREE;this._updateCommands(_94d,_951);if(!_930.compareIgnoreVersion(_94f,_950)&&_930.emptyContentReference!=_950){this.set("currentTreeItem",_950);}},onListItemSelected:function(_952){var _953=this.get("currentListItem"),_954=_930.toContentReference(_952.contentLink);this._updateCommands(_952,this.menuType.LIST);if(!_930.compareIgnoreVersion(_953,_954)){this.set("currentListItem",_954);}},onListItemUpdated:function(_955){},_isSupportedContent:function(_956){return !!(_956&&_956.id)&&this.containedTypes.some(function(type){return _92c.isBaseTypeIdentifier(_956.dataType,type);});},_setupSelection:function(){when(this.getCurrentContext(),lang.hitch(this,function(ctx){var _957;if(!this._isContentContext(ctx)||!this._isSupportedContent(ctx)){_957=_930.toContentReference(this.roots[0]).toString();when(this.store.get(_957),lang.hitch(this,function(_958){this.onTreeItemSelected(_958,true);}));}else{this.contentContextChanged(ctx,null);}}));},_setupTreeStoreModel:function(){var _959=new this.treeStoreModelClass({store:this.store,roots:this.roots,typeIdentifiers:this.mainNavigationTypes,containedTypes:this.containedTypes,notAllowToCopy:this.preventCopyingFor,notAllowToDelete:this.preventDeletionFor,notSupportContextualContents:this.preventContextualContentFor,onAddDelegate:lang.hitch(this,function(node){var _95a=dijit.getEnclosingWidget(node.domNode),_95b=_95a&&_95a.item,_95c=(typeof (this.treeStoreModel.canEdit)==="function")&&this.treeStoreModel.canEdit(_95b);if(_95c){node.edit();var _95d=function(){_926.publish("/epi/cms/contentdata/childrenchanged",_95b.parentLink);};var _95e=node.on("rename",function(){_95e.remove();_95d();});var _95f=node.on("cancelEdit",function(){_95f.remove();_95d();});}}),onRefreshRoots:lang.hitch(this,this._setupSearchRoots),additionalQueryOptions:{sort:this._getSortSettings()}});this.set("treeStoreModel",_959);},_getSortSettings:function(){return [{attribute:"name",descending:false}];},_setupSearchRoots:function(){when(this.getCurrentContent(),lang.hitch(this,function(_960){var _961=this.roots instanceof Array&&this.roots.length>0?lang.clone(this.roots):[],_962=_960&&_960.assetsFolderLink;if(_962&&typeof this._getPseudoContextualContent==="function"&&_962!=this._getPseudoContextualContent()){_961.push(_962);}this.set("searchRoots",_961.join(","));}));},_setupCommands:function(){var _963=this.menuType;var _964={category:"context",model:this.treeStoreModel,selection:this.selection,clipboard:this.clipboardManager};this.createHierarchyCommands={};var _965=1;_924.forEach(this.mainNavigationTypes,function(type){this.createHierarchyCommands[type]={command:new _932(lang.mixin({typeIdentifier:type},_964)),isAvailable:_963.ROOT|_963.TREE,order:_965};_965=_965+1;},this);this.createCommands=this.getCreateCommands(_965);var _966={rename:{command:new _933({category:"context"}),isAvailable:_963.TREE,order:10},cut:{command:new _937(_964),isAvailable:_963.TREE|_963.LIST,order:20},copy:{command:new _936(_964),isAvailable:_963.TREE|_963.LIST,order:30},paste:{command:new _939(_964),isAvailable:_963.ROOT|_963.TREE,order:40},edit:{command:new _93c({category:"context",forceContextChange:true}),isAvailable:this.menuType.LIST,order:3},translate:{command:new _93a(),isAvailable:this.menuType.TREE|this.menuType.LIST},"delete":{command:new _938(_964),isAvailable:_963.TREE|_963.LIST,order:50},trash:{command:new _93b({typeIdentifiers:this.mainNavigationTypes}),order:60},sort:function(){var _967=[];for(var key in this){if(key!=="toArray"&&key!=="sort"&&this.hasOwnProperty(key)){var _968=this[key].order;if(!_968){_968=100;}_967.push([_968,this[key].command]);}}_967.sort(function(a,b){return a[0]-b[0];});return _967;},toArray:function(){var _969=this.sort();var _96a=[];_924.forEach(_969,function(key){_96a.push(key[1]);});return _96a;}};this._commandRegistry=lang.mixin(this._commandRegistry,this.createHierarchyCommands,this.createCommands,_966);this.pseudoContextualCommands=this._getPseudoContextualCommands();},_updateListQuery:function(_96b){var id,_96c=null;var _96d=_924.filter(this.containedTypes,function(item){return this.mainNavigationTypes.indexOf(item)<0;},this);if(_96b){id=_96b.toString(),_96c=this._createListChildrenQuery(id,this.showAllLanguages,_96d);}this.set("listQuery",_96c);},_createListChildrenQuery:function(id,_96e,_96f){return {referenceId:id,query:"getchildren",allLanguages:_96e,typeIdentifiers:_96f};},_updateSelection:function(_970){this.selection.set("data",_970?[{type:"epi.cms.contentdata",data:_970}]:[]);},_updateCommands:function(_971,_972){this._updateSelection(_971);if(typeof this.treeStoreModel.isSupportedType==="function"&&this.treeStoreModel.isSupportedType(_971.typeIdentifier)){this._updateTreeContextCommandModels(_971);this.decoratePseudoContextualCommands(this.pseudoContextualCommands);}this._commandRegistry.translate.command.set("model",_971);this._commandRegistry.translate.command.set("executeDelegate",null);this._commandRegistry.edit.command.set("model",_971);this._updateCommandAvailability(_972);},_updateTreeContextCommandModels:function(_973){this._updateCreateCommandModels(_973);this._commandRegistry.rename.command.set("model",_973);},_updateCreateCommandModels:function(_974){var _975=this.createCommands;for(var key in _975){_975[key].command.set("model",_974);}},_getPseudoContextualCommands:function(){var key,_976=[];for(key in this.createCommands){_976.push(this.createCommands[key].command);}for(key in this.createHierarchyCommands){_976.push(this.createHierarchyCommands[key].command);}_976.push(this._commandRegistry.paste.command);return _976;},_updateCommandAvailability:function(_977){var _978=this._commandRegistry,_979;for(var key in _978){if(key!=="toArray"&&_978.hasOwnProperty(key)){_979=_978[key].isAvailable;if(_979){var _97a=_978[key].command;this._updateAvailabilityForSpecificCommand(_97a,_977,_979);}}}},_updateAvailabilityForSpecificCommand:function(_97b,_97c,_97d){if(!_97b.isInstanceOf(_93a)){_97b.set("isAvailable",!!(_97d&_97c));}},upload:function(_97e){}});});},"epi/shell/ClipboardManager":function(){define("epi/shell/ClipboardManager",["dojo/_base/declare","dojo/Stateful"],function(_97f,_980){return _97f(_980,{copy:true,data:null,constructor:function(){this.data=[];},clear:function(){this.set("data",null);},isCopy:function(){return this.get("copy");},setDataObject:function(_981,copy){this.set("copy",copy);this.set("data",_981);},getDataObject:function(){return this.data;},containsData:function(){return !!this.data;}});});},"epi/shell/selection":function(){define("epi/shell/selection",["dojo/_base/declare","./StatefulArray"],function(_982,_983){return _982(_983,{data:null,constructor:function(){this.data=[];}});});},"epi-cms/_MultilingualMixin":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/when","dojo/_base/lang","epi/dependency","epi-cms/ApplicationSettings","epi-cms/component/SiteTreeModel"],function(_984,_985,when,lang,_986,_987,_988){return _984([],{isMultilingual:false,_application:null,_siteTreeModel:null,_cachedValue:undefined,constructor:function(_989){lang.mixin(this,_989);},_isSiteMultilingual:function(){var _98a=new _985();if(this._cachedValue!==undefined){_98a.resolve(this._cachedValue);}if(!this._siteTreeModel){var _98b=_986.resolve("epi.storeregistry"),_98c=_98b.get("epi.cms.sitestructure");this._siteTreeModel=new _988({store:_98c});}when(this._siteTreeModel.getAllLanguagesForCurrentSite(),lang.hitch(this,function(_98d){this._cachedValue=_98d.length>=2;_98a.resolve(this._cachedValue);}));return _98a;},_contentExistsInCurrentLanguage:function(_98e){if(!_98e){return false;}if(_98e.capabilities&&!_98e.capabilities.language){return true;}if(!_98e.currentLanguageBranch){return false;}return _987.currentContentLanguage===_98e.currentLanguageBranch.languageId;}});});},"epi-cms/widget/command/NewFolder":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(_98f,_990,lang,_991,when,_992,_993,_994,_995,_996){return _990([_992,_993],{iconClass:"epi-iconFolder",typeIdentifier:null,createAsLocalAsset:false,_defaultName:null,postscript:function(){this.inherited(arguments);var _997=this.typeIdentifier;this._defaultName=_994.getResourceValue(_997,"newitemdefaultname");var _998=_994.getResourceValue(_997,"create");this.set("label",_998);this.set("tooltip",_998);},_execute:function(){var self=this,_999=self.get("selectionData"),_99a=(new _995(_999.contentLink)).createVersionUnspecificReference().toString(),_99b=self.createAsLocalAsset;var _99c=function(_99d){self.model.getChildren(_99d,function(_99e){when(self.model.add({parentLink:_99a,name:self._getUniqueFolderName(_99e,self._defaultName),contentTypeIdentifier:self.typeIdentifier,createAsLocalAsset:_99b},self.onRefreshSelection),function(_99f){if(_99f.parentLink!=_99a){_991.publish("/epi/cms/action/createlocalasset");}});});};if(_99b){when(self.model.store.refresh(_99a),function(_9a0){when(self.model.store.get(_9a0.assetsFolderLink),_99c);});}else{_99c(_999);}},_onModelChange:function(){var _9a1=this.get("selectionData"),_9a2=_996.action.Create,_9a3=_996.providerCapabilities.Create,_9a4=this.model&&_9a1&&_996.isActionAvailable(_9a1,_9a2,_9a3,true);this.set("canExecute",!!_9a4);},_getUniqueFolderName:function(arr,_9a5){var _9a6=function(_9a7){var name=_9a7>0?lang.replace(_9a5+" {0}",[_9a7]):_9a5;if(_9a7>1000){return name;}var _9a8=_98f.some(arr,function(_9a9){return lang.trim(_9a9.name).toLowerCase()===lang.trim(name).toLowerCase();});if(_9a8){_9a7=_9a7+1;return _9a6(_9a7);}return name;};return _9a6(0);}});});},"epi-cms/command/RenameFolder":function(){define(["dojo/_base/declare","epi","epi-cms/_MultilingualMixin","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command"],function(_9aa,epi,_9ab,_9ac,_9ad){return _9aa([_9ad,_9ab],{label:epi.resources.action.rename,contentActionSupport:null,iconClass:"epi-iconRename",renameDelegate:null,typeIdentifier:"episerver.core.contentfolder",postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_9ac;},_execute:function(){this.renameDelegate(this.model);},_onModelChange:function(){var _9ae=this.renameDelegate&&this.model&&this.model.typeIdentifier===this.typeIdentifier&&this.contentActionSupport.hasAccess(this.model.accessMask,_9ac.accessLevel[_9ac.action.Edit])&&this._contentExistsInCurrentLanguage(this.model);this.set("canExecute",_9ae);}});});},"epi-cms/widget/CreateCommandsMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/dependency","../command/PopupCommand","../command/NewContent","epi/i18n!epi/nls/episerver.shared"],function(_9af,_9b0,lang,_9b1,_9b2,_9b3,_9b4){return _9b0([],{contentRepositoryDescriptors:null,typeDescriptorManager:null,createCommandClass:_9b3,repositoryKey:null,category:null,isAvailableFlags:null,postscript:function(){this.inherited(arguments);if(!this.repositoryKey){throw "You need to specify the repositoryKey field";}this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_9b1.resolve("epi.cms.contentRepositoryDescriptors");_9b0.safeMixin(this,this.contentRepositoryDescriptors[this.repositoryKey]);this.commandCategory=this.commandCategory||"context";var _9b5={ROOT:1,TREE:2,LIST:4};this.isAvailableFlags=this.isAvailableFlags||_9b5.ROOT|_9b5.TREE;},getCreateCommands:function(_9b6){var _9b7={};var _9b8=_9b6||1;if(!this.creatableTypes){return _9b7;}_9af.forEach(this.creatableTypes,function(type){_9b7[type]={command:this._createCommand(type),isAvailable:this.isAvailableFlags,order:_9b8};_9b8=_9b8+1;},this);if(this.creatableTypes.length<2){return _9b7;}var _9b9=new _9b2({label:_9b4.action["new"],commands:_9b7});return {popupCommand:{command:_9b9,order:_9b6}};},_createCommand:function(type){return new this.createCommandClass({contentType:type,category:this.commandCategory});}});});},"epi-cms/command/PopupCommand":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","epi/shell/command/_Command","epi/shell/command/_CommandProviderMixin","epi/shell/widget/ContextMenu"],function(_9ba,_9bb,_9bc,_9bd,_9be,_9bf){return _9bb([_9bd,_9be],{category:"popup",canExecute:true,popup:null,popupClass:_9bf,popupCategory:"context",_commandsSetter:function(_9c0){if(!_9c0){return;}var _9c1=[];if(_9c0 instanceof Array){_9c1=_9c0;}else{for(var _9c2 in _9c0){_9c1.push(_9c0[_9c2].command);}}this.commands=_9c1;this._updateIsAvailable();},_popupSetter:function(_9c3){this.popup=_9c3;_9c3.addProvider(this);},_updateIsAvailable:function(){var _9c4=_9ba.some(this.get("commands"),function(_9c5){return _9c5.get("isAvailable");});this.set("isAvailable",_9c4);},_onModelChange:function(){this.updateCommandModel(this.model);this._updateIsAvailable();}});});},"epi-cms/command/NewContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/topic","dojo/when","dojo/promise/all","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport"],function(_9c6,_9c7,lang,_9c8,_9c9,when,all,_9ca,_9cb,_9cc,_9cd){return _9c7([_9cb],{contentType:null,createAsLocalAsset:false,canChangeLocalAssetName:true,postscript:function(){this.inherited(arguments);var _9ce=this.contentType;this.label=this.label||_9cc.getResourceValue(_9ce,"create");this.tooltip=this.tooltip||_9cc.getResourceValue(_9ce,"createdescription");this.iconClass=this.iconClass||_9cc.getValue(_9ce,"commandIconClass");if(!this.store){var _9cf=_9ca.resolve("epi.storeregistry");this.store=_9cf.get("epi.cms.contenttype");}},_execute:function(){_9c9.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.contentType,parent:this.model,createAsLocalAsset:this.createAsLocalAsset,canChangeLocalAssetName:this.canChangeLocalAssetName,view:_9cc.getValue(this.contentType,"createView")});},_onModelChange:function(){if(this.model&&this.model instanceof Array){if(this.model.length==1){this.model=this.model[0];}else{this.model=null;}}var _9d0=this.model,_9d1=_9cd.action.Create,_9d2=_9cd.providerCapabilities.Create,_9d3=_9d0&&!(_9d0.isWastebasket||_9d0.isDeleted)&&_9cd.hasLanguageAccess(_9d0)&&_9cd.isActionAvailable(_9d0,_9d1,_9d2,true);this.set("canExecute",!!_9d3);if(!_9d0){return;}when(this._getContentType(_9d0),lang.hitch(this,function(_9d4){if(!_9d4){this.set("isAvailable",false);return;}when(this._checkAvailability(_9d4.availableContentTypes),lang.hitch(this,function(_9d5){this.set("isAvailable",_9d5);}));}));},_getContentType:function(_9d6){if(!_9d6){return null;}return this.store.get(_9d6.contentTypeID);},_checkAvailability:function(_9d7){if(_9d7.length===0){return false;}var _9d8=new _9c8();var _9d9=_9c6.map(_9d7,lang.hitch(this,function(_9da){return this.store.get(_9da);}));when(all(_9d9),lang.hitch(this,function(_9db){var _9dc=_9c6.some(_9db,lang.hitch(this,function(_9dd){return _9cc.isBaseTypeIdentifier(_9dd.typeIdentifier,this.contentType);}));_9d8.resolve(_9dc);}));return _9d8;}});});},"epi-cms/command/CopyContent":function(){define(["dojo/_base/declare","dojo/_base/array","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_9de,_9df,epi,_9e0,_9e1,_9e2){return _9de([_9e0,_9e1,_9e2],{label:epi.resources.action.copy,iconClass:"epi-iconCopy",_execute:function(){this.clipboard.set("copy",true);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var _9e3=this.model,_9e4=this.selection.data,_9e5=false;if(_9e3&&_9e4.length){_9e5=_9df.every(_9e4,function(item){return _9e3.canCopy(item.data);});}this.set("canExecute",_9e5);}});});},"epi-cms/command/CutContent":function(){define(["dojo/_base/array","dojo/_base/declare","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_9e6,_9e7,epi,_9e8,_9e9,_9ea){return _9e7([_9e8,_9e9,_9ea],{label:epi.resources.action.cut,iconClass:"epi-iconCut",_execute:function(){this.clipboard.set("copy",false);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var _9eb=this.model,_9ec=this.selection.data,_9ed=false;if(_9eb&&_9ec.length){_9ed=_9e6.every(_9ec,function(item){return _9eb.canCut(item.data);});}this.set("canExecute",_9ed);}});});},"epi-cms/command/DeleteContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command","epi/i18n!epi/nls/episerver.shared"],function(_9ee,lang,_9ef,_9f0,when,_9f1,_9f2,_9f3,_9f4,_9f5,_9f6,_9f7){return _9ee([_9f3,_9f4,_9f5],{label:_9f6.movetotrash,iconClass:"epi-iconTrash",hasWastebasket:true,_execute:function(){var _9f8=this.model,_9f9=this.clipboard,_9fa=this.selection.data,_9fb=this.hasWastebasket?_9f8.move(_9fa,{contentLink:_9f1.wastebasketPage,isWastebasket:true}):_9f8.remove(_9fa);return when(_9fb,lang.hitch(this,function(){var _9fc=[];if(_9f9&&_9f9.data){_9fa.forEach(function(_9fd){var map=_9f9.data.map(function(_9fe){return _9f8.isAncestor(_9fd.data,_9fe.data);});_9fc=_9fc.concat(map);});}when(_9ef(_9fc),function(_9ff){var _a00=_9ff.every(function(_a01){return _a01;});if(_a00){_9f9.clear();}});}),lang.hitch(this,function(){_9f0.publish("/epi/cms/action/delete/error");}));},_hasWastebasketSetter:function(_a02){this.hasWastebasket=_a02;this.set("iconClass",_a02?"epi-iconTrash":"epi-iconClose");this.set("label",_a02?_9f6.movetotrash:_9f7.action.deletelabel);},_onModelChange:function(){var _a03=this.model,_a04=this.selection.data,_a05=function(item){var _a06=item.data;return _a06&&!_a06.isDeleted&&_a03.canDelete(_a06);},_a07=function(item){var _a08=item.data;return _a08&&_9f2.hasProviderCapability(_a08.providerCapabilityMask,_9f2.providerCapabilities.Wastebasket);};this.set("hasWastebasket",!!_a04.length&&_a04.every(_a07));this.set("canExecute",!!(_a03&&_a04.length)&&_a04.every(_a05)&&(this.hasWastebasket||!_a04.some(_a07)));}});});},"epi-cms/command/PasteContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_a09,_a0a,lang,_a0b,when,epi,_a0c,_a0d,_a0e){return _a0a([_a0c,_a0d,_a0e],{label:epi.resources.action.paste,iconClass:"epi-iconPaste",createAsLocalAsset:false,_execute:function(){var _a0f=this.get("clipboardData"),_a10=this.get("selectionData");this.model.set("createAsLocalAsset",this.createAsLocalAsset);if(this.clipboard.copy){return this.model.copy(_a0f,_a10);}else{return when(this.model.move(_a0f,_a10),lang.hitch(this,function(){this.clipboard.clear();}));}},_onModelChange:function(){var self=this,_a11=self.model,_a12=self.get("clipboardData"),_a13=self.get("selectionData");self.set("canExecute",false);if(_a11&&_a12&&_a12.length&&_a13){var _a14=_a09.map(_a12,function(item){return _a11.canPaste(item.data,_a13,self.clipboard.copy);});when(_a0b(_a14),function(_a15){var _a16=_a09.every(_a15,function(_a17){return _a17;});if(self.clipboard.copy){self.set("canExecute",_a16);return;}_a11.getAncestors(_a13,function(_a18){var _a19=_a09.some(_a12,function(item){return _a09.indexOf(_a18,item.data)>=0;});self.set("canExecute",_a16&&!_a19);});});}}});});},"epi-cms/component/command/ViewTrash":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/topic","epi/dependency","epi/shell/command/_Command","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_a1a,lang,_a1b,_a1c,_a1d,_a1e,_a1f,_a20){return _a1a([_a1e],{label:_a20.viewtrash,category:"setting",_wasteBasketId:null,typeIdentifiers:null,postscript:function(){this.inherited(arguments);this.set("canExecute",false);this._wasteBasketId=_a1f.wastebasketPage;var _a21=_a1d.resolve("epi.storeregistry").get("epi.cms.content.light");_a1b.when(_a21.get(this._wasteBasketId),lang.hitch(this,function(_a22){this.set("canExecute",(_a22.statusCode!="401"));}));},_execute:function(){_a1c.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+this._wasteBasketId},{sender:this,typeIdentifiers:this.typeIdentifiers});}});});},"epi-cms/component/command/ChangeContext":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_a23,_a24,_a25,_a26,_a27){return _a23([_a26],{contentActionSupport:null,forceContextChange:false,viewType:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_a25;},_execute:function(){_a24.publish("/epi/shell/context/request",{uri:this.model.uri},{sender:null,forceContextChange:this.forceContextChange,viewType:this.viewType,viewName:this.viewName});},_onModelChange:function(){if(this.model&&this.model.length==1){this.model=this.model[0];}var _a28=this.model&&this.model.contentLink;this.set("canExecute",!!_a28);if(_a28&&this.model.accessMask){if(this.contentActionSupport.hasAccess(this.model.accessMask,this.contentActionSupport.accessLevel[this.contentActionSupport.action.Edit])){this.set("label",_a27.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_a27.view);this.set("iconClass","epi-iconSearch");}}}});});},"epi-cms/widget/viewmodel/MultipleFileUploadViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/when","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin"],function(_a29,_a2a,when,_a2b,_a2c){return _a2a([_a2b,_a2c],{upload:function(_a2d){return when(this._filterUploadingFiles(_a2d),function(_a2e){if(!_a2e||!(_a2e.existingContents instanceof Array)||_a2e.existingContents.length===0){return {showConfirmation:false,uploadingFiles:_a2d};}return {showConfirmation:true,uploadingFiles:_a2d,newFiles:_a2e.newFiles,existingContents:_a2e.existingContents};});},_filterUploadingFiles:function(_a2f){var self=this;if(!self.store){return null;}return when(self.store.query(self.get("query")),function(_a30){var _a31=_a29.filter(_a30,function(_a32){return _a29.some(_a2f,function(file){return file.name.toLowerCase()===_a32.name.toLowerCase();});});var _a33=_a29.filter(_a2f,function(file){return _a29.every(_a30,function(_a34){return file.name.toLowerCase()!==_a34.name.toLowerCase();});});return {existingContents:_a31,newFiles:_a33};});}});});},"epi-cms/widget/MultipleFileUpload":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/when","dojo/Evented","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Toolbar","dojox/form/Uploader","dojox/form/uploader/plugins/Flash","epi/routes","epi/shell/widget/dialog/Alert","epi-cms/widget/Breadcrumb","epi-cms/widget/FileList","epi-cms/widget/MultipleFileUploadConfirmation","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/FileListViewModel","dojo/text!./templates/MultipleFileUpload.html","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles"],function(_a35,_a36,lang,_a37,_a38,_a39,_a3a,when,_a3b,_a3c,_a3d,_a3e,_a3f,_a40,_a41,_a42,_a43,_a44,_a45,_a46,_a47,_a48,_a49,_a4a){return _a36([_a3c,_a3d,_a3e,_a3b],{res:_a4a,_isCompleted:true,_uploadStatus:[],templateString:_a49,postCreate:function(){this.inherited(arguments);this._setupUploader();this._setupFileList();this._confirmationDialog=this._confirmationDialog||new _a46();},upload:function(_a4b){var self=this,_a4c=self.uploaderInput,_a4d=self._getUploadSettings();when(self.model.upload(_a4b),function(_a4e){when(self._confirm(_a4e),function(_a4f){self._resetUploader();if(!(_a4f instanceof Array)||_a4f.length===0){return;}self._fileListModel.set("uploadFiles",_a4f);_a4c._files=_a4f;_a4c.upload(_a4d);});});},close:function(){var self=this,_a50=self.uploaderInput._files,_a51=function(_a52){self.emit("close",_a52);self.set("disableToolbar",false);};if(self._isCompleted||!_a50||_a50.length<=0){_a51(false);}else{var _a53=new _a43({description:_a4a.confirmdialog.description,onAction:function(){_a51(true);}});_a53.show();}},_setUploadStatusAttr:function(_a54,_a55,_a56){this._uploadStatus=_a47.addStatus(this._uploadStatus,_a54,_a55,_a56);},_getUploadStatusAttr:function(){return this._uploadStatus;},_setBreadcrumbAttr:function(_a57){this.breadcrumbBar._cleanUp();this.breadcrumbBar._availableWidth=_a38.getContentBox(this.breadcrumbBar.domNode).w;var i=0,_a58=_a57?_a57.length:0;if(_a58>0){for(i;i<_a58-1;i++){this.breadcrumbBar._createItem(_a57[i],true);}this.breadcrumbBar._createItem(_a57[_a58-1],false);}},_setDisableToolbarAttr:function(_a59){var _a5a=this.uploaderInput;if(_a47.supportNativeDndFiles()){_a5a.set("disabled",_a59);!_a59&&_a5a.set("tabindex",0);}else{_a37.toggle(this.toolbarDisableLayer,"epi-uploadToolbarOverlay",_a59);_a47.toggleVisibility(this.toolbarDisableLayer,_a59);_a5a.flashMovie&&(_a59===false?_a5a.flashMovie.focus():_a5a.flashMovie.blur());if(_a59===true&&!this._toolbarSize){this._toolbarSize=_a38.position(this.uploadToolbar);_a39.set(this.toolbarDisableLayer,{"width":this._toolbarSize.w+"px","height":this._toolbarSize.h+"px"});}}},_setupUploader:function(){this._setupUploaderDefault();this._setupUploaderHtml5Plugin();this._setupUploaderFlashPlugin();},_setupUploaderDefault:function(){var self=this,_a5b=self.uploaderInput;_a5b.uploadUrl=_a42.getActionPath({moduleArea:"CMS",controller:"FileUpload",action:"Upload"});self.own(_a3a.before(_a5b,"onChange",function(_a5c){self._isCompleted=false;self.set("disableToolbar",true);return [self._getUploadSettings()];}));},_setupUploaderHtml5Plugin:function(){if(!_a47.supportNativeDndFiles()){return;}var self=this;self.own(self.uploaderInput.on("error",function(err){self.set("uploadStatus",_a47.StatusScope.All,"",_a4a.uploadform.errormessage);self._onUploadComplete();}));},_setupUploaderFlashPlugin:function(){if(_a47.supportNativeDndFiles()){return;}var self=this;self.own(self.uploaderInput.on("error",function(err){self.set("uploadStatus",_a47.StatusScope.Single,err.target&&err.target.name,_a4a.uploadform.errormessage);}));self._setFlashUploaderSize();self._setFocusOnFlash();},_setFlashUploaderSize:function(){this.own(_a3a.around(this.uploaderInput,"_createInput",function(_a5d){return function(){var _a5e=lang.clone(this.btnSize);this.btnSize.w+=10;this.btnSize.h+=10;_a5d.apply(this,arguments);this.btnSize=_a5e;};}));},_setFocusOnFlash:function(){var _a5f=this.uploaderInput;["focus","load"].forEach(function(_a60){_a5f.on(_a60,function(){setTimeout(function(){var swf=_a5f.flashMovie;if(swf){swf.focus();}return;},1);});},this);},_getUploadSettings:function(){return {"useFlash":!_a47.supportNativeDndFiles(),"uploadDirectory":this.get("uploadDirectory"),"createAsLocalAsset":this.get("createAsLocalAsset")};},_setupFileList:function(){var self=this,_a61=this.uploaderInput;self._fileListModel=new _a48();self.fileList.set("model",self._fileListModel);this.own(_a61.on("begin",function(_a62){if(_a62&&_a62.length>0){self._fileListModel.set("showProgressBar",true);}}),_a61.on("progress",function(_a63){self._fileListModel.set("progress",_a63);}),_a61.on("complete",lang.hitch(self,self._onUploadComplete)),_a3a.after(_a61,"reset",lang.hitch(self,self._fileListModel.clear)),_a3a.around(_a61,"onChange",function(_a64){return function(_a65){var _a66=_a61._files;return when(self.model.upload(_a66),function(_a67){return when(self._confirm(_a67),function(_a68){self._clearUploadStatus();_a68=_a47.getFileArray(_a68);if(!(_a68 instanceof Array)||_a68.length===0){self._resetUploader();return _a64.apply(_a61,[_a65]);}self._fileListModel.set("uploadFiles",_a68);_a61._files=_a68;_a61.upload(self._getUploadSettings());return _a64.apply(_a61,[_a65]);});});};}));},_confirm:function(_a69){return _a69.showConfirmation===true?this._confirmationDialog.showConfirmation(_a69.existingContents,_a69.uploadingFiles,_a69.newFiles):_a69.uploadingFiles;},_clearUploadStatus:function(){this._uploadStatus=[];},_clearUploadFiles:function(){this.uploaderInput._files=[];},_resetUploader:function(){var self=this,_a6a=self.uploaderInput,_a6b=function(){self._fileListModel.set("showProgressBar",false);_a6a.reset();self.set("disableToolbar",false);};if(_a47.supportNativeDndFiles()){_a6b();return;}(_a6a.flashMovie&&_a6a.flashMovie["reset"])&&_a6b();},_onUploadComplete:function(evt){this._isCompleted=true;if(evt){if(evt instanceof Array){var _a6c="";_a35.forEach(evt,function(item){_a6c=item.errorMessage||item.error;if(_a6c!=="server timeout"){if(!_a47.supportNativeDndFiles()&&item.additionalParams&&item.additionalParams.replaceChar){_a47.setAltCommaChar(item.additionalParams.replaceChar);}this.set("uploadStatus",item.index?_a47.StatusScope.Single:_a47.StatusScope.All,item.fileName||item.name,_a6c);}},this);}else{if(evt.isValid===false&&evt.saved===false){this.set("uploadStatus",_a47.StatusScope.All,"",evt.errorMessage);}}}this._fileListModel.set("uploadStatus",this.get("uploadStatus"));this.set("disableToolbar",false);this._clearUploadFiles();this.emit("uploadComplete",!this._fileListModel.uploadStatus?this._fileListModel.uploadFiles:null);}});});},"dojox/form/uploader/plugins/Flash":function(){define("dojox/form/uploader/plugins/Flash",["dojo/dom-form","dojo/dom-style","dojo/dom-construct","dojo/dom-attr","dojo/_base/declare","dojo/_base/config","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojox/form/uploader/plugins/HTML5","dojox/embed/Flash"],function(_a6d,_a6e,_a6f,_a70,_a71,_a72,_a73,lang,_a74,_a75,_a76){var _a77=_a71("dojox.form.uploader.plugins.Flash",[],{swfPath:_a72.uploaderPath||require.toUrl("dojox/form/resources/uploader.swf"),skipServerCheck:true,serverTimeout:2000,isDebug:false,devMode:false,deferredUploading:0,force:"",postMixInProperties:function(){if(!this.supports("multiple")){this.uploadType="flash";this._files=[];this._fileMap={};this._createInput=this._createFlashUploader;this.getFileList=this.getFlashFileList;this.reset=this.flashReset;this.upload=this.uploadFlash;this.fieldname="flashUploadFiles";}this.inherited(arguments);},onReady:function(_a78){},onLoad:function(_a79){},onFileChange:function(_a7a){},onFileProgress:function(_a7b){},getFlashFileList:function(){return this._files;},flashReset:function(){this.flashMovie.reset();this._files=[];},uploadFlash:function(_a7c){this.onBegin(this.getFileList());_a7c.returnType="F";this.flashMovie.doUpload(_a7c);},_change:function(_a7d){this._files=this._files.concat(_a7d);_a74.forEach(_a7d,function(f){f.bytesLoaded=0;f.bytesTotal=f.size;this._fileMap[f.name+"_"+f.size]=f;},this);this.onChange(this._files);this.onFileChange(_a7d);},_complete:function(_a7e){var o=this._getCustomEvent();o.type="load";this.onComplete(_a7e);},_progress:function(f){this._fileMap[f.name+"_"+f.bytesTotal].bytesLoaded=f.bytesLoaded;var o=this._getCustomEvent();this.onFileProgress(f);this.onProgress(o);},_error:function(err){this.onError(err);},_onFlashBlur:function(_a7f){},_getCustomEvent:function(){var o={bytesLoaded:0,bytesTotal:0,type:"progress",timeStamp:new Date().getTime()};for(var nm in this._fileMap){o.bytesTotal+=this._fileMap[nm].bytesTotal;o.bytesLoaded+=this._fileMap[nm].bytesLoaded;}o.decimal=o.bytesLoaded/o.bytesTotal;o.percent=Math.ceil((o.bytesLoaded/o.bytesTotal)*100)+"%";return o;},_connectFlash:function(){this._subs=[];this._cons=[];var _a80=lang.hitch(this,function(s,_a81){this._subs.push(_a73.subscribe(this.id+s,this,_a81));});_a80("/filesSelected","_change");_a80("/filesUploaded","_complete");_a80("/filesProgress","_progress");_a80("/filesError","_error");_a80("/filesCanceled","onCancel");_a80("/stageBlur","_onFlashBlur");this.connect(this.domNode,"focus",function(){this.flashMovie.focus();this.flashMovie.doFocus();});if(this.tabIndex>=0){_a70.set(this.domNode,"tabIndex",this.tabIndex);}},_createFlashUploader:function(){var w=this.btnSize.w;var h=this.btnSize.h;if(!w){setTimeout(dojo.hitch(this,function(){this._getButtonStyle(this.domNode);this._createFlashUploader();}),200);return;}var url=this.getUrl();if(url){if(url.toLowerCase().indexOf("http")<0&&url.indexOf("/")!=0){var loc=window.location.href.split("/");loc.pop();loc=loc.join("/")+"/";url=loc+url;}}else{}this.inputNode=_a6f.create("div",{className:"dojoxFlashNode"},this.domNode,"first");_a6e.set(this.inputNode,{position:"absolute",top:"-2px",width:w+"px",height:h+"px",opacity:0});var args={expressInstall:true,path:(this.swfPath.uri||this.swfPath)+"?cb_"+(new Date().getTime()),width:w,height:h,allowScriptAccess:"always",allowNetworking:"all",vars:{uploadDataFieldName:this.flashFieldName||this.name+"Flash",uploadUrl:url,uploadOnSelect:this.uploadOnSelect,deferredUploading:this.deferredUploading||0,selectMultipleFiles:this.multiple,id:this.id,isDebug:this.isDebug,noReturnCheck:this.skipServerCheck,serverTimeout:this.serverTimeout},params:{scale:"noscale",wmode:"transparent",wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all"}};this.flashObject=new _a76(args,this.inputNode);this.flashObject.onError=lang.hitch(function(msg){console.error("Flash Error: "+msg);});this.flashObject.onReady=lang.hitch(this,function(){this.onReady(this);});this.flashObject.onLoad=lang.hitch(this,function(mov){this.flashMovie=mov;this.flashReady=true;this.onLoad(this);});this._connectFlash();}});dojox.form.addUploaderPlugin(_a77);return _a77;});},"dojox/embed/Flash":function(){define("dojox/embed/Flash",["dojo"],function(dojo){var _a82,_a83;var _a84=9;var _a85="dojox-embed-flash-",_a86=0;var _a87={expressInstall:false,width:320,height:240,swLiveConnect:"true",allowScriptAccess:"sameDomain",allowNetworking:"all",style:null,redirect:null};function prep(_a88){_a88=dojo.delegate(_a87,_a88);if(!("path" in _a88)){console.error("dojox.embed.Flash(ctor):: no path reference to a Flash movie was provided.");return null;}if(!("id" in _a88)){_a88.id=(_a85+_a86++);}return _a88;};if(dojo.isIE){_a82=function(_a89){_a89=prep(_a89);if(!_a89){return null;}var p;var path=_a89.path;if(_a89.vars){var a=[];for(p in _a89.vars){a.push(p+"="+_a89.vars[p]);}_a89.params.FlashVars=a.join("&");delete _a89.vars;}var s="<object id=\""+_a89.id+"\" "+"classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" "+"width=\""+_a89.width+"\" "+"height=\""+_a89.height+"\""+((_a89.style)?" style=\""+_a89.style+"\"":"")+">"+"<param name=\"movie\" value=\""+path+"\" />";if(_a89.params){for(p in _a89.params){s+="<param name=\""+p+"\" value=\""+_a89.params[p]+"\" />";}}s+="</object>";return {id:_a89.id,markup:s};};_a83=(function(){var _a8a=10,_a8b=null;while(!_a8b&&_a8a>7){try{_a8b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_a8a--);}catch(e){}}if(_a8b){var v=_a8b.GetVariable("$version").split(" ")[1].split(",");return {major:(v[0]!=null)?parseInt(v[0]):0,minor:(v[1]!=null)?parseInt(v[1]):0,rev:(v[2]!=null)?parseInt(v[2]):0};}return {major:0,minor:0,rev:0};})();dojo.addOnUnload(function(){var _a8c=function(){};var objs=dojo.query("object").reverse().style("display","none").forEach(function(i){for(var p in i){if((p!="FlashVars")&&dojo.isFunction(i[p])){try{i[p]=_a8c;}catch(e){}}}});});}else{_a82=function(_a8d){_a8d=prep(_a8d);if(!_a8d){return null;}var p;var path=_a8d.path;if(_a8d.vars){var a=[];for(p in _a8d.vars){a.push(p+"="+_a8d.vars[p]);}_a8d.params.flashVars=a.join("&");delete _a8d.vars;}var s="<embed type=\"application/x-shockwave-flash\" "+"src=\""+path+"\" "+"id=\""+_a8d.id+"\" "+"width=\""+_a8d.width+"\" "+"height=\""+_a8d.height+"\""+((_a8d.style)?" style=\""+_a8d.style+"\" ":"")+"pluginspage=\""+window.location.protocol+"//www.adobe.com/go/getflashplayer\" ";if(_a8d.params){for(p in _a8d.params){s+=" "+p+"=\""+_a8d.params[p]+"\"";}}s+=" />";return {id:_a8d.id,markup:s};};_a83=(function(){var _a8e=navigator.plugins["Shockwave Flash"];if(_a8e&&_a8e.description){var v=_a8e.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split(".");return {major:(v[0]!=null)?parseInt(v[0]):0,minor:(v[1]!=null)?parseInt(v[1]):0,rev:(v[2]!=null)?parseInt(v[2]):0};}return {major:0,minor:0,rev:0};})();}var _a8f=function(_a90,node){if(location.href.toLowerCase().indexOf("file://")>-1){throw new Error("dojox.embed.Flash can't be run directly from a file. To instatiate the required SWF correctly it must be run from a server, like localHost.");}this.available=dojox.embed.Flash.available;this.minimumVersion=_a90.minimumVersion||_a84;this.id=null;this.movie=null;this.domNode=null;if(node){node=dojo.byId(node);}setTimeout(dojo.hitch(this,function(){if(_a90.expressInstall||this.available&&this.available>=this.minimumVersion){if(_a90&&node){this.init(_a90,node);}else{this.onError("embed.Flash was not provided with the proper arguments.");}}else{if(!this.available){this.onError("Flash is not installed.");}else{this.onError("Flash version detected: "+this.available+" is out of date. Minimum required: "+this.minimumVersion);}}}),100);};dojo.extend(_a8f,{onReady:function(_a91){},onLoad:function(_a92){},onError:function(msg){},_onload:function(){clearInterval(this._poller);delete this._poller;delete this._pollCount;delete this._pollMax;this.onLoad(this.movie);},init:function(_a93,node){this.destroy();node=dojo.byId(node||this.domNode);if(!node){throw new Error("dojox.embed.Flash: no domNode reference has been passed.");}var p=0,_a94=false;this._poller=null;this._pollCount=0;this._pollMax=15;this.pollTime=100;if(dojox.embed.Flash.initialized){this.id=dojox.embed.Flash.place(_a93,node);this.domNode=node;setTimeout(dojo.hitch(this,function(){this.movie=this.byId(this.id,_a93.doc);this.onReady(this.movie);this._poller=setInterval(dojo.hitch(this,function(){try{p=this.movie.PercentLoaded();}catch(e){}if(p==100){this._onload();}else{if(p==0&&this._pollCount++>this._pollMax){clearInterval(this._poller);throw new Error("Building SWF failed.");}}}),this.pollTime);}),1);}},_destroy:function(){try{this.domNode.removeChild(this.movie);}catch(e){}this.id=this.movie=this.domNode=null;},destroy:function(){if(!this.movie){return;}var test=dojo.delegate({id:true,movie:true,domNode:true,onReady:true,onLoad:true});for(var p in this){if(!test[p]){delete this[p];}}if(this._poller){dojo.connect(this,"onLoad",this,"_destroy");}else{this._destroy();}},byId:function(_a95,doc){doc=doc||document;if(doc.embeds[_a95]){return doc.embeds[_a95];}if(doc[_a95]){return doc[_a95];}if(window[_a95]){return window[_a95];}if(document[_a95]){return document[_a95];}return null;}});dojo.mixin(_a8f,{minSupported:8,available:_a83.major,supported:(_a83.major>=_a83.required),minimumRequired:_a83.required,version:_a83,initialized:false,onInitialize:function(){_a8f.initialized=true;},__ie_markup__:function(_a96){return _a82(_a96);},proxy:function(obj,_a97){dojo.forEach((dojo.isArray(_a97)?_a97:[_a97]),function(item){this[item]=dojo.hitch(this,function(){return (function(){return eval(this.movie.CallFunction("<invoke name=\""+item+"\" returntype=\"javascript\">"+"<arguments>"+dojo.map(arguments,function(item){return __flash__toXML(item);}).join("")+"</arguments>"+"</invoke>"));}).apply(this,arguments||[]);});},obj);}});_a8f.place=function(_a98,node){var o=_a82(_a98);node=dojo.byId(node);if(!node){node=dojo.doc.createElement("div");node.id=o.id+"-container";dojo.body().appendChild(node);}if(o){node.innerHTML=o.markup;return o.id;}return null;};_a8f.onInitialize();dojo.setObject("dojox.embed.Flash",_a8f);return _a8f;});},"epi-cms/widget/FileList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/form/uploader/Base","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dijit/ProgressBar","epi/shell/widget/_ModelBindingMixin","epi/shell/dgrid/Formatter","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.uploadform","dojo/text!./templates/FileList.html"],function(_a99,lang,_a9a,_a9b,_a9c,_a9d,_a9e,_a9f,_aa0,_aa1,_aa2,_aa3,_aa4,_aa5,_aa6,_aa7){return _a99([_a9e,_aa3],{templateString:_aa7,modelBindingMap:{"showProgressBar":["showProgressBar"],"progress":["progress"],"uploadFiles":["uploadFiles"]},postCreate:function(){this.inherited(arguments);this._buildGrid();},_setUploadFilesAttr:function(_aa8){this._bindData(_aa8);},_setShowProgressBarAttr:function(show){_aa5.toggleVisibility(this.progressBar.domNode,show);},_setProgressAttr:function(_aa9){if(!_aa9){return;}this.progressBar.update({progress:_aa9.percent.replace("%","")});},_bindData:function(data){data=data||[];this._grid.refresh();this._grid.renderArray(data);},_buildGrid:function(){var _aaa=_a99([_a9f,_aa1,_aa4]);this._grid=new _aaa({columns:{fileName:{label:_aa6.uploadfilename,field:"fileName",htmlEncode:true},size:{label:_aa6.uploadfilesize,field:"size",get:lang.hitch(this,function(file){var _aab=this.convertBytes(file.size).value;if(isNaN(_aab)){return _aab;}var _aac=_aab===0?_aa6.bytetext:_aa6.bytestext;return lang.replace("{0} {1}",[_aab,_aac]);})},status:{label:_aa6.uploadfilestatus,field:"status",renderCell:lang.hitch(this,function(item,_aad,node,_aae){_a9a.set(node,"title",item.statusMessage?item.statusMessage:"");_a9c.toggle(node,"epi-failedStatus",item.status===_aa6.failed);node.innerHTML=item.status;})}}});this.own(this._grid);_a9b.place(this._grid.domNode,this.domNode);}});});},"dijit/ProgressBar":function(){require({cache:{"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n"}});define("dijit/ProgressBar",["require","dojo/_base/declare","dojo/dom-class","dojo/_base/lang","dojo/number","./_Widget","./_TemplatedMixin","dojo/text!./templates/ProgressBar.html"],function(_aaf,_ab0,_ab1,lang,_ab2,_ab3,_ab4,_ab5){return _ab0("dijit.ProgressBar",[_ab3,_ab4],{progress:"0",value:"",maximum:100,places:0,indeterminate:false,label:"",name:"",templateString:_ab5,_indeterminateHighContrastImagePath:_aaf.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);if(!(this.params&&"value" in this.params)){this.value=this.indeterminate?Infinity:this.progress;}},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());this.update();},update:function(_ab6){lang.mixin(this,_ab6||{});var tip=this.internalProgress,ap=this.domNode;var _ab7=1;if(this.indeterminate){ap.removeAttribute("aria-valuenow");}else{if(String(this.progress).indexOf("%")!=-1){_ab7=Math.min(parseFloat(this.progress)/100,1);this.progress=_ab7*this.maximum;}else{this.progress=Math.min(this.progress,this.maximum);_ab7=this.maximum?this.progress/this.maximum:0;}ap.setAttribute("aria-valuenow",this.progress);}ap.setAttribute("aria-describedby",this.labelNode.id);ap.setAttribute("aria-valuemin",0);ap.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(_ab7);_ab1.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);tip.style.width=(_ab7*100)+"%";this.onChange();},_setValueAttr:function(v){this._set("value",v);if(v==Infinity){this.update({indeterminate:true});}else{this.update({indeterminate:false,progress:v});}},_setLabelAttr:function(_ab8){this._set("label",_ab8);this.update();},_setIndeterminateAttr:function(_ab9){this.indeterminate=_ab9;this.update();},report:function(_aba){return this.label?this.label:(this.indeterminate?"&#160;":_ab2.format(_aba,{type:"percent",places:this.places,locale:this.lang}));},onChange:function(){}});});},"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n","epi-cms/widget/UploadUtil":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/dom-style"],function(_abb,lang,_abc){return {_altCommaChar:null,StatusScope:{Single:0,All:1},setAltCommaChar:function(_abd){this._altCommaChar=_abd;},getAltCommaChar:function(){return this._altCommaChar;},validUploadFiles:function(_abe){if(!_abe||!(_abe instanceof Array)||_abe.length===0){return false;}return !_abb.some(_abe,function(item){return (item.name==null||item.size==null);});},addStatus:function(_abf,_ac0,_ac1,_ac2){var _ac3=[];if(_abf instanceof Array){_ac3=lang.clone(_abf);}if(!this.supportNativeDndFiles()){_ac2=this.replaceComma(_ac2);}var _ac4=_abb.some(_ac3,function(item){return (item.scope===_ac0&&item.itemName===_ac1&&item.message===_ac2);});if(!_ac4){_ac3.push({scope:_ac0,itemName:_ac1,message:_ac2});}return _ac3;},supportNativeDndFiles:function(){return !!window.FileReader;},filterFileOnly:function(_ac5){return _abb.filter(_ac5,function(file){if(file.type===""&&(file.size===0||file.size%4096===0)){return false;}return true;});},replaceComma:function(data){return data.replace(new RegExp("\\"+this.getAltCommaChar(),"gim"),",");},toggleVisibility:function(_ac6,_ac7){_abc.set(_ac6,"display",(_ac7?"block":"none"));},getFileArray:function(_ac8){if(!_ac8){return null;}if(_ac8 instanceof Array){return _ac8;}if(typeof _ac8.item!=="function"){return null;}var i=0,_ac9=_ac8.length,_aca=[];for(i;i<_ac9;i++){_aca.push(_ac8.item(i));}return _aca;}};});},"url:epi-cms/widget/templates/FileList.html":"<div class=\"epi-multiFileUpload-list\">\r\n    <div data-dojo-type=\"dijit/ProgressBar\" data-dojo-attach-point=\"progressBar\" data-dojo-props=\"maximum:100\"></div>\r\n</div>","epi-cms/widget/MultipleFileUploadConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/aspect","dojo/Deferred","dojo/when","epi/string","epi/shell/widget/dialog/Dialog","epi-cms/widget/ReadOnlyContentList","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.replaceconfirmdialog"],function(_acb,_acc,lang,_acd,_ace,_acf,when,_ad0,_ad1,_ad2,_ad3){return _acc(null,{showConfirmation:function(_ad4,_ad5,_ad6){var _ad7=new _acf(),_ad8=this._getDialog(_ad4.length),_ad9=this._getContentList();_ad8.set("content",_ad9);_ad8.set("onAction",function(_ada){_ad7.resolve(_ada?_ad5:_ad6);});when(_ad8.show(),function(){_ad9.grid.renderArray(_ad4);});return _ad7;},_getDialog:function(_adb){var self=this,_adc=_ad0.toHTML(_adb>1?lang.replace(_ad3.multiple.heading,[_adb]):_ad3.single.heading),_add=_ad0.toHTML(_adb>1?_ad3.multiple.description:_ad3.single.description);var _ade=new _ad1({closeIconVisible:false,destroyOnHide:true,title:_ad3.title,heading:_adc,description:_add,getActions:function(){return self._getActions(this,_adb===1);}});_acd.add(_ade.domNode,"epi-readOnlyContentListDialog");return _ade;},_getActions:function(_adf,_ae0){return [{name:"replaceFiles",label:_ae0?_ad3.single.buttons.replace:_ad3.multiple.buttons.replace,title:null,action:function(){when(_adf.hide(),function(){return _adf.onAction(true);});}},{name:"skipFiles",label:_ae0?_ad3.single.buttons.skip:_ad3.multiple.buttons.skip,title:null,action:function(){when(_adf.hide(),function(){return _adf.onAction(false);});}}];},_getContentList:function(){var _ae1=new _ad2();_acd.add(_ae1.domNode,"epi-thumbnailContentList");return _ae1;}});});},"epi-cms/widget/ReadOnlyContentList":function(){define(["dojo/_base/declare","dgrid/OnDemandList","epi/shell/dgrid/Formatter","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/widget/_ContentListBase","epi/i18n!epi-cms/nls/episerver.shared.header"],function(_ae2,_ae3,_ae4,_ae5,_ae6,_ae7,_ae8){return _ae2([_ae7],{_gridClass:_ae2([_ae3,_ae4]),query:null,queryOptions:null,onPostCreateSettings:function(){},postCreate:function(){this.inherited(arguments);this.onPostCreateSettings();},destroy:function(){if(this.grid){this.grid.destroy();this.grid=null;}this.inherited(arguments);},getContextMenu:function(){},createList:function(){this.inherited(arguments);this.grid.set("showHeader",false);},getListSettings:function(){return this._getBaseSettings();},_setQueryAttr:function(_ae9){this._set("query",_ae9);this._updateQuery(_ae9);},_getBaseSettings:function(_aea){var _aeb=function(item){var _aec=new _ae5(item.contentLink);var _aed=item.name+", "+_ae8.id+": "+_aec.id+" ("+_ae8.type+": "+item.contentTypeName+")";return _aed;};var _aee=function(item){return item.thumbnailUrl;};return {store:this.store,queryOptions:this.queryOptions,formatters:[_ae6.contentItemFactory("name",_aeb,null,_aea,_aee)],deselectOnRefresh:true};},_updateQuery:function(_aef){if(_aef){this.grid.set("query",_aef);}else{this.grid.cleanup();}}});});},"epi-cms/widget/_ContentListBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/when","epi/shell/widget/ContextMenu","./_GridWidgetBase"],function(_af0,lang,_af1,when,_af2,_af3){return _af0([_af3],{storeKeyName:"epi.cms.content.search",trackActiveItem:false,gridAttachNode:null,contextChangeEvent:"dblclick",postMixInProperties:function(){this.inherited(arguments);this.model=this.model||this.createModel();},postCreate:function(){this.inherited(arguments);this.createList();},createModel:function(){},createList:function(){var _af4=this.getListSettings();_af4=lang.mixin(_af4,this.defaultGridMixin);this.grid=new this._gridClass(_af4,this.gridAttachNode||this.domNode);var _af5=this.model&&this.model.commands&&this.model.commands.length>0;if(_af5){this.grid.contextMenu.addProvider(this.model);}if(this.contextMenu){this.grid.contextMenu=this.contextMenu;}this.own(this.grid);this.setupEvents();},getListSettings:function(){return {};},setupEvents:function(){},onContextChanged:function(){},_onSelect:function(e){when(this.getCurrentContext(),lang.hitch(this,function(_af6){var grid=this.grid;var _af7={contextId:_af6.id,data:[]};if(this.model){for(var id in grid.selection){if(grid.selection[id]){var row=grid.row(id);_af7.data.push(row.data);}}this.model.set("model",_af7);}}));}});});},"epi-cms/widget/viewmodel/FileListViewModel":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles"],function(_af8,_af9,lang,_afa,_afb,_afc,_afd){return _af8([_afa,_afb],{progress:null,uploadFiles:null,uploadStatus:null,showProgressBar:false,_setUploadFilesAttr:function(_afe){if(!_afc.validUploadFiles(_afe)){return;}var _aff=[];_af9.forEach(_afe,function(file){_aff.push({fileName:file.name,size:file.size,status:_afd.uploadform.uploading});},this);this._set("uploadFiles",_aff);},_setUploadStatusAttr:function(_b00){var _b01=this.get("uploadFiles");if(_af9.some(_b01,function(item){return item.status!==_afd.uploadform.uploading;})){return;}_af9.forEach(_b01,function(item){if(!_b00||_b00.length<=0){item.status=_afd.uploadform.uploaded;return false;}if(_b00[0]&&_b00[0].scope===_afc.StatusScope.All&&_b00[0].itemName===""){item.status=_afd.uploadform.failed;item.statusMessage=_b00[0].message;return false;}var _b02=_af9.filter(_b00,function(_b03){return item.fileName===_b03.itemName;});if(_b02&&_b02.length>0){item.status=_afd.uploadform.failed;item.statusMessage=_b02[0].message;}else{item.status=_afd.uploadform.uploaded;}},this);this._set("uploadFiles",_b01);},clear:function(){this._set("uploadFiles",null);}});});},"url:epi-cms/widget/templates/MultipleFileUpload.html":"<div class=\"epi-multiFileUpload\">\r\n    <form method=\"post\" action=\"\" enctype=\"multipart/form-data\">\r\n        <div data-dojo-attach-point=\"breadcrumbBar\" data-dojo-type=\"epi-cms/widget/Breadcrumb\"></div>\r\n        <div data-dojo-attach-point=\"uploadToolbar\" class=\"epi-toolbar-unwrapped\">\r\n            <span title=\"${res.uploadform.addfiles}\" >\r\n                <input type=\"file\" multiple=\"multiple\" data-dojo-type=\"dojox.form.Uploader\" data-dojo-attach-point=\"uploaderInput\" \r\n                    data-dojo-props=\"iconClass:'epi-iconPlus', showLabel: false, multiple: true\" />\r\n            </span>\r\n            <div data-dojo-attach-point=\"toolbarDisableLayer\"></div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"fileList\" data-dojo-type=\"epi-cms/widget/FileList\"></div>\r\n    </form>\r\n</div>","epi-cms/command/UploadContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference"],function(_b04,_b05,_b06,_b07){return _b04([_b05],{fileList:null,createAsLocalAsset:false,_execute:function(){var _b08=_b07.toContentReference(this.model.contentLink).createVersionUnspecificReference();this.viewModel.upload(this.fileList,_b08.toString(),this.createAsLocalAsset);this.fileList=null;},_onModelChange:function(){var _b09=this.model,_b0a=_b09&&_b06.hasProviderCapability(_b09.providerCapabilityMask,_b06.providerCapabilities.Create)&&_b06.hasAccess(_b09.accessMask,_b06.accessLevel.Create);this.set("canExecute",!!(_b0a&&this.viewModel));}});});},"epi-cms/command/EditImage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/topic","epi/dependency","epi/routes","epi/Url","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper","epi-cms/legacy/LegacyDialogPopup","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/shell/command/_SelectionCommandMixin","epi-cms/contentediting/ContentActionSupport"],function(_b0b,lang,when,_b0c,_b0d,_b0e,Url,_b0f,_b10,_b11,_b12,_b13,_b14,_b15,_b16){return _b0b([_b14,_b15],{canExecute:false,iconClass:"epi-iconNewWindow",_segmentIdSeperator:",,",getRouteParams:function(){var _b17=this._getTarget();return {moduleArea:"LegacyCMS",path:"Edit/ImageEditor/ImageEditor.aspx",IsInLegacyWrapper:false,imageId:_b17?_b17.contentLink:""};},_createDialog:function(_b18,_b19){var _b1a=this._getTarget(),_b1b=this.model;if(_b1a){var _b1c=function(_b1d){if(_b1d){_b0c.publish("/epi/shell/context/request",{url:_b1d.src},{forceReload:true});}};lang.mixin(_b18,{url:_b0e.getActionPath(_b19),dialogArguments:{src:_b12.toPermanentLink(_b1a)},destroyOnHide:true,onCallback:_b1c});}return new _b13(_b18);},_onModelChange:function(){if(!_b10.imageEditorEnabled){if(this.get("isAvailable")){this.set("isAvailable",false);}return;}var _b1e=this._getTarget(),_b1f=this.model&&_b1e&&_b0f.isBaseTypeIdentifier(_b1e.typeIdentifier,"episerver.core.icontentimage");this.set("canExecute",!!_b1f);},_getTarget:function(){var _b20=this.selection&&this.selection.data,_b21=_b20&&_b20.length==1&&_b20[0];return _b21&&(_b21.type=="epi.cms.contentdata")?_b21.data:null;}});});},"epi-cms/command/DownloadMedia":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/dom-construct","dojo/has","dojo/sniff","dojo/when","epi/shell/Downloader","epi/shell/TypeDescriptorManager","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_b22,_b23,_b24,has,_b25,when,_b26,_b27,_b28,_b29,_b2a){return _b22([_b28,_b29],{label:_b2a.download,tooltip:_b2a.download,iconClass:"epi-iconDownload",_execute:function(){var _b2b=this._getContentData();if(!_b2b){return;}_b26.download(_b2b.downloadUrl,_b2b.name);},_onModelChange:function(){var _b2c=this._getContentData(),_b2d=_b2c&&_b2c.downloadUrl,_b2e=_b2c&&_b2c.typeIdentifier,_b2f=_b2e&&_b27.getValue(_b2e,"actAsAnAsset");this.set("canExecute",!!(_b2f&&_b2d));},_getContentData:function(){var _b30=null;if(this.selection&&this.selection.data&&this.selection.data instanceof Array&&this.selection.data.length===1){_b30=this.selection.data[0].data;}return _b30;}});});},"epi/shell/Downloader":function(){define("epi/shell/Downloader",["dojo/_base/lang","dojo/dom-construct"],function(lang,_b31){return {_classicalDownload:function(url,name){var _b32=document.getElementsByTagName("body")[0],_b33={href:url,download:name,target:"_blank",style:{display:"none;"}},_b34=_b31.create("a",_b33,_b32,"last");_b34.click();_b31.destroy(_b34);},download:function(url,name){if(url){return this._classicalDownload(url,name);}}};});},"epi-cms/widget/HierarchicalList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dojox/html/entities","epi/string","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Alert","epi/shell/widget/ContextMenu","epi-cms/widget/SearchBox","epi-cms/widget/FolderTree","epi-cms/widget/ContentList","epi-cms/widget/FilesUploadDropZone","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/HierarchicalListViewModel","dojo/text!./templates/HierarchicalList.html","dojo/text!./templates/AssetsDropZone.html","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist"],function(_b35,_b36,lang,_b37,_b38,_b39,_b3a,_b3b,on,when,_b3c,_b3d,_b3e,_b3f,_b40,_b41,_b42,_b43,_b44,_b45,_b46,_b47,_b48,_b49,_b4a,_b4b,_b4c,_b4d,_b4e,res){return _b36([_b3e,_b3c,_b3d,_b44,_b42],{contextMenu:null,templateString:_b4d,showRoot:false,enableDndFileDropZone:false,showCreateContentArea:false,triggerContextChange:false,res:res,modelClassName:_b4c,hierarchicalListClass:"",noDataMessage:"",createContentIcon:"",createContentText:"",_dropZoneCreated:false,modelBindingMap:{"searchRoots":["searchRoots"],"searchArea":["searchArea"],"listQuery":["listQuery"],"currentTreeItem":["currentTreeItem"],"currentListItem":["currentListItem"],"editingListItem":["editingListItem"],"showAllLanguages":["showAllLanguages"]},_setSearchAreaAttr:function(_b4f){this.searchBox.set("area",_b4f);},_setSearchRootsAttr:function(_b50){this.searchBox.set("searchRoots",_b50);},_setListQueryAttr:function(_b51){this.list.set("query",_b51);},_setShowAllLanguagesAttr:function(_b52){this.searchBox.set("filterOnCulture",!_b52);},_setCurrentTreeItemAttr:function(_b53){if(_b53){this._toggleActive(this.tree,this.list);when(this.tree.selectContent(_b53.toString()),lang.hitch(this,function(){var _b54=this.tree.getNodesByItem(_b53.toString())[0];if(_b54){this.tree.model.set("previousSelection",{selectedContent:_b54,selectedAncestors:_b54.getTreePath()});}}));}},_setCurrentListItemAttr:function(_b55){this.list.set("currentItem",_b55);this._toggleActive(this.list,this.tree);},_setEditingListItemAttr:function(_b56){this.list.set("editingItem",_b56);},_setShowRootAttr:function(_b57){this.tree.set("showRoot",_b57);},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&!this.commandProvider&&this.modelClassName){var _b58=_b36(this.modelClassName);this.model=this.commandProvider=new _b58({repositoryKey:this.repositoryKey});}this.setupContextMenu();},setupContextMenu:function(){this.own(this.contextMenu=new _b46({category:"context"}));this.contextMenu.addProvider(this.model);},postCreate:function(){this.inherited(arguments);_b38.add(this.domNode,this.hierarchicalListClass);this._setupTree();this._setupCreateContentArea();this._setupList();if(this.enableDndFileDropZone){this._setupDropZone();}this._toggleCreateContentArea(this.showCreateContentArea);this.model.startup();this.own(this.model.clipboardManager.watch("data",lang.hitch(this,this._updateClipboardIndicators)));},startup:function(){this.inherited(arguments);if(this.contextMenu){this.contextMenu.startup();}},destroy:function(){this.model.destroy();this.inherited(arguments);},layout:function(){if(this.enableDndFileDropZone){var grid=this.list.grid;if(grid){_b38.add(grid.bodyNode,"epi-drop-area");}}var _b59=_b3a.getMarginBox(this.list.domNode),_b5a=_b3a.getMarginBox(this.searchBox.domNode),_b5b=this._contentBox.h-_b5a.h-32;if(_b59.h>_b5b){this.list.resize({h:_b5b});}this.container.resize(this._contentBox);},_toggleCreateContentArea:function(_b5c){_b3b.set(this.createContentArea,{"display":_b5c?"":"none"});},_toggleActive:function(_b5d,_b5e){_b38.remove(_b5e.domNode,"epi-focused");_b38.add(_b5d.domNode,"epi-focused");},_showNotification:function(_b5f){var _b60=new _b45({destroyOnHide:true,description:_b41.toHTML(_b5f)});_b60.show();},_onDrop:function(evt,_b61){_b61=_b4b.filterFileOnly(_b61);if(!_b61||_b61.length<=0){return;}var _b62=this.model.getCommand("uploadDefault");if(!_b62){return;}_b62.set("fileList",_b61);_b62.execute();},_setupDropZone:function(){if(!(_b4b.supportNativeDndFiles()&&!this._dropZoneCreated)){return;}var _b63=new _b4a({"templateString":_b4e,"res":res,"outsideDomNode":this.container.domNode});_b39.place(_b63.domNode,this.domNode,"first");this.connect(_b63,"onDrop",this._onDrop);this._dropZoneCreated=true;var _b64=this.model.getCommand("uploadDefault");if(_b64){this.own(_b64.watch("canExecute",function(name,_b65,_b66){_b63.set("enabled",_b66);}));}},_setupTree:function(){var _b67=this.model._commandRegistry;function _b68(item,node,e){this.model.onTreeItemSelected(item,this.tree.model.isTypeOfRoot(item));};function _b69(copy){copy?_b67.copy.command.execute():_b67.cut.command.execute();};this.own(on(this.tree,"copyOrCut",_b69),on(this.tree,"select",lang.hitch(this,_b68)),on(this.tree,"paste",function(){_b67.paste.command.execute();}),on(this.tree,"delete",function(){_b67["delete"].command.execute();}),_b37.after(this.tree,"onClick",lang.hitch(this,_b68),true));this.model._commandRegistry.rename.command.set("renameDelegate",lang.hitch(this,function(_b6a){this.tree.getNodesByItem(_b6a)[0].edit();}));},_setupCreateContentArea:function(){_b38.add(this.createContentAreaIcon,this.createContentIcon);this.createContentAreaText.innerHTML=this.createContentText;this.list.set("noDataMessage",this.noDataMessage);},_setupList:function(){this.own(on(this.list,"itemSelected",lang.hitch(this.model,this.model.onListItemSelected)),_b37.after(this.model,"onListItemUpdated",lang.hitch(this.list,function(_b6b){when(_b6b,lang.hitch(this,this.editContent));})));},_onSearchAction:function(_b6c){this.model.onSearch(_b6c.metadata);},_updateClipboardIndicators:function(name,_b6d,_b6e){var _b6f=this.model.clipboardManager.isCopy();if(_b6d instanceof Array){_b35.forEach(_b6d,function(clip){this.tree.toggleCut(clip.data,false);this.list.toggleCut(clip.data,false);},this);}if(!_b6f&&_b6e instanceof Array){_b35.forEach(_b6e,function(clip){this.tree.toggleCut(clip.data,true);this.list.toggleCut(clip.data,true);},this);}}});});},"epi-cms/widget/FolderTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/aspect","dojo/json","dojo/when","dojox/html/entities","dijit/tree/_dndSelector","epi/dependency","epi/string","epi-cms/widget/_FolderTreeNode","epi-cms/widget/ContentTree","epi-cms/widget/ContentTreeStoreModel"],function(_b70,_b71,lang,_b72,_b73,_b74,json,when,_b75,_b76,_b77,_b78,_b79,_b7a,_b7b){return _b71([_b7a],{handleSelection:true,postCreate:function(){var self=this;self.inherited(arguments);self.own(self.connect(self.model,"onDeleted",lang.hitch(self,self._onDeleted)),_b74.around(self.model,"onRefreshRoots",function(_b7c){return function(_b7d){if(_b7d&&typeof self._onItemDelete==="function"){self._onItemDelete(_b7d);}return _b7c.apply(self.model,[_b7d]);};}));},toggleCut:function(item,_b7e){var node=this.tree.getNodesByItem(item)[0];if(node){_b73.toggle(node.rowNode,"epi-opacity50",_b7e);}},_createTreeModel:function(){return new _b7b({store:this.store});},_updateItemDeletedHierachy:function(node){if(!node){return;}_b70.forEach(node.getChildren(),function(_b7f){_b7f.set({item:lang.mixin(_b7f.item,{isDeleted:true})});this._updateItemDeletedHierachy(_b7f);},this);},_onDeleted:function(item){var _b80=this.getNodesByItem(item);_b70.forEach(_b80,function(node){this._updateItemDeletedHierachy(node);},this);},_renameFolder:function(item,name){var _b81=lang.trim(name),_b82=this.getNodesByItem(item)[0];if(_b81){when(this.model.rename(item.contentLink,_b81),function(item){_b72.set(_b82.contentNode,"title",item.name);},function(ex){_b82.rollbackLabel(item.name,ex);_b82.edit();});}else{_b82.rollbackLabel(item.name);}},buildNodeFromTemplate:function(args){var _b83=new _b79(args);_b83.bindContextMenu(this.contextMenu);this.own(_b83.on("rename",lang.hitch(this,function(val){this._renameFolder(_b83.item,val);})));return _b83;},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node._handleMouseEnter();},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node._handleMouseLeave();},_onClick:function(node,evt){this.inherited(arguments);node._onClick();}});});},"epi-cms/widget/_FolderTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/Evented","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojox/html/entities","dojo/text!./templates/_FolderTreeNode.html","dijit/form/TextBox","dijit/form/ValidationTextBox","dijit/InlineEditBox","epi","epi-cms/widget/_ContentTreeNode"],function(_b84,lang,_b85,_b86,_b87,_b88,_b89,_b8a,keys,on,when,_b8b,_b8c,_b8d,_b8e,_b8f,epi,_b90){_b84("_TreeInlineEditor",[dijit._InlineEditor],{postCreate:function(){this.inherited(arguments);this.own(on(this.domNode,"mousedown, mouseup, click, keydown, keypress, selectstart",function(e){e.stopPropagation();}));}});var _b91={normal:0,root:1};return _b84([_b90,_b89],{templateString:_b8c,_blockFolderMenu:"epi-iconContextMenu",_blockFolderDnDIcon:"epi-iconDnD",_blockFolderExpand:"epi-iconObjectFolderOpen",_blockFolderCollapse:"epi-iconObjectFolder",_isResetValue:false,_menuTooltip:undefined,contextMenu:null,_editWidget:null,_rowStates:{NORMAL:1,EXPANDED:2,ENTERED:4,SELECTED:8},_currentRowState:1,postMixInProperties:function(){this.inherited(arguments);this._menuTooltip=epi.resources.action.options;},postCreate:function(){this.inherited(arguments);_b88.set(this.iconNodeMenu,"zIndex",_b87.position(this.rowNode).zIndex+1);this._updateStyle();},buildRendering:function(){this.inherited(arguments);this.labelWidget=new _b8f({value:this.label,editorWrapper:"_TreeInlineEditor",editor:"dijit/form/ValidationTextBox",width:"auto",editorParams:{maxLength:255},_onMouseOver:function(){},_onClick:function(){},onChange:lang.hitch(this,this._onChangeLabelValue),onCancel:lang.hitch(this,function(){this.emit("cancelEdit",this.item.contentLink);this._resetValue();this._setEditorState();})},this.labelNode);},edit:function(){this.labelWidget.value=this.label;this.labelWidget.edit();this._editWidget=this.labelWidget.wrapperWidget.editWidget;this.own(on(this._editWidget.domNode,"keydown",lang.hitch(this,function(e){if(!this._editWidget.isValid()&&e.keyCode!=keys.ENTER){this._setEditorState();}})));},_resetValue:function(val){this._isResetValue=true;this.labelWidget.set("value",val||this.label);},_onChangeLabelValue:function(val){if(!val){this._resetValue();return;}if(!this._isResetValue){this.emit("rename",val);}this._isResetValue=false;},_onClick:function(evt){this.inherited(arguments);_b86.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");this.emit("nodeSelected",this);},rollbackLabel:function(val,_b92){if(!this.labelWidget.value){this._resetValue(val);}if(_b92&&_b92.length>0){this._setEditorState(_b92[0].errorMessage);}},bindContextMenu:function(menu){this.contextMenu=menu;this.connect(this.iconNodeMenu,"onclick","_onIconNodeMenuClick");},collapse:function(){var self=this,def=new _b8a();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState^self._rowStates.EXPANDED;self._updateStyle();def.resolve(true);});return def;},expand:function(){var self=this,def=new _b8a();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState|self._rowStates.EXPANDED;self._updateStyle();def.resolve();});return def;},setSelected:function(_b93){if(!this.tree.getNodesByItem(this.item)[0]){return;}this.inherited(arguments);var _b94=this._currentRowState;this._currentRowState=_b93?(this._currentRowState|this._rowStates.SELECTED):parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0?(this._currentRowState^this._rowStates.SELECTED):_b94;this._updateStyle();if(_b93){this.emit("nodeSelected",this);}},_updateIndividualLayout:function(){_b85.set(this.contentNode,"title",this.label);this._updateStyleBySingleState();if(this.item&&this.item.contentLink){this.emit("nodeRefreshed",this.item.contentLink);}},_updateBlockFolderTypeIcon:function(){if(this._isTypeOfRoot()){this._iconNodeClass=this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse);}else{this._iconNodeClass=this.isExpanded?this._blockFolderExpand:this._blockFolderCollapse;}_b86.add(this.iconNode,this._iconNodeClass);},_handleMouseEnter:function(){this._currentRowState=this._currentRowState|this._rowStates.ENTERED;this._updateStyle();_b86.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");},_handleMouseLeave:function(){this._currentRowState=this._currentRowState^this._rowStates.ENTERED;this._updateStyle();},_onIconNodeMenuClick:function(evt){this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});this.emit("nodeSelected",this);},_updateStyleBySingleState:function(_b95){var _b96=this._rowStates;switch(_b95){case _b96.SELECTED:case _b96.ENTERED:if(this.contextMenu){_b86.add(this.iconNodeMenu,this._blockFolderMenu);}break;default:if(this.contextMenu){_b86.remove(this.iconNodeMenu,this._blockFolderMenu);}_b86.remove(this.iconNode,this._blockFolderExpand);_b86.remove(this.iconNode,this._blockFolderCollapse);var _b97=this.isExpanded&&this.hasChildren()?this._blockFolderExpand:this._blockFolderCollapse;_b86.add(this.iconNode,this._isTypeOfRoot()?this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse):_b97);if(this.contextMenu&&parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0){_b86.add(this.iconNodeMenu,this._blockFolderMenu);}break;}},_updateStyle:function(){for(var _b98 in this._rowStates){if(parseInt(this._currentRowState&this._rowStates[_b98],10)>0){this._updateStyleBySingleState(this._rowStates[_b98]);}}},_addLanguageIndicator:function(){this.inherited(arguments);_b85.remove(this.iconNodeLanguage,"title");},_setEditorState:function(_b99){if(this._editWidget){_b99=_b8b.encode(_b99);this._editWidget.invalidMessage=_b99||"";this._editWidget.set("state",_b99?"Error":"");this._editWidget.isValid=function(){return !_b99;};this._editWidget.validate();}}});});},"url:epi-cms/widget/templates/_FolderTreeNode.html":"<div class=\"dijitTreeNode epi-folderTreeNode\" role=\"presentation\">\r\n    <div tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon dijitTreeIcon\" role=\"presentation\" title=\"${_menuTooltip}\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-ft-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/ContentList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/aspect","dojo/Evented","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","dojox/html/entities","epi","epi/shell/dgrid/Formatter","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/dgrid/WithContextMenu","epi-cms/widget/ReadOnlyContentList"],function(_b9a,lang,_b9b,_b9c,_b9d,_b9e,_b9f,_ba0,_ba1,_ba2,epi,_ba3,_ba4,_ba5,_ba6,DnD,_ba7,_ba8){return _b9a([_ba8,_b9e],{_gridClass:_b9a([_ba0,_ba3,_ba1,DnD,_b9f,_ba7]),resources:"",noDataMessage:null,editingItem:null,postCreate:function(){this.inherited(arguments);_b9b.add(this.domNode,"epi-contentList");},_setCurrentItemAttr:function(_ba9){if(!this.get("editingItem")){this.set("editingItem",_ba9);}this._set("currentItem",_ba9);this.select(_ba9);},_setNoDataMessageAttr:function(_baa){this.noDataMessage=_baa;this.grid.set("noDataMessage",_baa);},_dndNodeCreator:function(item,hint){var _bab=_ba4.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_bab&&this.dndTypes){_bab=this.dndTypes;}return {"node":_b9c.create("div").appendChild(document.createTextNode(item.name)),"type":_bab,"data":item};},getListSettings:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:epi.resources.action.options}};return lang.delegate(this._getBaseSettings(menu),{noDataMessage:this.noDataMessage,dndParams:{copyOnly:true,selfAccept:false,accept:[],creator:lang.hitch(this,this._dndNodeCreator)}});},setupEvents:function(){this.inherited(arguments);this.own(this.grid.on(".epi-createContent:click",lang.hitch(this,function(e){this.emit("createItemAction",{});})),_b9d.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)));},_onSelect:function(evt){this.inherited(arguments);if(this.grid.selectionMode==="single"){this.emit("itemSelected",evt.rows[0].data);}},editContent:function(item){if(!item||!this.grid.row(item).element){return;}this.emit("itemAction",item);this.set("editingItem",this.currentItem);},_onChangeContext:function(evt){this.editContent(this.grid.row(evt).data);},toggleCut:function(item,_bac){var row;if(item){row=this.grid.row(_ba5.toContentReference(item.contentLink).id);if(row&&row.element){_b9b.toggle(row.element,"epi-opacity50",_bac);}}}});});},"epi-cms/widget/FilesUploadDropZone":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dijit/_Widget","dijit/_TemplatedMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.dropzone","dojo/text!./templates/FilesUploadDropZone.html"],function(_bad,lang,_bae,_baf,_bb0,_bb1,_bb2,_bb3){return _bad([_bb0,_bb1],{res:_bb2,templateString:_bb3,dragStartCssClass:"epi-dragStart",dragOverCssClass:"epi-dragOver",outsideDomNode:null,enabled:true,postCreate:function(){this.inherited(arguments);if(this.outsideDomNode){this.connect(this.outsideDomNode,"dragover",lang.hitch(this,this._onDragOverOutside));this.connect(this.outsideDomNode,"dragleave",lang.hitch(this,function(evt){this._onDragLeave(evt,this.outsideDomNode);}));this.connect(this.outsideDomNode,"dragend",lang.hitch(this,this._onDragLeave));this.connect(this.outsideDomNode,"drop",lang.hitch(this,this._onDragLeave));}this.connect(this.domNode,"dragover",lang.hitch(this,this._onDragOver));this.connect(this.domNode,"dragleave",lang.hitch(this,this._onDragLeave));this.connect(this.domNode,"dragend",lang.hitch(this,this._onDragLeave));this.connect(this.domNode,"drop",lang.hitch(this,this._onDrop));},_onDragOverOutside:function(evt){if(!this.enabled){return;}evt.preventDefault();_bae.add(this.domNode,this.dragStartCssClass);},_isHover:function(evt,_bb4){var _bb5=_baf.position(_bb4),_bb6=evt.clientX,_bb7=evt.clientY;return !(_bb6<_bb5.x||_bb6>(_bb5.x+_bb5.w)||_bb7<_bb5.y||_bb7>(_bb5.y+_bb5.h));},_onDragOver:function(evt){if(!this.enabled){return;}evt.preventDefault();_bae.remove(this.domNode,this.dragStartCssClass);_bae.add(this.domNode,this.dragOverCssClass);},_onDragLeave:function(evt,_bb8){if(!this.enabled){return;}evt.preventDefault();if(!this._isHover(evt,_bb8||this.domNode)){this._removeAllCssClasses();}},onDrop:function(evt,_bb9){},_onDrop:function(evt){if(!this.enabled){return;}evt.preventDefault();this._removeAllCssClasses();this.onDrop(evt,evt.dataTransfer.files);},_removeAllCssClasses:function(){_bae.remove(this.domNode,this.dragStartCssClass);_bae.remove(this.domNode,this.dragOverCssClass);}});});},"url:epi-cms/widget/templates/FilesUploadDropZone.html":"<div class=\"epi-filesUploadDropZone\">\r\n    <div>\r\n        <span data-dojo-attach-point=\"description\">${res.description}</span>\r\n    </div>\r\n</div>","url:epi-cms/widget/templates/HierarchicalList.html":"<div class=\"epi-hierarchicalList\">\r\n    <div data-dojo-attach-point=\"container\"\r\n         data-dojo-type=\"dijit/layout/BorderContainer\"\r\n         data-dojo-props=\"gutters: false\">\r\n        <div class=\"epi-gadgetInnerToolbar\"\r\n             data-dojo-attach-point=\"searchBox\"\r\n             data-dojo-type=\"epi-cms/widget/SearchBox\"\r\n             data-dojo-props=\"region:'top', splitter: false, triggerContextChange: this.triggerContextChange\"\r\n             data-dojo-attach-event=\"onItemAction:_onSearchAction\"></div>\r\n        <div class=\"epi-secondaryGadgetContainer epi-gadgetTopContainer\"\r\n             data-dojo-attach-point=\"tree\"\r\n             data-dojo-type=\"epi-cms/widget/FolderTree\" \r\n             data-dojo-props=\"region:'center', splitter:false, model: this.model.treeStoreModel, showRoot: false, contextMenu: this.contextMenu\"></div>\r\n        <div data-dojo-attach-point=\"list\" class=\"epi-gadgetBottomContainer\"\r\n             data-dojo-type=\"epi-cms/widget/ContentList\"\r\n             data-dojo-props=\"region:'bottom', splitter:true, store: this.model.store, queryOptions: this.model.listQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n            <div data-dojo-attach-point=\"createContentArea\" class=\"epi-createContentContainer\">\r\n                <div class=\"epi-createContent\">\r\n                    <span data-dojo-attach-point=\"createContentAreaIcon\" class=\"dijitReset dijitInline dijitIcon\"></span>\r\n                    <span data-dojo-attach-point=\"createContentAreaText\" class=\"dijitReset dijitInline epi-createContentText\"></span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","url:epi-cms/widget/templates/AssetsDropZone.html":"<div class=\"epi-assetsDropZone\">\r\n    <span class=\"dijitReset dijitInline epi-dropZoneText\">${res.dropzonedescription}</span>\r\n</div>\r\n","epi-cms/component/PageNavigationTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","../core/ContentReference","../command/NewContent","./command/ViewTrash","./ContentNavigationTree","epi/i18n!epi/cms/nls/episerver.cms.components.createpage"],function(_bba,_bbb,lang,_bbc,when,_bbd,_bbe,_bbf,_bc0,_bc1,_bc2,_bc3){return _bbb([_bc2],{betweenThreshold:5,expandExtraNodeItems:_bbe.startPage,checkAcceptance:function(_bc4,_bc5){return _bc4===this.tree.dndController;},_startupCommands:function(){this.inherited(arguments);this._createCommand=new _bc0({order:10,contentType:this.settings.containedTypes[0],iconClass:"epi-iconPlus",label:_bc3.command.label,resources:_bc3});this.commands=_bba.filter(this.commands,lang.hitch(this,function(_bc6){return !(_bc6 instanceof _bc0);}));this._viewTrashCommand=new _bc1({typeIdentifiers:this.typeIdentifiers});this.commands.push(this._createCommand);this.commands.push(this._viewTrashCommand);},getIconClass:function(item,_bc7){var _bc8=_bba.some(this.model.roots,function(root){return root==this.model.getIdentity(item);},this);if(_bc8){return "epi-iconObjectRoot";}else{if(item.isStartPage){return "epi-iconObjectStart";}else{return this.inherited(arguments);}}}});});},"epi-cms/component/ContentNavigationTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/topic","dojo/when","epi/dependency","epi/string","epi/shell/ClipboardManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/_ContentContextMixin","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/PageShortcutTypeSupport","epi-cms/command/ShowAllLanguages","epi-cms/component/_ContentNavigationTreeNode","epi-cms/component/ContentContextMenuCommandProvider","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/ContentTree","epi/shell/widget/ContextMenu","./command/_GlobalToolbarCommandProvider","../command/CopyContent","../command/CutContent","../command/DeleteContent","../command/PasteContent","epi/i18n!epi/cms/nls/episerver.cms.components.createpage","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree"],function(_bc9,_bca,_bcb,lang,_bcc,_bcd,when,_bce,_bcf,_bd0,_bd1,_bd2,_bd3,_bd4,_bd5,_bd6,_bd7,_bd8,_bd9,_bda,_bdb,_bdc,_bdd,_bde,_bdf,_be0,_be1,_be2,_be3,_be4,_be5,_be6,res){return _bcb([_bdf,_bd6,_bd1,_bd7],{res:res,showAllLanguages:true,_separatorBeforeCssClass:"rowSeparatorBefore",_separatorAfterCssClass:"rowSeparatorAfter",_clipboardManager:null,_contextMenu:null,_contextMenuCommandProvider:null,_focusNode:null,betweenThreshold:0,contextMenuCommandProvider:_bdc,nodeConstructor:_bdb,postMixInProperties:function(){this.inherited(arguments);this._clipboardManager=new _bd0();this.selection=new _bd2();this._contextMenuCommandProvider=new this.contextMenuCommandProvider({treeModel:this.model,clipboardManager:this._clipboardManager,repositoryKey:this.repositoryKey});this._startupCommands();this.model.roots=this.roots;this.model.notAllowToDelete=this.settings.preventDeletionFor;this.model.notAllowToCopy=this.settings.preventCopyingFor;},postCreate:function(){this.inherited(arguments);this.own(this.on("copyOrCut",lang.hitch(this,function(copy){copy?this._copyCommand.execute():this._cutCommand.execute();})),this.on("paste",lang.hitch(this,function(){when(this._pasteCommand.execute(),lang.hitch(this,function(){this.selectedNode.expand();}));})),this.on("delete",lang.hitch(this,function(){this._deleteCommand.canExecute?this._deleteCommand.execute():this._showNotificationMessage(this.res.cannotdelete);})),this.on("select",lang.hitch(this,this._onTreeNodeClicked)));this.connect(this,"onClick","_onTreeNodeClicked");var _be7=lang.hitch(this,"_resetSelectionToLastSelected");this.subscribe("/epi/dnd/dropdata",_be7);this.subscribe("/dnd/cancel",_be7);},startup:function(){this.inherited(arguments);when(this.getCurrentContext(),lang.hitch(this,function(_be8){this.contextChanged(_be8);}));},_preparePathNodes:function(_be9){var self=this,_bea;_bc9.some(_be9,function(_beb,_bec){var _bed=self.getNodesByItem(_beb),_bee=_bed.length===1&&!_bed[0];if(_bec>0&&_bee){_bc9.forEach(_bea,function(_bef){if(_bef.state==="LOADED"){_bef._loadDeferred=null;}});return true;}_bea=_bed;return false;});},_resetSelectionToLastSelected:function(){if(!this._lastSelectedContentReference||!this.selectedItem){return;}if(this.selectedItem.contentLink!==this._lastSelectedContentReference){this.selectContent(this._lastSelectedContentReference);}},_startupCommands:function(){this._showLanguagesCommand=new _bda({model:this});var _bf0=this._contextMenuCommandProvider.get("commands");_bc9.some(_bf0,lang.hitch(this,function(_bf1){if(_bf1 instanceof _be2){this._copyCommand=_bf1;}else{if(_bf1 instanceof _be3){this._cutCommand=_bf1;}else{if(_bf1 instanceof _be5){this._pasteCommand=_bf1;}else{if(_bf1 instanceof _be4){this._deleteCommand=_bf1;}}}}if(this._deleteCommand&&this._pasteCommand&&this._copyCommand){return true;}}));this.commands=[this._showLanguagesCommand].concat(_bf0);},_setShowAllLanguagesAttr:function(_bf2){this._set("showAllLanguages",_bf2);this.model.set("showAllLanguages",_bf2);},_onTreeNodeClicked:function(page,node,_bf3){when(this.getCurrentContext(),lang.hitch(this,function(_bf4){var _bf5=_bf4?_bde.compareIgnoreVersion(page.contentLink,_bf4.id):true;var _bf6=function(_bf7){var _bf8={typeName:_bd3.getResourceValue(page.typeIdentifier,"name"),name:page.name};_bcd.publish("/epi/shell/context/request",{uri:page.uri},{sender:lang.mixin(_bf7,{requestedContent:_bf8}),forceContextChange:true});};if(!_bf5){_bf6(this);return;}if(this.selectContentThrottle){clearTimeout(this.selectContentThrottle);this.selectContentThrottle=null;}this.selectContentThrottle=setTimeout(_bf6,300);}));},contentContextChanged:function(_bf9,_bfa){var _bfb=new _bde(_bf9.id),_bfc=_bfb.createVersionUnspecificReference().toString(),_bfd=_bd8.wastebasketPage.toString();this.inherited(arguments);if(_bfc===_bfd){return;}this.selection.set("data",this._getSelectionData(this.selectedItem));this._lastSelectedContentReference=_bfc;if(_bfa&&_bfa.sender===this&&this.selectedItem&&_bfc===this.selectedItem.contentLink){this._updateGlobalToolbarButtons();}if(this.isSupportedType(_bf9.dataType)){this.selectContent(_bfc,false,true).then(lang.hitch(this,"_updateGlobalToolbarButtons"));}},isSupportedType:function(_bfe){return this.tree.model.isSupportedType(_bfe);},_getSelectionData:function(_bff){return _bff?[{type:"epi.cms.contentdata",data:_bff}]:[];},_updateGlobalToolbarButtons:function(_c00){var node=_c00||this.get("selectedNode"),_c01=node?this._getSelectionData(node.item):[];if(this._createCommand){this._createCommand.set("model",node&&node.item);}this._contextMenuCommandProvider.updateCommandModel(node&&node.item);this.selection.set("data",_c01);},contextChangeFailed:function(_c02,_c03,_c04){this.inherited(arguments);if(_c02){if(_c04&&_c04.sender===this){this.selectContent(_c02.contentLink);}}},_removeHighlightClass:function(){if(this._focusNode&&this._focusNode!=this.selectedNode&&this._focusNode.rowNode){_bcc.remove(this._focusNode.rowNode,"dijitTreeRowSelected");}},_onContextMenuClose:function(){this._removeHighlightClass();},_onContextMenuOpen:function(){if(this._focusNode){_bcc.add(this._focusNode.rowNode,"dijitTreeRowSelected");}},_set_focusNodeAttr:function(_c05){this._removeHighlightClass();this._focusNode=_c05;},_showContextMenu:function(evt){if(!this._contextMenu){this.own(this._contextMenu=new _be0({leftClickToOpen:true,category:"context"}),_bca.connect(this._contextMenu,"onClose",this,"_onContextMenuClose"),_bca.connect(this._contextMenu,"onOpen",this,"_onContextMenuOpen"));this._contextMenu.addProvider(this._contextMenuCommandProvider);this._contextMenu.startup();}this._contextMenu.scheduleOpen(evt.target,null,{x:evt.x,y:evt.y});},_createTreeNode:function(){var _c06=this.inherited(arguments);if(_c06.item.contentLink==this.tree.model.rootPage){var _c07=_bc9.filter(_c06.domNode.children,function(_c08){return _c08.className==this._separatorAfterCssClass;},this);}_c06.on("onContextMenuClick",lang.hitch(this,function(node){this._updateGlobalToolbarButtons(node.node);this.set("_focusNode",node.node);this._showContextMenu(node);}));return _c06;},getIconClass:function(item,_c09){var _c0a=this.inherited(arguments);if(!item||!item.properties||!item.properties.pageShortcutType){return _c0a;}var _c0b="";switch(item.properties.pageShortcutType){case _bd9.pageShortcutTypes.Shortcut:_c0b="epi-iconObjectInternalLink";break;case _bd9.pageShortcutTypes.External:_c0b="epi-iconObjectExternalLink";break;case _bd9.pageShortcutTypes.Inactive:_c0b="epi-iconObjectNoLink";break;case _bd9.pageShortcutTypes.FetchData:_c0b=!item.hasTemplate?"epi-iconObjectContainerFetchContent":"epi-iconObjectFetchContent";break;default:break;}return _c0b?_c0a+" "+_c0b:_c0a;},enableDrop:function(node,_c0c){node._droppable=_c0c;},_showNotificationMessage:function(_c0d){var _c0e=new _bd4({destroyOnHide:true,description:_bcf.toHTML(_c0d)});_c0e.show();},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node.showContextMenu(true);},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node.showContextMenu(false);}});});},"epi-cms/contentediting/PageShortcutTypeSupport":function(){define([],function(){var _c0f={pageShortcutTypes:{Normal:0,Shortcut:1,External:2,Inactive:3,FetchData:4}};return _c0f;});},"epi-cms/command/ShowAllLanguages":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.command"],function(_c10,lang,when,_c11,_c12,_c13,_c14){return _c10([_c13],{property:"showAllLanguages",category:"setting",order:50,_watchHandle:null,postscript:function(){this.inherited(arguments);this.currentContentLanguage=this.currentContentLanguage||_c12.currentContentLanguage;this.store=this.store||_c11.resolve("epi.storeregistry").get("epi.cms.language");when(this.store.get(this.currentContentLanguage),lang.hitch(this,function(_c15){this.set("label",lang.replace(_c14.showonlycontentin,[_c15.name]));}));},_execute:function(){this.set("active",!this.active);this.model.set(this.property,!this.active);},_onModelChange:function(){if(this.model&&this.model._isSiteMultilingual){when(this.model._isSiteMultilingual(),lang.hitch(this,function(_c16){this.set("canExecute",_c16);}));}}});});},"epi-cms/component/_ContentNavigationTreeNode":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/Evented","dojo/mouse","dojo/on","dojo/text!./templates/_ContentNavigationTreeNode.html","epi/datetime","epi/dependency","epi/string","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/Tooltip","epi-cms/core/ContentReference","epi-cms/widget/_ContentTreeNode","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.shared.header"],function(_c17,_c18,_c19,lang,_c1a,_c1b,_c1c,_c1d,on,_c1e,_c1f,_c20,_c21,_c22,_c23,_c24,_c25,_c26,res,_c27){return _c18([_c25,_c22,_c1c],{templateString:_c1e,res:res,hasContextMenu:true,_pageLocked:"epi-pt-accessRights",_pageBeingEdited:"epi-pt-edited",_contextMenuClass:"epi-iconContextMenu",_iconNodeClass:"",_iconNodeToolTip:undefined,_inUseTooltip:undefined,_selected:false,_contentTypeStore:null,postMixInProperties:function(){this.inherited(arguments);var _c28=_c20.resolve("epi.storeregistry");this._contentTypeStore=_c28.get("epi.cms.contenttype");},postCreate:function(){this.inherited(arguments);this.set("model",new _c26({contentStatus:this.item.status}));},modelBindingMap:{"statusIcon":["statusIcon"],"statusMessage":["statusMessage"]},_setStatusMessageAttr:function(_c29){_c1a.set(this.iconNodeStatus,"title",_c21.toTooltipText(_c29));},_setStatusIconAttr:function(_c2a){if(!(_c2a instanceof Array)){return;}_c1b.remove(this.iconNodeStatus);_c1b.add(this.iconNodeStatus,"dijitTreeIcon epi-extraIcon");_c17.forEach(_c2a,function(_c2b){_c1b.add(this.iconNodeStatus,_c2b);},this);},destroy:function(){this.inherited(arguments);this._destroyIconNodeTooltip();},setSelected:function(_c2c){this.inherited(arguments);if(this.hasContextMenu){_c1b.toggle(this.iconNodeMenu,this._contextMenuClass,this._selected=_c2c);}},showContextMenu:function(show){if(!this._selected&&this.hasContextMenu){_c1b.toggle(this.iconNodeMenu,this._contextMenuClass,show);}},_onClickIconNodeMenu:function(evt){_c19.stop(evt);this.labelNode.focus();this.emit("onContextMenuClick",{node:this,target:evt.target,x:evt.pageX,y:evt.pageY});},_onMouseDownIconNodeMenu:function(evt){_c19.stop(evt);},_updateIndividualLayout:function(){this._updateAccessRightIcon();if(this.model){this.model.set("contentStatus",this.item.status);}this._createTooltip();},_updateAccessRightIcon:function(){if(this.item.accessMask===0||this.item.accessMask==1){_c1b.add(this.iconNodeAccess,this._pageLocked);_c1a.set(this.iconNodeAccess,"title",this.res.tooltip.pagelocked);_c1b.add(this.contentNode,"epi-treeReadOnly");}else{if(this.item.inUseNotifications&&this.item.inUseNotifications.length>0){_c1b.add(this.iconNodeAccess,this._pageBeingEdited);var _c2d=[{label:this.res.tooltip.beingedited}];_c17.forEach(this.item.inUseNotifications,function(_c2e){var date=_c1f.toUserFriendlyHtml(_c2e.created);_c2d.push({label:_c2e.userName+", "+date,htmlEncode:false});},this);this._populateIconNodeTooltip(_c2d,this.iconNodeAccess);}else{_c1b.remove(this.iconNodeAccess,this._pageBeingEdited);_c1b.remove(this.iconNodeAccess,this._pageLocked);_c1b.remove(this.contentNode,"epi-treeReadOnly");this._destroyIconNodeTooltip();}}},_createTooltip:function(){if(this.indent<0){return;}var _c2f=new _c24(this.item.contentLink);var _c30=this.item.name+", "+_c27.id+": "+_c2f.id+" ("+_c27.type+": "+this.item.contentTypeName+")";_c1a.set(this.labelNode,"title",_c30);_c1a.set(this.iconNode,"title",_c30);},_populateIconNodeTooltip:function(_c31,_c32){if(!this._iconNodeToolTip){this._iconNodeToolTip=new _c23({position:["after-centered","below"]});}this._iconNodeToolTip.tooltipRows=_c31;this.own(on(_c32,_c1d.enter,lang.hitch(this,function(){if(this._iconNodeToolTip){this._iconNodeToolTip.open(_c32);}})),on(_c32,_c1d.leave,lang.hitch(this,function(){if(this._iconNodeToolTip){this._iconNodeToolTip.close();}})));},_destroyIconNodeTooltip:function(){if(this._iconNodeToolTip){this._iconNodeToolTip.destroyRecursive();this._iconNodeToolTip=null;}}});});},"url:epi-cms/component/templates/_ContentNavigationTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <div data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow dijitInline\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\" data-dojo-attach-event=\"onmousedown:_onMouseDownIconNodeMenu, click: _onClickIconNodeMenu\" >&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeStatus\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeAccess\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi/shell/widget/Tooltip":function(){define("epi/shell/widget/Tooltip",["dojo/_base/declare","dojo/string","dojox/html/entities","dojox/html/ellipsis","dijit/Tooltip"],function(_c33,_c34,_c35,_c36,_c37){return _c33(_c37,{showDelay:600,position:["after","before","below","above"],tooltipRows:null,tooltipRowTemplate:"<span>${label}</span>: ${text}",tooltipRowNoTextTemplate:"<span>${label}</span>",getContent:function(){if(this.tooltipRows){var _c38="<ul class='dijitInline dijitReset epi-tooltip-ellipsis'>";for(var i=0;i<this.tooltipRows.length;i++){var row=this.tooltipRows[i];if(!row.text){row.text="";}if(row.htmlEncode===undefined||row.htmlEncode===true){row.label=_c35.encode(row.label);row.text=_c35.encode(row.text);}if(!row.text){_c38+="<li class='dojoxEllipsis'>"+_c34.substitute(this.tooltipRowNoTextTemplate,row)+"</li>";}else{_c38+="<li class='dojoxEllipsis'>"+_c34.substitute(this.tooltipRowTemplate,row)+"</li>";}}_c38+="</ul>";return _c38;}return this.inherited(arguments);}});});},"epi-cms/widget/viewmodel/ContentStatusViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/when","dojo/promise/all","dojo/Stateful","epi/dependency","epi/shell/_StatefulGetterSetterMixin","epi-cms/contentediting/ContentActionSupport","epi/shell/_ContextMixin","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_c39,_c3a,_c3b,lang,when,all,_c3c,_c3d,_c3e,_c3f,_c40,_c41,_c42){return _c3a([_c3c,_c40],{_contentStructureStore:null,autoLoadStatus:false,statusIcon:null,statusMessage:null,constructor:function(){this._statusIconArray=[["epi-statusIndicatorIcon","epi-statusIndicator0"],["epi-statusIndicatorIcon","epi-statusIndicator1"],["epi-statusIndicatorIcon","epi-statusIndicator2"],["epi-statusIndicatorIcon","epi-statusIndicator3"],["epi-statusIndicatorIcon","epi-statusIndicator4"],["epi-statusIndicatorIcon","epi-statusIndicator5"],["epi-statusIndicatorIcon","epi-statusIndicator6"],["epi-statusIndicatorIcon","epi-statusIndicator7"]];this._statusMessageArray=[_c42.notcreated,_c42.rejected,_c42.checkedout,_c42.checkedin,_c42.published,_c42.previouslypublished,_c42.delayedpublish,_c42.expired];},postscript:function(){this.inherited(arguments);this._contentStructureStore=this._contentStructureStore||_c3d.resolve("epi.storeregistry").get("epi.cms.content.light");},loadStatus:function(){if(!this.contentLink){return;}when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this._contentStructureStore.refresh(this.contentLink),lang.hitch(this,function(_c43){if(_c43&&_c43.status!==undefined){this.set("content",_c43);}}));}));},_contentLinkSetter:function(_c44){if(!_c44){return;}this.contentLink=_c44;if(this.autoLoadStatus){this.loadStatus();}},_isDeletedGetter:function(){return this.get("content")&&this.get("content").isDeleted;},_isTranslationNeededGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch&&this.get("content").missingLanguageBranch.isTranslationNeeded;},_missingLanguageBranchGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch;},_contentSetter:function(_c45){this.content=_c45;this.set("contentStatus",_c45.status);},_contentStatusSetter:function(_c46){this.contentStatus=_c46;if(!_c46){return;}this.set("statusIcon",this._statusIconArray[_c46]);when(this._getStatusMessage(),lang.hitch(this,function(_c47){this.set("statusMessage",_c47);}));},_getStatusMessage:function(){if(this.get("isDeleted")){return _c42.versionnotfound;}if(this.get("isTranslationNeeded")){return _c41.getMissingLanguageMessage(this.content);}if(this.get("isVisibleOnSite")){return null;}return this._statusMessageArray[this.get("contentStatus")];},_isVisibleOnSiteGetter:function(){var _c48=this.get("missingLanguageBranch");if(this.get("isDeleted")||_c48&&_c48.reason==6){return false;}return this.get("contentStatus")===_c3f.versionStatus.Published;}});});},"epi-cms/component/ContentContextMenuCommandProvider":function(){define(["dojo/_base/declare","dojo/_base/array","epi/shell/command/_CommandProviderMixin","../command/CopyContent","../command/CutContent","../command/PasteContent","../command/TranslateContent","../command/DeleteContent","../widget/CreateCommandsMixin","epi/shell/selection"],function(_c49,_c4a,_c4b,_c4c,_c4d,_c4e,_c4f,_c50,_c51,_c52){return _c49([_c4b,_c51],{treeModel:null,clipboardManager:null,_settings:null,_newContentCommand:null,_translateContentCommand:null,constructor:function(_c53){_c49.safeMixin(this,_c53);},postscript:function(){this.inherited(arguments);this._settings={category:"context",model:this.treeModel,clipboard:this.clipboardManager,selection:new _c52()};this._translateContentCommand=new _c4f({category:"context"});var _c54=this.getCreateCommands(),_c55=[];for(var key in _c54){_c55.push(_c54[key].command);}_c55.push(this._translateContentCommand,new _c4d(this._settings),new _c4c(this._settings),new _c4e(this._settings),new _c50(this._settings));this.set("commands",_c55);},updateCommandModel:function(_c56){_c4a.forEach(this.get("commands"),function(_c57){if(_c57.isInstanceOf(this.createCommandClass)||_c57.popup){_c57.set("model",_c56);}},this);this._translateContentCommand.set("model",_c56);this._settings.selection.set("data",[{type:"epi.cms.contentdata",data:_c56}]);}});});},"epi-cms/component/RecentlyChanged":function(){define(["dojo/_base/declare","dojo/_base/lang","epi","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/_Command","epi/shell/command/ToggleCommand","epi/shell/widget/layout/ComponentContainer","epi/shell/widget/dialog/Alert","epi/shell/widget/_FocusableMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.recentlychanged"],function(_c58,lang,epi,_c59,_c5a,_c5b,_c5c,_c5d,_c5e,_c5f,_c60,_c61,_c62,_c63){return _c58([_c62,_c5a,_c5f],{_componentsController:null,onlyShowMyChanges:false,postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this._componentsController=_c59.resolve("epi.shell.controller.Components");this.ignoreVersionWhenComparingLinks=false;this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _c64=lang.mixin({columns:this._createGridColumns(),store:this.store,selectionMode:"single"},this.defaultGridMixin);this.grid=new this._gridClass(_c64,this.domNode);},startup:function(){if(this._started){return;}this.inherited(arguments);var _c65=[new _c5c({label:_c63.showmychanges,category:"setting",model:this,property:"onlyShowMyChanges"}),new _c5b({iconClass:"epi-iconReload",label:epi.resources.action.refresh,canExecute:true,_execute:lang.hitch(this,function(){this.grid.refresh();})})];this.add("commands",_c65);this.fetchData();},_setOnlyShowMyChangesAttr:function(_c66){this._set("onlyShowMyChanges",_c66);if(this._started){this._saveSettingComponent("onlyShowMyChanges",_c66);}},fetchData:function(){var _c67=this._getQuery();this.grid.set("query",_c67.query,_c67.options);},_getQuery:function(){return {query:{query:"recentlychanged",onlyShowMyChanges:this.onlyShowMyChanges,keepversion:true},options:{ignore:["query"],sort:[{attribute:"saved",descending:true}]}};},_createGridColumns:function(){var _c68={name:{label:epi.resources.header.name,className:"epi-width50",renderCell:lang.hitch(this,this._renderContentItem)},status:{label:epi.resources.header.status,renderCell:function(item,_c69,node,_c6a){node.innerHTML=_c60.getVersionStatus(_c69);},className:"epi-width15"},saved:{label:epi.resources.header.saved,formatter:this._localizeDate,className:"epi-width25"}};if(!this.get("onlyShowMyChanges")){_c68.changedBy={label:epi.resources.header.by,formatter:this._createUserFriendlyUsername,className:"epi-width10"};}return _c68;},_saveSettingComponent:function(type,_c6b){var item=this._componentsController.getComponentDefinition(this.id),_c6c;if(item){item.settings.onlyShowMyChanges=_c6b;var _c6d=this._componentsController.saveComponent(item);_c6d.then(function(done){},function(){var _c6e=new _c5e({description:_c63.errormessage});_c6e.show();});_c6c=this._getQuery();this.grid.query=_c6c.query;this.grid.queryOptions=_c6c.options;this.grid.set("columns",this._createGridColumns());}},onContextChanged:function(_c6f){this.grid.clearSelection();var _c70=new _c61(_c6f.id).createVersionUnspecificReference().toString();var row=this.grid.row(_c70);if(row){this.grid.select(row);}}});});},"epi-cms/component/SharedBlocks":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/when","epi-cms/widget/HierarchicalList","epi-cms/component/SharedBlocksViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.createblock","epi/i18n!epi/cms/nls/contenttypes.blockdata"],function(_c71,_c72,lang,on,when,_c73,_c74,_c75,res){return _c72([_c73],{showCreateContentArea:true,modelClassName:_c74,noDataMessage:_c75.nocontent,hierarchicalListClass:"epi-blockList",createContentIcon:"epi-iconPlus",createContentText:res.create,postCreate:function(){this.inherited(arguments);this.own(this.list.grid.on("dgrid-refresh-complete",lang.hitch(this,function(evt){when(evt.results,lang.hitch(this,function(_c76){var _c77=_c76.length>0?false:this.model.getCommand("newBlockDefault").get("canExecute");this._toggleCreateContentArea(_c77);}));})));},_setupList:function(){this.inherited(arguments);var _c78=this.model._commandRegistry,_c79=this.list;this.own(on(_c79,"copyOrCut",function copyOrCuthandler(copy){copy?_c78.copy.command.execute():_c78.cut.command.execute();}),on(_c79,"delete",function(){_c78["delete"].command.execute();}),on(_c79,"createItemAction",function(){_c78.newBlockDefault.command.execute();}),on(_c79,"itemAction",function(){_c78.edit.command.execute();}));}});});},"epi-cms/component/SharedBlocksViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/viewmodel/HierarchicalListViewModel","epi-cms/command/NewContent","epi-cms/command/ShowAllLanguages","epi/i18n!epi/cms/nls/episerver.cms.components.createblock"],function(_c7a,lang,when,_c7b,_c7c,_c7d,_c7e,_c7f){return _c7a([_c7c],{treeStoreModelClass:_c7b,_updateTreeContextCommandModels:function(_c80){this.inherited(arguments);var _c81=lang.hitch(this.treeStoreModel,this.treeStoreModel.translate);this._commandRegistry.translate.command.set("model",_c80);this._commandRegistry.translate.command.set("executeDelegate",_c81);this._commandRegistry.newBlockDefault.command.set("model",_c80);},_setupCommands:function(){this.inherited(arguments);var _c82={newBlockDefault:{command:new _c7d({contentType:"episerver.core.blockdata",iconClass:"epi-iconPlus",label:_c7f.command.label,resources:_c7f})},allLanguages:{command:new _c7e({model:this}),order:55}};this._commandRegistry=lang.mixin(this._commandRegistry,_c82);this.pseudoContextualCommands.push(this._commandRegistry.newBlockDefault.command);}});});},"epi-cms/component/SiteTree":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/array","dojo/when","dojo/dom-style","dijit/layout/_LayoutWidget","dijit/Tooltip","epi-cms/component/SiteTreeModel","epi-cms/component/SiteTreeNode","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/ToggleCommand","epi/shell/widget/Tree","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree"],function(_c83,_c84,lang,_c85,when,_c86,_c87,_c88,_c89,_c8a,_c8b,_c8c,_c8d,Tree,_c8e){return _c83([_c87,_c8c],{profile:null,buildRendering:function(){this.inherited(arguments);_c86.set(this.domNode,"overflow","auto");},postCreate:function(){this.inherited(arguments);var _c8f=_c8b.resolve("epi.storeregistry");var _c90=_c8f.get("epi.cms.sitestructure");this.profile=this.profile||_c8b.resolve("epi.shell.Profile");var _c91=this._treeModel=new _c89({store:_c90});var _c92=new _c8d({category:"setting",label:_c8e.showalllanguages,model:_c91,property:"showAllLanguages"});this.commands.push(_c92);this._tree=new Tree({model:_c91,showRoot:false,"class":"epi-simpleTree",persist:false,onClick:lang.hitch(this,function(item){if(!item.host||!item.languageId){window.location.replace(item.editUrl);}else{var self=this;when(self.profile.setContentLanguage(item.languageId,item.host),function(){var _c93=item.editUrl;if(_c85.some(item.hosts,function(host){return host===window.location.host;})){_c93=item.editUrl.replace(new RegExp(item.host,"i"),window.location.host);}window.location.replace(_c93);});}}),_createTreeNode:function(args){return new _c8a(args);},_onNodeMouseEnter:function(node){if(node.item.isLanguageNode&&!node.item.isAvailable){_c88.show(_c8e.notavailabletooltip,node.labelNode,["after-centered","below"]);}},_onNodeMouseLeave:function(node){_c88.hide(node.labelNode);}});this.addChild(this._tree);},layout:function(){this._tree.resize();},startup:function(){this.inherited(arguments);this._setTreePath();},_setTreePath:function(){_c84.when(this._treeModel.getCurrentSite(),lang.hitch(this,function(_c94){this._tree.set("path",["root",_c94.currentSite,_c94.currentEditLanguageId]);}));}});});},"epi-cms/component/SiteTreeNode":function(){define(["dojo/dom-class","epi-cms/widget/_ContentTreeNode"],function(_c95,_c96){return dojo.declare([_c96],{_updateItemClasses:function(item){this.inherited(arguments);if(item.isLanguageNode&&!item.isAvailable){_c95.add(this.domNode,"epi-st-disabledRow");}else{_c95.remove(this.domNode,"epi-st-disabledRow");}if(!item.isLanguageNode){_c95.add(this.iconNode,"epi-iconObjectStart");}}});});},"epi-cms/component/Tasks":function(){define(["dojo","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","dojo/dom-geometry","dojo/topic","dijit/form/Select","dijit/_TemplatedMixin","dijit/_Container","dijit/layout/_LayoutWidget","dijit/_WidgetsInTemplateMixin","epi","epi-cms/component/ContentQueryGrid","dojo/text!./templates/Tasks.html","epi/i18n!epi/cms/nls/episerver.cms.components.tasks"],function(dojo,_c97,_c98,lang,_c99,_c9a,_c9b,_c9c,_c9d,_c9e,_c9f,_ca0,epi,_ca1,_ca2,_ca3){return _c97([_c9e,_c9f,_c9d,_ca0],{templateString:_ca2,resources:_ca3,querySelection:null,_selectionChangedEventHandler:null,postCreate:function(){this.inherited(arguments);var _ca4=_c98.map(this.queries,function(item){return {label:item.displayName,value:item.name};},this);this.querySelection=new _c9c({name:"QuerySelection",options:_ca4});_c99.place(this.querySelection.domNode,this.reloadButton.domNode,"before");this._reloadQuery();this.own(this.querySelection.on("change",lang.hitch(this,this._reloadQuery)),_c9b.subscribe("/epi/cms/action/refreshmytasks",lang.hitch(this,this._reloadQuery)));},resize:function(_ca5){this.inherited(arguments);this.contentQuery.resize(this._caculateContentQuerySize(_ca5));},_caculateContentQuerySize:function(_ca6){var _ca7=_c9a.getMarginBox(this.toolbar);return {w:_ca6.w,h:_ca6.h-_ca7.h};},_reloadQuery:function(){var _ca8=this.querySelection.get("value");_c98.some(this.queries,function(item,_ca9){if(item.name==_ca8){this.contentQuery.set("ignoreVersionWhenComparingLinks",!item.versionSpecific);return true;}},this);this.contentQuery.set("queryName",_ca8);}});});},"dijit/form/Select":function(){require({cache:{"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode,_popupStateNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n"}});define("dijit/form/Select",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/_base/event","dojo/i18n","dojo/_base/lang","dojo/sniff","./_FormSelectWidget","../_HasDropDown","../Menu","../MenuItem","../MenuSeparator","../Tooltip","dojo/text!./templates/Select.html","dojo/i18n!./nls/validate"],function(_caa,_cab,_cac,_cad,_cae,_caf,i18n,lang,has,_cb0,_cb1,Menu,_cb2,_cb3,_cb4,_cb5){var _cb6=_cab("dijit.form._SelectMenu",Menu,{autoFocus:true,buildRendering:function(){this.inherited(arguments);var o=(this.menuTableNode=this.domNode);var n=(this.domNode=this.ownerDocument.createElement("div"));n.style.cssText="overflow-x: hidden; overflow-y: scroll";if(o.parentNode){o.parentNode.replaceChild(n,o);}_cad.remove(o,"dijitMenuTable");n.className=o.className+" dijitSelectMenu";o.className="dijitReset dijitMenuTable";o.setAttribute("role","listbox");n.setAttribute("role","presentation");n.appendChild(o);},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",_caf.stop);},focus:function(){var _cb7=false,val=this.parentWidget.value;if(lang.isArray(val)){val=val[val.length-1];}if(val){_caa.forEach(this.parentWidget._getChildren(),function(_cb8){if(_cb8.option&&(val===_cb8.option.value)){_cb7=true;this.focusChild(_cb8,false);}},this);}if(!_cb7){this.inherited(arguments);}},resize:function(mb){if(mb){_cae.setMarginBox(this.domNode,mb);if("w" in mb){this.menuTableNode.style.width="100%";}}}});var _cb9=_cab("dijit.form.Select",[_cb0,_cb1],{baseClass:"dijitSelect dijitValidationTextBox",templateString:_cb5,_buttonInputDisabled:has("ie")?"disabled":"",required:false,state:"",message:"",tooltipPosition:[],emptyLabel:"&#160;",_isLoaded:false,_childrenLoaded:false,_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var si=this.srcNodeRef.selectedIndex||0;this.value=this.options[si>=0?si:0].value;}this.dropDown=new _cb6({id:this.id+"_menu",parentWidget:this});_cad.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "));},_getMenuItemForOption:function(_cba){if(!_cba.value&&!_cba.label){return new _cb3({ownerDocument:this.ownerDocument});}else{var _cbb=lang.hitch(this,"_setValueAttr",_cba);var item=new _cb2({option:_cba,label:_cba.label||this.emptyLabel,onClick:_cbb,ownerDocument:this.ownerDocument,dir:this.dir,disabled:_cba.disabled||false});item.focusNode.setAttribute("role","option");return item;}},_addOptionItem:function(_cbc){if(this.dropDown){this.dropDown.addChild(this._getMenuItemForOption(_cbc));}},_getChildren:function(){if(!this.dropDown){return [];}return this.dropDown.getChildren();},_loadChildren:function(_cbd){if(_cbd===true){if(this.dropDown){delete this.dropDown.focusedChild;}if(this.options.length){this.inherited(arguments);}else{_caa.forEach(this._getChildren(),function(_cbe){_cbe.destroyRecursive();});var item=new _cb2({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(item);}}else{this._updateSelection();}this._isLoaded=false;this._childrenLoaded=true;if(!this._loadingStore){this._setValueAttr(this.value,false);}},_refreshState:function(){if(this._started){this.validate(this.focused);}},startup:function(){this.inherited(arguments);this._refreshState();},_setValueAttr:function(_cbf){this.inherited(arguments);_cac.set(this.valueNode,"value",this.get("value"));this._refreshState();},_setDisabledAttr:function(_cc0){this.inherited(arguments);this._refreshState();},_setRequiredAttr:function(_cc1){this._set("required",_cc1);this.focusNode.setAttribute("aria-required",_cc1);this._refreshState();},_setOptionsAttr:function(_cc2){this._isLoaded=false;this._set("options",_cc2);},_setDisplay:function(_cc3){var lbl=_cc3||this.emptyLabel;this.containerNode.innerHTML="<span role=\"option\" class=\"dijitReset dijitInline "+this.baseClass.replace(/\s+|$/g,"Label ")+"\">"+lbl+"</span>";},validate:function(_cc4){var _cc5=this.disabled||this.isValid(_cc4);this._set("state",_cc5?"":(this._hasBeenBlurred?"Error":"Incomplete"));this.focusNode.setAttribute("aria-invalid",_cc5?"false":"true");var _cc6=_cc5?"":this._missingMsg;if(_cc6&&this.focused&&this._hasBeenBlurred){_cb4.show(_cc6,this.domNode,this.tooltipPosition,!this.isLeftToRight());}else{_cb4.hide(this.domNode);}this._set("message",_cc6);return _cc5;},isValid:function(){return (!this.required||this.value===0||!(/^\s*$/.test(this.value||"")));},reset:function(){this.inherited(arguments);_cb4.hide(this.domNode);this._refreshState();},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=i18n.getLocalization("dijit.form","validate",this.lang).missingMessage;},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",_caf.stop);this.domNode.setAttribute("aria-expanded","false");if(has("ie")<9){this.defer(function(){try{var s=domStyle.getComputedStyle(this.domNode);if(s){var ff=s.fontFamily;if(ff){var _cc7=this.domNode.getElementsByTagName("INPUT");if(_cc7){for(var i=0;i<_cc7.length;i++){_cc7[i].style.fontFamily=ff;}}}}}catch(e){}});}},_setStyleAttr:function(_cc8){this.inherited(arguments);_cad.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width);},isLoaded:function(){return this._isLoaded;},loadDropDown:function(_cc9){this._loadChildren(true);this._isLoaded=true;_cc9();},closeDropDown:function(){this.inherited(arguments);if(this.dropDown&&this.dropDown.menuTableNode){this.dropDown.menuTableNode.style.width="";}},destroy:function(_cca){if(this.dropDown&&!this.dropDown._destroyed){this.dropDown.destroyRecursive(_cca);delete this.dropDown;}this.inherited(arguments);},_onFocus:function(){this.validate(true);this.inherited(arguments);},_onBlur:function(){_cb4.hide(this.domNode);this.inherited(arguments);this.validate(false);}});_cb9._Menu=_cb6;return _cb9;});},"dijit/form/_FormSelectWidget":function(){define("dijit/form/_FormSelectWidget",["dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/data/util/sorter","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/when","dojo/store/util/QueryResults","./_FormValueWidget"],function(_ccb,_ccc,_ccd,_cce,_ccf,dom,_cd0,_cd1,lang,_cd2,when,_cd3,_cd4){var _cd5=_ccf("dijit.form._FormSelectWidget",_cd4,{multiple:false,options:null,store:null,query:null,queryOptions:null,labelAttr:"",onFetch:null,sortByLabel:true,loadChildrenOnOpen:false,onLoadDeferred:null,getOptions:function(_cd6){var _cd7=_cd6,opts=this.options||[],l=opts.length;if(_cd7===undefined){return opts;}if(lang.isArray(_cd7)){return _ccb.map(_cd7,"return this.getOptions(item);",this);}if(lang.isObject(_cd6)){if(!_ccb.some(this.options,function(o,idx){if(o===_cd7||(o.value&&o.value===_cd7.value)){_cd7=idx;return true;}return false;})){_cd7=-1;}}if(typeof _cd7=="string"){for(var i=0;i<l;i++){if(opts[i].value===_cd7){_cd7=i;break;}}}if(typeof _cd7=="number"&&_cd7>=0&&_cd7<l){return this.options[_cd7];}return null;},addOption:function(_cd8){if(!lang.isArray(_cd8)){_cd8=[_cd8];}_ccb.forEach(_cd8,function(i){if(i&&lang.isObject(i)){this.options.push(i);}},this);this._loadChildren();},removeOption:function(_cd9){if(!lang.isArray(_cd9)){_cd9=[_cd9];}var _cda=this.getOptions(_cd9);_ccb.forEach(_cda,function(i){if(i){this.options=_ccb.filter(this.options,function(node){return (node.value!==i.value||node.label!==i.label);});this._removeOptionItem(i);}},this);this._loadChildren();},updateOption:function(_cdb){if(!lang.isArray(_cdb)){_cdb=[_cdb];}_ccb.forEach(_cdb,function(i){var _cdc=this.getOptions(i),k;if(_cdc){for(k in i){_cdc[k]=i[k];}}},this);this._loadChildren();},setStore:function(_cdd,_cde,_cdf){var _ce0=this.store;_cdf=_cdf||{};if(_ce0!==_cdd){var h;while((h=this._notifyConnections.pop())){h.remove();}if(!_cdd.get){lang.mixin(_cdd,{_oldAPI:true,get:function(id){var _ce1=new _ccc();this.fetchItemByIdentity({identity:id,onItem:function(_ce2){_ce1.resolve(_ce2);},onError:function(_ce3){_ce1.reject(_ce3);}});return _ce1.promise;},query:function(_ce4,_ce5){var _ce6=new _ccc(function(){if(_ce7.abort){_ce7.abort();}});_ce6.total=new _ccc();var _ce7=this.fetch(lang.mixin({query:_ce4,onBegin:function(_ce8){_ce6.total.resolve(_ce8);},onComplete:function(_ce9){_ce6.resolve(_ce9);},onError:function(_cea){_ce6.reject(_cea);}},_ce5));return new _cd3(_ce6);}});if(_cdd.getFeatures()["dojo.data.api.Notification"]){this._notifyConnections=[_ccd.after(_cdd,"onNew",lang.hitch(this,"_onNewItem"),true),_ccd.after(_cdd,"onDelete",lang.hitch(this,"_onDeleteItem"),true),_ccd.after(_cdd,"onSet",lang.hitch(this,"_onSetItem"),true)];}}this._set("store",_cdd);}if(this.options&&this.options.length){this.removeOption(this.options);}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}if(_cdf.query){this._set("query",_cdf.query);this._set("queryOptions",_cdf.queryOptions);}if(_cdd){this._loadingStore=true;this.onLoadDeferred=new _ccc();this._queryRes=_cdd.query(this.query,this.queryOptions);when(this._queryRes,lang.hitch(this,function(_ceb){if(this.sortByLabel&&!_cdf.sort&&_ceb.length){if(_ceb[0].getValue){_ceb.sort(_cce.createSortFunction([{attribute:_cdd.getLabelAttributes(_ceb[0])[0]}],_cdd));}else{var _cec=this.labelAttr;_ceb.sort(function(a,b){return a[_cec]>b[_cec]?1:b[_cec]>a[_cec]?-1:0;});}}if(_cdf.onFetch){_ceb=_cdf.onFetch.call(this,_ceb,_cdf);}_ccb.forEach(_ceb,function(i){this._addOptionForItem(i);},this);if(this._queryRes.observe){this._queryRes.observe(lang.hitch(this,function(_ced,_cee,_cef){if(_cee==_cef){this._onSetItem(_ced);}else{if(_cee!=-1){this._onDeleteItem(_ced);}if(_cef!=-1){this._onNewItem(_ced);}}}),true);}this._loadingStore=false;this.set("value","_pendingValue" in this?this._pendingValue:_cde);delete this._pendingValue;if(!this.loadChildrenOnOpen){this._loadChildren();}else{this._pseudoLoadChildren(_ceb);}this.onLoadDeferred.resolve(true);this.onSetStore();}),function(err){console.error("dijit.form.Select: "+err.toString());this.onLoadDeferred.reject(err);});}return _ce0;},_setValueAttr:function(_cf0,_cf1){if(!this._onChangeActive){_cf1=null;}if(this._loadingStore){this._pendingValue=_cf0;return;}var opts=this.getOptions()||[];if(!lang.isArray(_cf0)){_cf0=[_cf0];}_ccb.forEach(_cf0,function(i,idx){if(!lang.isObject(i)){i=i+"";}if(typeof i==="string"){_cf0[idx]=_ccb.filter(opts,function(node){return node.value===i;})[0]||{value:"",label:""};}},this);_cf0=_ccb.filter(_cf0,function(i){return i&&i.value;});if(!this.multiple&&(!_cf0[0]||!_cf0[0].value)&&opts.length){_cf0[0]=opts[0];}_ccb.forEach(opts,function(i){i.selected=_ccb.some(_cf0,function(v){return v.value===i.value;});});var val=_ccb.map(_cf0,function(i){return i.value;}),disp=_ccb.map(_cf0,function(i){return i.label;});if(typeof val=="undefined"||typeof val[0]=="undefined"){return;}this._setDisplay(this.multiple?disp:disp[0]);this.inherited(arguments,[this.multiple?val:val[0],_cf1]);this._updateSelection();},_getDisplayedValueAttr:function(){var val=this.get("value");if(!lang.isArray(val)){val=[val];}var ret=_ccb.map(this.getOptions(val),function(v){if(v&&"label" in v){return v.label;}else{if(v){return v.value;}}return null;},this);return this.multiple?ret:ret[0];},_loadChildren:function(){if(this._loadingStore){return;}_ccb.forEach(this._getChildren(),function(_cf2){_cf2.destroyRecursive();});_ccb.forEach(this.options,this._addOptionItem,this);this._updateSelection();},_updateSelection:function(){this._set("value",this._getValueFromOpts());var val=this.value;if(!lang.isArray(val)){val=[val];}if(val&&val[0]){_ccb.forEach(this._getChildren(),function(_cf3){var _cf4=_ccb.some(val,function(v){return _cf3.option&&(v===_cf3.option.value);});_cd0.toggle(_cf3.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),_cf4);_cf3.domNode.setAttribute("aria-selected",_cf4?"true":"false");},this);}},_getValueFromOpts:function(){var opts=this.getOptions()||[];if(!this.multiple&&opts.length){var opt=_ccb.filter(opts,function(i){return i.selected;})[0];if(opt&&opt.value){return opt.value;}else{opts[0].selected=true;return opts[0].value;}}else{if(this.multiple){return _ccb.map(_ccb.filter(opts,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_onNewItem:function(item,_cf5){if(!_cf5||!_cf5.parent){this._addOptionForItem(item);}},_onDeleteItem:function(item){var _cf6=this.store;this.removeOption(_cf6.getIdentity(item));},_onSetItem:function(item){this.updateOption(this._getOptionObjForItem(item));},_getOptionObjForItem:function(item){var _cf7=this.store,_cf8=(this.labelAttr&&this.labelAttr in item)?item[this.labelAttr]:_cf7.getLabel(item),_cf9=(_cf8?_cf7.getIdentity(item):null);return {value:_cf9,label:_cf8,item:item};},_addOptionForItem:function(item){var _cfa=this.store;if(_cfa.isItemLoaded&&!_cfa.isItemLoaded(item)){_cfa.loadItem({item:item,onItem:function(i){this._addOptionForItem(i);},scope:this});return;}var _cfb=this._getOptionObjForItem(item);this.addOption(_cfb);},constructor:function(_cfc){this._oValue=(_cfc||{}).value||null;this._notifyConnections=[];},buildRendering:function(){this.inherited(arguments);dom.setSelectable(this.focusNode,false);},_fillContent:function(){if(!this.options){this.options=this.srcNodeRef?_cd2("> *",this.srcNodeRef).map(function(node){if(node.getAttribute("type")==="separator"){return {value:"",label:"",selected:false,disabled:false};}return {value:(node.getAttribute("data-"+_cd1._scopeName+"-value")||node.getAttribute("value")),label:String(node.innerHTML),selected:node.getAttribute("selected")||false,disabled:node.getAttribute("disabled")||false};},this):[];}if(!this.value){this._set("value",this._getValueFromOpts());}else{if(this.multiple&&typeof this.value=="string"){this._set("value",this.value.split(","));}}},postCreate:function(){this.inherited(arguments);this.connect(this,"onChange","_updateSelection");var _cfd=this.store;if(_cfd&&(_cfd.getIdentity||_cfd.getFeatures()["dojo.data.api.Identity"])){this.store=null;this.setStore(_cfd,this._oValue);}},startup:function(){this._loadChildren();this.inherited(arguments);},destroy:function(){var h;while((h=this._notifyConnections.pop())){h.remove();}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}this.inherited(arguments);},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return [];},_getSelectedOptionsAttr:function(){return this.getOptions(this.get("value"));},_pseudoLoadChildren:function(){},onSetStore:function(){}});return _cd5;});},"dojo/data/util/sorter":function(){define("dojo/data/util/sorter",["../../_base/lang"],function(lang){var _cfe={};lang.setObject("dojo.data.util.sorter",_cfe);_cfe.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_cfe.createSortFunction=function(_cff,_d00){var _d01=[];function _d02(attr,dir,comp,s){return function(_d03,_d04){var a=s.getValue(_d03,attr);var b=s.getValue(_d04,attr);return dir*comp(a,b);};};var _d05;var map=_d00.comparatorMap;var bc=_cfe.basicComparator;for(var i=0;i<_cff.length;i++){_d05=_cff[i];var attr=_d05.attribute;if(attr){var dir=(_d05.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_d01.push(_d02(attr,dir,comp,_d00));}}return function(rowA,rowB){var i=0;while(i<_d01.length){var ret=_d01[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _cfe;});},"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode,_popupStateNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n","epi-cms/component/ContentQueryGrid":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/aspect","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase"],function(_d06,lang,when,_d07,_d08,_d09){return _d06([_d09],{queryName:null,queryParameters:null,dndTypes:["epi.cms.contentreference"],postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _d0a=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)},status:{className:"epi-width35",renderCell:function(item,_d0b,node,_d0c){node.innerHTML=_d08.getVersionStatus(_d0b);}}},store:this.store,dndSourceType:this.dndTypes},this.defaultGridMixin);this.grid=new this._gridClass(_d0a,this.domNode);this.grid.set("showHeader",false);this.own(_d07.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)));},fetchData:function(){when(this._getCurrentItem(),lang.hitch(this,function(_d0d){this.set("currentItem",_d0d);}));this.grid.set("queryOptions",{ignore:["query"],sort:[{attribute:"name",descending:true}]});var _d0e=this.queryParameters||{};_d0e.query=this.queryName;this.grid.set("query",_d0e);},_setQueryNameAttr:function(_d0f){this.queryName=_d0f;this.fetchData();}});});},"url:epi-cms/component/templates/Tasks.html":"<div>\r\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"toolbar\">\r\n        <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"reloadButton\" data-dojo-attach-event=\"onClick: _reloadQuery\"\r\n            class=\"epi-chromelessButton epi-iconReload epi-input-margin--left dijitInline dijitReset\">\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"epi-cms/component/ContentQueryGrid\" data-dojo-attach-point=\"contentQuery\">\r\n    </div>\r\n</div>\r\n","epi-cms/component/Trash":function(){define(["dojo/_base/declare","dojo/dom-construct","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_FocusableMixin","epi-cms/widget/Trash","epi-cms/widget/viewmodel/TrashViewModel"],function(_d10,_d11,_d12,_d13,_d14,_d15,_d16,_d17){return _d10([_d12,_d13,_d14,_d15],{templateString:"<div class=\"epi-trashComponent\"><div data-dojo-type='epi-cms/widget/Trash' data-dojo-attach-point='trash'></div></div>",updateView:function(data){if(data){this.trash.set("typeIdentifiers",data.typeIdentifiers);}if(this._trashModel){this._trashModel.destroy();}this.trash.set("model",this._trashModel=new _d17());},destroy:function(){this._trashModel.destroy();this.inherited(arguments);}});});},"epi-cms/widget/Trash":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/Deferred","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/registry","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Alert","epi/shell/command/withConfirmation","epi-cms/widget/TrashItemList","epi-cms/widget/EmptyTrashMenu","epi-cms/widget/TrashViewModelConfirmation","epi-cms/widget/command/EmptyTrash","epi-cms/widget/command/RestoreContent","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/Trash.html"],function(_d18,_d19,lang,_d1a,_d1b,_d1c,_d1d,_d1e,_d1f,_d20,_d21,_d22,_d23,_d24,_d25,_d26,_d27,_d28,_d29,_d2a,_d2b,_d2c,_d2d){return _d19([_d1e,_d1f,_d20,_d24,_d1c],{resources:_d2c,templateString:_d2d,_restoreContentCommand:null,typeIdentifiers:null,modelBindingMap:{"contentStore":["store"],"queryOptions":["queryOptions"],"actionResponse":["actionResponse"],"trashes":["trashes"]},postCreate:function(){this.inherited(arguments);this.tabContainer.watch("selectedChildWidget",lang.hitch(this,function(name,_d2e,_d2f){if(_d2f.itemListId){var _d30=_d23.byId(_d2f.itemListId);_d30.bindUserSelector(_d2f.trash.deletedByUsers);}this.model.set("currentTrash",_d2f.trash);}));this._restoreContentCommand=new _d2b({model:this.model});this.watch("model",lang.hitch(this,function(){this.model=_d29(this.model);this._restoreContentCommand.set("model",this.model);}));this.on("itemClick",this._onItemClick);this.on("deletedByChange",this._onDeletedByChange);},_setTrashesAttr:function(_d31){this.tabContainer.destroyDescendants();var _d32=[];_d18.forEach(_d31,function(_d33){if(_d33&&_d33.active){this._addTrash(_d33);var _d34=new _d2a({label:_d33.name,tooltip:_d33.name,trashId:_d33.wasteBasketLink,model:this.model});_d32.push(_d26(_d34,null,{title:_d2c.emptytrash.title,description:this.model.getEmptyTrashConfirmMessage(_d33.name),onShow:lang.hitch(this,function(){var _d35=this.tabContainer.selectedChildWidget.getChildren()[0];_d35.clearSelection();})}));}},this);this.emptyTrashMenu.set("commands",_d32);if(_d31&&_d31.length===1){_d1a.add(this.tabContainer.domNode,"hide-tablist");}this.tabContainer.startup();this.tabContainer.layout();},_addTrash:function(_d36){var _d37=null;if(_d36.active){_d36.isRequireLoad=true;var item=new _d22({title:_d36.name,trash:_d36});this.tabContainer.addChild(item);if(this._isSelected(_d36)){_d37=item;}}if(_d37){this.tabContainer.selectChild(_d37);}},_isSelected:function(_d38){var _d39=false;_d18.some(_d38.typeIdentifiers,lang.hitch(this,function(_d3a){return _d18.some(this.typeIdentifiers,function(type){if(_d3a==type){_d39=true;return false;}});}));return _d39;},_setQueryOptionsAttr:function(_d3b){if(_d3b){var _d3c=this.tabContainer.selectedChildWidget;if(_d3c){var _d3d=this.get("store"),_d3e=null;if(_d3c.itemListId){_d3e=_d23.byId(_d3c.itemListId);_d3e.set("queryOptions",_d3b);}else{_d3e=new _d27({queryOptions:_d3b,store:_d3d,model:this.model});_d3e.on("itemClick",lang.hitch(this,function(row){this.emit("itemClick",row);}));_d3e.on("deletedByChange",lang.hitch(this,function(_d3f){this.emit("deletedByChange",_d3f);}));_d3e.on("searchBoxChange",lang.hitch(this,this._onSearchBoxChange));_d3c.set("content",_d3e);_d3c.itemListId=_d3e.id;}_d3e.updateRemovedBy(_d3b);}}},_setActionResponseAttr:function(_d40){if(!_d40){return;}this._showNotificationMessage(_d40);},_showNotificationMessage:function(_d41){new _d25({destroyOnHide:true,description:_d41?_d41:""}).show();},_onItemClick:function(row){if(row&&row.data&&this.model.get("currentTrash")){this._restoreContentCommand.set("content",row.data);this._restoreContentCommand.execute();}},_onDeletedByChange:function(_d42){var _d43=this.model.get("currentTrash");_d43.deletedBy=_d42;_d43.isRequireLoad=true;this.model.set("currentTrash",_d43);},_onSearchBoxChange:function(_d44){var _d45=this.model.get("currentTrash");_d45.queryText=_d44;_d45.isRequireLoad=true;this.model.set("currentTrash",_d45);}});});},"epi-cms/widget/TrashItemList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/keys","dojo/Evented","dojo/query","dojo/html","dojo/Stateful","dojo/string","dojo/when","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/widget/Standby","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dgrid/tree","dgrid/extensions/ColumnResizer","dgrid/util/mouse","put-selector/put","epi","epi/dependency","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi/shell/widget/SearchBox","epi/shell/widget/_ModelBindingMixin","epi/datetime","epi/username","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/TrashItemList.html"],function(_d46,_d47,lang,_d48,_d49,_d4a,_d4b,_d4c,_d4d,keys,_d4e,_d4f,html,_d50,_d51,when,_d52,_d53,_d54,_d55,_d56,_d57,_d58,_d59,Tree,_d5a,_d5b,put,epi,_d5c,_d5d,_d5e,_d5f,_d60,_d61,_d62,_d63,_d64,_d65){return _d47([_d52,_d53,_d54,_d4e,_d50,_d61],{resources:_d64,epi:epi,templateString:_d65,_grid:null,_observers:{},_setQueryOptionsAttr:function(_d66){this._set("queryOptions",_d66);this._initialize();},updateRemovedBy:function(_d67){var _d68=this.model.get("currentTrash");if(this.model.isEmptyTrash){this.bindDefaultUserSelector();return;}var _d69=this.store.query({referenceId:_d67.query.referenceId,query:"getblockrootchildren"});var _d6a=lang.hitch(this,function(item,_d6b,_d6c){var _d6d=_d68.isDefaultProvider?"":_d68.name;when(this.model.trashStore.query({providerName:_d6d}),lang.hitch(this,function(_d6e){if(_d6e){var _d6f=_d6e.deletedByUsers;_d68.deletedByUsers=_d6f;this.bindUserSelector(_d6f);}}));});var id=_d68.name,_d70=this._observers[id];if(_d70){_d70.cancel();delete this._observers[id];}this._observers[id]=_d69.observe(_d6a,true);},destroy:function(){for(var id in this._observers){this._observers[id].cancel();delete this._observers[id];}if(this._standby){this._standby.destroyRecursive();this._standby=null;}if(this._grid){this._grid.destroy();this._grid=null;}this.inherited(arguments);},clearSelection:function(){this._grid.clearSelection();this._grid._lastSelected=null;},postCreate:function(){this.inherited(arguments);this.bindUserSelector(this.model.get("currentTrash").deletedByUsers);this.searchBox.encodeSearchText=true;this.searchBox.on("searchBoxChange",lang.hitch(this,function(_d71){this.emit("searchBoxChange",_d71);}));this.removedBy._updateSelection=function(){this._set("value",this._getValueFromOpts());var val=this.value;if(!lang.isArray(val)){val=[val];}_d46.forEach(this._getChildren(),function(_d72){var _d73=_d46.some(val,function(v){return _d72.option&&(v===_d72.option.value);});_d49.toggle(_d72.domNode,this.baseClass+"SelectedOption",_d73);_d72.domNode.setAttribute("aria-selected",_d73);},this);};},resize:function(){if(this._grid){var top=_d4b.position(this._grid.domNode).y;var _d74=_d4b.position(_d48.body()).h;_d4c.set(this._grid.domNode,"height",(_d74-top)+"px");}},_initialize:function(){this.searchBox.set("disabled",!this.queryOptions.query.isSearchable);if(!this._grid){this._grid=this._createGrid(this.store,this.queryOptions);_d4a.place(this._grid.domNode,this.gridContainerNode);}else{this._showStandby(true);if(this.queryOptions){this._grid.set("queryOptions",this.queryOptions.options);this._grid.set("query",this.queryOptions.query);}}this.resize();},bindDefaultUserSelector:function(){this.removedBy._onChangeActive=false;this.removedBy.removeOption(this.removedBy.options);this.removedBy.addOption({label:epi.resources.text.anyone,value:""});this.removedBy._onChangeActive=true;},bindUserSelector:function(_d75){if(_d75){var _d76=this.removedBy.get("value");this.bindDefaultUserSelector();this.removedBy._onChangeActive=false;_d46.forEach(_d75,function(_d77){this.removedBy.addOption({label:this._createUserFriendlyUsername(_d77),value:_d77});},this);this.removedBy.set("value",_d76);this.removedBy._onChangeActive=true;}},_createGrid:function(_d78,_d79){var _d7a=_d47([_d57,_d58,_d59,_d5d,_d5a]);var grid=new _d7a({store:_d78,columns:{name:Tree({field:"name",label:epi.resources.header.name,renderCell:lang.hitch(this,this._renderTreeNode)}),removedOn:{field:"deleted",label:epi.resources.header.removed,formatters:[this._localizeDate,_d5e.ellipsis]},by:{field:"deletedBy",label:epi.resources.header.by,formatters:[this._createUserFriendlyUsername,_d5e.ellipsis]},action:{label:" ",formatter:this._renderActionMenu,sortable:false}},minWidth:100,noDataMessage:this._getNoDataMessage(),selectionMode:"single"});this._standby=new _d56({target:grid.domNode,color:"#fff"}).placeAt(document.body);this._standby.startup();this.own(_d4d.after(grid,"expand",function(_d7b){var row=_d7b.element?_d7b:grid.row(_d7b),_d7c=_d4f(row.element).parent()[0];if(_d7c){_d4c.set(_d7c,"height","");}},true));_d4d.after(grid,"_processScroll",lang.hitch(this,function(){this._showStandby(false);}));this._showStandby(true);_d4d.before(grid,"adjustRowIndices",function(_d7d){if(_d7d){_d46.forEach(_d4f("div.dgrid-no-data",this.contentNode),function(div){html.set(div,"");});}});_d4d.around(grid,"insertRow",lang.hitch(this,this._aroundInsertRow));_d4d.before(grid,"renderArray",lang.hitch(this,function(_d7e,_d7f,_d80){var _d81=this.queryOptions.query;if(_d81&&_d81.query==="searchdeletedcontent"){_d7e.map(function(_d82){if(_d82){_d82.hasChildren=false;}});}}));if(_d79){grid.set("queryOptions",_d79.options);grid.set("query",_d79.query);}var _d83="epi-dgrid-mouseover";grid.on(_d5b.enterRow,function(evt){_d49.add(this,_d83);});grid.on(_d5b.leaveRow,function(evt){_d49.remove(this,_d83);});grid.on(".epi-gridAction:click",lang.hitch(this,function(evt){var row=grid.row(evt);this.emit("itemClick",row);}));grid.on(".dgrid-column-action:keydown",lang.hitch(this,function(e){if(e.keyCode==keys.ENTER&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){var row=grid.row(e);this.emit("itemClick",row);}}));return grid;},_renderTreeNode:function(_d84,data,td,_d85){if(_d84&&_d84.thumbnailUrl){var _d86=_d4a.create("img",{src:_d84.thumbnailUrl+_d51.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"},td);_d4a.place(_d5e.ellipsis(_d5e.htmlEncode(data)),td);}else{var _d87=_d5f.getValue(_d84.typeIdentifier,"iconClass")||"epi-iconObjectPage";_d4a.place(_d5e.icon(_d87+" epi-objectIcon",_d5e.ellipsis(_d5e.htmlEncode(data))),td);}},_renderActionMenu:function(_d88){var data={"title":_d64.restore.tooltip,"label":_d64.restore.label};return lang.replace("<a class=\"epi-gridAction epi-visibleLink\" title=\"{title}\">{label}</a>",data);},_localizeDate:function(_d89){return _d62.toUserFriendlyString(_d89);},_createUserFriendlyUsername:function(name){return _d63.toUserFriendlyString(_d5e.htmlEncode(name));},_onDeletedByChange:function(_d8a){if(this.model.isEmptyTrash){this.model.isEmptyTrash=false;return;}this.emit("deletedByChange",_d8a);},_showStandby:function(_d8b){if(!this._standby){return;}if(_d8b){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},_getNoDataMessage:function(){return "<span><span class=\"dijitReset dijitInline\">"+_d64.trashitemempty+"</span></span>";},_aroundInsertRow:function(_d8c){return lang.hitch(this,function(_d8d,_d8e,_d8f,i,_d90){var row=_d8c.apply(this._grid,arguments);if(_d8d&&_d8d.thumbnailUrl){_d49.add(row,"epi-mediaContent");}return row;});}});});},"dgrid/tree":function(){define("dgrid/tree",["dojo/_base/declare","dojo/_base/array","dojo/_base/Deferred","dojo/query","dojo/on","dojo/aspect","./util/has-css3","./Grid","dojo/has!touch?./util/touch","put-selector/put"],function(_d91,_d92,_d93,_d94,on,_d95,has,Grid,_d96,put){function _d97(_d98,_d99,_d9a,_d9b){var dir=this.grid.isRTL?"right":"left",cls=".dgrid-expando-icon",node;if(_d99){cls+=".ui-icon.ui-icon-triangle-1-"+(_d9a?"se":"e");}node=put("div"+cls+"[style=margin-"+dir+": "+(_d98*(this.indentWidth||9))+"px; float: "+dir+"]");node.innerHTML="&nbsp;";return node;};function _d9c(_d9d){var _d9e=this,_d9f=this.style.height;if(_d9f){this.style.display=_d9f=="0px"?"none":"block";}if(_d9d){put(this,".dgrid-tree-resetting");setTimeout(function(){put(_d9e,"!dgrid-tree-resetting");});}this.style.height="";};function tree(_da0){var _da1=_da0.renderCell||Grid.defaultRenderCell;var _da2,_da3;if(!_da0){_da0={};}_da0.shouldExpand=_da0.shouldExpand||function(row,_da4,_da5){return _da5;};_d95.after(_da0,"init",function(){var grid=_da0.grid,_da6=".dgrid-content .dgrid-column-"+_da0.id,_da7=[];if(!grid.store){throw new Error("dgrid tree column plugin requires a store to operate.");}if(!_da0.renderExpando){_da0.renderExpando=_d97;}_da7.push(grid.on(_da0.expandOn||".dgrid-expando-icon:click,"+_da6+":dblclick,"+_da6+":keydown",function(_da8){var row=grid.row(_da8);if((!grid.store.mayHaveChildren||grid.store.mayHaveChildren(row.data))&&(_da8.type!="keydown"||_da8.keyCode==32)&&!(_da8.type=="dblclick"&&_da3&&_da3.count>1&&row.id==_da3.id&&_da8.target.className.indexOf("dgrid-expando-icon")>-1)){grid.expand(row);}if(_da8.target.className.indexOf("dgrid-expando-icon")>-1){if(_da3&&_da3.id==grid.row(_da8).id){_da3.count++;}else{_da3={id:grid.row(_da8).id,count:1};}}}));if(has("touch")){_da7.push(grid.on(_d96.selector(_da6,_d96.dbltap),function(){grid.expand(this);}));}if(!grid._expanded){grid._expanded={};}_da7.push(_d95.after(grid,"insertRow",function(_da9){var row=this.row(_da9),_daa=_da0.shouldExpand(row,_da2,this._expanded[row.id]);if(_daa){this.expand(_da9,true,true);}return _da9;}));_da7.push(_d95.before(grid,"removeRow",function(_dab,_dac){var _dad=_dab.connected;if(_dad){_d94(">.dgrid-row",_dad).forEach(function(_dae){grid.removeRow(_dae,true);});if(!_dac){put(_dad,"!");}}}));if(_da0.collapseOnRefresh){_da7.push(_d95.after(grid,"cleanup",function(){this._expanded={};}));}grid._calcRowHeight=function(_daf){var _db0=_daf.connected;return _daf.offsetHeight+(_db0?_db0.offsetHeight:0);};grid.expand=function(_db1,_db2,_db3){var row=_db1.element?_db1:grid.row(_db1),_db4=has("transitionend");_db1=row.element;_db1=_db1.className.indexOf("dgrid-expando-icon")>-1?_db1:_d94(".dgrid-expando-icon",_db1)[0];if(_db1&&_db1.mayHaveChildren&&(_db3||_db2!==!!this._expanded[row.id])){var _db5=_db2===undefined?!this._expanded[row.id]:_db2;put(_db1,".ui-icon-triangle-1-"+(_db5?"se":"e")+"!ui-icon-triangle-1-"+(_db5?"e":"se"));var _db6=_db1.preloadNode,_db7=row.element,_db8,_db9,_dba,_dbb;if(!_db6){_db8=_db7.connected=put("div.dgrid-tree-container");_db6=_db1.preloadNode=put(_db7,"+",_db8,"div.dgrid-preload");var _dbc=function(_dbd){return grid.store.getChildren(row.data,_dbd);};_dbc.level=_db1.level;if(_da0.allowDuplicates){_dbb={parentId:row.id};}_d93.when(grid.renderQuery?grid._trackError(function(){return grid.renderQuery(_dbc,_db6,_dbb);}):grid.renderArray(_dbc(_dbb),_db6,{query:_dbc}),function(){if(grid._expanded[row.id]&&_db4){var _dbe=_db8.scrollHeight;_db8.style.height=_dbe?_dbe+"px":"auto";}});if(_db4){on(_db8,_db4,_d9c);}else{_d9c.call(_db8);}}_db8=_db7.connected;_db8.hidden=!_db5;_db9=_db8.style;if(!_db4||_db3){_db9.display=_db5?"block":"none";_db9.height="";}else{if(_db5){_db9.display="block";_dba=_db8.scrollHeight;_db9.height="0px";}else{put(_db8,".dgrid-tree-resetting");_db9.height=_db8.scrollHeight+"px";}setTimeout(function(){put(_db8,"!dgrid-tree-resetting");_db9.height=_db5?(_dba?_dba+"px":"auto"):"0px";});}if(_db5){this._expanded[row.id]=true;}else{delete this._expanded[row.id];}}};_d95.after(_da0,"destroy",function(){_d92.forEach(_da7,function(l){l.remove();});delete grid.expand;delete grid._calcRowHeight;});});_da0.renderCell=function(_dbf,_dc0,td,_dc1){var grid=_da0.grid,_dc2=Number(_dc1&&_dc1.query&&_dc1.query.level)+1,_dc3=!grid.store.mayHaveChildren||grid.store.mayHaveChildren(_dbf),_dc4=_dc1.parentId,_dc5,node;_dc2=_da2=isNaN(_dc2)?0:_dc2;_dc5=_da0.renderExpando(_dc2,_dc3,grid._expanded[(_dc4?_dc4+"-":"")+grid.store.getIdentity(_dbf)],_dbf);_dc5.level=_dc2;_dc5.mayHaveChildren=_dc3;node=_da1.call(_da0,_dbf,_dc0,td,_dc1);if(node&&node.nodeType){put(td,_dc5);put(td,node);}else{td.insertBefore(_dc5,td.firstChild);}};return _da0;};tree.defaultRenderExpando=_d97;return tree;});},"dgrid/extensions/ColumnResizer":function(){define("dgrid/extensions/ColumnResizer",["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(_dc6,_dc7,_dc8,lang,dom,geom,has,_dc9,put){function _dca(_dcb,span,_dcc,_dcd,id){for(var i=1;i<span;i++){_dcb[_dcc+i][_dcd]=id;}};function _dce(_dcf){var i=_dcf.length,l=i,_dd0=_dcf[0].length,_dd1=new Array(i);while(i--){_dd1[i]=new Array(_dd0);}var _dd2={};for(i=0;i<l;i++){var row=_dd1[i],_dd3=_dcf[i];for(var j=0,js=0;j<_dd0;j++){var cell=_dd3[js],k;if(typeof row[j]!="undefined"){continue;}row[j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_dca(_dd1,cell.rowSpan,i,j,cell.id);}if(i>0&&cell.colSpan&&cell.colSpan>1){for(k=1;k<cell.colSpan;k++){row[++j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_dca(_dd1,cell.rowSpan,i,j,cell.id);}}}_dd2[cell.id]=_dcf[0][j].id;js++;}}return _dd2;};function _dd4(grid,_dd5,_dd6,_dd7){if(_dd6<=0){return;}var _dd8=grid.columns[_dd5],_dd9={grid:grid,columnId:_dd5,width:_dd6,bubbles:true,cancelable:true},rule;if(_dd7){_dd9.parentType=_dd7;}if(!grid._resizedColumns||_dc7.emit(grid.headerNode,"dgrid-columnresize",_dd9)){if(_dd6==="auto"){delete _dd8.width;}else{_dd8.width=_dd6;_dd6+="px";}rule=grid._columnSizes[_dd5];if(rule){rule.set("width",_dd6);}else{rule=_dc9.addCssRule("#"+_dc9.escapeCssIdentifier(grid.domNode.id)+" .dgrid-column-"+_dd5,"width: "+_dd6+";");}grid._columnSizes[_dd5]=rule;grid.resize();return true;}};var _dda,_ddb=0;var _ddc={create:function(){_dda=put("div.dgrid-column-resizer");},destroy:function(){put(_dda,"!");_dda=null;},show:function(grid){var pos=geom.position(grid.domNode,true);_dda.style.top=pos.y+"px";_dda.style.height=pos.h+"px";put(document.body,_dda);},move:function(x){_dda.style.left=x+"px";},hide:function(){_dda.parentNode.removeChild(_dda);}};return _dc6(null,{resizeNode:null,minWidth:40,adjustLastColumn:true,_resizedColumns:false,buildRendering:function(){this.inherited(arguments);if(!_ddb++){_ddc.create();}},destroy:function(){this.inherited(arguments);for(var name in this._columnSizes){this._columnSizes[name].remove();}if(!--_ddb){_ddc.destroy();}},resizeColumnWidth:function(_ddd,_dde){return _dd4(this,_ddd,_dde);},configStructure:function(){var _ddf=this._oldColumnSizes=lang.mixin({},this._columnSizes),k;this._resizedColumns=false;this._columnSizes={};this.inherited(arguments);for(k in _ddf){if(!(k in this._columnSizes)){_ddf[k].remove();}}delete this._oldColumnSizes;},_configColumn:function(_de0){this.inherited(arguments);var _de1=_de0.id,rule;if("width" in _de0){if((rule=this._oldColumnSizes[_de1])){rule.set("width",_de0.width+"px");}else{rule=_dc9.addCssRule("#"+this.domNode.id+" .dgrid-column-"+_de1,"width: "+_de0.width+"px;");}this._columnSizes[_de1]=rule;}},renderHeader:function(){this.inherited(arguments);var grid=this;var _de2;if(this.columnSets&&this.columnSets.length){var csi=this.columnSets.length;while(csi--){_de2=lang.mixin(_de2||{},_dce(this.columnSets[csi]));}}else{if(this.subRows&&this.subRows.length>1){_de2=_dce(this.subRows);}}var _de3=_dc8(".dgrid-cell",grid.headerNode),i=_de3.length;while(i--){var _de4=_de3[i],id=_de4.columnId,col=grid.columns[id],_de5=_de4.childNodes;if(!col||col.resizable===false){continue;}var _de6=put("div.dgrid-resize-header-container");_de4.contents=_de6;while(_de5.length>0){put(_de6,_de5[0]);}put(_de4,_de6,"div.dgrid-resize-handle.resizeNode-"+id).columnId=_de2?_de2[id]:id;}if(!grid.mouseMoveListen){_dc7(grid.headerNode,".dgrid-resize-handle:mousedown"+(has("touch")?",.dgrid-resize-handle:touchstart":""),function(e){grid._resizeMouseDown(e,this);grid.mouseMoveListen.resume();grid.mouseUpListen.resume();});grid._listeners.push(grid.mouseMoveListen=_dc7.pausable(document,"mousemove"+(has("touch")?",touchmove":""),_dc9.throttleDelayed(function(e){grid._updateResizerPosition(e);})));grid._listeners.push(grid.mouseUpListen=_dc7.pausable(document,"mouseup"+(has("touch")?",touchend":""),function(e){grid._resizeMouseUp(e);grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}));grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}},_resizeMouseDown:function(e,_de7){e.preventDefault();dom.setSelectable(this.domNode,false);this._startX=this._getResizeMouseLocation(e);this._targetCell=_dc8(".dgrid-column-"+_de7.columnId,this.headerNode)[0];this._updateResizerPosition(e);_ddc.show(this);},_resizeMouseUp:function(e){var _de8=this._columnSizes,_de9,_dea,_deb;if(this.adjustLastColumn){_deb=this.headerNode.clientWidth-1;}if(!this._resizedColumns){_de9=_dc8(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_de9=_de9.filter(function(node){var idx=node.columnId.split("-");return idx[0]=="0"&&!(node.columnId in _de8);});}else{if(this.subRows&&this.subRows.length>1){_de9=_de9.filter(function(node){return node.columnId.charAt(0)=="0"&&!(node.columnId in _de8);});}}_dea=_de9.map(function(_dec){return _dec.offsetWidth;});_de9.forEach(function(_ded,i){this.resizeColumnWidth(_ded.columnId,_dea[i]);},this);this._resizedColumns=true;}dom.setSelectable(this.domNode,true);var cell=this._targetCell,_dee=this._getResizeMouseLocation(e)-this._startX,_def=cell.offsetWidth+_dee,obj=this._getResizedColumnWidths(),_df0=obj.totalWidth,_df1=obj.lastColId,_df2=_dc8(".dgrid-column-"+_df1,this.headerNode)[0].offsetWidth;if(_def<this.minWidth){_def=this.minWidth;}if(_dd4(this,cell.columnId,_def,e.type)){if(cell.columnId!=_df1&&this.adjustLastColumn){if(_df0+_dee<_deb){_dd4(this,_df1,"auto",e.type);}else{if(_df2-_dee<=this.minWidth){_dd4(this,_df1,this.minWidth,e.type);}}}}_ddc.hide();delete this._startX;delete this._targetCell;},_updateResizerPosition:function(e){if(!this._targetCell){return;}var _df3=this._getResizeMouseLocation(e),_df4=_df3-this._startX,_df5=this._targetCell.offsetWidth,left=_df3;if(_df5+_df4<this.minWidth){left=this._startX-(_df5-this.minWidth);}_ddc.move(left);},_getResizeMouseLocation:function(e){var posX=0;if(e.pageX){posX=e.pageX;}else{if(e.clientX){posX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;}}return posX;},_getResizedColumnWidths:function(){var _df6=0,_df7=_dc8(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_df7=_df7.filter(function(node){var idx=node.columnId.split("-");return idx[1]=="0";});}else{if(this.subRows&&this.subRows.length>1){_df7=_df7.filter(function(node){return node.columnId.charAt(0)=="0";});}}var i=_df7.length;if(!i){return {};}var _df8=_df7[i-1].columnId;while(i--){_df6+=_df7[i].offsetWidth;}return {totalWidth:_df6,lastColId:_df8};}});});},"dgrid/util/mouse":function(){define("dgrid/util/mouse",["dojo/on","dojo/dom","dojo/query"],function(on,dom){function _df9(_dfa,type){return function(node,_dfb){return on(node,_dfa+":"+type,function(evt){if(!dom.isDescendant(evt.relatedTarget,this)){return _dfb.call(this,evt);}});};};return {enterRow:_df9(".dgrid-content .dgrid-row","mouseover"),enterCell:_df9(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:_df9(".dgrid-header .dgrid-cell","mouseover"),leaveRow:_df9(".dgrid-content .dgrid-row","mouseout"),leaveCell:_df9(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:_df9(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:_df9};});},"url:epi-cms/widget/templates/TrashItemList.html":"<div>\r\n    <div class=\"epi-trashHeader clearfix\">\r\n        <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxContainer\">\r\n            <div data-dojo-type=\"epi/shell/widget/SearchBox\" data-dojo-attach-point=\"searchBox\"></div>\r\n        </div>\r\n        <span class=\"epi-removedByContainer\">\r\n            <label for=\"removedBy_${id}\">${resources.removedby}</label>\r\n            <select data-dojo-type=\"dijit/form/Select\" data-dojo-attach-point=\"removedBy\" id=\"removedBy_${id}\" data-dojo-attach-event='onChange: _onDeletedByChange'>\r\n            </select>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridContainerNode\"></div>\r\n</div>","epi-cms/widget/EmptyTrashMenu":function(){define(["dojo/_base/declare","dijit/layout/_LayoutWidget","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_dfc,_dfd,_dfe,_dff,_e00,_e01){return _dfc([_dfd],{resources:_e01,_setCommandsAttr:function(_e02){this._set("commands",_e02);this._bindEmptyTrashMenu(_e02);},_bindEmptyTrashMenu:function(_e03){this.destroyDescendants();if(!_e03||_e03.length<1){return;}var _e04=_e03.length>1;var _e05=null;if(_e04){_e05=new _dff({settings:{label:_e01.emptytrash.title,dropDownPosition:["below-alt"]}});}else{_e05=new _dfe({settings:{label:_e01.emptytrash.title}});this.commands[0].label=_e01.emptytrash.title;}new _e00({configuration:[{builder:_e05,target:this}],commandSource:this}).build();},getCommands:function(){return this.get("commands");}});});},"epi-cms/widget/TrashViewModelConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/when","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/dialog/Confirmation","epi/shell/widget/dialog/Alert","epi-cms/widget/ContentSelectorDialog","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_e06,_e07,_e08,lang,_e09,when,_e0a,_e0b,_e0c,_e0d,_e0e,_e0f,_e10,_e11,_e12){return function(_e13){var _e14=function(_e15,_e16,_e17){var _e18=new _e08();var _e19=new _e0e({destroyOnHide:true,description:_e0b.toHTML(_e16),title:_e0b.toHTML(_e15),onAction:function(_e1a){_e1a?_e18.resolve(_e17):_e18.cancel();}});_e19.show();return _e18;};var _e1b=function(_e1c,_e1d,_e1e){var df=new _e08(),_e1f=_e12.restore.dialog,_e20=_e0c.getValue(_e1c.typeIdentifier,"containerTypes"),_e21=_e22(_e1c),_e23={showButtons:false,roots:_e1d,multiRootsMode:true,canSelectOwnerContent:false,allowedTypes:_e20||_e21,selectedContentType:_e1c.typeIdentifier};var _e24=new _e10(_e23);var _e25=new _e0d({title:_e0b.toHTML(_e1f.title),description:_e1e||_e0b.toHTML(_e1f.description),confirmActionText:_e0b.toHTML(_e12.restore.label),content:_e24});var _e26=function(_e27){when(_e13.contentStore.query({id:_e27}),function(_e28){_e25.onActionPropertyChanged({name:"ok"},"disabled",!_e28);});};_e24.on("change",function(_e29){if(_e29){_e26(_e29);}else{_e25.onActionPropertyChanged({name:"ok"},"disabled",true);}});_e25.on("execute",function(){df.resolve(_e24.get("value"));});_e25.on("onHide",function(){df.cancel();});_e25.show();_e24.onChange(null);return df;};var _e2a=function(_e2b,_e2c){var _e2d=_e11.action.Create,_e2e=_e11.providerCapabilities.Create,_e2f=_e2c&&!(_e2c.isWastebasket||_e2c.isDeleted)&&_e11.isActionAvailable(_e2c,_e2d,_e2e,true,true);if(!_e2f){var _e30=new _e0f({description:_e0b.toHTML(_e12.restore.userdonothavepermission)});_e30.show();return false;}return true;};var _e31=function(_e32,_e33,_e34,_e35,_e36,_e37){if(!_e36||!_e32||!_e33){return false;}if(_e35&&_e34){confirmation=_e14(_e12.restore.label,_e12.restore.confirmquestion,_e34);}else{confirmation=_e1b(_e33,_e38(_e33),_e37);}when(confirmation,function(_e39){when(_e32.contentStore.get(_e39),function(_e3a){if(!_e2a(_e33,_e3a)){return false;}return _e36.apply(_e32,[_e33,_e39]);});},function(){return false;});};var _e38=function(_e3b){var _e3c=_e0a.resolve("epi.cms.contentRepositoryDescriptors");var _e3d=[];for(var key in _e3c){_e3c[key].containedTypes.forEach(function(type){if(_e0c.isBaseTypeIdentifier(_e3b.typeIdentifier,type)){_e3c[key].roots.forEach(function(root){if(_e3d.indexOf(root)===-1){_e3d.push(root);}});}});}return _e3d;};var _e22=function(_e3e){var _e3f=_e0a.resolve("epi.cms.contentRepositoryDescriptors");var _e40=[];for(var key in _e3f){_e3f[key].containedTypes.forEach(function(type){if(_e0c.isBaseTypeIdentifier(_e3e.typeIdentifier,type)){_e40=_e40.concat(_e3f[key].containedTypes);}});}return _e40;};_e09.around(_e13,"restore",function(_e41){return function(_e42,_e43){var _e44;return when(_e13.contentStore.query({id:_e42.contentLink}),lang.hitch(this,function(_e45){var _e46=null;var _e47=null;if(_e45.hasOwnProperty("statusCode")&&(_e45.statusCode===401||_e45.statusCode===403)){_e46=_e0b.toHTML(_e12.restore.userdonothavepermission);}if(_e45.hasOwnProperty("isDeleted")&&!_e45.isDeleted){_e46=_e0b.toHTML(_e12.restore.contentalreadyrestored);_e47=function(){_e13.updateTrash(_e13.get("currentTrash"));};}if(_e46){var _e48=new _e0f({description:_e46,onAction:_e47});_e48.show();return false;}var _e49=_e13.get("currentTrash");if(_e45.parentLink!=_e49.wasteBasketLink){return when(_e1b(_e45,_e38(_e45)),function(_e4a){when(_e13.contentStore.get(_e4a),function(_e4b){if(!_e2a(_e45,_e4b)){return false;}return _e41.apply(_e13,[_e45,_e4a]);});},function(){return false;});}else{return when(_e13.getOldParent(_e45.contentLink),function(_e4c){var _e4d=_e4c?_e4c.contentLink:null;_e31(_e13,_e45,_e4d,_e4d!=null,_e41);});}}),lang.hitch(this,function(_e4e){var _e4f=new _e0f({description:_e0b.toHTML(_e12.restore.contentdeletedpermanently),onAction:function(){_e13.updateTrash(_e13.get("currentTrash"));}});_e4f.show();return false;}));};});return _e13;};});},"epi-cms/widget/command/EmptyTrash":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_e50,_e51){return _e50([_e51],{label:null,tooltip:null,trashId:null,_execute:function(){if(this.canExecute){this.model.emptyTrash(this.trashId);}},_onModelChange:function(){var _e52=!!this.trashId;this.set("canExecute",_e52);}});});},"epi-cms/widget/command/RestoreContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_e53,_e54){return _e53([_e54],{content:null,_execute:function(){if(this.canExecute&&this.content){this.model.restore(this.content);}},_onModelChange:function(){var _e55=!!this.model;this.set("canExecute",_e55);}});});},"url:epi-cms/widget/templates/Trash.html":"<div class=\"epi-trash\">\r\n    <div class=\"epi-listingTopContainer\">\r\n        <h1 class=\"dijitInline\">${resources.heading}</h1>\r\n        <div class=\"epi-mediumButton epi-boldButton epi-emptyCommand\" data-dojo-attach-point=\"emptyTrashMenu\" data-dojo-type=\"epi-cms/widget/EmptyTrashMenu\"\r\n            data-dojo-props=\"title: '${resources.emptytrash.tooltip}'\"></div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"stackContainer\">\r\n        <div data-dojo-type=\"dijit/layout/TabContainer\" data-dojo-attach-point=\"tabContainer\" data-dojo-props=\"doLayout:false, useMenu:true, useSlider:false\"> <!-- doLayout=\"false\" for flexible height -->\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/widget/viewmodel/TrashViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/_base/json","epi/epi","epi/shell/_StatefulGetterSetterMixin","epi/shell/TypeDescriptorManager","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_e56,_e57,_e58,lang,_e59,_e5a,json,epi,_e5b,_e5c,_e5d,_e5e){return _e57([_e5a,_e5b],{resources:_e5e,trashes:null,currentTrash:null,queryOptions:null,isEmptyTrash:false,storeRegistry:null,contentStore:null,trashStore:null,showAllLanguages:true,_contentRepositoryDescriptors:null,postscript:function(){this.inherited(arguments);this.storeRegistry=_e5d.resolve("epi.storeregistry");this.contentStore=this.contentStore||this._getStore();this.trashStore=this.trashStore||this.storeRegistry.get("epi.cms.wastebasket");this._contentRepositoryDescriptors=_e5d.resolve("epi.cms.contentRepositoryDescriptors");if(!this.trashes){this._createTrashes();}},destroy:function(){epi.removeDelegateAspects(this.contentStore);},_getStore:function(){var _e5f=this.storeRegistry.get("epi.cms.content.light"),_e60=this;var _e61=epi.delegate(_e5f,{getChildren:function(_e62,_e63){var _e64=_e60.get("currentTrash"),_e65=_e60._createQueryOptions(_e64);lang.mixin(_e65.query,{referenceId:_e62.contentLink});return this.query(_e65.query,_e65.options);},mayHaveChildren:function(_e66){return _e66.hasChildren;}},["notify"]);return _e61;},_createTrashes:function(){_e58.when(this.trashStore.query(),lang.hitch(this,function(_e67){this.set("trashes",lang.clone(_e67));}));},_setCurrentTrashAttr:function(_e68){this._set("currentTrash",_e68);if(_e68.isRequireLoad){this.updateTrash(_e68);_e68.isRequireLoad=false;}},getEmptyTrashConfirmMessage:function(_e69){var _e6a=_e5e.emptytrash.singleproviderdescription;if(this.trashes.length>1){_e6a=_e5e.emptytrash.description.replace("{0}",_e69);}return _e6a;},updateTrash:function(_e6b){if(_e6b&&_e6b.active){this.set("queryOptions",this._createQueryOptions(_e6b));}else{this.set("queryOptions",null);}},_createQueryOptions:function(_e6c){var _e6d={referenceId:_e6c.wasteBasketLink,query:"getchildren"};var _e6e={ignore:["query"],comparers:this._createComparers()};if(this.showAllLanguages){lang.mixin(_e6d,{allLanguages:this.showAllLanguages});_e6e.ignore.push("allLanguages");}if(_e6c.deletedBy){lang.mixin(_e6d,{deletedBy:_e6c.deletedBy});}if(_e6c.isSearchable){lang.mixin(_e6d,{isSearchable:_e6c.isSearchable});_e6e.ignore.push("isSearchable");}if(_e6c.queryText){lang.mixin(_e6d,{query:"searchdeletedcontent"});lang.mixin(_e6d,{matchProvider:true});lang.mixin(_e6d,{queryText:_e6c.queryText});}return {query:_e6d,options:_e6e};},_createComparers:function(){return {"referenceId":function(_e6f,_e70){return _e6f===_e70.parentLink;}};},emptyTrash:function(_e71){if(_e71){_e58.when(this.trashStore.executeMethod("Empty",_e71),lang.hitch(this,function(_e72){var _e73=_e56.filter(this.get("trashes"),function(_e74){return _e74&&_e74.wasteBasketLink===_e71;});_e56.forEach(_e73,function(_e75){_e75.deletedByUsers=[];_e75.isRequireLoad=true;_e75.deletedByUsers=[];});this.isEmptyTrash=true;_e59.publish("/epi/cms/trash/empty",_e72.extraInformation);if(this.currentTrash.wasteBasketLink===_e71){this.set("currentTrash",this.currentTrash);}}),lang.hitch(this,function(_e76){if(_e76.status===403){this.set("actionResponse",_e5e.emptytrash.accessdenied);}}));}},restore:function(_e77,_e78){if(_e77&&_e77.contentLink&&_e77.isDeleted&&_e78){_e58.when(this.contentStore.move(_e77.contentLink,{targetId:_e78}),lang.hitch(this,function(_e79){if(_e79){this.contentStore.refresh(_e77.contentLink);if(_e77.parentLink!=this.currentTrash.wasteBasketLink){this.contentStore.refresh(_e77.parentLink).then(lang.hitch(this,function(){this.updateTrash(this.currentTrash);}));}var _e7a=this.contentStore.get(_e78);if(_e7a&&!_e7a.hasChildren){this.contentStore.refresh(_e78).then(function(_e7b){_e59.publish("/epi/cms/contentdata/restored",_e7b);});}}}),lang.hitch(this,function(_e7c){this.set("actionResponse",_e7c.xhr?json.fromJson(_e7c.xhr.responseText):_e5e.restore.error);}));}},getOldParent:function(_e7d){var df=new _e58();_e58.when(this.contentStore.query({referenceId:_e7d,query:"getrestorepoint",allLanguages:true}),function(_e7e){var _e7f=_e7e&&lang.isArray(_e7e)&&_e7e.length>0?_e7e[0]:null;df.resolve(_e7f);});return df;}});});},"epi-cms/component/Versions":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/aspect","dojo/dom-class","dojo/on","dojo/string","dojo/topic","dojo/when","dojox/html/entities","dgrid/OnDemandGrid","dgrid/Selection","epi","epi/dependency","epi/username","epi/shell/TypeDescriptorManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/withConfirmation","epi/shell/widget/_FocusableMixin","epi/shell/widget/Tooltip","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/component/command/DeleteVersion","epi-cms/component/command/DeleteLanguageBranch","epi-cms/component/command/SetCommonDraft","epi-cms/command/ShowAllLanguages","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(_e80,_e81,lang,_e82,_e83,_e84,on,_e85,_e86,when,_e87,_e88,_e89,epi,_e8a,_e8b,_e8c,_e8d,_e8e,_e8f,_e90,_e91,_e92,_e93,_e94,_e95,_e96,_e97,_e98,_e99,_e9a,_e9b,_e9c){return _e81([_e9b,_e8d,_e8f,_e93],{showAllLanguages:true,isMultilingual:false,_tooltips:[],postMixInProperties:function(){this._commonDrafts={};this.storeKeyName="epi.cms.contentversion";this.ignoreVersionWhenComparingLinks=false;this.inherited(arguments);this._currentContentLanguage=_e94.currentContentLanguage;this.connect(this.store,"onItemChanged","_onItemChanged");var _e9d=_e8a.resolve("epi.storeregistry");this._contentStore=_e9d.get("epi.cms.contentdata");},buildRendering:function(){this.inherited(arguments);var _e9e=_e81([_e88,_e89]);this.grid=new _e9e({columns:{language:{label:epi.resources.header.language},statusName:{label:epi.resources.header.status,renderCell:function(item,_e9f,node,_ea0){var html=item.statusName;if(item.isCommonDraft){html="<span class=\"dijitReset dijitInline dijitIcon epi-iconPrimary epi-floatRight\"></span>"+item.statusName;}node.innerHTML=html;}},savedDate:{label:epi.resources.header.saved,formatter:this._localizeDate},savedBy:{label:epi.resources.header.by,formatter:this._createUserFriendlyUsername}},store:this.store,selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",sort:[{attribute:"savedDate",descending:true}]},this.domNode);},postCreate:function(){this.add("commands",new _e99({model:this}));this._commonDraftCommand=new _e98();this._deleteVersionCommand=new _e96();this._deleteLanguageBranchCommand=new _e97();this.own(_e83.after(this._commonDraftCommand,"execute",lang.hitch(this,function(_ea1){_ea1.then(null,lang.hitch(this,this._onSetCommonDraftFailure));})),_e83.after(this._deleteVersionCommand,"execute",lang.hitch(this,function(_ea2){_ea2.then(lang.hitch(this,this._onDeleteVersionSuccess),lang.hitch(this,this._onDeleteVersionFailure));})),_e83.after(this._deleteLanguageBranchCommand,"execute",lang.hitch(this,function(_ea3){_ea3.then(lang.hitch(this,this._onDeleteVersionSuccess),lang.hitch(this,this._onDeleteVersionFailure));})));this.add("commands",this._commonDraftCommand);this.add("commands",_e8e(this._deleteVersionCommand,null,{title:_e9c.deletemenuitemtitle,heading:_e9c.deleteversion.note,description:_e9c.deleteversion.confirmquestion}));this._deleteLanguageBranchSettings={cancelActionText:epi.resources.action.cancel,setFocusOnConfirmButton:false};this.add("commands",_e8e(this._deleteLanguageBranchCommand,null,this._deleteLanguageBranchSettings));},startup:function(){if(this._started){return;}this.inherited(arguments);this.own(_e83.around(this.grid,"renderRow",lang.hitch(this,this._aroundRenderRow)));this._toggleLanguage(this.showAllLanguages);this.fetchData();},_setShowAllLanguagesAttr:function(_ea4){this._set("showAllLanguages",_ea4);this._toggleFilterByLanguage(_ea4);},destroy:function(){this.inherited(arguments);this._destroyTooltips();},_onItemChanged:function(){this.fetchData();},fetchData:function(){when(this.getCurrentContent(),lang.hitch(this,function(item){if(!item){return;}this._destroyTooltips();if(item.accessMask&&!_e9a.hasAccess(item.accessMask,_e9a.accessLevel.Edit)||item.providerCapabilityMask&&!_e9a.hasProviderCapability(item.providerCapabilityMask,_e9a.providerCapabilities.Edit)){this._showErrorMessage(epi.resources.messages.nopermissiontoviewdata);this.set("isMultilingual",false);this._updateMenu(item);return;}var _ea5={contentLink:item.contentLink};if(!this._allLanguages){_ea5.language=this._currentContentLanguage;}this.grid.set("query",_ea5);this.set("isMultilingual",true);}));},_destroyTooltips:function(){_e80.forEach(this._tooltips,function(_ea6){_ea6.destroyRecursive();});this._tooltips=[];},_aroundRenderRow:function(_ea7){return lang.hitch(this,function(item){if(item.isCommonDraft){var _ea8=this._commonDrafts[item.language];if(_ea8&&_ea8!=item.contentLink){this._removeCommonDraft(_ea8);}this._commonDrafts[item.language]=item.contentLink;}var row=_ea7.apply(this.grid,arguments);_e84.toggle(row,"dgrid-row-published",item.status===_e9a.versionStatus.Published);this._createTooltip(item,row);return row;});},_onSelect:function(e){var item=e.rows[0].data;this._updateMenu(item);this.inherited(arguments);},_updateMenu:function(item){this._commonDraftCommand.set("model",item);this._deleteVersionCommand.set("model",item);when(this._contentStore.get(item.contentLink),lang.hitch(this,function(_ea9){if(_ea9&&_ea9.currentLanguageBranch){var _eaa=lang.replace(_e9c.deletelanguagebranch.label,[_ea9.currentLanguageBranch.name]),_eab=_e8c.getResourceValue(_ea9.typeIdentifier,"deletelanguagebranchdescription");lang.mixin(this._deleteLanguageBranchSettings,{confirmActionText:_eaa,description:lang.replace(_eab,[_e87.encode(_ea9.name),_ea9.currentLanguageBranch.name]),title:_eaa});this._deleteLanguageBranchCommand.set("label",_eaa);}this._deleteLanguageBranchCommand.set("model",_ea9);}));},_showNotificationMessage:function(_eac){var _ead=new _e91({title:_e9c.notificationtitle,description:_eac});_ead.show();},_selectCommonDraftVersion:function(uri){var _eae={uri:uri};_e86.publish("/epi/shell/context/request",_eae,{sender:null});},_onDeleteVersionSuccess:function(){var _eaf=new _e95(this.grid.get("query").contentLink);this._selectCommonDraftVersion("epi.cms.contentdata:///"+_eaf.createVersionUnspecificReference().toString());},_onDeleteVersionFailure:function(_eb0){if(!_eb0||!_eb0.status){return;}else{if(_eb0.status===403){this._showNotificationMessage(_e9c.deleteversion.cannotdeletepublished);}else{this._showNotificationMessage(_e9c.deleteversion.cannotdelete);}}},_onSetCommonDraftFailure:function(){this._showNotificationMessage(_e9c.setcommondraft.failuremessage);},_removeCommonDraft:function(_eb1){if(_eb1){var item=this.grid.row(_eb1).data;if(item){item.isCommonDraft=false;}}},_toggleFilterByLanguage:function(_eb2){when(this.getCurrentContext(),lang.hitch(this,function(_eb3){var _eb4={contentLink:_eb3.id};if(!_eb2){_eb4.language=this._currentContentLanguage;}this._toggleLanguage(_eb2);this.grid.set("query",_eb4);this._allLanguages=_eb2;}));},_toggleLanguage:function(_eb5){var _eb6=_eb5?"table-cell":"none";this.grid.styleColumn("language",_e85.substitute("display:${0};",[_eb6]));},_createTooltip:function(item,row){var _eb7=[{label:epi.resources.header.language,text:epi.resources.language[item.language]},{label:epi.resources.header.name,text:item.name},{label:epi.resources.header.status,text:_e9a.getVersionStatus(item.status)},{label:_e9c.saved,text:this._localizeDate(item.savedDate),htmlEncode:false},{label:_e9c.by,text:_e8b.toUserFriendlyString(item.savedBy,null,true)}];var _eb8=new _e90({connectId:row,tooltipRows:_eb7});this._tooltips.push(_eb8);}});});},"epi-cms/component/command/DeleteVersion":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_eb9,lang,when,_eba,_ebb,_ebc,_ebd,_ebe){return _eb9([_ebe],{label:_ebd.deletemenuitemtitle,iconClass:"epi-iconTrash",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_ebc.resolve("epi.storeregistry");this._content=this.storeRegistry.get("epi.cms.contentdata");this._versions=this.storeRegistry.get("epi.cms.contentversion");},_execute:function(){return this._versions.remove(this.model.contentLink);},_onModelChange:function(){if(_eba.disableVersionDeletion){this.set("isAvailable",false);return;}this.set("isAvailable",true);if(!this.model.allowToDelete){this.set("canExecute",false);return;}when(this._content.get(this.model.contentLink),lang.hitch(this,function(_ebf){var _ec0=_ebb.action,_ec1=_ebf&&_ebb.isActionAvailable(_ebf,_ec0.Delete);this.set("canExecute",_ec1);}));}});});},"epi-cms/component/command/DeleteLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/shell/command/_Command","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(_ec2,lang,when,_ec3,_ec4,_ec5,_ec6,_ec7,_ec8){return _ec2([_ec4,_ec5],{label:"",iconClass:"",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_ec3.resolve("epi.storeregistry");this._versions=this.storeRegistry.get("epi.cms.contentversion");this._structure=this.storeRegistry.get("epi.cms.content.light");},_execute:function(){var _ec9=_ec7.toContentReference(this.model.contentLink);return when(this._versions.remove(_ec9,{deleteLanguageBranch:true}),lang.hitch(this,function(){return this._structure.refresh(_ec9.id);}));},_onModelChange:function(){var _eca=this.model,_ecb=!!(_eca&&_eca.currentLanguageBranch&&_eca.capabilities.deleteLanguageBranch&&!_ec6.disableVersionDeletion),_ecc=_ecb&&!_eca.currentLanguageBranch.isMasterLanguage&&_ec8.isActionAvailable(_eca,_ec8.action.Delete);this.set("canExecute",_ecc);this.set("isAvailable",_ecb);}});});},"epi-cms/component/command/SetCommonDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_ecd,_ece,_ecf,_ed0,_ed1){return _ecd([_ed1],{label:_ed0.setcommondraftitemtitle,iconClass:"epi-iconPrimary",category:"context",constructor:function(){var _ed2=_ecf.resolve("epi.storeregistry");this.store=_ed2.get("epi.cms.contentversion");},_execute:function(){var self=this;return this.store.patch({isCommonDraft:true,contentLink:this.model.contentLink},{id:this.model.contentLink}).then(function(item){return self.store.patchCache(item);});},_onModelChange:function(){var _ed3=this.model,_ed4=_ece.versionStatus,_ed5=_ed3&&!_ed3.isCommonDraft&&(_ed3.status==_ed4.CheckedOut||_ed3.status==_ed4.Rejected);this.set("canExecute",_ed5);}});});},"epi-cms/contentediting/_Renderer":function(){define(["epi","dojo"],function(epi,dojo){return dojo.declare(null,{constructor:function(_ed6){dojo.mixin(this,_ed6);},render:function(_ed7,_ed8,_ed9,_eda){throw new Error("Abstract method _render must be overridden in a derived class");}});});},"epi-cms/contentediting/ContentDetails":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/url","dojo/_base/window","dojo/dom-style","dojo/dom-construct","dojo/on","dojo/topic","dijit/_TemplatedMixin","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","epi","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails","dojo/text!./templates/ContentDetails.html"],function(dojo,_edb,_edc,lang,url,win,_edd,_ede,on,_edf,_ee0,_ee1,_ee2,epi,_ee3,_ee4,_ee5,res,_ee6){return _edc([_ee1,_ee0,_ee2,_ee3],{templateString:_ee6,_setContentTypeNameAttr:{node:"typeNode",type:"innerHTML"},_setContentIdAttr:{node:"idNode",type:"innerHTML"},_setExistingLanguagesAttr:function(_ee7){this.languagesNode.innerHTML="";_edb.forEach(_ee7,function(item,idx){var elm,_ee8=idx===_ee7.length-1;if(item.isCurrentLanguage){elm=_ede.create("span",{innerHTML:item.urlSegment});}else{var url=new dojo._Url(window.top.location.href);elm=_ede.create("a",{innerHTML:item.urlSegment,href:[url.scheme,"://",url.authority,url.path,"?language=",item.text,"#context=epi.cms.contentdata:///",item.contentLink].join(""),"class":"epi-visibleLink"});}_ede.place(elm,this.languagesNode);if(!_ee8){_ede.place(win.doc.createTextNode(", "),this.languagesNode);}},this);},_setVisibleToAttr:function(_ee9){this.visibleToNode.innerHTML=_ee9?res.visibleto.everyone:res.visibleto.restricted;},_setManageAccessRightsVisibleAttr:function(_eea){_edd.set(this.manageAccessRightsButton.domNode,"display",_eea?"":"none");},resources:null,modelBindingMap:{"contentTypeName":["contentTypeName"],"contentId":["contentId"],"existingLanguages":["existingLanguages"],"visibleToEveryOne":["visibleTo"]},_menuAssembler:null,postMixInProperties:function(){this.inherited(arguments);this.resources=dojo.mixin({},epi.resources.action,res);},postCreate:function(){this.inherited(arguments);var _eeb=new _ee4();this._menuAssembler=new _ee5({configuration:[{builder:_eeb,target:this.additionalActionsMenu}],commandSource:this.model});this.dropdownButton.set("title",this.resources.toolsbutton.tooltip);},destroy:function(){if(this._menuAssembler){this._menuAssembler.destroy();}this.inherited(arguments);if(this.model){this.model.destroy();}},_setModelAttr:function(_eec){this.inherited(arguments);if(this._menuAssembler){this._menuAssembler.set("commandSource",this.model);}if(this.model&&this.model.accessRightsCommand){this.own(this.model.accessRightsCommand.watch("canExecute",lang.hitch(this,function(){this.set("manageAccessRightsVisible",this.model.accessRightsCommand.canExecute);})));}},_onManageAccessRightsClick:function(){if(this.model&&this.model.accessRightsCommand){this.model.accessRightsCommand.execute();}}});});},"url:epi-cms/contentediting/templates/ContentDetails.html":"<div class=\"epi-containerLayout\">\r\n    <ul>\r\n        <li class=\"epi-formsRow\">\r\n            <label>${resources.visibleto.title}</label>\r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <span data-dojo-attach-point=\"visibleToNode\" class=\"dijitInline\"></span>\r\n                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"manageAccessRightsButton\" data-dojo-attach-event=\"onClick: _onManageAccessRightsClick\" class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink epi-valign--top\">${resources.manage}</div>\r\n            </div>\r\n        </li>\r\n        <li class=\"epi-formsRow\">\r\n            <label>${resources.existinglanguages}</label>\r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <span data-dojo-attach-point=\"languagesNode\" class=\"dijitInline\"></span>\r\n            </div>\r\n        </li>\r\n        <li class=\"epi-formsRow\">\r\n            <label>${resources.idandtypename}</label> \r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <span data-dojo-attach-point=\"idNode\" class=\"dijitInline\"></span>, <span data-dojo-attach-point=\"typeNode\" class=\"dijitInline\"></span>\r\n            </div>\r\n        </li>\r\n        <li class=\"epi-formsRow\">\r\n            <label></label>\r\n            <div class=\"epi-formsWidgetWrapper\">\r\n                <div data-dojo-attach-point=\"dropdownButton\" data-dojo-type=\"dijit/form/DropDownButton\" class=\"dijit dijitReset dijitInline epi-mediumButton\">\r\n                    <span>${resources.toolsbutton.label}</span>\r\n                    <div data-dojo-type=\"dijit/DropDownMenu\" data-dojo-attach-point=\"additionalActionsMenu\"></div>\r\n                </div>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n</div>","epi-cms/contentediting/CreateContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-style","dojo/dom-class","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/StackContainer","epi/dependency","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/NewContentNameInputDialog","epi-cms/contentediting/viewmodel/CreateContentViewModel","epi-cms/widget/ContentTypeList","epi-cms/widget/PropertiesForm","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","dojo/text!./templates/CreateContent.html","epi/i18n!epi/nls/episerver.shared"],function(_eed,lang,_eee,_eef,_ef0,_ef1,when,_ef2,_ef3,_ef4,_ef5,_ef6,_ef7,_ef8,_ef9,_efa,_efb,_efc,_efd,_efe,_eff,_f00,_f01,_f02,_f03){return _eed([_ef5,_ef2,_ef3,_efa],{templateString:_f02,sharedResources:_f03,modelType:_efd,_contextService:null,_beingSuspended:null,modelBindingMap:{"parent":["parent"],"requestedType":["requestedType"],"metadata":["metadata"],"isContentTypeSelected":["isContentTypeSelected"],"headingText":["headingText"],"createAsLocalAssetHelpText":["createAsLocalAssetHelpText"],"contentName":["contentName"],"wizardStep":["wizardStep"],"showAllProperties":["showAllProperties"],"createAsLocalAsset":["createAsLocalAsset"],"seamlessTopPanel":["seamlessTopPanel"],"namePanelIsVisible":["namePanelIsVisible"],"headingPanelIsVisible":["headingPanelIsVisible"],"saveButtonIsVisible":["saveButtonIsVisible"],"saveButtonDisabled":["saveButtonDisabled"],"showCurrentNodeOnBreadcrumb":["showCurrentNodeOnBreadcrumb"],"notificationContext":["notificationContext"],"actualParentLink":["actualParentLink"],"propertyFilter":["propertyFilter"]},_setParentAttr:function(_f04){if(_f04){this.toolbar.setItemProperty("currentcontent","currentItemInfo",{name:_f04.name,dataType:_f04.typeIdentifier});}},_setPropertyFilterAttr:function(_f05){this._set("propertyFilter",_f05);this.propertiesForm.propertyFilter=_f05;},_setRequestedTypeAttr:function(_f06){this.contentTypeList.set("requestedType",_f06);},_setMetadataAttr:function(_f07){if(_f07){this.propertiesForm.set("metadata",_f07);}},_setHeadingTextAttr:function(_f08){this.headingTextNode.innerHTML=this.subHeadingTextNode.innerHTML=_f08;},_setCreateAsLocalAssetAttr:function(_f09){this._set("createAsLocalAsset",_f09);var _f0a=this.model.get("parent");if(_f0a){this.toolbar.setItemProperty("breadcrumbs","contentLink",_f09&&this.model.canChangeLocalAssetName?_f0a.assetsFolderLink:_f0a.contentLink);}},_setCreateAsLocalAssetHelpTextAttr:{node:"subHeadingDescNode",type:"innerHTML"},_setContentNameAttr:function(_f0b){this.nameTextBox.set("value",_f0b);},_setWizardStepAttr:function(_f0c){var _f0d;var _f0e;if(_f0c<0||_f0c===this.wizardStep){return;}_f0d=this.stackContainer.getChildren();if(_f0c<_f0d.length){_f0e=_f0d[_f0c];this.stackContainer.selectChild(_f0e);this._set("wizardStep",_f0c);}},_setShowAllPropertiesAttr:function(_f0f){this._set("showAllProperties",_f0f);this.propertiesForm.set("showAllProperties",_f0f);},_setSeamlessTopPanelAttr:function(_f10){_ef0.toggle(this.topPanel.domNode,"epi-listingTopContainer",_f10);},_setNamePanelIsVisibleAttr:function(_f11){_eef.set(this.namePanel,"display",_f11?"":"none");},_setHeadingPanelIsVisibleAttr:function(_f12){_eef.set(this.headingPanel,"display",_f12?"":"none");_eef.set(this.subHeadingPanel,"display",_f12?"none":"");},_setSaveButtonIsVisibleAttr:function(_f13){this.toolbar.setItemVisibility("saveButton",_f13);},_setSaveButtonDisabledAttr:function(_f14){this.toolbar.setItemProperty("saveButton","disabled",_f14);},_setShowCurrentNodeOnBreadcrumbAttr:function(show){this.toolbar.setItemProperty("breadcrumbs","showCurrentNode",show);this.toolbar.setItemVisibility("currentcontent",!show);},_setNotificationContextAttr:function(_f15){this.toolbar.setItemProperty("notificationCenter","notificationContext",_f15);},_setActualParentLinkAttr:function(_f16){this.contentTypeList.set("parentLink",_f16);},_setContentTypeNameAttr:{type:"innerHTML",node:"contentTypeNameNode"},postMixInProperties:function(){this.inherited(arguments);this.model=new this.modelType();this.own(this.model.on("saveSuccess",lang.hitch(this,this._onSaveSuccess)));this.own(this.model.on("saveError",lang.hitch(this,this._onSaveError)));this.own(this.model.on("invalidContentName",lang.hitch(this,this._onInvalidContentName)));},postCreate:function(){this.inherited(arguments);this._contextService=this._contextService||_ef9.resolve("epi.shell.ContextService");this._setupToolbar();},layout:function(){if(this._started){this.layoutContainer.resize(this._containerContentBox||this._contentBox);_ef0.add(this.stackContainer.domNode,"epi-animation-node-reset");}},updateView:function(data){this.view=data.view;this._setCreateMode();this._beingSuspended=false;this.set("contentTypeName","");when(this.model.update(data),lang.hitch(this,function(){this.layout();}),function(err){});},_onSaveSuccess:function(_f17){this._clearCreateMode();this._beingSuspended=true;if(_f17.changeContext){this._changeContext(_f17.newContentLink);}else{this._backToCurrentContext();}if(this.createAsLocalAsset===true){_ef1.publish("/epi/cms/action/createlocalasset");}},_onSaveError:function(){this._clearCreateMode();_ef1.publish("/epi/cms/action/showerror");},_onInvalidContentName:function(_f18){var _f19=new _efc({defaultContentName:_f18});var _f1a=new _efb({defaultActionsVisible:false,content:_f19,title:_f19.title,destroyOnHide:true});this.own(_eee.after(_f1a,"onExecute",lang.hitch(this,function(){var name=_f19.get("value");if(name===_f18){this.model.set("ignoreDefaultNameWarning",true);}this.model.set("contentName",name);this.model.save();}),true),_eee.after(_f1a,"onCancel",lang.hitch(this,function(){if(this.contentTypeList.shouldSkipContentTypeSelection){this._cancel();}else{this.model.set("isContentTypeSelected",false);}}),true));_f1a.show();},_onContentTypeSelected:function(item){if(!this.isContentTypeSelected){this.model.set("contentTypeId",item.id);this.set("contentTypeName",item.name);}},_onPropertyValidStateChange:function(_f1b,_f1c){if(_f1c){this.model.addInvalidProperty(_f1b,_f1c);}else{this.model.removeInvalidProperty(_f1b);}},_onContentNameChange:function(name){this.model.set("contentName",name);},_onSave:function(){if(this._beingSuspended){return;}this.propertiesForm.validate();this.model.set("properties",this.propertiesForm.get("value"));this.model.save();},_onCancel:function(){this._cancel();},_cancel:function(){this._clearCreateMode();this.model.cancel();this._backToCurrentContext();},_setupToolbar:function(){var _f1d=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _f1e=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{showCurrentNode:false}},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"},{parent:"trailing",name:"notificationCenter",widgetType:"epi-cms/widget/NotificationStatusBar"},{parent:"trailing",name:"saveButton",title:_f03.action.create,label:_f03.action.create,type:"button",action:lang.hitch(this,this._onSave),settings:{"class":"epi-boldButton Salt"}},{parent:"trailing",name:"cancelButton",title:_f03.action.cancel,label:_f03.action.cancel,type:"button",action:lang.hitch(this,this._onCancel),settings:{"class":"epi-boldButton"}}];when(this.toolbar.add(_f1d),lang.hitch(this,function(){this.toolbar.add(_f1e);}));},_changeContext:function(_f1f){_ef1.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_f1f},{sender:this,viewName:this.view,forceContextChange:true});},_backToCurrentContext:function(){_ef1.publish("/epi/shell/action/changeview/back");},_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{"currentMode":"create"});_ef1.publish("/epi/cms/action/togglecreatemode",true);},_clearCreateMode:function(){_ef0.remove(this.stackContainer.domNode,"epi-animation-node-reset");lang.mixin(this._contextService.currentContext,{"currentMode":undefined});_ef1.publish("/epi/cms/action/togglecreatemode",false);}});});},"epi-cms/contentediting/NewContentNameInputDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/TextBox","epi","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/NewContentNameInputDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.newcontentnamedialog"],function(_f20,lang,_f21,_f22,_f23,_f24,_f25,_f26,epi,_f27,_f28,_f29,_f2a,res){return _f20([_f23,_f24,_f25,_f29,_f27,_f22],{templateString:_f2a,res:res,defaultContentName:null,message:null,title:null,nameLabel:epi.resources.header.name,_setMessageAttr:{node:"messageNode",type:"innerHTML"},postMixInProperties:function(){this.inherited(arguments);this.message=lang.replace(this.res.warningtext,{defaultname:this.defaultContentName});this._set("message",this.message);this.title=res.title;},postCreate:function(){this.inherited(arguments);this.contentNameTextbox.set("value",this.defaultContentName);this.contentNameTextbox.on("focus",function(){this.focusNode.select();});this.contentNameTextbox.on("keyup",lang.hitch(this,function(evt){var _f2b=this.contentNameTextbox.isValid();if(evt.keyCode==dojo.keys.ENTER&&_f2b){this.executeDialog();}}));this.contentNameTextbox.focus();},_getValueAttr:function(){return this.contentNameTextbox.get("value");},getActions:function(){this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.contentNameTextbox.isValid()){this.executeDialog();}else{this.contentNameTextbox.focus();}})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"url:epi-cms/contentediting/templates/NewContentNameInputDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-attach-point=\"messageNode\"></div>\r\n    <br />\r\n    <div>\r\n        <label data-dojo-attach-point=\"contentNameLabelNode\">${nameLabel}</label>\r\n        <input type=\"text\" size=\"40\" maxlength=\"255\"  data-dojo-attach-point=\"contentNameTextbox\" data-dojo-type=\"dijit/form/ValidationTextBox\"\r\n                data-dojo-props=\"required: true, trim:true\"\r\n                missingMessage: \"${res.errormessage.missingmessage}\" />\r\n    </div>\r\n</div>","epi-cms/contentediting/viewmodel/CreateContentViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/Stateful","dojo/string","dojo/when","dojo/Evented","epi/dependency","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentEditingValidator","epi/i18n!epi/cms/nls/episerver.cms.components.requiredproperties"],function(_f2c,_f2d,lang,json,_f2e,_f2f,when,_f30,_f31,_f32,_f33,_f34,_f35){return _f2d([_f2e,_f30],{_topLevelContainerType:"epi/shell/layout/SimpleContainer",_groupContainerType:"epi-cms/layout/CreateContentGroupContainer",contentDataStore:null,metadataManager:null,typeIdentifierManager:null,validator:null,parent:null,contentTypeId:null,requestedType:null,createAsLocalAsset:null,canChangeLocalAssetName:null,addToDestination:null,wizardStep:0,startWizardStep:0,contentName:null,ignoreDefaultNameWarning:null,properties:null,headingText:null,createAsLocalAssetHelpText:null,namePanelIsVisible:null,headingPanelIsVisible:null,seamlessTopPanel:null,saveButtonIsVisible:null,saveButtonDisabled:null,showAllProperties:null,showCurrentNodeOnBreadcrumb:null,actualParentLink:null,metadata:null,postscript:function(){this.inherited(arguments);if(!this.contentDataStore){var _f36=_f31.resolve("epi.storeregistry");this.contentDataStore=_f36.get("epi.cms.contentdata");}this.metadataManager=this.metadataManager||_f31.resolve("epi.shell.MetadataManager");this.validator=this.validator||new _f34({contextTypeName:"epi.cms.contentdata"});this.set("propertyFilter",lang.hitch(this,this._propertyFilter));},update:function(_f37){this.set("ignoreDefaultNameWarning",false);this.set("properties",null);this.set("saveButtonIsVisible",false);this.set("wizardStep",this.startWizardStep);this.set("isContentTypeSelected",false);if(_f37){_f2c.forEach(["requestedType","parent","canChangeLocalAssetName","createAsLocalAsset","addToDestination","contentTypeId"],function(_f38){this.set(_f38,_f37[_f38]);},this);}if(this.parent){var _f39=this.parent.contentLink+"_new_content";this.validator.clearErrorsBySource();this.validator.setContextId(_f39);this.set("notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_f39});}},save:function(){this.set("saveButtonDisabled",true);if(!this.ignoreDefaultNameWarning&&(this.canChangeLocalAssetName||!this.createAsLocalAsset)&&(!this.contentName||this.contentName===""||this.contentName===this.defaultName)){this._emitSaveEvent("invalidContentName",this.contentName);return;}this.validator.clearErrorsBySource(this.validator.validationSource.server);when(this.validator.validate(),lang.hitch(this,function(_f3a){if(_f3a){this._emitSaveEvent("validationError");return;}var _f3b=this.buildContentObject();this.contentDataStore.put(_f3b).then(lang.hitch(this,this._saveSuccessHandler),lang.hitch(this,this._saveErrorHandler));}),lang.hitch(this,function(){this._emitSaveEvent("validationError");}));},_emitSaveEvent:function(_f3c,_f3d){this.set("saveButtonDisabled",false);this.emit(_f3c,_f3d);},cancel:function(){this.addToDestination&&(typeof this.addToDestination.cancel==="function")&&this.addToDestination.cancel();},_propertyFilter:function(_f3e,_f3f){var _f40=_f3f.originalGroupName!=="EPiServerCMS_SettingsPanel"&&_f3f.originalGroupName!=="Advanced";var _f41=this._isRequiredProperty(_f3e,_f3f);if(this.showAllProperties){return _f40||_f41;}else{return _f41;}},_saveSuccessHandler:function(_f42){var ref=new _f33(_f42),_f43=ref.createVersionUnspecificReference(),_f44=lang.hitch(this,function(_f45){this._emitSaveEvent("saveSuccess",{newContentLink:_f45,changeContext:true});});when(this.contentDataStore.refresh(_f42),lang.hitch(this,function(_f46){if(this.addToDestination){this.addToDestination.save({contentLink:_f43.toString(),name:_f46.name,typeIdentifier:this.requestedType});this._emitSaveEvent("saveSuccess",{changeContext:false});}else{_f44(_f43.toString());}}));},_saveErrorHandler:function(err){if(err&&err.responseText){var _f47=json.fromJson(err.responseText);_f2c.forEach(_f47,function(item){if(item.propertyName){this.validator.setPropertyErrors(item.propertyName,[{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}else{this.validator.setGlobalErrors([{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}},this);}else{if(err){this.validator.setGlobalErrors([{severity:this.validator.severity.error,errorMessage:err.message}],this.validator.validationSource.server);}}this._emitSaveEvent("saveError",err);},buildContentObject:function(){return {name:(!this.createAsLocalAsset||this.canChangeLocalAssetName)?_f2f.trim(this.contentName+""):null,parentLink:this.parent?this.parent.contentLink:null,contentTypeId:this.contentTypeId,properties:this.properties,createAsLocalAsset:this.createAsLocalAsset};},addInvalidProperty:function(_f48,_f49){this.validator.setPropertyErrors(_f48,[{severity:this.validator.severity.error,errorMessage:_f49}],this.validator.validationSource.client);},removeInvalidProperty:function(_f4a){this.validator.clearPropertyErrors(_f4a);},_contentTypeIdSetter:function(_f4b){this.contentTypeId=_f4b;if(_f4b&&this.parent){this.set("isContentTypeSelected",true);when(this._getMetadata(this.parent.contentLink,_f4b),lang.hitch(this,function(_f4c){if(!this.canChangeLocalAssetName||this._hasRequiredProperties(_f4c)){_f4c=this._regroupProperties(_f4c);this.set("metadata",_f4c);this.set("wizardStep",1);this.set("saveButtonIsVisible",true);}else{this.save();}}));}},_canChangeLocalAssetNameSetter:function(_f4d){this.canChangeLocalAssetName=_f4d==null?true:_f4d;},_createAsLocalAssetSetter:function(_f4e){var _f4f=this.canChangeLocalAssetName||!_f4e;this.set("namePanelIsVisible",_f4f);this.set("headingPanelIsVisible",_f4f);this.set("showAllProperties",!this.canChangeLocalAssetName);this.set("showCurrentNodeOnBreadcrumb",_f4f);this.set("seamlessTopPanel",_f4f);if(this.parent){this.set("actualParentLink",_f4e?this.parent.assetsFolderLink:this.parent.contentLink);}this.createAsLocalAsset=_f4e;},_parentSetter:function(_f50){this.parent=_f50;var _f51=this.parent.typeIdentifier,_f52=_f32.getResourceValue(this.requestedType,"name"),_f53=_f32.getResourceValue(_f51,"name"),_f54=_f32.getResourceValue(_f51,"createaslocalassethelptext");if(_f52&&_f53){_f54=lang.replace(_f54,[_f52.toLowerCase(),_f53.toLowerCase()]);}this.set("createAsLocalAssetHelpText",_f54);},_requestedTypeSetter:function(_f55){var _f56=_f32.getResourceValue(_f55,"create"),_f57=_f32.getResourceValue(_f55,"newitemdefaultname");this.defaultName=_f57;this.set("headingText",_f56);this.set("contentName",_f57);this.requestedType=_f55;},_hasRequiredProperties:function(_f58){return _f2c.some(_f58.properties,function(_f59){return this._isRequiredProperty(_f58,_f59);},this);},_isRequired:function(_f5a){return _f5a.settings&&_f5a.settings.required;},_isRequiredProperty:function(_f5b,_f5c){var _f5d=!_f5c.additionalValues.hasValue;var _f5e=_f5c.showForEdit&&_f2c.every(_f5b.groups,function(_f5f){return (_f5f.name!==_f5c.groupName&&_f5f.name!==_f5c.originalGroupName)||_f5f.displayUI;});var _f60=_f2c.some(_f5c.properties,function(_f61){return this._isRequiredProperty(_f5c,_f61);},this);return (this._isRequired(_f5c)||_f60)&&_f5d&&_f5e&&(_f5c.name!=="icontent_name");},_regroupProperties:function(_f62){_f62=lang.clone(_f62);_f62.layoutType=this._topLevelContainerType;_f2c.forEach(_f62.properties,function(prop){var _f63=this._isRequiredProperty(_f62,prop);prop.originalGroupName=prop.groupName;prop.groupName=_f63?"required":"additional";},this);_f62.groups=[{name:"required",displayUI:true,title:_f35.groups.required,uiType:this._groupContainerType},{name:"additional",displayUI:true,title:_f35.groups.additional,uiType:this._groupContainerType}];return _f62;},_getMetadata:function(_f64,_f65){return this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{parentLink:_f64,contentTypeId:_f65});}});});},"epi-cms/contentediting/ContentEditingValidator":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/connect","dojo/store/Memory","dojo/Stateful","epi/dependency"],function(dojo,_f66,_f67,_f68,lang,_f69,_f6a,_f6b,_f6c){return _f67([_f6b],{contextTypeName:"",contextId:null,messageService:null,_isBlocking:false,isValid:true,hasErrors:false,_storeId:0,_store:null,severity:{"none":0,"info":1,"warn":2,"error":3},validationSource:{"server":1,"client":2},_errorLevels:{},constructor:function(_f6d){_f67.safeMixin(this,_f6d);},postscript:function(){this.inherited(arguments);for(var p in this.severity){var _f6e=this.severity[p];this._errorLevels[_f6e]=p;}this.messageService=this.messageService||_f6c.resolve("epi.shell.MessageService");this._store=new _f6a({idAttribute:"id",data:[]});},setContextId:function(_f6f){var _f70=this.contextId;this.contextId=_f6f;var _f71=this.messageService.query({contextTypeName:this.contextTypeName,contextId:_f70});_f71.forEach(lang.hitch(this,function(item){item.contextId=this.contextId;this.messageService.put(item);}));},clearPropertyErrors:function(_f72,_f73){if(!_f72){return;}this._clearErrors(_f72,_f73);},setPropertyErrors:function(_f74,_f75,_f76){if(!_f74){return;}this._setErrors(_f75,_f74,_f76);},clearGlobalErrors:function(_f77){this._clearErrors(null,_f77);},clearErrorsBySource:function(_f78){this._clearErrors(undefined,_f78);},setGlobalErrors:function(_f79,_f7a){this._setErrors(_f79,null,_f7a);},_clearErrors:function(_f7b,_f7c){var _f7d;if(_f7b){_f7d={"propertyName":_f7b};}else{if(_f7b===null){_f7d={"global":true};}else{_f7d={};}}if(_f7c){_f7d.source=_f7c;}var _f7e=this._store.query(_f7d);_f7e.forEach(lang.hitch(this,function(item){this.messageService.remove({id:item.messageId});this._store.remove(item.id);}));this._updateFlags();},_setErrors:function(_f7f,_f80,_f81){this._clearErrors(_f80,_f81);_f66.forEach(_f7f,function(item){this._putStoreItem(item,_f80,_f81);},this);this._updateFlags();},_putStoreItem:function(item,_f82,_f83){var _f84="";if(this._errorLevels[item.severity]){_f84=this._errorLevels[item.severity];}var _f85=this.messageService.put(_f84,item.errorMessage,this.contextTypeName,this.contextId);var _f86={"id":this._storeId++,"item":item,"severity":item.severity,"messageId":_f85};if(_f82){_f86.propertyName=_f82;}else{_f86.global=true;}if(_f83!==undefined){_f86.source=_f83;}return this._store.put(_f86);},_updateFlags:function(){var _f87=this._store.query({"severity":this.severity.error});var _f88=this._store.query({"severity":this.severity.warn});var _f89=_f87.length===0&&_f88.length===0;var _f8a=_f87.length>0;this.set("isValid",_f89);this.set("hasErrors",_f8a);},validate:function(){var _f8b=this.severity.error,_f8c=this.severity.warn,_f8d=new _f68();_f68.when(this._validate(_f8b),function(_f8e){if(_f8e){_f69.publish("/epi/cms/action/showerror");}_f8d.resolve(_f8e);},function(){_f69.publish("/epi/cms/action/showerror");_f8d.reject();});return _f8d;},_validate:function(_f8f){var _f90=new _f68();if(!this._isBlocking){_f68.when(this._store.query({"severity":_f8f}),lang.hitch(this,function(_f91){var _f92=_f66.filter(_f91,function(item){return item.source==this.validationSource.client;},this);var _f93=_f92.length>0;var _f94=_f91.length>_f92.length;if(_f93){_f90.reject();}else{_f90.resolve(_f94);}}));}return _f90;}});});},"epi-cms/widget/ContentTypeList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Deferred","dojo/promise/all","dojo/when","dijit/layout/_LayoutWidget","epi/dependency","epi/shell/TypeDescriptorManager","epi-cms/widget/ContentTypeGroup","epi/i18n!epi/cms/nls/episerver.cms.widget.contenttypelist"],function(_f95,_f96,lang,_f97,_f98,all,when,_f99,_f9a,_f9b,_f9c,i18n){return _f96([_f99],{store:null,parentLink:null,groups:null,requestedType:null,shouldSkipContentTypeSelection:null,postMixInProperties:function(){this.inherited(arguments);this.groups={};if(!this.store){var _f9d=_f9a.resolve("epi.storeregistry");this.store=_f9d.get("epi.cms.contenttype");}},buildRendering:function(){this.inherited(arguments);var _f9e=new _f9c();this.connect(_f9e,"onSelect",function(item){this.onContentTypeSelected(item);});this.addChild(_f9e);this._suggestedContentTypes=_f9e;},refresh:function(){this.clear();this._setupWidgetTemplate();when(all({types:this._getSuggestedContentTypes(this.requestedType),groups:this._groupContentTypes()}),lang.hitch(this,function(_f9f){var _fa0=_f9f.types,_fa1=_f9f.groups,_fa2=_fa1.grouped,_fa3=_fa1.contentTypes;if(_fa0.length<=0){this._suggestedContentTypes.setVisibility(false);}else{_f97.add(this._suggestedContentTypes.titleNode,"epi-ribbonHeaderSpecial");this._suggestedContentTypes.set("title",this._suggestedTypesTitle);this._suggestedContentTypes.set("contentTypes",_fa0);this._suggestedContentTypes.setVisibility(true);}var key,_fa4;for(key in _fa2){_fa4=this._getOrCreateGroup(key);_fa4.set("contentTypes",_fa2[key]);}if(_fa3 instanceof Array&&_fa3.length===1){this.setVisibility(false);this.set("shouldSkipContentTypeSelection",true);this.onContentTypeSelected(_fa3[0]);}else{this.set("shouldSkipContentTypeSelection",false);}}));},setVisibility:function(_fa5){this.getChildren().forEach(function(_fa6){_fa6.setVisibility(_fa5);},this);},_setupWidgetTemplate:function(){this._suggestedTypesTitle=_f9b.getResourceValue(this.requestedType,"suggestedtypes");this._otherTypesTitle=_f9b.getResourceValue(this.requestedType,"othertypes");},clear:function(){this._suggestedContentTypes.clear();for(var key in this.groups){this.groups[key].destroyRecursive();delete this.groups[key];}},_getOrCreateGroup:function(name){var _fa7=this.groups[name];if(!_fa7){_fa7=new _f9c({title:name});this.connect(_fa7,"onSelect",function(item){this.onContentTypeSelected(item);});this.addChild(_fa7);this.groups[name]=_fa7;}return _fa7;},_getAvailableContentTypes:function(type){return this.store.query({query:"getavailablecontenttypes",parentReference:this.parentLink,requestedTypes:[type]});},_getSuggestedContentTypes:function(type){return this.store.query({query:"getsuggestedcontenttypes",parentReference:this.parentLink,requestedTypes:[type]});},_groupContentTypes:function(){var _fa8={},_fa9=new _f98(),_faa=this._otherTypesTitle;when(this._getAvailableContentTypes(this.requestedType),lang.hitch(this,function(_fab){var _fac=_fab.length;_f95.forEach(_fab,function(item){when(item,function(type){var _fad=type.groupName||_faa,_fae=_fa8[_fad]||[];_fae.push(type);_fa8[_fad]=_fae;_fac--;if(_fac===0){_fa9.resolve({grouped:_fa8,contentTypes:_fab});}});});}));return _fa9;},_setParentLinkAttr:function(_faf){this._set("parentLink",_faf);if(this.requestedType){this.refresh();}},_setRequestedTypeAttr:function(_fb0){this._set("requestedType",_fb0);},onContentTypeSelected:function(){}});});},"epi-cms/widget/ContentTypeGroup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-style","dojo/text!./templates/ContentTypeGroup.html","dijit/_TemplatedMixin","dijit/layout/_LayoutWidget","epi-cms/widget/ContentType","dojo/keys","dijit/_KeyNavContainer"],function(_fb1,lang,_fb2,_fb3,_fb4,_fb5,_fb6,_fb7,keys,_fb8){return _fb1([_fb6,_fb5,_fb8],{title:"",contentTypes:null,templateString:_fb4,buildRendering:function(){this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.render();this.connectKeyNavHandlers(this.isLeftToRight()?[keys.LEFT_ARROW,keys.UP_ARROW]:[keys.RIGHT_ARROW,keys.DOWN_ARROW],this.isLeftToRight()?[keys.RIGHT_ARROW,keys.DOWN_ARROW]:[keys.LEFT_ARROW,keys.UP_ARROW]);},render:function(){this.clear();_fb2.forEach(this.contentTypes,function(type){var _fb9=new _fb7({contentType:type});this.connect(_fb9,"onSelect",this.onSelect);this.addChild(_fb9);},this);},clear:function(){_fb2.forEach(this.getChildren(),function(_fba){this.removeChild(_fba);_fba.destroyRecursive();},this);},_setTitleAttr:{node:"titleNode",type:"innerText"},_setContentTypesAttr:function(_fbb){this._set("contentTypes",_fbb);if(this._created){this.render();}},onSelect:function(){},setVisibility:function(_fbc){var _fbd=(_fbc?"block":"none");_fb3.set(this.domNode,"display",_fbd);}});});},"url:epi-cms/widget/templates/ContentTypeGroup.html":"<div class=\"epi-listingContainer\" data-dojo-attach-point=\"focusNode\" tabIndex=\"${tabIndex}\">\r\n    <h2 data-dojo-attach-point=\"titleNode\" class=\"epi-ribbonHeader\"></h2>\r\n    <ul data-dojo-attach-point=\"containerNode\" class=\"epi-advancedListing\"></ul>\r\n</div>","epi-cms/widget/ContentType":function(){define(["dojo","dojo/dom-class","dojo/string","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.pagetype","dojo/text!./templates/ContentType.html"],function(dojo,_fbe,_fbf,_fc0,_fc1,_fc2,i18n,_fc3){return dojo.declare([_fc1,_fc2],{templateString:_fc3,contentType:null,iconTemplate:"<img src=\"${0}\" alt=\"${1}\" class=\"epi-preview\" />",emptyIconTemplate:_fbf.substitute("<div class=\"epi-noPreviewIcon\"><span class=\"epi-noPreview\">${0}</span></div>",[i18n.nopreview]),buildRendering:function(){this.inherited(arguments);this.connect(this.domNode,"onclick",this._onClick);this.render();},render:function(){var type=this.contentType;if(type){this.set("name",type.localizedName);this.set("description",type.localizedDescription||i18n.nodescription);this.set("icon",type.imagePath);}},_setContentTypeAttr:function(_fc4){this._set("contentType",_fc4);if(this._created){this.render();}},_setNameAttr:{node:"nameNode",type:"innerText"},_setDescriptionAttr:{node:"descriptionNode",type:"innerText"},_setIconAttr:function(_fc5){this._set("icon",_fc5);this.iconNode.innerHTML=_fc5?_fbf.substitute(this.iconTemplate,[_fc5,this.name]):this.emptyIconTemplate;},focus:function(){this.inherited(arguments);_fbe.add(this.focusNode,"epi-advancedListingItemActive");_fc0.focus(this.focusNode);},_onBlur:function(){this.inherited(arguments);_fbe.remove(this.focusNode,"epi-advancedListingItemActive");},_onKeyPress:function(e){if(e.keyCode===13||e.keyCode===32){this.onSelect(this.contentType);}},_onClick:function(){this.onSelect(this.contentType);},_onMouseOver:function(){_fbe.add(this.focusNode,"epi-advancedListingItemActive");},_onMouseOut:function(){_fbe.remove(this.focusNode,"epi-advancedListingItemActive");},onSelect:function(item){}});});},"url:epi-cms/widget/templates/ContentType.html":"<li class=\"clearfix\" data-dojo-attach-event=\"onkeypress:_onKeyPress, onmouseover:_onMouseOver, onmouseout:_onMouseOut\" data-dojo-attach-point=\"focusNode\">\r\n    <div class=\"epi-browserWindow\"><div class=\"epi-browserWindowContent\" data-dojo-attach-point=\"iconNode\">${emptyIconTemplate}</div></div>\r\n    <h3 data-dojo-attach-point=\"nameNode\"></h3>\r\n    <p data-dojo-attach-point=\"descriptionNode\"></p>\r\n</li>","epi-cms/widget/PropertiesForm":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/layout/_LayoutWidget","epi/shell/widget/FormContainer"],function(_fc6,_fc7,lang,when,_fc8,_fc9){return _fc7([_fc8],{metadata:null,showAllProperties:false,propertyFilter:null,_setMetadataAttr:function(_fca){this._set("metadata",_fca);this._setupForm();},_setupForm:function(){if(this._form){this._form.destroy();}this._form=new _fc9({metadata:this.metadata,doLayout:false,propertyFilter:lang.hitch(this,this.propertyFilter)});this.connect(this._form,"onFieldCreated",function(_fcb,_fcc){this.own(_fcc.watch("state",lang.hitch(this,function(name,_fcd,_fce){if(_fcd==="Error"&&_fce!=="Error"){this.onPropertyValidStateChange(_fcb);}else{if(_fcd!=="Error"&&_fce==="Error"){this.onPropertyValidStateChange(_fcb,_fcc.getErrorMessage());}}})));});this._form.placeAt(this.domNode);this.own(this._form);},validate:function(){return this._form.validate();},onPropertyValidStateChange:function(_fcf,_fd0){},_getValueAttr:function(){return this._form.get("value");}});});},"epi-cms/widget/BreadcrumbCurrentItem":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/Evented","dojo/topic","dojo/dom-construct","dijit/_TemplatedMixin","dijit/_WidgetBase","epi/string","epi/shell/TypeDescriptorManager","dojo/text!./templates/BreadcrumbCurrentItem.html"],function(_fd1,_fd2,_fd3,_fd4,_fd5,_fd6,_fd7,_fd8,_fd9,_fda){return _fd1([_fd7,_fd6],{templateString:_fda,_currentIconClass:null,_setCurrentItemInfoAttr:function(_fdb){if(!_fdb){return;}this.heading.innerHTML=_fd8.encodeForWebString(_fdb.name);if(_fdb.dataType){var _fdc=_fd9.getValue(_fdb.dataType,"iconClass");if(_fdc&&_fdc!==this._currentIconClass){_fd2.remove(this.iconNode,this._currentIconClass);_fd2.add(this.iconNode,_fdc);this._currentIconClass=_fdc;}}}});});},"url:epi-cms/widget/templates/BreadcrumbCurrentItem.html":"<div>\r\n    <div class=\"epi-breadCrumbs-title-wrapper\"><span data-dojo-attach-point=\"iconNode\" class=\"dijitInline dijitIcon epi-breadCrumbsCurrentItem-icon\"></span><h1 data-dojo-attach-point=\"heading\" class=\"epi-breadcrumbContentItem dojoxEllipsis\"></h1></div>\r\n</div>","url:epi-cms/contentediting/templates/CreateContent.html":"<div class=\"epi-createContent\">\r\n    <div data-dojo-attach-point=\"layoutContainer\" data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\">\r\n        <div class=\"epi-static-node\" data-dojo-attach-point=\"topPanel\" data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props=\"region:'top'\">\r\n            <div data-dojo-attach-point=\"headingPanel\">\r\n                <h1><span data-dojo-attach-point=\"headingTextNode\"></span>:&nbsp;<span data-dojo-attach-point=\"contentTypeNameNode\"></span></h1>\r\n            </div>\r\n            <div data-dojo-attach-point=\"toolbar\" class=\"epi-localToolbar epi-viewHeaderContainer\" data-dojo-type=\"epi/shell/widget/ToolbarSet\" data-dojo-props=\"region:'top'\"></div>\r\n            <div data-dojo-attach-point=\"namePanel\">\r\n                <label>${sharedResources.header.name}</label>\r\n                <input data-dojo-attach-point=\"nameTextBox\" data-dojo-type=\"dijit/form/ValidationTextBox\" data-dojo-attach-event=\"onChange: _onContentNameChange\" maxlength=\"255\" />\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-newContentContainer epi-animation-node\" data-dojo-attach-point=\"stackContainer\" data-dojo-type=\"dijit/layout/StackContainer\" data-dojo-props=\"region: 'center'\">\r\n            <div data-dojo-attach-point=\"contentTypeList\" data-dojo-type=\"epi-cms/widget/ContentTypeList\" data-dojo-attach-event=\"onContentTypeSelected: _onContentTypeSelected\">\r\n                <div data-dojo-attach-point='subHeadingPanel' class=\"push-padding--left\">\r\n                    <h1 data-dojo-attach-point=\"subHeadingTextNode\"></h1>\r\n                    <p data-dojo-attach-point=\"subHeadingDescNode\"></p>\r\n                </div>\r\n            </div>\r\n            <div data-dojo-attach-point=\"propertiesForm\" data-dojo-type=\"epi-cms/widget/PropertiesForm\" data-dojo-attach-event=\"onPropertyValidStateChange: _onPropertyValidStateChange\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/contentediting/CreateLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/CreateContent","epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel"],function(_fdd,lang,_fde,_fdf){return _fdd([_fde],{modelType:_fdf,_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{"currentMode":"translate"});}});});},"epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/contentediting/viewmodel/CreateContentViewModel"],function(_fe0,lang,when,_fe1){return _fe0([_fe1],{languageBranch:null,masterLanguageVersionId:null,postscript:function(){this.wizardStep=1;this.startWizardStep=1;this.inherited(arguments);},update:function(_fe2){var _fe3=_fe2.contentData;var _fe4=_fe2.languageBranch;return when(this.contentDataStore.get(_fe3.parentLink),lang.hitch(this,function(_fe5){var _fe6=_fe1.prototype.update.apply(this,[{requestedType:_fe3.typeIdentifier,parent:_fe5,contentTypeId:_fe3.contentTypeID}]);this.set("languageBranch",_fe4);this.set("masterLanguageVersionId",_fe3.contentLink);this.set("contentName",_fe3.name);return _fe6;}));},_isRequired:function(_fe7){return this.inherited(arguments)&&(!this.languageBranch||_fe7.settings.isLanguageSpecific===true);},buildContentObject:function(){var _fe8=this.inherited(arguments);lang.mixin(_fe8,{languageBranch:this.languageBranch,masterLanguageVersionId:this.masterLanguageVersionId});return _fe8;}});});},"epi-cms/contentediting/DateTimeNowEditor":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/text!./templates/DateTimeNowEditor.html","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Tooltip","epi/shell/widget/_ValueRequiredMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.datetimenow"],function(_fe9,_fea,lang,_feb,_fec,_fed,_fee,_fef,_ff0,_ff1,_ff2){return _fea([_fed,_fee,_fef,_ff1],{templateString:_fec,value:null,resources:_ff2,_selectorWatchHandle:null,postCreate:function(){this.inherited(arguments);this._selectorWatchHandle=this.dateTimeSelector.watch("value",lang.hitch(this,function(_ff3,_ff4,_ff5){this.onChange(_ff5);}));},onChange:function(_ff6){this.validate();},validate:function(){var _ff7=this.inherited(arguments);if(_ff7){var _ff8=this.get("value");_ff7=this.disabled||!_ff8||!this.minimumValue||_ff8>this.minimumValue;this._set("state",_ff7?"":"Error");if(_ff7){_ff0.hide(this.domNode);}else{_ff0.show(this.minimumValueMessage,this.domNode);}}return _ff7;},_setValueAttr:function(_ff9){this.dateTimeSelector.set("value",_ff9);this._set("value",_ff9);},_getValueAttr:function(){return this.dateTimeSelector.get("value");},_onExpireNowClick:function(){this.set("value",new Date());},destroy:function(){if(this._selectorWatchHandle){this._selectorWatchHandle.unwatch();}_ff0.hide(this.domNode);}});});},"url:epi-cms/contentediting/templates/DateTimeNowEditor.html":"<div class=\"dijitInline dijitInputContainer\">\r\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\"></div\r\n    ><a class=\"epi-visibleLink\" style=\"padding-left:10px\" data-dojo-attach-event=\"onclick:_onExpireNowClick\">${resources.now}</a>\r\n</div>","epi-cms/contentediting/DialogEditorWrapper":function(){define(["epi","dojo","epi-cms/contentediting/_EditorWrapperBase","epi/shell/widget/dialog/Dialog"],function(epi,dojo,_ffa,_ffb){return dojo.declare([_ffa],{closeOnChange:true,showButtons:false,_dialog:null,buildRendering:function(){this.inherited(arguments);if(!this.editorWidget){dojo["require"](this.editorWidgetType);var cls=dojo.getObject(this.editorWidgetType);var _ffc=this.editorParams||{};if("displayedValue" in cls.prototype||"value" in cls.prototype){_ffc["displayedValue" in cls.prototype?"displayedValue":"value"]=this.value;}this.editorWidget=new cls(_ffc);}var ew=this.editorWidget;var _ffd=new _ffb({content:ew,title:this.propertyDisplayName,defaultActionsVisible:this.showButtons,contentClass:"epi-dialog-fullWidth"});this.connect(ew,"onKeyPress",this._onKeyPress);this.connect(ew,"onCancel",this._onCancel);this.connect(ew,"onResize",dojo.hitch(this,function(){this._dialog.resize();}));if("intermediateChanges" in ew){ew.set("intermediateChanges",true);}this.connect(ew,"onChange","_onChange");this.connect(_ffd,"onHide",this._onHide);this.connect(_ffd,"onCancel",this._onCancel);this._dialog=_ffd;},destroy:function(){this._dialog.destroyRecursive();this.inherited(arguments);},_onKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode==dojo.keys.ESCAPE){dojo.stopEvent(e);this.cancel();}else{if(e.keyCode==dojo.keys.ENTER&&e.target.tagName=="INPUT"){dojo.stopEvent(e);this._stopEdit();}}}},_onCancel:function(){this.cancel();this.editorWidget.set("value",this.value);if(this._dialog.open){this._dialog.hide();}},_onChange:function(){this.inherited(arguments);if(this.closeOnChange){this._stopEdit();}},_onHide:function(){if(this.editing){this._stopEdit();}},startEdit:function(){this.inherited(arguments);this._dialog.show();},_stopEdit:function(){this.inherited(arguments);if(this._dialog.open){this._dialog.hide();}},_setTitleAttr:function(_ffe){if(this._dialog){this._dialog.set("title",_ffe);}this._set("title",_ffe);}});});},"epi-cms/contentediting/_EditorWrapperBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/_Widget","epi/epi"],function(_fff,lang,_1000,epi){return _fff([_1000],{wrapperType:"",editorWidgetType:null,editorParams:null,editing:false,disabled:false,blockDisplayNode:null,editorWidget:null,isModified:false,_resetValue:null,_lastSavedValue:null,_createdEditor:false,propertyName:"",propertyDisplayName:"",overlayItem:null,isOverlayDisabled:false,isUndoDisabled:false,hasInlineEditor:false,contentModel:null,onStartEdit:function(_1001,data){},onValueChange:function(_1002,value,_1003){},onCancel:function(_1004){},onStopEdit:function(_1005,value,_1006){},postCreate:function(){this.inherited(arguments);this._contentModelWatchHandle=this.contentModel.watch(this.propertyName,lang.hitch(this,"contentModelChanged"));},destroy:function(){this._contentModelWatchHandle.unwatch();if(this._createdEditor&&this.editorWidget){this.editorWidget.destroyRecursive();}if(this.editorWidget){this.editorWidget.parent=null;}this.blockDisplayNode=this.overlayItem=this.editorWidget=null;this.inherited(arguments);},contentModelChanged:function(name,_1007,value){if(!this.editing){this.set("value",value);}},startEdit:function(_1008){this._startEdit(_1008);},_startEdit:function(_1009){lang.mixin(this.editorParams,_1009);this.set("editing",true);this.set("isModified",false);this._lastSavedValue=this._resetValue=lang.clone(this.getEditorValue());this.isValid();this.onStartEdit(this,this.editorParams);},_stopEdit:function(_100a){this.set("editing",false);this._removeEditingFeatures();this.onStopEdit(this,this.getEditorValue(),this._resetValue,_100a);},cancel:function(){if(this.isModified){this.save(this._resetValue);}else{this.set("value",this._resetValue);}this.set("editing",false);this._removeEditingFeatures();this.onCancel(this);},save:function(val){this.set("value",val);this.set("isModified",true);this.onValueChange(this,val,this._lastSavedValue);this._lastSavedValue=lang.clone(val);},hasBeenEdited:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._resetValue));},hasPendingChanges:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._lastSavedValue));},tryToStopEditing:function(_100b){if(this.editing){if(this.isValid()){if(this.hasBeenEdited()){if(this.hasPendingChanges()){this.save(this.getEditorValue());}this._stopEdit(_100b);}else{this.cancel(_100b);}}else{this._onTryToStopWithInvalidValue();}}},_removeEditingFeatures:function(){},_onTryToStopWithInvalidValue:function(){},_onEditorKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode==dojo.keys.ESCAPE){dojo.stopEvent(e);this.cancel();}else{if(e.keyCode==dojo.keys.ENTER&&e.target.tagName=="INPUT"){dojo.stopEvent(e);this.tryToStopEditing(false);}}}},_onChange:function(val){if(this.editing&&this.isValid()&&this.hasPendingChanges()){this.save(val);}},getEditorWidget:function(){return this.editorWidget;},getEditorValue:function(){var ew=this.editorWidget;if(ew){return ew.get("value");}return null;},setEditorValue:function(val){var ew=this.editorWidget;if(ew&&!epi.areEqual(val,ew.get("value"))){ew.set("value",val);}},_setValueAttr:function(value){this.setEditorValue(value);this._set("value",this.getEditorValue()||value);},isValid:function(){return (this.editorWidget&&this.editorWidget.isValid?this.editorWidget.isValid():true);},focus:function(){this.editorWidget.focus();setTimeout(lang.hitch(this,function(){if(this.editorWidget.focusNode&&this.editorWidget.focusNode.tagName=="INPUT"){dijit.selectInputText(this.editorWidget.focusNode);}}),0);}});});},"epi-cms/contentediting/EditActionPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/DropDownButton","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/PublishMenu","epi/shell/widget/_ModelBindingMixin","epi/string","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel","dojo/text!./templates/EditActionPanel.html"],function(_100c,lang,_100d,_100e,_100f,_1010,_1011,_1012,_1013,_1014,_1015,_1016,_1017,_1018,res,_1019){return _100c([_1012,_1011,_1013,_1010,_1017],{templateString:_1019,commonRes:epi.resources,baseClass:"epi-statusIndicator",modelBindingMap:{"state":["state"],"statusText":["statusText"],"visible":["visible"],"buttonText":["buttonText"],"nonEditableIndicator":["nonEditableIndicator"],"statusIcon":["statusIcon"],"publishMenuViewModel":["publishMenuViewModel"],"additionalClass":["additionalClass"],"expanded":["expanded"]},_setStatusTextAttr:function(_101a){this._set("statusText",_101a);this._setStatusNodeText(_101a);},_setStatusNodeText:function(_101b){this.statusTextNode.innerHTML=_101b;_100f.set(this.stateNode,"title",!this.expanded?_1018.stripHtmlTags(_101b):"");},_setButtonTextAttr:function(val){this.dropDownButton.set("label",val);},_setVisibleAttr:function(val){_100d.set(this.domNode,"visibility",val?"visible":"hidden");},_setExpandedAttr:function(_101c){this._set("expanded",_101c);this._setStatusNodeText(this.statusText);},_setNonEditableIndicatorAttr:function(val){if(val){_100e.add(this.statusNonEditableIcon,"epi-iconPenDisabled");}else{_100e.remove(this.statusNonEditableIcon,"epi-iconPenDisabled");}},_setStatusIconAttr:function(val){_100d.set(this.statusTextIcon,"class","dijitInline dijitReset dijitIcon "+val);},_setAdditionalClassAttr:function(val){var _101d=this.get("additionalClass");if(_101d){_100e.remove(this.stateNode,_101d);}this._set("additionalClass",val);_100e.add(this.stateNode,val);},focus:function(){this.dropDownButton.focus();},_setPublishMenuViewModelAttr:function(val){this.dropDownMenu.set("model",val);},postCreate:function(){this.inherited(arguments);this.dropDownButton.dropDownPosition=["below-alt"];}});});},"epi-cms/contentediting/PublishMenu":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/html","dojo/on","dojo/sniff","dojo/Stateful","dojo/when","dijit/DropDownMenu","dijit/_KeyNavContainer","dijit/_WidgetsInTemplateMixin","epi","epi/shell/TypeDescriptorManager","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/Downloader","epi-cms/contentediting/ContentActionSupport","dojo/text!./templates/PublishMenu.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(array,_101e,event,lang,_101f,_1020,_1021,_1022,html,on,sniff,_1023,when,_1024,_1025,_1026,epi,_1027,_1028,_1029,_102a,_102b,_102c,res){return _101e([_1024,_1026,_1028],{templateString:_102c,res:res,_menuBuilder:null,commands:null,mainButtonCommand:null,postMixInProperties:function(){this._menuBuilder=new _1029();},modelBindingMap:{"commands":["commands"],"mainButtonCommand":["mainButtonCommand"],"mainButtonSectionVisible":["mainButtonSectionVisible"],"lastChangeStatus":["lastChangeStatus"],"topInfoSectionVisible":["topInfoSectionVisible"],"publishInfoSectionVisible":["publishInfoSectionVisible"],"lastPublishedTitle":["lastPublishedTitle"],"lastPublishedTitleVisible":["lastPublishedTitleVisible"],"lastPublishedText":["lastPublishedText"],"lastPublishedViewLinkVisible":["lastPublishedViewLinkVisible"],"lastPublishedViewLinkHref":["lastPublishedViewLinkHref"],"additionalInfoSectionVisible":["additionalInfoSectionVisible"],"additionalInfoText":["additionalInfoText"],"typeIdentifier":["typeIdentifier"]},_setCommandsAttr:function(_102d){this.focusedChild=null;var _102e=this.getChildren();array.forEach(_102e,function(item){this.removeChild(item);},this);this.destroyDescendants();this._addCommandsToMenu(_102d);this.focusFirstChild();},_setMainButtonCommandAttr:function(_102f){this._set("mainButtonCommand",_102f);if(_102f){this.mainButton.set("label",_102f.label);this.mainButton.set("disabled",!_102f.get("canExecute"));_1021.remove(this.mainButton.domNode,"epi-loading");if(this._addedMainButtonClass){_1021.remove(this.mainButton.domNode,this._addedMainButtonClass);}if(_102f.options&&_102f.options.mainButtonClass){this._addedMainButtonClass=_102f.options.mainButtonClass;_1021.add(this.mainButton.domNode,this._addedMainButtonClass);}}},_setMainButtonSectionVisibleAttr:function(_1030){_101f.set(this.mainButtonSection,"display",_1030?"":"none");_101f.set(this.mainButton.domNode,"display",_1030?"":"none");},_setLastChangeStatusAttr:{node:"lastChangeStatusNode",type:"innerHTML"},_setTopInfoSectionVisibleAttr:function(_1031){_101f.set(this.topInfoSection,"display",_1031?"":"none");},_setPublishInfoSectionVisibleAttr:function(_1032){_101f.set(this.publishInfoSection,"display",_1032?"":"none");},_setLastPublishedTitleAttr:{node:"lastPublishedTitleNode",type:"innerHTML"},_setLastPublishedTitleVisibleAttr:function(_1033){_101f.set(this.lastPublishedTitleNode,"display",_1033?"":"none");},_setLastPublishedTextAttr:{node:"lastPublishedTextNode",type:"innerHTML"},_setLastPublishedViewLinkVisibleAttr:function(_1034){_101f.set(this.lastPublishedViewLinkNode,"display",_1034?"":"none");},_setLastPublishedViewLinkHrefAttr:function(value){_1020.set(this.lastPublishedViewLinkNode,"href",value);},_setAdditionalInfoSectionVisibleAttr:function(_1035){_101f.set(this.additionalInfoSection,"display",_1035?"":"none");},_setAdditionalInfoTextAttr:{node:"additionalInfoNode",type:"innerHTML"},_setTypeIdentifierAttr:function(_1036){var _1037=this.model&&this.model.dataModel&&this.model.dataModel.contentData,_1038=_1037&&_1037.downloadUrl,_1039=_1036&&_1027.getValue(_1036,"actAsAnAsset");if(!_1039||!_1038){_1020.set(this.lastPublishedViewLinkNode,"title",res.lastpublishedviewlinktooltip);html.set(this.lastPublishedViewLinkNode,res.view);if(this._downloadClickHandler){this._downloadClickHandler.remove();this._downloadClickHandler=null;}return;}_1020.set(this.lastPublishedViewLinkNode,"title",res.download);html.set(this.lastPublishedViewLinkNode,res.download);if(!this._downloadClickHandler){this.own(this._downloadClickHandler=on(this.lastPublishedViewLinkNode,"click",lang.hitch(this,function(e){event.stop(e);var _103a=this.model&&this.model.dataModel&&this.model.dataModel.contentData,url=_103a&&_103a.downloadUrl,name=_103a.name;_102a.download(url,name);})));}},postCreate:function(){this.inherited(arguments);this.mainButton._setSelected=this.mainButton._onUnhover=function(){};},onOpen:function(){this.model.set("isOpen",true);this.inherited(arguments);},onClose:function(){this.model.set("isOpen",false);this.inherited(arguments);},_setModelAttr:function(){this.inherited(arguments);this.ownByKey(this.model,this.connect(this.model,"onCommandsChanged","onCommandsChanged"));},onCommandsChanged:function(name,_103b,added){if(_103b){this._removeCommandsFromMenu(lang.isArray(_103b)?_103b:[_103b]);}if(added){this._addCommandsToMenu(lang.isArray(added)?added:[added]);}},_addCommandsToMenu:function(_103c){array.forEach(_103c,function(_103d){if(_103d!==this.model.mainButtonCommand){this._menuBuilder.create(_103d,this);}},this);},_removeCommandsFromMenu:function(_103e){var _103f=this.menu.getChildren();array.forEach(_103e,function(_1040){for(var i=_103f.length-1;i>=0;i--){var item=_103f[i];if(item._command==_1040){this.removeChild(item);break;}}},this);},_onMainButtonClick:function(){if(this.mainButtonCommand){this.mainButton.set("label",this.mainButtonCommand.executingLabel);_1021.add(this.mainButton.domNode,"epi-loading");var _1041=lang.hitch(this,function(_1042){if(_1042||this.mainButtonCommand.options&&this.mainButtonCommand.options.resetLabelAfterExecution){this.mainButton.set("label",this.mainButtonCommand.label);}_1021.remove(this.mainButton.domNode,"epi-loading");if(this.mainButtonCommand.options&&!this.mainButtonCommand.options.keepMenuOpen){this.onExecute();}}),_1043=lang.hitch(this,function(){this.model.set("lastExecutedCommand",this.mainButtonCommand);});when(this.mainButtonCommand.execute(),function(){return when(_1041(false),_1043);},function(){return _1041();});}},focusFirstChild:function(){if(this.mainButton.isFocusable()){return this.focusChild(this.mainButton);}else{return this.inherited(arguments);}},focusNext:function(){var _1044=this._getLastFocusableChild();if(!this.focusedChild.focused){return this.focusChild(this._getFirstFocusableChild());}else{if(this.focusedChild===_1044){this.focusedChild._setSelected(false);return _101f.get(this.mainButton.domNode,"display")==="none"?this.lastPublishedViewLinkNode.focus():this.focusChild(this.mainButton);}else{if(this.focusedChild===this.mainButton){return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}}},focusPrev:function(){var _1045=this._getFirstFocusableChild();if(!this.focusedChild.focused){return _101f.get(this.mainButton.domNode,"display")==="none"?this.focusChild(this._getLastFocusableChild()):this.focusChild(this.mainButton);}else{if(this.focusedChild===_1045){this.focusedChild._setSelected(false);return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}},resize:function(_1046){var _1047=_1022.getMarginBox(this.domNode),_1048=_1022.getPadExtents(this.topInfoSection),_1049=_1022.getMarginBox(this.mainButton.containerNode),_104a=_1022.getMarginBox(this.containerNode);var _104b=Math.max(_1049.w+_1048.l+_1048.r,_1047.w);_104b=Math.max(_104a.w,_104b);_1046.w=_104b;_1022.setMarginBox(this.domNode,_1046);}});});},"url:epi-cms/contentediting/templates/PublishMenu.html":"<div class=\"epi-invertedTooltip epi-publishActionMenu\" role=\"menu\" tabIndex=\"${tabIndex}\" data-dojo-attach-event=\"onkeypress:_onKeyPress\" >\r\n    <div class=\"epi-tooltipDialogTop\" data-dojo-attach-point=\"topInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastChangeStatusNode\" class=\"epi-lastchangeStatus\"></li>\r\n            <li data-dojo-attach-point=\"mainButtonSection\">\r\n                <button data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"mainButton\" data-dojo-attach-event=\"onClick: _onMainButtonClick\" class=\"epi-fullWidthButton\"></button>\r\n            </li>            \r\n        </ul>          \r\n        <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\"data-dojo-attach-point=\"publishInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastPublishedTitleNode\"></li>\r\n            <li>\r\n                <span data-dojo-attach-point=\"lastPublishedTextNode\"></span>\r\n            </li>\r\n            <li>\r\n                <a href=\"#\" title=\"${res.lastpublishedviewlinktooltip}\" data-dojo-attach-point=\"lastPublishedViewLinkNode\">${res.view}</a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\" data-dojo-attach-point=\"additionalInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"additionalInfoNode\"></li>\r\n        </ul>\r\n    </div>\r\n    <table class=\"dijitReset epi-tooltipDialogMenu epi-menuInverted\" cellspacing=\"0\">\r\n\t    <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n    </table>\r\n</div>\r\n","url:epi-cms/contentediting/templates/EditActionPanel.html":"<div style=\"display: inline-block\">\r\n    <div class=\"dijitInline dijitReset\" data-dojo-attach-point=\"stateNode\">\r\n        <span data-dojo-attach-point=\"statusNonEditableIcon\" class=\"dijitInline dijitReset dijitIcon\">&nbsp;</span>\r\n        <span class=\"epi-statusContainer dijitInline dijitReset\">\r\n            <span data-dojo-attach-point=\"statusTextIcon\" class=\"dijitInline dijitReset dijitIcon\"></span>\r\n            <span data-dojo-attach-point=\"statusTextNode\" class=\"epi-statusText\"></span>\r\n        </span><span class=\"epi-statusArrow dijitInline dijitReset\"></span><!-- These need to be on the same line because of stupid. -->\r\n    </div>\r\n\r\n\r\n\r\n    <div data-dojo-attach-point=\"dropDownButton\" data-dojo-type=\"dijit/form/DropDownButton\"\r\n        data-dojo-props=\"label: '${commonRes.action.publish}', 'class': 'epi-mediumButton epi-boldButton'\">\r\n        <div data-dojo-attach-point=\"dropDownMenu\" data-dojo-type=\"epi-cms/contentediting/PublishMenu\"></div>\r\n    </div>\r\n</div>","epi-cms/contentediting/EditingBase":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/_base/json","dojo/_base/lang","dojo/aspect","dojo/date/stamp","dojo/dom-attr","dojo/on","dojo/query","dojo/topic","dojo/when","dijit/_Widget","epi/dependency","epi/datetime","epi/string","epi/Url","epi/shell/DestroyableByKey","epi-cms/contentediting/_View","epi-cms/contentediting/AutoSaveButton","epi-cms/contentediting/MappingManager","epi-cms/contentediting/RenderManager","epi-cms/contentediting/UpdateController","epi-cms/widget/overlay/overlayFactory","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(array,_104c,_104d,_104e,_104f,json,lang,_1050,date,_1051,on,query,topic,when,_1052,_1053,_1054,_1055,Url,_1056,_1057,_1058,_1059,_105a,_105b,_105c,res){return _104d([_1057,_1056],{toolbar:null,editorFactory:null,syncInterval:10000,activePropertyOnStartup:null,createOverlays:true,_renderManager:null,_mappingManager:null,_activeEditorWrapper:null,_autoSaveButton:null,_reloadRequiredProperty:null,_eventHandlers:null,constructor:function(){this.defaultQueryParameters={epieditmode:true};},postMixInProperties:function(){this.inherited(arguments);this.editorFactory=this.editorFactory||_1053.resolve("epi.cms.contentediting.EditorFactory");this._mappingManager=new _1059();this._eventHandlers=[];},postCreate:function(){this.inherited(arguments);if(this.syncInterval>0){this._syncIntervalId=window.setInterval(lang.hitch(this,"_save"),this.syncInterval);}this.subscribe("/epi/cms/action/save",this._save);this.subscribe("/epi/cms/action/undo",this._undo);this.subscribe("/epi/cms/action/redo",this._redo);this.subscribe("/epi/cms/action/disableundoredoactions",this._toggleUndoRedoActions);},destroy:function(){this._unwatchViewModelHandles();this._stopActiveEditorWrapper();if(this._renderManager){this._renderManager.destroy();}if(this._autoSaveButton){this._autoSaveButton.destroyRecursive();}this._mappingManager.clear();if(this.toolbar){this.toolbar=null;}if(this._syncIntervalId){clearInterval(this._syncIntervalId);}this.inherited(arguments);},_setCommandEnabled:function(_105d,_105e){if(this.toolbar){this.toolbar.setItemProperty(_105d,"disabled",!_105e);}},onContentLinkSyncChange:function(){this.inherited(arguments);this._setButtonState();},_setViewModelAttr:function(_105f){if(_105f===this.viewModel){return;}this.inherited(arguments);this.destroyByKey("viewModel");this.ownByKey("viewModel",_104c.connect(this.viewModel,"onContentChange",this,this._stopActiveEditorWrapper));this.ownByKey("viewModel",_104c.connect(this.viewModel,"onSetActiveProperty",this,this.onSetActiveProperty));this.ownByKey("viewModel",topic.subscribe("/dnd/start",lang.hitch(this.viewModel,"beginOperation")));this.ownByKey("viewModel",topic.subscribe("/dnd/stop",lang.hitch(this,function(){if(this._activeEditorWrapper){return;}this.viewModel.endOperation();})));},_stopActiveEditorWrapper:function(){if(this._activeEditorWrapper!=null){when(this._activeEditorWrapper.tryToStopEditing(),lang.hitch(this,function(){this._activeEditorWrapper=null;}));}},onSetActiveProperty:function(_1060){var _1061=this._mappingManager.findOne("propertyName",_1060);if(_1061){if(_1061.wrapper){_1061.wrapper.startEdit();}else{if(_1061.overlayItem){this._onOverlayItemClick(_1061.overlayItem);}}}},onPreviewReady:function(_1062,doc){if(_1062!=this.viewModel){this.set("viewModel",_1062);this.setupEditMode(doc);}else{if(_1062){this.remapEditMode(doc);}}},_setButtonState:function(){this._setCommandEnabled("reverttopublished",this.viewModel&&!this.viewModel.contentData.isPendingPublish);},setupEditMode:function(doc){this.viewModel.getContentModelAndMetadata().then(lang.hitch(this,function(){this._mappingManager.clear();this._renderManager=new _105a();if(this.toolbar&&!this._autoSaveButton){this._autoSaveButton=new _1058({button:this.toolbar._getWidget("autosave")});}this.own(_1050.after(this._autoSaveButton,"onLayoutChanged",lang.hitch(this,function(){this.mainLayoutContainer.layout();})));this._autoSaveButton.set("model",this.viewModel);var _1063=lang.hitch(this,function(){this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);});this.viewModel.resetNotifications();this._unwatchViewModelHandles();this._viewModelHandles=[this.viewModel.watch("hasUndoSteps",_1063),this.viewModel.watch("hasRedoSteps",_1063)];_1063();this.onReadySetupEditMode(doc);this._setButtonState();this.onPrepareOverlayComplete();}));},remapEditMode:function(doc){this.viewModel.getMetadataThenUpdateModel().then(lang.hitch(this,function(){this._renderManager.resume();if(doc){setTimeout(lang.hitch(this,function(){this._remapUpdateControllers(doc);this.onPrepareOverlayComplete();this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);this._autoSaveButton.set("model",this.viewModel);}),1);}}));},_unwatchViewModelHandles:function(){if(this._viewModelHandles){array.forEach(this._viewModelHandles,function(_1064){_1064.unwatch();});this._viewModelHandles=null;}},onReadySetupEditMode:function(doc){this._createUpdateControllers(doc);},onSetupEditModeComplete:function(){if(this.activePropertyOnStartup){this.onSetActiveProperty(this.activePropertyOnStartup);this.activePropertyOnStartup=null;}},_getPropertyNodes:function(doc){var _1065=query("[data-epi-property-name]",doc);var _1066=query("[data-epi-property-name] [data-epi-property-name]",doc);return array.filter(_1065,function(node){return _1066.indexOf(node)===-1;});},_getEditableNodes:function(doc){if(!doc||!this.viewModel.canChangeContent()){return [];}var nodes=this._getPropertyNodes(doc);var _1067=[];array.forEach(nodes,function(node){var _1068=_1055.pascalToCamel(_1051.get(node,"data-epi-property-name"));var _1069=this.viewModel.getPropertyMetaData(_1068);if(!_1069){return;}var _106a=_1055.pascalToCamel(_1069.name);var _106b=_1051.get(node,"data-epi-property-display-name");if(_106b){_1069=lang.delegate(_1069,{displayName:_106b});}if(_1069!=null&&_1069.showForEdit){var _106c={cacheResults:true,rerenderOnCancel:false,propertyRenderSettings:_1051.get(node,"data-epi-property-rendersettings")||undefined,useMvc:_1051.has(node,"data-epi-use-mvc")?_1051.get(node,"data-epi-use-mvc").toLowerCase()==="true":false};_106c=lang.mixin(_106c,_1069.additionalValues.renderSettings);var _106d=_1051.has(node,"data-epi-property-editorsettings")?json.fromJson(_1051.get(node,"data-epi-property-editorsettings")):null;var _106e=_1051.has(node,"data-epi-property-overlaysettings")?json.fromJson(_1051.get(node,"data-epi-property-overlaysettings")):null;_106e=lang.mixin(_106e,_1069.overlaySettings);_1067.push({node:node,disabled:(_1051.get(node,"data-epi-disabled")=="true"),useOverlay:(_1051.get(node,"data-epi-useoverlay")=="true"),overlayZIndex:parseInt(_1051.get(node,"data-epi-overlay-z-index"),10)||0,property:{name:_106a,contentLink:this.viewModel.contentLink,contentModel:this.viewModel.contentModel,type:_1051.get(node,"data-epi-property-type"),wrapperType:_1051.get(node,"data-epi-property-edittype"),editorParams:_106d,overlayParams:_106e,editorWidgetType:_1051.get(node,"data-epi-property-editor"),renderSettings:_106c,rendererClass:(_1051.get(node,"data-epi-property-render")==="client")?"epi.cms.contentediting.ClientRenderer":_1069.customEditorSettings.rendererClass,metadata:_1069,propertyNodeName:_1068}});}},this);_1067.sort(function(a,b){if(a.overlayZIndex<b.overlayZIndex){return -1;}else{if(a.overlayZIndex>b.overlayZIndex){return 1;}else{return 0;}}});return _1067;},_createUpdateControllers:function(doc){var _106f=this._createFullPageUpdateController(doc);if(_106f){this._connectUpdateControllerAndOverlayEvents(_106f,null);this._mappingManager.add({updateController:_106f});}var _1070=this._getEditableNodes(doc);array.forEach(_1070,function(_1071){var _1072=_1071.property;var _1073=_1071.node.innerHTML;var _1074=this._createNodeUpdateController(_1071);when(this._createNodeOverlay(_1071),lang.hitch(this,function(_1075){this._connectUpdateControllerAndOverlayEvents(_1074,_1075);this._mappingManager.add({blockPropertyInfo:_1072,node:_1071.node,updateController:_1074,overlayItem:_1075});}));this._renderManager.cacheRender(_1072.name,_1072.renderSettings,this.viewModel.getProperty(_1072.name),_1073);},this);},_createNodeOverlay:function(_1076){var _1077=new _104e();if(!this.createOverlays){_1077.resolve(null);return _1077;}when(_105c.create(_1076),lang.hitch(this,function(_1078){this.overlay.addChild(_1078);_1077.resolve(_1078);}));return _1077;},_createNodeUpdateController:function(_1079){var _107a=_1079.property;var _107b=_107a.metadata;var _107c=new _105b({displayName:_107b.displayName,renderManager:this._renderManager,contentModel:_107a.contentModel,contentLink:_107a.contentLink,modelPropertyName:_107a.name,nodePropertyName:_107a.propertyNodeName,renderSettings:_107a.renderSettings,rendererClass:_107a.rendererClass,displayNode:_1079.node});return _107c;},_createFullPageUpdateController:function(doc){var _107d=[];if(doc){var _107e=query("input[data-epi-full-refresh-property-names][type='hidden']",doc);array.forEach(_107e,function(tag){array.forEach(_1051.get(tag,"data-epi-full-refresh-property-names").split(","),function(_107f){if(!array.some(_107d,function(p){return p===_107f;})){_107d.push(_1055.pascalToCamel(_107f));}});});}array.forEach(this.viewModel.metadata.properties,function(_1080){if(_1080.additionalValues["reloadOnChange"]===true){_107d.push(_1055.pascalToCamel(_1080.name));}});if(!_107d.length){return null;}var _1081=new _105b({displayName:"",renderManager:this._renderManager,contentModel:this.viewModel.contentModel,modelPropertyName:_107d,renderSettings:{isFullReload:true}});return _1081;},_remapUpdateControllers:function(doc){var _1082=this._getEditableNodes(doc);var _1083=this._mappingManager.remap(_1082);array.forEach(_1083,function(_1084){var _1085=_1084.property;var _1086=this._createNodeUpdateController(_1084);var _1087=this._mappingManager.find(function(m){return (m.updateController===undefined||m.updateController===null)&&(m.propertyName.indexOf(_1085.name)===0);});when(this._createNodeOverlay(_1084),lang.hitch(this,function(_1088){this._connectUpdateControllerAndOverlayEvents(_1086,_1088);if(_1087&&_1087.length){this._mappingManager.update(_1087[0],{updateController:_1086,overlayItem:_1088,node:_1084.node});}else{this._mappingManager.add({blockPropertyInfo:_1085,node:_1084.node,updateController:_1086,overlayItem:_1088});}}));this._renderManager.cacheRender(_1085.name,_1085.renderSettings,this.viewModel.getProperty(_1085.name),_1084.node.innerHTML);},this);var _1089=this._createFullPageUpdateController(doc);if(_1089){this._connectUpdateControllerAndOverlayEvents(_1089,null);this._mappingManager.add({updateController:_1089});}},_connectUpdateControllerAndOverlayEvents:function(_108a,_108b){if(_108a){this.connect(_108a,"onReloadRequired",this._onBlockReloadRequired);this.connect(_108a,"onRender",this._onBlockRender);}if(_108b){this.connect(_108b,"onClick",this._onOverlayItemClick);this.connect(_108b,"onValueChange",function(value){this._onOverlayValueChange(_108b,value);});}},_getEditor:function(_108c){var _108d=this._mappingManager.findOne("overlayItem",_108c);return (_108d.wrapper&&_108d.wrapper.editorWidget)?_108d.wrapper.editorWidget:null;},onEditorWrapperCreated:function(_108e){},_onOverlayItemClick:function(_108f,e){if(e){_104f.stop(e);}var _1090=this._mappingManager.findOne("overlayItem",_108f);var _1091=_1090.blockPropertyInfo;var val=this.viewModel.getProperty(_1090.propertyName);var value=lang.clone(val,true);var _1092;var _1093=lang.hitch(this,function(_1094){_1090.wrapper=_1094;this._activeEditorWrapper=_1094;topic.publish("/epi/layout/pinnable/propertyEditor/show",null);array.forEach(this._mappingManager.find(),function(m){if(m.overlayItem){m.overlayItem.set("active",false);}});_1090.overlayItem.set("active",true);var _1095={value:value,parent:_1094};_1094.startEdit(_1095);this.overlay.set("readOnly",_1094.isOverlayDisabled);this.viewModel.set("disableUndo",_1094.isUndoDisabled);});if(_1090.wrapper){_1092=_1090.wrapper;if(_1092&&_1092.editorWidget&&!_1092.editorWidget.overlayItem){_1092.editorWidget.overlayItem=_108f;}_1092.set("blockDisplayNode",_1090.node);_1093(_1092);}else{when(this._createEditorWrapper(_1091,_108f,_1090.node,value),lang.hitch(this,function(_1096){_1093(_1096);this.onEditorWrapperCreated(_1096);}));}},_createEditorWrapper:function(_1097,_1098,node,value){var def=new _104e(),_1099={overlayItem:_1098};when(this.editorFactory.createEditor(_1097,node,value,_1099),lang.hitch(this,function(_109a){this.connect(_109a,"onValueChange","_onWrapperValueChange");this.connect(_109a,"onCancel","_onWrapperCancel");this.connect(_109a,"onStopEdit","_onWrapperStopEdit");def.resolve(_109a);}),def.reject);return def;},_onBlockReloadRequired:function(_109b){var rm=this._renderManager;setTimeout(function(){rm.suspend();rm.clear();},1);this._reloadRequiredProperty=_109b.modelPropertyName;this._reloadPropertyPreview();},_onBlockRender:function(_109c){var _109d=this._mappingManager.findOne("updateController",_109c);if(_109d&&_109d.overlayItem){_109d.overlayItem.refresh();}},_saveEditorChanges:function(_109e,data){var _109f=this._getEditor(_109e);if(_109f&&!_109f.overlayItem){_109f.overlayItem=_109e;}if(_109f&&_109f.saveChanges){_109f.saveChanges(_109f,data);}},_onOverlayValueChange:function(_10a0,data){this._saveEditorChanges(_10a0,data.value);this.viewModel.setProperty(data.propertyName,data.value);},_onWrapperValueChange:function(_10a1,value,_10a2){var _10a3=this._mappingManager.findOne("wrapper",_10a1),_10a4=_10a3.propertyName;if(_10a3.overlayItem){_10a3.overlayItem.set("updated",true);}this.viewModel.beginOperation();this.viewModel.setProperty(_10a4,value,_10a2);},_onWrapperStopEdit:function(_10a5,value,_10a6,_10a7){var _10a8=this._mappingManager.findOne("wrapper",_10a5);this.viewModel.endOperation();this._save();if(_10a8.overlayItem){_10a8.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_onWrapperCancel:function(_10a9,_10aa){this.viewModel.abortOperation();var _10ab=this._mappingManager.findOne("wrapper",_10a9);var _10ac=_10ab.updateController;if(_10ac&&_10ac.renderSettings&&_10ac.renderSettings.rerenderOnCancel){_10ac.render();}if(_10a9.get("isModified")){this._save();}if(_10ab.overlayItem){_10ab.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_undo:function(){setTimeout(lang.hitch(this,function(){this.viewModel.undo();}),0);},_redo:function(){setTimeout(lang.hitch(this,function(){this.viewModel.redo();}),0);},_toggleUndoRedoActions:function(_10ad,_10ae){this._setCommandEnabled("undo",!!_10ad);this._setCommandEnabled("redo",!!_10ae);},_save:function(){if(!this.viewModel||!this.viewModel.hasPendingChanges){return;}when(this.viewModel.save(),lang.hitch(this,this._reloadPropertyPreview));},_reloadPropertyPreview:function(){if(!this.viewModel.isSaved){this._save();return;}var _10af=this._activeEditorWrapper&&(this._activeEditorWrapper.propertyName===this._reloadRequiredProperty);var _10b0=this._activeEditorWrapper&&this._activeEditorWrapper.hasInlineEditor;if(this._reloadRequiredProperty&&!(_10af&&_10b0)){this._toggleUndoRedoActions(false,false);this.onReloadRequired();this._reloadRequiredProperty=null;}}});});},"epi-cms/contentediting/_View":function(){define(["epi","dojo","dijit/_Widget","epi/Url"],function(epi,dojo,_10b1,Url){return dojo.declare([_10b1],{iframeWithOverlay:null,overlay:null,iFrame:null,layoutContainer:null,contextTypeName:null,viewModel:null,postMixInProperties:function(){this.inherited(arguments);if(this.iframeWithOverlay){this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;}this._viewConnections=[];},_setViewModelAttr:function(_10b2){this._set("viewModel",_10b2);},_setIframeWithOverlayAttr:function(value){this._set("iframeWithOverlay",value);this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;},onPreviewReady:function(_10b3,doc){this.set("viewModel",_10b3);this.onPrepareOverlayComplete();},onPrepareOverlayComplete:function(){},onContentLinkSyncChange:function(){},onReloadRequired:function(){},_setReloadRequiredAttr:function(value){this._set("reloadRequired",value);}});});},"epi-cms/contentediting/AutoSaveButton":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/string","dijit/_WidgetBase","epi/datetime","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.autosave"],function(array,_10b4,_10b5,lang,_10b6,_10b7,_10b8,_10b9,_10ba,res){var _10bb={Saving:0,Offline:1,Saved:2};return _10b5([_10b9],{_state:null,button:undefined,lastSaved:undefined,model:null,_currentlySavingClass:"epi-autosave-saving",_errorClass:"epi-autosave-error",_savedClass:"epi-autosave-saved",_hoverClass:"epi-autosave-hover",_modelHandles:null,postMixInProperties:function(){this.inherited(arguments);this._modelHandles=[];},postCreate:function(){this.inherited(arguments);if(!this.button){return;}this.connect(this.button.domNode,"onmouseover",this._addHoverClass);this.connect(this.button.domNode,"onmouseout",this._removeHoverClass);},destroy:function(){array.forEach(this._modelHandles,function(_10bc){_10bc.unwatch();});this.inherited(arguments);},_setModelAttr:function(model){array.forEach(this._modelHandles,function(_10bd){_10bd.unwatch();});this._set("model",model);if(model){this._modelHandles=[model.watch("isOnline",lang.hitch(this,"_isOnlineChanged")),model.watch("lastSaved",lang.hitch(this,"_lastSavedChanged")),model.watch("isSaved",lang.hitch(this,"_isSavedChanged")),model.watch("isSaving",lang.hitch(this,"_isSavingChanged")),model.watch("hasErrors",lang.hitch(this,"_hasErrorsChanged")),model.watch("disableUndo",lang.hitch(this,this._disableUndo))];this.set("lastSaved",model.lastSaved);if(this.lastSaved){this.updateButton();}else{this._setVisibility(false);}}},_setLastSavedAttr:function(_10be){this._set("lastSaved",_10be);this.updateLastSaveTime();},_disableUndo:function(_10bf,_10c0,value){this._isUndoDisabled=value;this.updateButton();},_isOnlineChanged:function(name,_10c1,_10c2){if(_10c2===_10c1){return;}if(_10c2){this.revertToLastAutoSaveTime();}else{this.showOfflineStatus();}},_lastSavedChanged:function(name,_10c3,_10c4){this.set("lastSaved",_10c4);},_isSavedChanged:function(name,_10c5,_10c6){if(_10c6){this.updateLastSaveTime();}},_isSavingChanged:function(name,_10c7,_10c8){if(_10c8){this.showSavingStatus();}else{if(!this.model.isSaved){this.revertToLastAutoSaveTime();}}},_hasErrorsChanged:function(name,_10c9,_10ca){if(_10c9===_10ca){return;}if(!_10ca){this.revertToLastAutoSaveTime();}else{_10b4.publish("/epi/cms/action/showerror");}},_animateSaving:function(){_10b6.replace(this.button.domNode,this._currentlySavingClass,[this._errorClass,this._savedClass]);this._removeHoverClass();},_animateOffline:function(){_10b6.replace(this.button.domNode,this._errorClass,[this._currentlySavingClass,this._savedClass]);this._removeHoverClass();},_animateSaved:function(){_10b6.replace(this.button.domNode,this._savedClass,[this._currentlySavingClass,this._errorClass]);this._removeHoverClass();},_addHoverClass:function(){if(this._state==null||this._state==_10bb.Saving||this._hasDropDownOpen()){return;}if(this._state==_10bb.Saved){_10b6.add(this.button.domNode,this._hoverClass);}},_removeHoverClass:function(){if(!this._hasDropDownOpen()){_10b6.remove(this.button.domNode,this._hoverClass);}},_updateState:function(text){this.button.set("label",text);this.button.set("disabled",this._isUndoDisabled||this._state!=_10bb.Saved);this._setVisibility(true);},_setVisibility:function(_10cb){if(_10cb!==this._visible){this._visible=_10cb;if(this.button){_10b7.set(this.button.domNode,{display:_10cb?"":"none"});this.button.set("itemVisibility",_10cb&&!this.button.disabled);if(this.button.isInNarrowToolbar){this.onLayoutChanged();}}}},onLayoutChanged:function(){},_hasDropDownOpen:function(){return this.button._popupStateNode?_10b6.contains(this.button._popupStateNode,"dijitHasDropDownOpen"):false;},revertToLastAutoSaveTime:function(){if(this.lastSaved===undefined){this._setVisibility(false);return;}this.updateLastSaveTime();},updateLastSaveTime:function(){if(!this.lastSaved){return;}if(!this.model.isOnline){return;}setTimeout(lang.hitch(this,function(){if(this.model.isOnline){this.updateButton();this._animateSaved();}}),1000);},showSavingStatus:function(){this._state=_10bb.Saving;this._updateState(res.savinglabel);this._animateSaving();},showOfflineStatus:function(){this._state=_10bb.Offline;this._updateState(res.offlinelabel);this._animateOffline();},updateButton:function(){if(!this.lastSaved||(this.model.contentData&&this.model.contentData.isDeleted)){this._setVisibility(false);return;}this._state=_10bb.Saved;var _10cc="<span class=\"dijitReset dijitInline clearfix\">${autosavelabel} ${timestamp}</span>&nbsp;<span class=\"epi-inlineButtonLink\">${undolabel}</span>";var _10cd={autosavelabel:res.autosavelabel,undolabel:this.model.undoManager.get("hasUndoSteps")&&!this._isUndoDisabled?res.undolabel:"",timestamp:_10ba.toUserFriendlyHtml(this.lastSaved,null,true)};this._updateState(_10b8.substitute(_10cc,_10cd));}});});},"epi-cms/contentediting/MappingManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/connect","dojo/dom-attr","dojox/encoding/digests/SHA1"],function(_10ce,lang,array,json,_10cf,_10d0,SHA1){return _10ce(null,{_mappings:null,domUtils:null,attrNames:["data-epi-property-name","data-epi-property-display-names","data-epi-property-customsettings-customtag","data-epi-use-mvc","data-epi-disabled","data-epi-useoverlay","data-epi-overlay-z-index","data-epi-property-type","data-epi-property-edittype","data-epi-property-editorsetting","data-epi-property-editor","data-epi-property-render"],constructor:function(){this._mappings=[];this.domUtils=_10d0;},clear:function(){var _10d1;try{while(_10d1=this._mappings.pop()){for(var prop in _10d1){if(_10d1[prop]){if(prop!=="node"){if(lang.isFunction(_10d1[prop].destroyRecursive)){_10d1[prop].destroyRecursive();}else{if(lang.isFunction(_10d1[prop].destroy)){_10d1[prop].destroy();}}}_10d1[prop]=null;}}}}catch(ex){}},_calculateNodeHash:function(node){if(!node){return "";}var attrs=array.map(this.attrNames,dojo.hitch(this,function(n){return this.domUtils.get(node,n)||"";}));return SHA1(json.toJson(attrs));},update:function(_10d2,patch){lang.mixin(_10d2,patch);if(patch.node){_10d2.nodeHash=this._calculateNodeHash(patch.node);}},add:function(item){if(item.node){item.nodeHash=this._calculateNodeHash(item.node);}if(item.blockPropertyInfo&&!item.propertyName){item.propertyName=item.blockPropertyInfo.name;}this._mappings.push(item);},_tryRemapNode:function(item,_10d3){if(this._calculateNodeHash(_10d3.node)===item.nodeHash){item.node=_10d3.node;item.updateController.displayNode=_10d3.node;item.updateController.checkEmptyHtml();if(item.overlayItem){item.overlayItem.set("disabled",false);item.overlayItem.set("sourceItemNode",_10d3.node);item.overlayItem.refresh();}return {success:true,mappedNode:_10d3};}return {success:false};},remap:function(_10d4){var _10d5=[],_10d6=[];array.forEach(_10d4,function(_10d7){_10d5.push(_10d7);});array.forEach(this._mappings,lang.hitch(this,function(item){if(!item.updateController){return;}var _10d8=null;var _10d9=array.some(_10d5,lang.hitch(this,function(_10da){var _10db=this._tryRemapNode(item,_10da);_10d8=_10d8||_10db.mappedNode;return _10db.success;}));if(_10d9){if(_10d8){_10d5.splice(array.indexOf(_10d5,_10d8),1);}}else{item.updateController.destroy();delete item.updateController;if(item.overlayItem){item.overlayItem.destroy();delete item.overlayItem;}delete item.node;delete item.nodeHash;}if(this._isEmpty(item)){_10d6.push(item);}}));var _10dc;while(_10dc=_10d6.pop()){this._mappings.splice(array.indexOf(this._mappings,_10dc),1);}return _10d5;},_isEmpty:function(_10dd){for(var _10de in _10dd){if(_10dd.hasOwnProperty(_10de)){return false;}}return true;},findOne:function(_10df,value){var _10e0;array.some(this._mappings,function(m){if(m[_10df]===value){_10e0=m;return true;}});return _10e0;},find:function(){var _10e1;if(arguments[0]===undefined){return this._mappings;}else{if(lang.isFunction(arguments[0])){_10e1=arguments[0];}else{var _10e2=arguments[0],value=arguments[1];_10e1=function(m){return m[_10e2]===value;};}}return array.filter(this._mappings,_10e1);}});});},"dojox/encoding/digests/SHA1":function(){define("dojox/encoding/digests/SHA1",["./_base"],function(dxd){var chrsz=8,mask=(1<<chrsz)-1;function R(n,c){return (n<<c)|(n>>>(32-c));};function FT(t,b,c,d){if(t<20){return (b&c)|((~b)&d);}if(t<40){return b^c^d;}if(t<60){return (b&c)|(b&d)|(c&d);}return b^c^d;};function KT(t){return (t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514;};function core(x,len){x[len>>5]|=128<<(24-len%32);x[((len+64>>9)<<4)+15]=len;var w=new Array(80),a=1732584193,b=-271733879,c=-1732584194,d=271733878,e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d,olde=e;for(var j=0;j<80;j++){if(j<16){w[j]=x[i+j];}else{w[j]=R(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);}var t=dxd.addWords(dxd.addWords(R(a,5),FT(j,b,c,d)),dxd.addWords(dxd.addWords(e,w[j]),KT(j)));e=d;d=c;c=R(b,30);b=a;a=t;}a=dxd.addWords(a,olda);b=dxd.addWords(b,oldb);c=dxd.addWords(c,oldc);d=dxd.addWords(d,oldd);e=dxd.addWords(e,olde);}return [a,b,c,d,e];};function hmac(data,key){var wa=_10e3(key);if(wa.length>16){wa=core(wa,key.length*chrsz);}var ipad=new Array(16),opad=new Array(16);for(var i=0;i<16;i++){ipad[i]=wa[i]^909522486;opad[i]=wa[i]^1549556828;}var hash=core(ipad.concat(_10e3(data)),512+data.length*chrsz);return core(opad.concat(hash),512+160);};function _10e3(s){var wa=[];for(var i=0,l=s.length*chrsz;i<l;i+=chrsz){wa[i>>5]|=(s.charCodeAt(i/chrsz)&mask)<<(32-chrsz-i%32);}return wa;};function toHex(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((3-i%4)*8+4))&15),h.charAt((wa[i>>2]>>((3-i%4)*8))&15));}return s.join("");};function _10e4(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=chrsz){s.push(String.fromCharCode((wa[i>>5]>>>(32-chrsz-i%32))&mask));}return s.join("");};function _10e5(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(3-i%4))&255)<<16)|(((wa[i+1>>2]>>8*(3-(i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*(3-(i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};dxd.SHA1=function(data,_10e6){var out=_10e6||dxd.outputTypes.Base64;var wa=core(_10e3(data),data.length*chrsz);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return toHex(wa);case dxd.outputTypes.String:return _10e4(wa);default:return _10e5(wa);}};dxd.SHA1._hmac=function(data,key,_10e7){var out=_10e7||dxd.outputTypes.Base64;var wa=hmac(data,key);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return toHex(wa);case dxd.outputTypes.String:return _10e4(wa);default:return _10e5(wa);}};return dxd.SHA1;});},"dojox/encoding/digests/_base":function(){define("dojox/encoding/digests/_base",["dojo/_base/lang"],function(lang){var d=lang.getObject("dojox.encoding.digests",true);d.outputTypes={Base64:0,Hex:1,String:2,Raw:3};d.addWords=function(a,b){var l=(a&65535)+(b&65535);var m=(a>>16)+(b>>16)+(l>>16);return (m<<16)|(l&65535);};var chrsz=8;var mask=(1<<chrsz)-1;d.stringToWord=function(s){var wa=[];for(var i=0,l=s.length*chrsz;i<l;i+=chrsz){wa[i>>5]|=(s.charCodeAt(i/chrsz)&mask)<<(i%32);}return wa;};d.wordToString=function(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=chrsz){s.push(String.fromCharCode((wa[i>>5]>>>(i%32))&mask));}return s.join("");};d.wordToHex=function(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((i%4)*8+4))&15)+h.charAt((wa[i>>2]>>((i%4)*8))&15));}return s.join("");};d.wordToBase64=function(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(i%4))&255)<<16)|(((wa[i+1>>2]>>8*((i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*((i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};return d;});},"epi-cms/contentediting/RenderManager":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/json","dojo/_base/array","epi","epi/dependency","epi/string","epi/datetime","dojox/encoding/digests/SHA1","dojo/Stateful","epi-cms/contentediting/PropertyRenderer"],function(dojo,_10e8,lang,_10e9,json,array,epi,_10ea,_10eb,_10ec,SHA1,_10ed,_10ee){return _10e8([_10ed],{_cache:null,_queue:null,defaultRenderer:null,_rendererPool:{},rendering:false,processQueueOnRenderValue:true,numberOfItemsInQueue:0,numberOfItemsRendering:0,concurrentProcessedItems:2,processInterval:200,_processIntervalId:0,_itemsBeingRendered:null,viewSettingsManager:null,_viewSettingsToCopy:["visitorgroup"],constructor:function(_10ef){this._cache={};this._queue=[];this._itemsBeingRendered={};lang.mixin(this,_10ef);this.defaultRenderer=this.defaultRenderer||new _10ee();},postscript:function(){this.viewSettingsManager=this.viewSettingsManager||_10ea.resolve("epi.viewsettingsmanager");},destroy:function(){this._stopRenderingInterval();this._isDestroyed=true;for(var i in this._cache){delete this._cache[i];}for(var j in this._itemsBeingRendered){delete this._itemsBeingRendered[j];}this._cache=null;this._itemsBeingRendered=null;this._queue=null;this.inherited(arguments);},_getRenderer:function(_10f0){var def=new _10e9();if(_10f0){if(this._rendererPool[_10f0]){return this._rendererPool[_10f0];}else{var _10f1=_10eb.slashName(_10f0);require([_10f1],function(_10f2){def.resolve(new _10f2());});}}else{return this.defaultRenderer;}return def;},renderValue:function(_10f3,_10f4,value,_10f5,_10f6){var def;if(this._isSuspending){def=new _10e9();def.cancel();return def;}value=_10ec.transformDate(value);_10f5=this.cloneAndCompleteRenderSettings(_10f5||{});var _10f7=this._get(_10f4,_10f5,value);if(_10f7){def=new _10e9();def.resolve(_10f7);}else{if(_10f5&&_10f5.isFullReload){def=new _10e9();def.resolve({doReload:true});}else{def=new _10e9();_10e9.when(this._getRenderer(_10f6),lang.hitch(this,function(_10f8){if(!_10f8){_10f8=this.defaultRenderer;}_10e9.when(this._queueItem(_10f8,_10f3,_10f4,_10f5,value),function(_10f9){def.resolve(_10f9);});if(this.processQueueOnRenderValue&&!this._isSuspending){this._startRenderingInterval();}}));}}return def;},cloneAndCompleteRenderSettings:function(_10fa){_10fa.propertyRenderSettings=_10fa.propertyRenderSettings||"";var _10fb=lang.clone(_10fa);if(this.viewSettingsManager.get("enabled")){array.forEach(this.viewSettingsManager.getRenderingViewSettings(),lang.hitch(this,function(_10fc){if(_10fc.get("enabled")){var _10fd=this.viewSettingsManager.getSettingProperty(_10fc.key);if(_10fd){this.updateRenderSettings(_10fb,_10fd,_10fc.key,_10fc.isTagItem);}}}));}return _10fb;},updateRenderSettings:function(_10fe,_10ff,key,_1100){var _1101=[],_1102=[],_1103="",_1104=(_1100?"tag":key),_1105=!_1100,data=null;if(_1100){_10fe.propertyRenderSettings=_10fe.propertyRenderSettings||"";data=(_10fe.propertyRenderSettings?dojo.fromJson(_10fe.propertyRenderSettings):{});}else{data=(_10fe?_10fe:{});}if(!data[_1104]||_1105){_1103=_10ff;}else{_1101=data[_1104].split(",");array.forEach(_1101,function(item,idx){item=lang.trim(item);if(item.toLowerCase()!=_10ff.toLowerCase()){_1102.push(item);}});_1102.push(_10ff);_1103=_1102.join(", ");}data[_1104]=_1103;if(_1100){_10fe.propertyRenderSettings=dojo.toJson(data);}},processQueue:function(){if(this._isSuspending){return;}if(this._queue.length===0){this._stopRenderingInterval();return;}if(this.numberOfItemsRendering>=this.concurrentProcessedItems){return;}var _1106=this._nextItemToProcessIndex();while(_1106>=0&&this.numberOfItemsRendering<this.concurrentProcessedItems){this._processItemInQueue(_1106);_1106=this._nextItemToProcessIndex();}},suspend:function(){if(this._isSuspending){return;}this._isSuspending=true;this._stopRenderingInterval();},clear:function(){this.set("numberOfItemsRendering",0);for(var key in this._itemsBeingRendered){this._itemsBeingRendered[key].deferred.cancel();delete this._itemsBeingRendered[key];}this._itemsBeingRendered={};this.set("numberOfItemsInQueue",0);for(var i=this._queue.length-1;i>=0;i--){delete this._queue[i];}this._queue=[];},resume:function(){if(!this._isSuspending){return;}this._isSuspending=false;this._startRenderingInterval();},_nextItemToProcessIndex:function(){var index=-1;var i=0;while(i<this._queue.length&&index==-1){var item=this._queue[i];var key=this._getRenderHash(item.propertyName,item.renderSettings);if(!(key in this._itemsBeingRendered)){index=i;}i++;}return index;},_processItemInQueue:function(index){var item=this._queue.splice(index,1)[0];this.set("numberOfItemsRendering",this.numberOfItemsRendering+1);this.set("numberOfItemsInQueue",this._queue.length);var key=this._getRenderHash(item.propertyName,item.renderSettings);this._itemsBeingRendered[key]=item;this.set("rendering",true);var _1107=lang.hitch(this,function(_1108){if(this._isDestroyed){item.deferred.cancel();return;}if(_1108&&_1108.innerHtml){this._put(item.propertyName,item.renderSettings,item.value,{doReload:_1108.doReload,innerHtml:_1108.innerHtml});}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.resolve(_1108);});var _1109=lang.hitch(this,function(err){if(this._isDestroyed){item.deferred.cancel();return;}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.reject(err);});_10e9.when(item.renderer.render(item.contentLink,item.propertyName,item.value,item.renderSettings),_1107,_1109);},cacheRender:function(_110a,_110b,value,_110c){data={innerHtml:_110c,doReload:false};this._put(_110a,_110b,value,data);},_queueItem:function(_110d,_110e,_110f,_1110,value){var key=this._getRenderHash(_110f,_1110);var _1111;var _1112=this._itemsBeingRendered[key];if(_1112&&!_1112.deferred.fired&&_1112.value===value){_1111=_1112.deferred;}else{var index=this._queueIndex(_110d,_110e,_110f,_1110,value);if(index<0){_1111=new _10e9();this._queue.push({contentLink:_110e,renderer:_110d,propertyName:_110f,renderSettings:_1110,renderSettingsString:json.toJson(_1110),value:value,deferred:_1111});this.set("numberOfItemsInQueue",this._queue.length);}else{var item=this._queue[index];item.contentLink=_110e;item.renderer=_110d;item.value=value;_1111=item.deferred;}}return _1111;},_startRenderingInterval:function(){if(!this._processIntervalId){this.processQueue();this._processIntervalId=setInterval(lang.hitch(this,function(){this.processQueue();}),this.processInterval);}},_stopRenderingInterval:function(){if(this._processIntervalId){clearInterval(this._processIntervalId);this._processIntervalId=0;}this.set("rendering",false);},_getRenderHash:function(_1113,_1114){return SHA1(json.toJson({p:_1113,r:_1114}));},_queueIndex:function(_1115,_1116,_1117,_1118,value){var index=-1;var _1119=json.toJson(_1118);array.some(this._queue,function(item,i){if((item.propertyName===_1117)&&(item.renderSettingsString==_1119)){index=i;return true;}});return index;},_put:function(_111a,_111b,value,data){if(!_111b.cacheResults){return;}var _111c=this._getCacheHash(_111a,_111b,value);if(!this._cache){this._cache={};}this._cache[_111c]={data:data};},_get:function(_111d,_111e,value){var _111f=this._getCacheHash(_111d,_111e,value);var _1120=this._cache[_111f];return (_1120?_1120.data:undefined);},_getCacheHash:function(_1121,_1122,value){return SHA1(json.toJson({p:_1121,r:_1122,v:value}));}});});},"epi-cms/contentediting/PropertyRenderer":function(){define(["dojo/_base/json","dojo/_base/declare","epi","epi/dependency","epi/shell/XhrWrapper","epi-cms/contentediting/_Renderer","epi-cms/core/ContentReference","epi/routes","dojo/string"],function(json,_1123,epi,_1124,_1125,_1126,_1127,_1128,_1129){return _1123([_1126],{_routes:_1128,_xhrHandler:null,_profile:null,constructor:function(){if(!this._routes){this._routes=epi.routes;}if(!this._xhrHandler){this._xhrHandler=new _1125();}this._profile=this._profile||_1124.resolve("epi.shell.Profile");},render:function(_112a,_112b,_112c,_112d){var _112e=_1127.toContentReference(_112a);var url=null;if(_112d.useMvc){url=this._routes.getActionPath({moduleArea:"CMS",controller:"PropertyRender",action:"Render",epieditmode:true,visitorgroupsByID:_112d.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}else{url=this._routes.getActionPath({moduleArea:"LegacyCMS",path:"edit/RenderProperty.aspx",id:_112e.toString(),epieditmode:true,visitorgroupsByID:_112d.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}var _112f={propertyName:_112b,propertyValue:json.toJson(_112c),id:_112e.toString(),renderSettings:""};if(_112d&&_112d.propertyRenderSettings){_112f.renderSettings=_112d.propertyRenderSettings;}return this._xhrHandler.xhrPost({url:url,handleAs:"json",content:_112f});}});});},"epi-cms/contentediting/UpdateController":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/dom-attr","dijit"],function(dojo,array,_1130,lang,_1131,_1132,_1133,_1134,dijit){return _1130(null,{_showEmptyNode:true,_hasEmptyHtml:false,emptyValue:"&nbsp;",minWidth:18,minHeight:14,displayNode:null,contentModel:null,contentLink:null,modelPropertyName:null,nodePropertyName:null,renderManager:null,displayName:null,renderSettings:null,rendererClass:null,constructor:function(_1135){dojo.mixin(this,_1135);},postscript:function(){if(this.contentModel){this._modelWatchHandle=[];dojo.forEach(dojo.isArray(this.modelPropertyName)?this.modelPropertyName:[this.modelPropertyName],dojo.hitch(this,function(_1136){this._modelWatchHandle.push(this.contentModel.watch(_1136,dojo.hitch(this,this._renderNode)));}));}this.checkEmptyHtml();},destroy:function(){dojo.forEach(this._modelWatchHandle,function(_1137){_1137.unwatch();});dojo.disconnect(this._renderDisplayNodeConnect);delete this.srcNodeRef;delete this.displayNode;this.inherited(arguments);},onReloadRequired:function(_1138){},onRender:function(block){},_renderNode:function(_1139,_113a,value){var _113b=this.contentLink;var _113c=this.renderSettings;var _113d=this.rendererClass;var _113e=this.nodePropertyName||this.modelPropertyName;var def=this.renderManager.renderValue(_113b,_113e,value,_113c,_113d);if(def!==this._lastRenderDeferred){this._lastRenderDeferred=def;dojo.when(def,dojo.hitch(this,function(_113f){if(this._lastRenderDeferred){if(_113f.doReload!==undefined&&_113f.doReload){this.onReloadRequired(this);}else{if(dojo.isString(_113f)){this._updateRendering(_113f);}else{if(_113f.innerHtml!==undefined){this._updateRendering(_113f.innerHtml,_113f.attributes);}else{if(_113f.error!==undefined){this._handleValidationError(_113f.error);}}}}if(def==this._lastRenderDeferred){this._lastRenderDeferred=null;}}}));}},_isEmptyHtml:function(_1140){var html="";if(!_1140){return false;}if(_1140.tagName=="IMG"){html=dojo.attr(_1140,"src")||"";}else{html=_1140.innerHTML;}html=html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");return (typeof html=="string")&&(html.replace(/\s*/g,"").length===0);},checkEmptyHtml:function(){var _1141;if(!this._showEmptyNode){return;}_1141=this._isEmptyHtml(this.displayNode);if(_1141){this.displayNode.innerHTML=dojo.string.substitute(this.emptyValue,this);}this._ensureSize();},_ensureSize:function(){try{this._clearComputedStyle();this._computeStyle();}catch(e){}},_clearComputedStyle:function(){var _1142=this._originalStyle;if(_1142){for(var prop in _1142){if(_1142.hasOwnProperty(prop)){_1132.set(this.displayNode,prop,this._originalStyle[prop]);}}this._originalStyle=null;}},_computeStyle:function(){if(!this.displayNode){return;}var _1143=_1132.get(this.displayNode),_1144={"minWidth":_1132.toPixelValue(this.displayNode,_1143.minWidth),"minHeight":_1132.toPixelValue(this.displayNode,_1143.minHeight),"display":_1143.display},_1145={},_1146=_1144.minHeight===0,_1147=_1144.minWidth===0,_1148=_1144.display==="inline",_1149=_1133.getMarginBox(this.displayNode,_1143);if(_1149.h<(_1146?this.minHeight:_1144.minHeight)||_1149.w<(_1147?this.minWidth:_1144.minWidth)){if(_1146){_1145.minHeight=this.minHeight+"px";}if(_1147){_1145.minWidth=this.minWidth+"px";}if(_1148){_1145.display="inline-block";}if(_1148||_1146||_1147){this._originalStyle=_1144;_1132.set(this.displayNode,_1145);}}},_updateRendering:function(_114a,_114b){this.displayNode.innerHTML=_114a;if(_114b){array.forEach(_114b,lang.hitch(this,function(_114c){this._updateAttribute(_114c);}));}this._hasEmptyHtml=this._isEmptyHtml(this.displayNode);if(this._hasEmptyHtml){this.checkEmptyHtml();if(!this._showEmptyNode){_1132.set(this.displayNode,"display","none");}}else{if(this._showEmptyNode){this._ensureSize();}}this.onRender(this);},_updateAttribute:function(_114d){if(_114d.name.toLowerCase()=="class"){_1131.add(this.displayNode,_114d.value);}else{_1134.set(this.displayNode,_114d.name,_114d.value);}},_handleValidationError:function(_114e){},render:function(){var val=this.contentModel.get(this.modelPropertyName);this._renderNode(this.modelPropertyName,val,val);},focus:function(){dijit.focus(this.displayNode);},setShowEmptyNode:function(val){this._showEmptyNode=val;if(this._hasEmptyHtml){this._updateRendering("");}}});});},"epi-cms/widget/overlay/overlayFactory":function(){define(["dojo/_base/lang","dojo/_base/Deferred","epi/string","epi-cms/widget/overlay/Property"],function(lang,_114f,_1150){return {defaultType:"epi-cms/widget/overlay/Property",create:function(_1151){var _1152=new _114f();var _1153=_1151.property.metadata.overlaySettings&&_1151.property.metadata.overlaySettings.customType;var _1154=_1151.property,_1155=_1150.slashName(_1153||this.defaultType);require([_1155],lang.hitch(this,function(_1156){var _1157=lang.mixin({name:_1154.name,contentModel:_1154.contentModel,displayName:_1154.metadata.displayName,disabled:_1151.disabled,sourceItemNode:_1151.node},_1154.overlayParams);var _1158=new _1156(_1157);_1152.resolve(_1158);}));return _1152;}};});},"epi-cms/widget/overlay/Property":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/widget/overlay/Item"],function(_1159,lang,_115a,Item){return _1159([Item],{onValueChange:function(_115b){},_getRightProperty:function(){var _115c=this.name;if(this.dndTargetPropertyName){_115c+=("."+_115a.pascalToCamel(this.dndTargetPropertyName));}return _115c;},onDrop:function(_115d,value){var _115e=this._getRightProperty();this.onValueChange({propertyName:_115e,value:value});}});});},"epi-cms/contentediting/editors/CheckBoxListEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dijit/focus","dijit/_TemplatedMixin","dijit/_Widget","dijit/form/CheckBox","epi/shell/widget/_ValueRequiredMixin"],function(array,_115f,lang,_1160,on,_1161,_1162,_1163,_1164,_1165){return _115f([_1163,_1162,_1165],{templateString:"<div class=\"dijit dijitReset dijitInline\"></div>",baseClass:"epi-checkBoxList",valueIsCsv:true,valueIsInclusive:true,value:null,constructor:function(){this._checkboxes=[];this._labelClickHandles=[];},buildRendering:function(){this.inherited(arguments);array.forEach(this.selections,this._addCheckBoxForItem,this);},destroy:function(){var _1166;while(_1166=this._checkboxes.pop()){_1166.destroyRecursive();}var _1167;while(_1167=this._labelClickHandles.pop()){_1167.remove();}this.inherited(arguments);},focus:function(){try{if(this._checkboxes.length>0){_1161.focus(this._checkboxes[0].domNode);}}catch(e){}},onChange:function(){},onBlur:function(){},onFocus:function(){},_calculateValue:function(){var _1168=[];var _1169=this.valueIsInclusive;array.forEach(this._checkboxes,function(_116a){if(_1169===_116a.checked){_1168.push(_116a.value);}});this._set("value",this.valueIsCsv?_1168.join(","):_1168);},_setValueAttr:function(value){this._set("value",value);var _116b=[];if(value){_116b=this.valueIsCsv?value.split(","):value;}var _116c=this.valueIsInclusive;array.forEach(this._checkboxes,function(_116d){_116d.set("checked",_116c===array.some(_116b,function(v){return v===_116d.value;}));});},_onBlur:function(){this.inherited(arguments);this.onBlur();},_addCheckBoxForItem:function(item){var _116e=_1160.create("span",null,this.domNode);var _116f=new _1164({value:item.value});_116f.placeAt(_116e);_116f.on("change",lang.hitch(this,function(){this._calculateValue();this.onChange(this.value);}));_116f.on("focus",lang.hitch(this,function(){this._set("focused",true);this.onFocus();}));_116f.on("blur",lang.hitch(this,function(){this._set("focused",false);this._onBlur();}));_116f.set("readOnly",!!this.readOnly);this._checkboxes.push(_116f);var label=_1160.create("label",{"for":_116f.id,innerHTML:item.text},_116e);this._labelClickHandles.push(on(label,"click",lang.hitch(this,function(){_1161.focus(_116f.domNode);})));}});});},"epi-cms/contentediting/editors/CollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/dom-class","dojo/json","dojo/on","dojo/Stateful","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dgrid/extensions/ColumnResizer","dgrid/extensions/ColumnReorder","put-selector/put","epi/shell/command/builder/ButtonBuilder","epi/shell/dgrid/Formatter","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/FormContainer","epi/string","epi/shell/command/withConfirmation","epi-cms/contentediting/editors/model/CollectionEditorModel","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/contentediting/_EditorWrapperBase","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi-cms/contentediting/editors/DefaultGridAssembler","./_AddItemDialogMixin","dojo/text!./templates/CollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor"],function(array,_1170,lang,_1171,_1172,_1173,json,on,_1174,when,_1175,_1176,_1177,_1178,_1179,_117a,_117b,put,_117c,_117d,_117e,_117f,_1180,_1181,_1182,_1183,_1184,DnD,_1185,_1186,_1187,_1188,_1189,_118a){return _1170([_1176,_1175,_117e,_1188],{templateString:_1189,multiple:true,baseClass:"epi-collection-editor",value:null,model:null,modelType:_1182,itemType:null,generateColumns:true,excludedColumns:null,includedColumns:null,gridType:_1170([_1178,_117d,_1179,_1177,DnD,_117a,_117b,_1186]),gridAssemblerType:_1187,gridSettings:null,itemModelType:null,itemEditorType:_117f,useFullWidth:true,_noDataMessage:"<span><span class=\"dijitReset dijitInline\">"+_118a.noitems+"</span></span>",_currentProviderHandler:null,postMixInProperties:function(){this.inherited(arguments);this.itemModelType=this.itemModelType||_1183;this.model=this.model||new this.modelType({itemType:this.itemType,itemModelType:this.itemModelType,data:this.value,availableCommands:this.commands});this.own(on(this.model,"itemsChanged",lang.hitch(this,this._onItemsChanged)));this.gridSettings=lang.mixin(this.gridSettings||{},{noDataMessage:this._noDataMessage});if(this.readOnly){this.allowedDndTypes=[];this.gridSettings.dndDisabled=true;}this.gridSettings.dndParams={copyOnly:true,accept:this.allowedDndTypes||[],creator:lang.hitch(this,this._dndNodeCreator)};},postCreate:function(){this.inherited(arguments);when(this.model.initialize(),lang.hitch(this,function(){this._setupGrid();}));},onChange:function(value){},_setValueAttr:function(value){this._set("value",value);if(this.model){this.model.set("data",value);}},_dndNodeCreator:function(item,hint){var _118b=this.allowedDndTypes,node=_1172.create("div").appendChild(document.createTextNode(item.text));return {"node":node,"type":_118b,"data":item};},_setupGrid:function(){var _118c=this._getGridDefinition();var _118d=new this.gridAssemblerType({gridType:this.gridType,gridSettings:this.gridSettings,columnDefinitions:_118c,listCommands:this.readOnly?[]:this.model.getListCommands(),itemCommandsFactory:lang.hitch(this,function(item,_118e){return this.readOnly?[]:this.model.getItemCommands(item,this.commands,_118e);})});this.own(this.grid=_118d.build(this.gridNode,this.commandTargetNode));_1173.add(this.gridNode,"epi-plain-grid-modal epi-plain-grid--margin-bottom epi-plain-grid--cell-borders");if(!this.gridSettings.dndDisabled){this._setupDnD();}var items=this.model.get("items");this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}this.own(this.grid.on(".dgrid-row:click",lang.hitch(this,this.onGridRowClick)));this.own(this.grid.on(".dgrid-row:dblclick",lang.hitch(this,this.onGridRowDblClick)));},_setupDnD:function(){this.own(_1171.after(this.grid.dndSource,"onDropData",lang.hitch(this,this.onDndDrop),true));},onDndDrop:function(_118f,_1190,nodes,copy){var i;if(this.grid.dndSource===_1190){for(i=0;i<nodes.length;i++){this.model.moveItem(this.grid.dndSource.getItem(nodes[i].id).data,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}}else{this.onDropping&&this.onDropping();this.onFocus();for(i=0;i<_118f.length;i++){this._addItem(_118f[i]);if(_1190&&_1190.grid&&_1190.grid.consumer&&_1190.grid.consumer!==this){_1190.grid.consumer.model.removeItem(this.grid.dndSource.getItem(nodes[i].id).data);}}}},_addItem:function(item){when(this._dndGetItemData(item),lang.hitch(this,function(_1191){this.model.addItem(_1191,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}));},_dndGetItemData:function(item){return item.data;},_getGridDefinition:function(){var _1192=this.generateColumns?this.model.generateColumnsDefinition(this.excludedColumns):this.includedColumns||{};return this.model.generateFormatters(_1192);},_onGridRowSelect:function(e){if(!this.grid.itemCommandProviderMap){return;}if(this._currentProviderHandler){this._currentProviderHandler.removeProvider();}var item=this.grid.row(e).data;this._currentProviderHandler=this.grid.contextMenu.addProvider(this.grid.itemCommandProviderMap[json.stringify(item)]);},onGridRowClick:function(e){this._onGridRowSelect(e);},onGridRowDblClick:function(e){var item={model:this.grid.row(e).data};this.model.editItemDelegate(item);},_getDialogConfirmActionText:function(){return this.gridSettings.confirmActionText?this.gridSettings.confirmActionText:this.inherited(arguments);},onExecuteDialog:function(){var item=this._itemEditor.get("value");if(this._editingItemIndex!==undefined){this.model.saveItem(item,this._editingItemIndex);}else{this.model.addItem(item);}},_onItemsChanged:function(items){if(this.grid){for(var item in this.grid.itemCommandProviderMap){delete this.grid.itemCommandProviderMap[item];}this.grid.refresh();this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}}var value=this.model.get("data");this._set("value",value);if(!this.readOnly){this.onChange(value);if(this.grid&&this.parent instanceof _1184&&this.editMode&&this.editMode==="formedit"){this.onBlur();}}},_renderNoDataMessage:function(){this.grid.noDataNode=put(this.grid.contentNode,"div.dgrid-no-data");this.grid.noDataNode.innerHTML=this.grid.noDataMessage;},_onBlur:function(){if(this.grid.contextMenu&&this.grid.contextMenu.isShowingNow){return;}this.inherited(arguments);}});});},"dgrid/extensions/ColumnReorder":function(){define("dgrid/extensions/ColumnReorder",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/on","dojo/query","dojo/dnd/Source","put-selector/put","xstyle/css!../css/extensions/ColumnReorder.css"],function(lang,_1193,_1194,on,query,_1195,put){var _1196=/(\d+)(?:-(\d+))?$/;function _1197(grid,match){var _1198=match[2],_1199=grid[_1198?"columnSets":"subRows"][match[1]];return _1198?_1199[match[2]]:_1199;};function _119a(grid,match,_119b){if(match[2]){grid.columnSets[match[1]][match[2]]=_119b;}else{grid.subRows[match[1]]=_119b;}};function _119c(_119d){return "dgrid-"+_119d+"-";};function _119e(_119f,_11a0){return _11a0.slice(_119c(_119f).length);};var _11a1=_1193(_1195,{copyState:function(){return false;},checkAcceptance:function(_11a2,nodes){return _11a2==this;},_legalMouseDown:function(evt){return evt.target.className.indexOf("dgrid-resize-handle")>-1?false:this.inherited(arguments);},onDropInternal:function(nodes){var grid=this.grid,match=_1196.exec(_119e(grid.id,nodes[0].getAttribute("dndType"))),_11a3=match[2]?"columnSets":"subRows",_11a4=_1197(grid,match),_11a5=grid.columns;this.inherited(arguments);if(!match){return;}setTimeout(function(){var _11a6=_1194.map(nodes[0].parentNode.childNodes,function(col){return _11a5[col.columnId];}),_11a7;_119a(grid,match,_11a6);_11a7={grid:grid,subRow:_11a6,column:_11a5[nodes[0].columnId],bubbles:true,cancelable:true,parentType:"dnd"};_11a7[_11a3]=grid[_11a3];if(on.emit(grid.domNode,"dgrid-columnreorder",_11a7)){grid.set(_11a3,grid[_11a3]);}else{_119a(grid,match,_11a4);grid.renderHeader();if(this._sort&&this._sort.length){this.updateSortArrow(this._sort);}}},0);}});var _11a8=_1193(null,{columnDndConstructor:_11a1,_initSubRowDnd:function(_11a9,_11aa){var _11ab,c,len,col,th;for(c=0,len=_11a9.length;c<len;c++){col=_11a9[c];if(col.reorderable===false){continue;}th=col.headerNode;if(th.tagName!="TH"){th=th.parentNode;}put(th,".dojoDndItem[dndType="+_11aa+"]");if(!_11ab){_11ab=th.parentNode;}}if(_11ab){this._columnDndSources.push(new this.columnDndConstructor(_11ab,{horizontal:true,grid:this}));}},renderHeader:function(){var _11ac=_119c(this.id),_11ad,cs;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets){for(cs=0,_11ad=this.columnSets.length;cs<_11ad;cs++){_1194.forEach(this.columnSets[cs],function(_11ae,sr){this._initSubRowDnd(_11ae,_11ac+cs+"-"+sr);},this);}}else{_1194.forEach(this.subRows,function(_11af,sr){this._initSubRowDnd(_11af,_11ac+sr);},this);}},_destroyColumns:function(){if(this._columnDndSources){_1194.forEach(this._columnDndSources,function(_11b0){_11b0.destroy();});}this.inherited(arguments);}});_11a8.ColumnDndSource=_11a1;return _11a8;});},"epi-cms/contentediting/editors/model/CollectionEditorModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/when","dojo/promise/all","dijit/Destroyable","dojox/mvc/StatefulArray","epi/dependency","epi/string","epi/shell/command/DelegateCommand","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared"],function(array,_11b1,lang,_11b2,_11b3,_11b4,_11b5,when,all,_11b6,_11b7,_11b8,_11b9,_11ba,_11bb,_11bc,_11bd){var _11be={none:0,add:1,edit:2,remove:4,moveUp:8,moveDown:16};var _11bf=_11b1([_11b5,_11b4,_11b6],{data:null,itemType:null,itemModelType:null,itemMetadata:null,metadataManager:null,availableCommands:null,_itemModels:null,_itemsUnchanged:false,postscript:function(){this.inherited(arguments);this.metadataManager=this.metadataManager||_11b8.resolve("epi.shell.MetadataManager");this.itemModelType=this.itemModelType||_11bb;},initialize:function(){return when(this.metadataManager.getMetadataForType(this.itemType),lang.hitch(this,function(_11c0){this.set("itemMetadata",_11c0);return this._initData();}));},_initData:function(){this._itemModels=new _11b7([]);_11b2.before(this._itemModels,"sort",lang.hitch(this,function(){this._itemsUnchanged=true;},true));this.own(this._itemModels.watchElements(lang.hitch(this,function(){if(!this._itemsUnchanged){this.emit("itemsChanged",this.get("items"));}this._itemsUnchanged=false;})));var _11c1=array.map(this.data,function(item){var _11c2=new this.itemModelType();return when(_11c2.fromItemData(item),function(){return _11c2;});},this);return when(all(_11c1),lang.hitch(this,function(_11c3){this._itemModels.splice.apply(this._itemModels,[0,this._itemModels.length].concat(_11c3));}));},getListCommands:function(_11c4){return [new _11ba({name:"add",tooltip:_11bd.action.add,iconClass:"epi-iconPlus",canExecute:true,isAvailable:this._commandIsAvailable(_11be.add,_11c4),delegate:lang.hitch(this,this.addItemDelegate)})];},getItemCommands:function(item,_11c5,_11c6){return [new _11ba({name:"edit",category:_11c6,label:_11bd.action.edit,iconClass:"epi-iconPen",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_11be.edit,_11c5),delegate:lang.hitch(this,this.editItemDelegate)}),new _11ba({name:"moveUp",category:_11c6,label:_11bd.action.moveup,iconClass:"epi-iconUp",model:item,canExecute:this._itemModels.indexOf(item)>0,isAvailable:this._commandIsAvailable(_11be.moveUp,_11c5),delegate:lang.hitch(this,this.moveItemUpDelegate)}),new _11ba({name:"moveDown",category:_11c6,label:_11bd.action.movedown,iconClass:"epi-iconDown",model:item,canExecute:this._itemModels.indexOf(item)<this._itemModels.length-1,isAvailable:this._commandIsAvailable(_11be.moveDown,_11c5),delegate:lang.hitch(this,this.moveItemDownDelegate)}),new _11ba({name:"remove",category:_11c6,label:_11bd.action.remove,iconClass:"epi-iconTrash",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_11be.remove,_11c5),delegate:lang.hitch(this,this.removeItemDelegate)})];},_commandIsAvailable:function(_11c7,_11c8){_11c8=_11c8||this.availableCommands;return !!(_11c7&_11c8);},generateColumnsDefinition:function(_11c9){var _11ca={};array.forEach(array.filter(this.itemMetadata.properties,function(_11cb){return array.every(_11c9,function(col){return col!==_11cb.name;});}),function(_11cc){var _11cd=_11b9.pascalToCamel(_11cc.name);_11ca[_11cd]={label:_11cc.displayName};});return _11ca;},generateFormatters:function(_11ce){for(var _11cf in _11ce){array.some(this.itemMetadata.properties,function(_11d0){if(_11cf==_11b9.pascalToCamel(_11d0.name)){this._setTypeFormatter(_11d0,_11ce[_11cf]);this._setSelectionFactoryFormatter(_11d0,_11ce[_11cf]);this._setWrappingFormatter(_11ce[_11cf]);return true;}},this);}return _11ce;},_typeFormatterMap:{"System.DateTime":_11bc.localizedDate,"System.Boolean":_11bc.friendlyBoolean},_wrappingFormatterMap:{"SecondaryText":function(_11d1){if(_11d1){return function(value){return _11bc.secondaryText(_11d1(value),true);};}return function(value){return _11bc.secondaryText(value);};},"VisibleLink":function(_11d2){if(_11d2){return function(value){return _11bc.visibleLink(_11d2(value),true);};}return function(value){return _11bc.visibleLink(value);};}},_setTypeFormatter:function(_11d3,_11d4){for(var _11d5 in this._typeFormatterMap){if(_11d3.modelType.indexOf(_11d5)>-1){_11d4.formatter=this._typeFormatterMap[_11d5];break;}}},_setSelectionFactoryFormatter:function(_11d6,_11d7){if(_11d6.selections&&_11d6.selections.length>0){var _11d8=_11d6.selections;if(_11d7){_11d7.formatter=function(value){var _11d9=value;_11d8.forEach(function(_11da){if(_11da.value===value){_11d9=_11da.text;}});return _11d9;};}}},_setWrappingFormatter:function(_11db){if(_11db.wrappingFormatter&&this._wrappingFormatterMap[_11db.wrappingFormatter]){_11db.formatter=this._wrappingFormatterMap[_11db.wrappingFormatter](_11db.formatter);}},addItemDelegate:function(){this.emit("toggleItemEditor",null);},editItemDelegate:function(cmd){if(this._commandIsAvailable(_11be.edit,this.availableCommands)){var item=cmd.model;var index=this._itemModels.indexOf(item);this.emit("toggleItemEditor",item,index);}},removeItemDelegate:function(cmd){this.removeItem(cmd.model);},moveItemUpDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _11dc=index-1;if(_11dc>=0){this.moveItem(item,this._itemModels[_11dc],true);}},moveItemDownDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _11dd=index+1;if(_11dd<this._itemModels.length){this.moveItem(item,this._itemModels[_11dd],false);}},saveItem:function(item,index){var _11de=new this.itemModelType();return when(_11de.fromItemData(item),lang.hitch(this,function(){this._itemModels.splice(index,1,_11de);}));},addItem:function(item,_11df,_11e0){var _11e1=new this.itemModelType();return when(_11e1.fromItemData(item),lang.hitch(this,function(){var _11e2;if(!_11df){_11e2=this._itemModels.length;}else{_11e2=this._itemModels.indexOf(_11df);if(!_11e0){_11e2++;}}this._itemModels.splice(_11e2,0,_11e1);}));},moveItem:function(item,_11e3,_11e4){this._itemsUnchanged=true;var _11e5=this._itemModels.indexOf(item);this._itemModels.splice(_11e5,1);var _11e6=this._itemModels.indexOf(_11e3);var _11e7=_11e4?_11e6:_11e6+1;_11e7=item==_11e3?_11e5:_11e7;this._itemModels.splice(_11e7,0,item);},removeItem:function(item){var index=this._itemModels.indexOf(item);this._itemModels.splice(index,1);},_dataSetter:function(value){this.data=value;this._initData();},_dataGetter:function(){return array.map(this._itemModels,function(_11e8){return _11e8.toItemData();},this);},_itemsGetter:function(){return this._itemModels;}});_11bf.commandMask=_11be;return _11bf;});},"dojox/mvc/StatefulArray":function(){define("dojox/mvc/StatefulArray",["dojo/_base/lang","dojo/Stateful"],function(lang,_11e9){function _11ea(a){if(a._watchElementCallbacks){a._watchElementCallbacks();}return a;};var _11eb=function(a){var array=lang._toArray(a);var ctor=_11eb;ctor._meta={bases:[_11e9]};array.constructor=ctor;return lang.mixin(array,{pop:function(){return this.splice(this.get("length")-1,1)[0];},push:function(){this.splice.apply(this,[this.get("length"),0].concat(lang._toArray(arguments)));return this.get("length");},reverse:function(){return _11ea([].reverse.apply(this,lang._toArray(arguments)));},shift:function(){return this.splice(0,1)[0];},sort:function(){return _11ea([].sort.apply(this,lang._toArray(arguments)));},splice:function(idx,n){var l=this.get("length");idx+=idx<0?l:0;var p=Math.min(idx,l),_11ec=this.slice(idx,idx+n),adds=lang._toArray(arguments).slice(2);[].splice.apply(this,[idx,n].concat(new Array(adds.length)));for(var i=0;i<adds.length;i++){this.set(p+i,adds[i]);}if(this._watchElementCallbacks){this._watchElementCallbacks(idx,_11ec,adds);}if(this._watchCallbacks){this._watchCallbacks("length",l,l-_11ec.length+adds.length);}return _11ec;},unshift:function(){this.splice.apply(this,[0,0].concat(lang._toArray(arguments)));return this.get("length");},concat:function(a){return new _11eb([].concat(this).concat(a));},join:function(sep){var list=[];for(var l=this.get("length"),i=0;i<l;i++){list.push(this.get(i));}return list.join(sep);},slice:function(start,end){var l=this.get("length");start+=start<0?l:0;end=(end===void 0?l:end)+(end<0?l:0);var slice=[];for(var i=start||0;i<Math.min(end,this.get("length"));i++){slice.push(this.get(i));}return new _11eb(slice);},watchElements:function(_11ed){var _11ee=this._watchElementCallbacks,_11ef=this;if(!_11ee){_11ee=this._watchElementCallbacks=function(idx,_11f0,adds){for(var list=[].concat(_11ee.list),i=0;i<list.length;i++){list[i].call(_11ef,idx,_11f0,adds);}};_11ee.list=[];}_11ee.list.push(_11ed);var h={};h.unwatch=h.remove=function(){for(var list=_11ee.list,i=0;i<list.length;i++){if(list[i]==_11ed){list.splice(i,1);break;}}};return h;}},_11e9.prototype,{set:function(name,value){if(name=="length"){var old=this.get("length");if(old<value){this.splice.apply(this,[old,0].concat(new Array(value-old)));}else{if(value>old){this.splice.apply(this,[value,old-value]);}}return this;}else{var _11f1=this.length;_11e9.prototype.set.call(this,name,value);if(_11f1!=this.length){_11e9.prototype.set.call(this,"length",this.length);}return this;}}});};return lang.setObject("dojox.mvc.StatefulArray",_11eb);});},"epi/shell/command/DelegateCommand":function(){define("epi/shell/command/DelegateCommand",["dojo/_base/declare","epi/shell/command/_Command"],function(_11f2,_11f3){return _11f2([_11f3],{delegate:null,_execute:function(){return this.delegate?this.delegate.apply(this,[this].concat(arguments)):null;}});});},"epi-cms/contentediting/editors/model/CollectionEditorItemModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful"],function(_11f4,lang,_11f5){return _11f4([_11f5],{_itemData:null,name:null,fromItemData:function(_11f6){lang.mixin(this,_11f6);this._itemData=_11f6;this.name=this.name||this._itemData.toString();},toItemData:function(){var _11f7={};for(var _11f8 in this._itemData){if(this._itemData.hasOwnProperty(_11f8)){_11f7[_11f8]=this.get(_11f8);}}return _11f7;}});});},"epi-cms/contentediting/editors/DefaultGridAssembler":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/json","dojo/Stateful","epi/shell/command/builder/ButtonBuilder","epi/shell/command/withConfirmation","epi-cms/dgrid/formatters"],function(array,_11f9,lang,json,_11fa,_11fb,_11fc,_11fd){var _11fe=_11f9([],{gridType:null,gridSettings:null,columnDefinitions:null,listCommands:null,itemCommandsFactory:null,constructor:function(_11ff){lang.mixin(this,_11ff);},build:function(_1200,_1201){},instantiateGrid:function(_1202,_1203,_1204,node){return new _1202(lang.mixin(_1203,{columns:_1204,className:"epi-plain-grid"}),node);}});return _11f9([_11fe],{itemCommandProviderMap:null,constructor:function(){this.itemCommandProviderMap={};},build:function(_1205,_1206){this.columnDefinitions["_epiGrid_Action"]={renderHeaderCell:function(){},renderCell:lang.hitch(this,function(item,value,node,_1207){var _1208=this._getItemCommands(item);this.itemCommandProviderMap[json.stringify(item)]=new _11fa({commands:_1208});this.renderActionMenu(item,node,_1208);}),className:"epi-columnNarrow",sortable:false};var grid=this.instantiateGrid(this.gridType,this.gridSettings,this.columnDefinitions,_1205);grid.itemCommandProviderMap=this.itemCommandProviderMap;this._setupCommands(this.listCommands,_1206);return grid;},renderActionMenu:function(item,node,_1209){node.innerHTML=_1209&&_1209.length>0?_11fd.menu({title:epi.resources.action.options}):"";},_getItemCommands:function(item){var _120a=this.itemCommandsFactory(item,"context");array.some(_120a,function(_120b){if(_120b.name=="remove"&&this.gridSettings.useDeleteWithConfirmation){_120b=_11fc(_120b,null,{title:this.gridSettings.deleteConfirmationTitle,description:this.gridSettings.deleteConfirmationMessage});return true;}},this);return _120a;},_setupCommands:function(_120c,_120d){var _120e=this.getListCommandBuilder();array.forEach(_120c,function(_120f){_120e.create(_120f,_120d);},this);},getListCommandBuilder:function(){return new _11fb({settings:{showLabel:true}});}});});},"epi-cms/contentediting/editors/_AddItemDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/dialog/Dialog","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor","epi/i18n!epi/nls/episerver.shared"],function(_1210,lang,on,_1211,_1212,_1213,_1214,_1215){return _1210([_1211,_1213],{itemEditorType:null,_itemEditor:null,_dialog:null,dialogParams:null,_editingItemIndex:null,postCreate:function(){this.inherited(arguments);this.own(on(this.model,"toggleItemEditor",lang.hitch(this,this._onToggleItemEditor)));},_onToggleItemEditor:function(item,index){this._setupItemEditor();this._itemEditor.set("value",item);this._editingItemIndex=index;this.isShowingChildDialog=true;this._dialog.show();this._setDialogConfirmActionText(item);this._setDialogTitle(item);this._setDialogConfirmActionStatus(item);},_setupItemEditor:function(){this._itemEditor=this._createItemEditor();this.own(this._dialog=new _1212(lang.mixin({title:this._getDialogTitleText(),content:this._itemEditor,destroyOnHide:true},this.dialogParams)));this._dialog.own(this._itemEditor,this.connect(this._itemEditor,"onChange","_setDialogConfirmActionStatus"),on(this._dialog,"execute",lang.hitch(this,function(){if(this.validate()){this.onExecuteDialog();}})),on(this._dialog,"hide",lang.hitch(this,this._onCancelDialog)));},_createItemEditor:function(){return new this.itemEditorType({metadata:this.model.get("itemMetadata"),doLayout:false});},_setDialogTitle:function(_1216){this._dialog.set("title",this._getDialogTitleText(_1216));},_getDialogTitleText:function(_1217){return _1214.title;},_onCancelDialog:function(){this.isShowingChildDialog=false;this.onCancelDialog();},onExecuteDialog:function(){},onCancelDialog:function(){},_setDialogConfirmActionText:function(_1218){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"label",this._getDialogConfirmActionText(_1218));},_getDialogConfirmActionText:function(_1219){return _1219?_1215.action.ok:_1215.action.add;},_setDialogConfirmActionStatus:function(item){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"disabled",!item||item==="");}});});},"epi-cms/widget/_HasChildDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom","dijit/_FocusMixin","dijit/popup"],function(_121a,lang,_121b,dom,_121c,popup){return _121a([_121c],{isShowingChildDialog:false,_openedChildDialog:null,_waitingForFocus:false,startup:function(){this.own(_121b.before(popup,"open",lang.hitch(this,"_onPopupOpen"),true),_121b.after(popup,"close",lang.hitch(this,"_onPopupClosed"),true));},_onPopupOpen:function(_121d){var popup=_121d.popup;var _121e=popup&&popup.currentTarget;if(_121e&&dom.isDescendant(_121e,this.domNode)){this._openedChildDialog=popup;this.isShowingChildDialog=true;}},_onPopupClosed:function(popup){if(this._openedChildDialog===popup){this._openedChildDialog=null;this.isShowingChildDialog=false;this._waitingForFocus=true;setTimeout(lang.hitch(this,"_waitForFocus"),0);}},_waitForFocus:function(){if(this._waitingForFocus){this._waitingForFocus=false;this._onBlur();}},_onBlur:function(){if(this.isShowingChildDialog){return;}this.inherited(arguments);},_onFocus:function(){this._waitingForFocus=false;if(this.isShowingChildDialog){return;}this.inherited(arguments);}});});},"url:epi-cms/contentediting/editors/templates/CollectionEditor.html":"<div class=\"dijitInline\" style=\"width:100%;\">\r\n    <div data-dojo-attach-point=\"commandTargetNode\"></div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>","epi-cms/contentediting/editors/ContentAreaEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-style","dojo/Deferred","dojo/on","dojo/topic","dojo/when","dijit/registry","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_CssStateMixin","dijit/_WidgetsInTemplateMixin","epi/dependency","epi/shell/dnd/Target","epi/shell/command/_CommandProviderMixin","./_ContentAreaTree","./_ContentAreaTreeModel","./_TextWithActionLinksMixin","epi-cms/_ContentContextMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi/shell/widget/ContextMenu","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/overlay/Block","epi-cms/widget/command/CreateContentFromSelector","epi-cms/widget/_HasChildDialogMixin","epi-cms/contentediting/command/BlockRemove","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/MoveToPrevious","epi-cms/contentediting/command/MoveToNext","epi-cms/contentediting/command/MoveOutsideGroup","epi-cms/contentediting/command/Personalize","epi-cms/contentediting/command/SelectDisplayOption","dojo/text!./templates/ContentAreaEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_121f,lang,_1220,_1221,_1222,on,topic,when,_1223,_1224,_1225,_1226,_1227,_1228,_1229,_122a,_122b,_122c,_122d,_122e,_122f,_1230,_1231,_1232,_1233,_1234,_1235,_1236,_1237,_1238,_1239,_123a,_123b,_123c,_123d,_123e){return _121f([_1224,_1225,_1227,_1226,_1232,_122e,_122a,_1235,_122d],{baseClass:"epi-content-area-editor",res:_123e,templateString:_123d,value:null,multiple:true,parent:null,overlayItem:null,model:null,intermediateChanges:true,editMode:"onpageedit",_contextService:null,_preventOnBlur:false,_dndTarget:null,constructor:function(){this.allowedDndTypes=[];},onChange:function(value){},_handleModelChange:function(value){this.validate();this.onChange(value);},_onBlur:function(){if(this._preventOnBlur){return;}this.inherited(arguments);},focus:function(){if(this.model.get("value").length>0){this._focusManager.focus(this.treeNode);}else{this.textWithLinks.focus();}},postMixInProperties:function(){this.inherited(arguments);this.commands=this._commands||[new _1237(),new _123c(),new _123b({category:null}),new _123a(),new _1238(),new _1239(),new _1236()];this.model=new _1230();this.own(this.model);this.own(this.model.watch("selectedItem",lang.hitch(this,function(name,_123f,_1240){this.updateCommandModel(_1240);})));this.own(on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._set("value",this.model.get("value"));this._handleModelChange(this.value);})));},postCreate:function(){this.inherited(arguments);this.set("emptyMessage",_123e.emptymessage);if(this.parent&&this.overlayItem){this.connect(this.parent,"onStartEdit",function(){this._selectFromOverlay(this.overlayItem.model);});}this.own(topic.subscribe("/dnd/start",lang.hitch(this,this._startDrag)));},buildRendering:function(){this.inherited(arguments);this._contextService=this._contextService||_1228.resolve("epi.shell.ContextService");this.contextMenu=new _1231();this.contextMenu.addProvider(this);this.own(this.contextMenu);this.setupActionLinks(this.actionsContainer);this.tree=new _122b({accept:this.allowedDndTypes,contextMenu:this.contextMenu,model:new _122c({model:this.model})},this.treeNode);this.own(this.tree);this._dndTarget=new _1229(this.actionsContainer,{accept:this.allowedDndTypes,isSource:false,alwaysCopy:false,insertNodes:function(){}});this.own(_1220.after(this._dndTarget,"onDropData",lang.hitch(this,function(_1241,_1242,nodes,copy){var model=_1241[0].data;this.model.modify(lang.hitch(this,function(){this.model.addChild(model);}));}),true));},startup:function(){this.inherited(arguments);this.tree.startup();this.contextMenu.startup();},isCreateLinkVisible:function(){var _1243=new _1222();var _1244=this._contextService&&this._contextService.currentContext;when(this.getCurrentContent(),function(_1245){var _1246=true;if(_1244){_1246=_1244.capabilities.resourceable&&!(_1244.currentMode==="create"||_1244.currentMode==="translate");}var _1247=_122f.isActionAvailable(_1245,_122f.action.Create,_122f.providerCapabilities.Create,true);_1243.resolve(!!(_1246&&_1247));});return _1243.promise;},executeAction:function(_1248){if(_1248==="createnewblock"){this._preventOnBlur=true;var _1249=new _1234({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,canChangeLocalAssetName:false});_1249.set("model",{save:lang.hitch(this,function(block){this._preventOnBlur=false;var value=lang.clone(this.get("value"),true)||[];value.push(block);this.set("value",value);this.onChange(value);this.onBlur();}),cancel:lang.hitch(this,function(){this._preventOnBlur=false;})});_1249.execute();}},isValid:function(){return (!this.required||this.model.get("value").length>0);},_setReadOnlyAttr:function(_124a){this._set("readOnly",_124a);_1221.set(this.actionsContainer,"display",_124a?"none":"");if(this._source){this._source.isSource=!this.readOnly;}if(this.model){this.model.set("readOnly",_124a);}this.tree.set("readOnly",_124a);},_checkAcceptance:function(_124b,nodes){return this.readOnly?false:this._source.defaultCheckAcceptance(_124b,nodes);},_setValueAttr:function(value){this._set("value",value||[]);this.tree.set("selectedItems",null);this._supressValueChanged=true;this.model.set("value",value);this._supressValueChanged=false;},_selectFromOverlay:function(_124c){var child=_124c&&_124c.selectedItem&&_124c.selectedItem.serialize(),model=this.model,path=["root"];if(!child){return;}if(child.contentGroup){model=model.getChild({name:child.contentGroup});path.push(model.id);}model=model.getChild(child);if(!model){return;}path.push(model.id);model.set("selected",true);model.set("ensurePersonalization",_124c.selectedItem.ensurePersonalization);this.tree.set("path",path);},_startDrag:function(_124d,nodes,copy){var _124e=_1223.getEnclosingWidget(nodes[0]);if(_124e.isInstanceOf(_1233)&&this.parent.cancel){this.parent.set("isModified",false);this.parent.cancel();}}});});},"epi-cms/contentediting/editors/_ContentAreaTree":function(){define(["dojo/_base/declare","dojo/aspect","dojo/_base/event","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dijit/registry","epi/dependency","epi/shell/conversion/ObjectConverterRegistry","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","./_BlockTreeNode","./_GroupTreeNode"],function(_124f,_1250,event,array,lang,_1251,_1252,_1253,_1254,_1255,_1256,Tree,_1257,_1258,_1259,_125a){return _124f([Tree],{showRoot:false,dndController:_1255,betweenThreshold:8,postMixInProperties:function(){this.inherited(arguments);this.dndParams.push("accept");this.accept.push("personalizationarea");},postCreate:function(){this.inherited(arguments);_1251.add(this.domNode,"epi-tree-mngr");this.own(_1250.after(this.dndController,"onDndItemRemoved",lang.hitch(this,function(_125b){if(_125b[0]&&_125b[0].data){this.model.deleteItem(_125b[0].data);}}),true));this.own(_1250.after(this,"_onItemChildrenChange",lang.hitch(this,function(_125c,_125d){array.forEach(_125d,function(child){var _125e=this._itemNodesMap[this.model.getIdentity(child)];if(child.expandOnAdd){this._expandNode(_125e[0]);}if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){_125e[0].showPersonalizationSelector();}},this);}),true));},_setReadOnlyAttr:function(_125f){this._set("readOnly",_125f);if(this.dndController){this.dndController.isSource=!_125f;}},getItemType:function(item){if(!item.typeIdentifier){if(item.contentGroup!==undefined){return ["personalizationarea"];}else{return null;}}return this.accept;},checkItemAcceptance:function(_1260,_1261,_1262,copy){if(this.tree.readOnly){return false;}var _1263=_1252.getEnclosingWidget(_1260);var _1264=_1263.item;var _1265=true;_1261.forInSelectedItems(function(item){_1265=this.tree.model.checkItemAcceptance(_1264,item.data.item,_1262);},this);return _1265;},_onNodeMouseEnter:function(node){node.set("mouseHover",true);},_onNodeMouseLeave:function(node){node.set("mouseHover",false);},_createTreeNode:function(model){var node;if(model.item instanceof _1258){node=new _125a(model);}else{if(model.item instanceof _1257){node=new _1259(model);}else{node=this.inherited(arguments);}}node.set("contextMenu",this.contextMenu);node.set("dndData",model.item);return node;},onClick:function(item,node,e){if(node instanceof _125a){if(node.isExpanded){this._collapseNode(node);}else{this._expandNode(node);}}}});});},"epi-cms/contentediting/viewmodel/ContentBlockViewModel":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/string","dojo/topic","dojo/Deferred","dojo/when","dojo/promise/all","dojox/html/entities","epi","epi/dependency","./_ViewModelMixin","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1266,array,lang,_1267,topic,_1268,when,all,_1269,epi,_126a,_126b,_126c,_126d){return _1266([_126c,_126b],{label:null,store:null,hasSiblings:true,isVisible:true,settings:{displayOptionsAttributeName:"data-epi-content-display-option",contentGroupAttributeName:"data-contentgroup"},constructor:function(){this.roleIdentities=this.roleIdentities||[];this._notExistRoleIdentities=this._notExistRoleIdentities||[];this.attributes={};},postscript:function(){this.inherited(arguments);if(!this.store){var _126e=_126a.resolve("epi.storeregistry");this.store=_126e.get("epi.cms.visitorgroup");}this.set("label",this.name);this._reloadRoles();},serialize:function(){return {contentGroup:this.contentGroup,contentLink:this.contentLink,name:this.name,roleIdentities:this.roleIdentities,typeIdentifier:this.typeIdentifier,attributes:this.attributes};},equals:function(item){for(var prop in item){if(!epi.areEqual(this[prop],item[prop])){return false;}}return true;},isRoleSelected:function(_126f){if(!this.roleIdentities){return false;}return this.roleIdentities.indexOf(_126f)>-1;},hasAnyRoles:function(){if(!this.roleIdentities){return false;}return this.roleIdentities.length>0;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},moveOutsideGroup:function(){if(!this.contentGroup){return;}this.parent.modify(function(){this.parent.moveOutsideGroup(this);},this);},remove:function(){this.parent.modify(function(){this.parent.removeChild(this);},this);},personalize:function(){this.parent.modify(function(){this.parent.personalize(this);},this);},selectRole:function(_1270,_1271){this.roleIdentities=this.roleIdentities||[];var index=array.indexOf(this.roleIdentities,_1270);if(index>=0){if(!_1271){this.roleIdentities.splice(index,1);}}else{if(_1271){this.roleIdentities.push(_1270);}}if(this._notExistRoleIdentities.length>0){this.roleIdentities=array.filter(this.roleIdentities,lang.hitch(this,function(item,i){return this._notExistRoleIdentities.indexOf(item)<0;}));}this.set("roleIdentities",this.roleIdentities);},resetRoleIdentities:function(){this.set("visible",true);this.set("roleIdentities",null);},_displayOptionSetter:function(_1272){this.attributes[this.settings.displayOptionsAttributeName]=_1272;},_displayOptionGetter:function(){return this.attributes[this.settings.displayOptionsAttributeName];},_roleIdentitiesSetter:function(_1273){this.roleIdentities=_1273||[];this._notExistRoleIdentities=[];this._reloadRoles();},_parentSetter:function(_1274){this.parent=_1274;this.set("contentGroup",this.parent.name);},_contentGroupSetter:function(_1275){this.contentGroup=_1275;this.attributes[this.settings.contentGroupAttributeName]=_1275;this._reloadRoles();},_reloadRoles:function(){if(!this.store){return;}var def=new _1268();var defs=array.map(this.roleIdentities,function(id){return when(this.store.get(id),function(_1276){return _1276;},lang.hitch(this,function(e){if(e.status===404){var index=array.indexOf(this._notExistRoleIdentities,id);if(index<0){this._notExistRoleIdentities.push(id);}}}));},this);all(defs).then(lang.hitch(this,function(roles){this.set("roles",roles);def.resolve(roles);}),function(e){def.reject(e);});return def;},_hasSiblingsSetter:function(_1277){this.hasSiblings=_1277;this._updateRolesString();},_selectedSetter:function(_1278){this.selected=_1278;if(_1278){this.emit("selected",this);}},_updateRolesString:function(){if(!this.contentGroup||this.roles===undefined){this.set("rolesString","");return;}if(this._notExistRoleIdentities.length>0){this.set("rolesString",_126d.groupcannotsees);return;}if(!this.hasAnyRoles()){if(this.hasSiblings){this.set("rolesString",_126d.everyoneelsesee);}else{this.set("rolesString",_126d.everyonesees);}return;}var _1279=array.map(this.roles,function(r){return "<em>"+_1269.encode(r.name)+"</em>";}).sort().join(", ");var names=_1279.replace(/, (?=[^,]+$)/," "+_126d.groupsand);var _127a="";if(this.roles.length>1){_127a=lang.replace(_126d.groupssee,{groupNames:names});}else{_127a=lang.replace(_126d.groupsees,{groupName:names});}this.set("rolesString",_127a);},_rolesSetter:function(roles){this.roles=roles;this._updateRolesString();}});});},"epi-cms/contentediting/viewmodel/_ViewModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Evented","dijit/Destroyable"],function(array,_127b,_127c,_127d,_127e){return _127b([_127c,_127d,_127e],{modify:function(_127f,scope,_1280){this._isBeingModified=true;if(scope){_127f.apply(scope);}else{_127f();}this._isBeingModified=false;if(_1280||_1280===undefined){this.emit("changed");}},emit:function(type,event){if(type==="changed"&&this._isBeingModified){return;}this.inherited(arguments);}});});},"epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(array,_1281,lang,_1282,_1283){return _1281([_1282],{name:null,label:_1283.grouplabel,addChild:function(child,index){this.inherited(arguments,[child,index||0]);this._handles[child.id]=[child.on("selected",lang.hitch(this,"emit","selected",child)),child.on("changed",lang.hitch(this,"emit","changed"))];},serialize:function(){return array.map(this.getChildren(),function(child){return child.serialize();});},equals:function(item){return this.name===item.name;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},moveOutsideGroup:function(child){this.parent.moveOutsideGroup(child);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},remove:function(){this.parent.modify(lang.hitch(this,function(){this.parent.removeChild(this);}));},_hash:function(child){return child.contentLink+"_"+Date.now();},_selectedSetter:function(_1284){this.selected=_1284;if(_1284){this.emit("selected",this);}},_visibleGetter:function(){return array.some(this._data,function(item){return item.get("visible");});}});});},"epi-cms/contentediting/viewmodel/_ContainerViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","./_ViewModelMixin"],function(array,_1285,_1286){return _1285([_1286],{constructor:function(){this._data=[];this._handles={};},addChild:function(child,index){child.set("parent",this);child.set("readOnly",this.readOnly);if(!child.id){child.id=this._hash(child);}if(typeof index=="number"){this._data.splice(index,0,child);}else{this._data.push(child);}this._emitChildrenChanged();},getChild:function(item){var _1287=this._data;for(var i=_1287.length-1;i>=0;i--){if(_1287[i].equals(item)){return _1287[i];}}return null;},getChildById:function(id){var _1288=this._data;for(var i=_1288.length-1;i>=0;i--){if(_1288[i].id===id){return _1288[i];}}return null;},getChildren:function(){return this._data;},removeChild:function(child,_1289){var index=this.indexOf(child),_128a=this._handles[child.id];if(index<0&&_1289){array.forEach(this.getChildren(),function(item){if(typeof item.removeChild==="function"){item.removeChild(child,_1289);}});return;}else{if(index<0){return;}}if(_128a){array.forEach(_128a,function(_128b){_128b.remove();});delete this._handles[child.id];}this._data.splice(index,1);this._emitChildrenChanged();},move:function(child,index){var _128c=this.indexOf(child);this._data.splice(_128c,1);this._data.splice(index,0,child);this._emitChildrenChanged();},indexOf:function(child){return this._data.indexOf(child);},_hash:function(child){},_readOnlySetter:function(_128d){this.readOnly=_128d;array.forEach(this.getChildren(),function(child){child.set("readOnly",_128d);},this);},_emitChildrenChanged:function(_128e){var _128f=this._data.length;array.forEach(this._data,function(child,index){child.set("canMoveNext",index<(_128f-1));child.set("canMovePrevious",index>0&&index<=(_128f-1));child.set("hasSiblings",_128f>1);});this.set("count",_128f||0);this.emit("childrenChanged",_128e?_128e:this);}});});},"epi-cms/contentediting/editors/_BlockTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/dom-class","dijit/Tree","dijit/focus","dijit/_HasDropDown","epi-cms/widget/PersonalizationSelector","epi-cms/dgrid/formatters","./_ContentAreaTreeNodeMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dojo/text!./templates/_BlockTreeNode.html"],function(_1290,lang,keys,_1291,Tree,_1292,_1293,_1294,_1295,_1296,_1297,_1298,_1299){return _1290([Tree._TreeNode,_1296,_1293],{templateString:_1299,_contextMenuClass:"epi-iconContextMenu",isExpandable:false,dropDownPosition:["before"],resources:lang.mixin(_1297,_1298),buildRendering:function(){this.inherited(arguments);this.dropDown=new _1294({model:this.item});this.own(this.dropDown);this.aroundNode=this.domNode;this.set("readOnly",this.item.readOnly);_1291.add(this.domNode,"epi-tree-mngr--block");var node=this.rolesNode;var icon=_1295.contentIcon(this.item.typeIdentifier);_1291.add(this.iconNode,icon);node.innerHTML=this.item.get("rolesString");this.own(this.item.watch("rolesString",lang.hitch(this,function(_129a,_129b,_129c){node.innerHTML=_129c;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this.set("readOnly",this.item.readOnly);})));},setSelected:function(_129d,_129e){this.inherited(arguments);this.item.set("selected",_129d);_1291.toggle(this.iconNodeMenu,this._contextMenuClass,_129d);},showPersonalizationSelector:function(){if(this.readOnly){return;}this.item.set("ensurePersonalization",false);_1292.focus(this.labelNode);this.loadAndOpenDropDown();},focus:function(){this.labelNode.focus();},_onKey:function(e){if(this.dropDown&&this._opened&&e.keyCode==keys.ESCAPE){this.closeDropDown();}},_onKeyUp:function(){}});});},"epi-cms/widget/PersonalizationSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","dojox/html/entities","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/CheckedMenuItem","epi/dependency","epi/shell/_StatefulGetterSetterMixin","dojo/text!./templates/PersonalizationSelector.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dijit/Menu","epi/shell/widget/RadioMenuItem"],function(array,_129f,lang,_12a0,when,_12a1,_12a2,_12a3,_12a4,_12a5,_12a6,_12a7,_12a8,_12a9){return _129f([_12a2,_12a3,_12a4],{templateString:_12a8,model:null,resources:_12a9,postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _12aa=_12a6.resolve("epi.storeregistry");this.store=_12aa.get("epi.cms.visitorgroup");}},postCreate:function(){this.inherited(arguments);this.own(this.rdEveryone.on("change",lang.hitch(this,"restoreDefault")),this.model.watch("roleIdentities",lang.hitch(this,function(){if(!this.rdEveryone.checked&&this.model.roleIdentities&&this.model.roleIdentities.length===0){this.restoreDefault();}})));when(this.store.query(),lang.hitch(this,function(_12ab){if(!this._destroyed){this.set("visitorGroups",_12ab);}}));},restoreDefault:function(){array.forEach(this.visitorGroupsMenu.getChildren(),function(item){item.set("checked",false);});this.rdEveryone.set("checked",true);this.model.set("roleIdentities",null);},_setVisitorGroupsAttr:function(_12ac){this._set("visitorGroups",_12ac);if(!this.model.hasAnyRoles()){this.rdEveryone.set("checked",true);}array.forEach(_12ac,function(group){var item=new _12a5({label:_12a1.encode(group.name),visitorgroupId:group.id,checked:this.model.isRoleSelected(group.id)});this.own(item.watch("checked",lang.hitch(this,function(_12ad,_12ae,_12af){this.model.selectRole(group.id,_12af);this.rdEveryone.set("checked",!this.model.hasAnyRoles());})));this.visitorGroupsMenu.addChild(item);},this);}});});},"url:epi-cms/widget/templates/PersonalizationSelector.html":"<div>\r\n    <div class=\"epi-dijitTooltipContainer\">\r\n        <div class=\"epi-invertedTooltip\">\r\n            <div class=\"epi-tooltipDialogTop\">\r\n                <span data-dojo-attach-point=\"header\">${resources.whocansee}</span>\r\n                <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-tooltipDialogContent--max-height\">\r\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"visitorGroupsMenu\" style=\"width:100%\"></div>\r\n            <div class=\"epi-menuSeparator\" tabindex=\"-1\"></div>\r\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"filterOptionsMenu\" style=\"width:100%\">\r\n                <div data-dojo-attach-point=\"rdEveryone\" data-dojo-type=\"epi/shell/widget/RadioMenuItem\" data-dojo-props=\"label:'${resources.everyone}', value: ''\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/contentediting/editors/_ContentAreaTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/focus","dojo/_base/event","dojo/dom-class"],function(_12b0,lang,on,_12b1,event,_12b2){return _12b0([],{destroy:function(){this._unBindContextMenu();this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.own(on(this.iconNodeMenu,"click",lang.hitch(this.labelNode,this.labelNode.focus)));},_unBindContextMenu:function(){if(this.contextMenu){this.contextMenu.unBindDomNode(this.iconNodeMenu);}},_setContextMenuAttr:function(_12b3){this._unBindContextMenu();this._set("contextMenu",_12b3);this.contextMenu.bindDomNode(this.iconNodeMenu);},_setMouseHoverAttr:function(hover){this._set("hover",hover);if(this.item.get("selected")){return;}_12b2.toggle(this.iconNodeMenu,this._contextMenuClass,this.hover);}});});},"url:epi-cms/contentediting/editors/templates/_BlockTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <div class=\"epi-tree-mngr--node-wrapper\" data-dojo-attach-point=\"rowNode\">\r\n        <span data-dojo-attach-point=\"rolesNode, _buttonNode\" class=\"epi-tree-mngr--view-settings\"></span>\r\n        <div class=\"dijitTreeRow dijitInline\" role=\"presentation\">\r\n            <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                    <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" title=\"${resources.settingstooltip}\" role=\"presentation\">&nbsp;</span>\r\n                </span>\r\n                <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"/>\r\n                <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n\r\n            </span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/editors/_GroupTreeNode":function(){define(["dojo/aspect","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/Tree","./_ContentAreaTreeNodeMixin","dojo/text!./templates/_GroupTreeNode.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_12b4,array,_12b5,lang,_12b6,_12b7,Tree,_12b8,_12b9,_12ba){return _12b5([Tree._TreeNode,_12b8],{templateString:_12b9,_contextMenuClass:"epi-iconContextMenu",resources:_12ba,buildRendering:function(){this.inherited(arguments);_12b6.remove(this.iconNode,"dijitFolderClosed");this.own(_12b4.after(this,"expand",lang.hitch(this,function(_12bb){_12bb.then(lang.hitch(this,function(){if(this._destroyed){return;}_12b6.add(this.domNode,"epi-treeNodeOpen");array.forEach(this.getChildren(),function(_12bc){var child=_12bc.item;if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){child.set("ensurePersonalization",false);_12bc.showPersonalizationSelector();}},this);}));return _12bb;})));this.own(_12b4.after(this,"collapse",lang.hitch(this,function(_12bd){_12bd.then(lang.hitch(this,function(){_12b6.remove(this.domNode,"epi-treeNodeOpen");}));return _12bd;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this._toggleDropMoreMessageNode();})));},postCreate:function(){this.inherited(arguments);this.own(this.item.watch("count",lang.hitch(this,function(_12be,_12bf,_12c0){this.set("count",_12c0);})));if(this.item){this.set("count",this.item.count);}},setSelected:function(_12c1){this.inherited(arguments);this.item.set("selected",_12c1);_12b6.remove(this.rowNode,"dijitTreeRowSelected");_12b6.toggle(this.domNode,"dijitTreeRowSelected",_12c1);},_setCountAttr:function(count){this._set("count",count);this._toggleDropMoreMessageNode();},_toggleDropMoreMessageNode:function(){_12b7.set(this.dropMoreMessageNode,"display",!this.item.readOnly&&this.count===1?"":"none");}});});},"url:epi-cms/contentediting/editors/templates/_GroupTreeNode.html":"<div class=\"dijitTreeNode epi-tree-mngr--group\" role=\"presentation\" data-dojo-attach-point=\"rowNode\">\r\n    <div class=\"dijitTreeRow dijitInline epi-tree-mngr--group-header\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"/>\r\n        <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon epi-iconUsers\" role=\"presentation\"/>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <hr />\r\n    <span data-dojo-attach-point=\"dropMoreMessageNode\" class=\"epi-tip epi-tip--block\">${resources.groupdropmoremessage}</span>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/_ContentAreaTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/tree/model","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel"],function(array,_12c2,lang,_12c3,_12c4,_12c5){return _12c2([_12c3],{model:null,root:{id:"root",name:"root"},constructor:function(_12c6){_12c2.safeMixin(this,_12c6);},pasteItem:function(_12c7,_12c8,_12c9,bCopy,_12ca,_12cb){var _12cc=_12c8.id==="root"?this.model:this.model.getChildById(_12c8.id);var child=_12cc.getChildById(_12c7.id);var _12cd=_12c9.id==="root"?this.model:this.model.getChildById(_12c9.id);if(child instanceof _12c4&&!child.hasAnyRoles()){child.set("ensurePersonalization",true);}if(_12cc===_12cd){this.model.modify(function(){_12cd.move(child,_12ca);});return;}this.model.modify(function(){_12cc.removeChild(child);_12cd.addChild(child,_12ca);});},deleteItem:function(item){this.model.modify(lang.hitch(this,function(){this.model.removeChild(item,true);}));},newItem:function(args,_12ce,_12cf,_12d0){if(args.dndData&&args.dndData.data){var _12d1=_12ce.id==="root"?this.model:this.model.getChildById(_12ce.id);var item=args.dndData.data;if(!(item instanceof _12c4)&&!(item instanceof _12c5)){item=new _12c4(item);}item.set("ensurePersonalization",true);this.model.modify(function(){_12d1.addChild(item,_12cf);});}},checkItemAcceptance:function(_12d2,item,_12d3){if(_12d3==="over"){if(!(_12d2 instanceof _12c5)){return false;}if(!(item instanceof _12c4)){return false;}}if(_12d2 instanceof _12c4&&item instanceof _12c5&&_12d2.contentGroup){return false;}return true;},getRoot:function(_12d4){_12d4(this.root);},getLabel:function(item){return item.label;},mayHaveChildren:function(item){if(typeof item.getChildren=="function"||item.id==="root"){return true;}return false;},getIdentity:function(item){return item.id;},getChildren:function(_12d5,_12d6){var _12d7;if(_12d5.id==="root"){_12d7=this.model.getChildren();_12d6(_12d7);this.model.on("childrenChanged",lang.hitch(this,function(index,_12d8,adds){this.onChildrenChange(this.root,this.model.getChildren());}));}else{var model=this.model.getChildById(_12d5.id);if(model&&typeof model.getChildren=="function"){_12d7=model.getChildren();_12d6(_12d7);model.on("childrenChanged",lang.hitch(this,function(index,_12d9,adds){this.onChildrenChange(_12d5,model.getChildren());}));}else{_12d6([]);}}}});});},"dijit/tree/model":function(){define("dijit/tree/model",["dojo/_base/declare"],function(_12da){return _12da("dijit.tree.model",null,{destroy:function(){},getRoot:function(_12db){},mayHaveChildren:function(item){},getChildren:function(_12dc,_12dd){},isItem:function(_12de){},fetchItemByIdentity:function(_12df){},getIdentity:function(item){},getLabel:function(item){},newItem:function(args,_12e0,_12e1,_12e2){},pasteItem:function(_12e3,_12e4,_12e5,bCopy,_12e6,_12e7){},onChange:function(item){},onChildrenChange:function(_12e8,_12e9){}});});},"epi-cms/contentediting/editors/_TextWithActionLinksMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dojo/when","epi/shell/widget/TextWithActionLinks","epi/i18n!epi/cms/nls/episerver.cms.widget.overlay.blockarea"],function(_12ea,lang,_12eb,on,when,_12ec,_12ed){return _12ea(null,{textWithLinks:null,actionsResource:_12ed,isCreateLinkVisible:function(){return true;},getTemplateString:function(){var _12ee=new _12eb();var _12ef=this.actionsResource.emptyactions;when(this.isCreateLinkVisible(),function(_12f0){var _12f1=_12f0?_12ef.template:_12ef.templatewithoutcreate;_12ee.resolve({templateString:_12f1,actions:_12ef.actions});});return _12ee.promise;},setupActionLinks:function(_12f2){when(this.getTemplateString(),lang.hitch(this,function(_12f3){if(!_12f3){return;}this.textWithLinks=new _12ec({contentString:_12f3.templateString,namedActions:_12f3.actions});this.own(on(this.textWithLinks,"onActionClick",lang.hitch(this,this.executeAction)));if(_12f2){this.textWithLinks.placeAt(_12f2);}}));},executeAction:function(_12f4){}});});},"epi/shell/widget/TextWithActionLinks":function(){define("epi/shell/widget/TextWithActionLinks",["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/Evented","dojo/on","dojo/query","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/focus","dojox/html/entities"],function(array,_12f5,event,lang,_12f6,on,query,_12f7,_12f8,_12f9,_12fa){return _12f5([_12f7,_12f8,_12f6],{tagName:"span",templateString:"<{0}>{1}</{0}>",contentString:"",namedActions:null,_actionMap:null,_eventHandlers:null,postMixInProperties:function(){this.inherited(arguments);this._actionMap=[];this._eventHandlers=[];var _12fb={};var _12fc=this.contentString;var _12fd;var id=0;if(this.namedActions){for(var _12fe in this.namedActions){_12fd=_12fa.encode(this.namedActions[_12fe]);_12fb[_12fe]="<a class=\"epi-visibleLink\" href=\"#\" data-dojo-attach-point=\"action"+(id++)+"\">"+_12fd+"</a>";this._actionMap.push(_12fe);}_12fc=lang.replace(_12fc,_12fb);}this.templateString=lang.replace(this.templateString,[this.tagName,_12fc]);},postCreate:function(){this.inherited(arguments);array.forEach(this._actionMap,function(_12ff,id){var link=this["action"+id];if(link){var _1300=on(link,"click",(function(_1301,_1302){return function(evt){event.stop(evt);_1301.emit("onActionClick",_1302);};})(this,_12ff));this._eventHandlers.push(_1300);}},this);},destroy:function(){array.forEach(this._eventHandlers,function(_1303){_1303.remove();},this);this._eventHandlers=null;this.inherited(arguments);},focus:function(){var links=query("a",this.domNode);if(links.length>0){_12f9.focus(links[0]);}}});});},"epi-cms/contentediting/viewmodel/ContentAreaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/viewmodel/_ContainerViewModel"],function(array,_1304,lang,_1305,_1306,_1307){return _1304([_1307],{selectedItem:null,addChild:function(child){if(!(child instanceof _1305)&&!(child instanceof _1306)){var model=new _1305(child);this.own(model.watch("roleIdentities",lang.hitch(this,function(){this.emit("changed");})));if(model.contentGroup){child=this._groups[model.contentGroup];if(!child){child=this._createGroup(model.contentGroup);}child.addChild(model);}else{child=model;}}else{child.set("contentGroup",null);if(child instanceof _1306){this.own(child.on("childrenChanged",lang.hitch(this,function(){this._emitChildrenChanged(child);if(child.getChildren().length===0){this.removeChild(child);}})));}else{if(child instanceof _1305){child.resetRoleIdentities();}}}this.own(child.on("changed",lang.hitch(this,function(){this.emit("changed");})));this.inherited(arguments);this._handles[child.id]=child.on("selected",lang.hitch(this,"set","selectedItem"));},moveVisible:function(child,_1308){var _1309=array.filter(this.getChildren(),function(item){return item.get("visible");}),delta=_1308?1:-1,_130a=array.indexOf(_1309,child)+delta,index=this.indexOf(_1309[_130a]);this.modify(lang.hitch(this,function(){this.move(child,index);}));},moveOutsideGroup:function(child){if(!child.contentGroup){return;}var group=this.getChild({name:child.contentGroup}),index=this.indexOf(group);this.modify(lang.hitch(this,function(){group.removeChild(child);this.addChild(child,index);}));},personalize:function(child){var index=this.indexOf(child);this.removeChild(child);var group=new _1306({name:"group_"+Date.now(),expandOnAdd:true});child.set("ensurePersonalization",true);group.addChild(child);this.addChild(group,index);},_valueGetter:function(){var value=[];array.forEach(this.getChildren(),function(child){value=value.concat(child.serialize());});return value;},_valueSetter:function(value){this._transformValueToModels(value);},_selectedItemSetter:function(value){if(this.selectedItem){this.selectedItem.set("selected",false);}this.selectedItem=value;},_transformValueToModels:function(value){this.modify(function(){var _130b=this.getChildren();for(var i=_130b.length-1;i>=0;i--){this.removeChild(_130b[i]);}this._groups={};array.forEach(value,function(child){var model=new _1305(child);this.own(model.watch("roleIdentities",lang.hitch(this,function(){this.emit("changed");})));if(model.contentGroup){var group=this._groups[model.contentGroup];if(!group){group=this._createGroup(model.contentGroup);this.addChild(group);}group.addChild(model,group.getChildren().length);}else{this.addChild(model);}},this);},this,false);},_createGroup:function(name){var group=new _1306({name:name});this._groups[name]=group;return group;},_hash:function(child){return (child.contentLink||child.name)+"_"+Date.now();}});});},"epi-cms/widget/overlay/Block":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/on","dojo/when","epi/shell/widget/overlay/_Base","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi-cms/widget/overlay/_OverlayItemInfoMixin","epi-cms/contentediting/command/ContentAreaCommands","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!../templates/Block.html","dijit/form/DropDownButton","epi/shell/widget/ContextMenu"],function(_130c,event,lang,_130d,_130e,on,when,_130f,_1310,_1311,_1312,_1313,_1314,_1315,_1316){return _130c([_130f,_1310,_1311,_1312],{templateString:_1316,res:_1315,_setMissingRendererAttr:function(value){_130d.toggle(this.domNode,"epi-overlay-item-missing-renderer",value);},buildRendering:function(){this.inherited(arguments);_130e.set(this.personalizedIcon,"display",this.viewModel.contentGroup?"":"none");},postCreate:function(){this.inherited(arguments);this._injectDynamicStyles();this.commandProvider=this.commandProvider||new _1313({model:this.viewModel});this.own(this.viewModel.watch("statusMessage",lang.hitch(this,function(_1317,_1318,_1319){when(_1314.getMissingLanguageMessage(this.viewModel.content),lang.hitch(this,function(_131a){_130e.set(this.warningIcon,"display",_131a?"":"none");}));_130e.set(this.iconsContainer,"display",this.viewModel.contentGroup||_1319?"":"none");})));this.viewModel.loadStatus();this.contextMenu.addProvider(this.commandProvider);if(this.blockInfo&&this.blockInfo.missingrenderer){this.set("missingRenderer",this.blockInfo.missingrenderer);}this.own(on(this.domNode,"click",lang.hitch(this.viewModel,"set","selected",true)),on(this.settingsButton,"click",lang.hitch(this,"_onContextMenuClick")),on(this.domNode,"mouseout",lang.hitch(this,function(e){if(this.contextMenu&&this.contextMenu.isShowingNow){event.stop(e);}})));},_injectDynamicStyles:function(){var node=this.sourceItemNode,_131b=_130e.get(node,"display"),_131c=/inline|inline-block/.test(_131b)?"-inline":"";_130d.add(node,"epi-injected-minSize"+_131c);},_onContextMenuClick:function(){this.commandProvider.set("model",this.viewModel);this.viewModel.set("selected",true);return false;}});});},"epi-cms/widget/overlay/_OverlayItemInfoMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dojo/when","dojo/mouse","epi/shell/TypeDescriptorManager","epi/shell/widget/overlay/OverlayItemInfo","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_131d,lang,_131e,on,when,mouse,_131f,_1320,_1321){return _131d(null,{disableTooltip:false,useIconOnBlock:false,postCreate:function(){this.own(this.viewModel.watch("contentStatus",lang.hitch(this,"_setupIcon")));this.own(this.viewModel.watch("statusMessage",lang.hitch(this,function(_1322,_1323,_1324){this.set("statusMessage",_1324);})));this.subscribe("/dnd/start",lang.hitch(this,function(){if(!this.disableTooltip){this._set("disableTooltip",true);this._showStatusMessage(false);}}));this.subscribe("/dnd/cancel",lang.hitch(this,function(){this._set("disableTooltip",false);}));this.subscribe("/dnd/drop",lang.hitch(this,function(){this._set("disableTooltip",false);}));var node=this.get("containerDomNode");if(node){this.own(on(node,mouse.enter,lang.hitch(this,function(){this._showStatusMessage(!this.get("disableTooltip"));})));this.own(on(node,mouse.leave,lang.hitch(this,function(){this._showStatusMessage(false);})));}this.inherited(arguments);},destroy:function(){if(this._overlayItemInfo){this._overlayItemInfo.destroyRecursive();this._overlayItemInfo=null;}this.inherited(arguments);},_setStatusIconAttr:function(_1325){var _1326=this.get("overlayItemInfo");if(!_1326){return;}_1326.set("statusIcon",_1325);},_setStatusMessageAttr:function(_1327){var _1328=this.get("overlayItemInfo");if(!_1328){return;}_1328.set("statusMessage",_1327);},_getContainerDomNodeAttr:function(){return this.containerDomNode||this.domNode;},_getOverlayItemInfoAttr:function(){if(!this._overlayItemInfo){this._overlayItemInfo=new _1320();_131e.place(this._overlayItemInfo.domNode,this.get("containerDomNode"));}return this._overlayItemInfo;},_setupIcon:function(){var _1329,_132a,_132b,_132c;_1329=this.get("overlayItemInfo");_1329.set("class",!this.viewModel.get("isVisibleOnSite")?"epi-overlay-content-invisible":"");var _132d=(this.viewModel.content&&this.viewModel.content.typeIdentifier)||this.viewModel.typeIdentifier;if(this.viewModel.get("isVisibleOnSite")&&_132d){_132a=_131f.getValue(_132d,"useIconOnBlock");_132b=_131f.getValue(_132d,"iconClass");_132c=_131f.getValue(_132d,"description");if(_132a){_1329.set("class","epi-overlay-content-info");this.set("useIconOnBlock",true);this.set("statusIcon",_132b);this.set("statusMessage",_132c);}}},_showStatusMessage:function(_132e){if(this._overlayItemInfo){this._overlayItemInfo.showStatusMessage(_132e);}}});});},"epi/shell/widget/overlay/OverlayItemInfo":function(){require({cache:{"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\r\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\r\n</span>"}});define("epi/shell/widget/overlay/OverlayItemInfo",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/_WidgetBase","dijit/_TemplatedMixin","dojox/html/entities","epi/string","epi/shell/widget/Tooltip","dojo/text!./templates/OverlayItemInfo.html"],function(array,_132f,lang,_1330,_1331,_1332,_1333,_1334,_1335,_1336,_1337,_1338){return _132f([_1333,_1334],{templateString:_1338,postCreate:function(){this.inherited(arguments);this.showStatusMessage(false);},destroy:function(){this.inherited(arguments);this._destroyTooltip();},showStatusMessage:function(_1339){if(this._tooltip){_1339?this._tooltip.open(this.domNode):this._tooltip.close();}},_setStatusIconAttr:function(_133a){var _133b=lang.isArray(_133a);if(_133b){array.forEach(_133a,function(_133c){_1330.add(this.highlightArea,_133c);},this);}else{_1330.add(this.highlightArea,_133a);}},_setStatusMessageAttr:function(_133d){if(!_133d){return;}var _133e=lang.isArray(_133d);if(this._tooltip){if(_133e){this._tooltip.tooltipRows=_133d;}else{this._tooltip.label=_1335.encode(_133d);}}else{var _133f=_1331.create("div",{"class":"epi-overlay-content-tooltip",innerHTML:_1336.toHTML(_1335.encode(_133d))}),_1340=_133e?{tooltipRows:_133d}:{label:_133f.outerHTML};this._tooltip=new _1337(_1340);}},_destroyTooltip:function(){if(this._tooltip){this._tooltip.destroyRecursive();this._tooltip=null;}}});});},"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\r\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\r\n</span>","epi-cms/contentediting/command/ContentAreaCommands":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","./BlockRemove","./BlockEdit","./MoveVisibleToPrevious","./MoveVisibleToNext","./Personalize","./SelectDisplayOption"],function(array,_1341,_1342,_1343,Edit,_1344,_1345,_1346,_1347){return _1341([_1342],{commands:null,constructor:function(){this.commands=[new Edit(),new _1347(),new _1346(),new _1344(),new _1345(),new _1343()];},_modelSetter:function(model){this.model=model;array.forEach(this.commands,function(_1348){_1348.set("model",model);});}});});},"epi-cms/contentediting/command/BlockRemove":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1349,epi,_134a){return _1349([_134a],{name:"remove",label:epi.resources.action.remove,tooltip:epi.resources.action.remove,iconClass:"epi-iconTrash",_execute:function(){this.model.remove();},_onModelValueChange:function(){this.set("canExecute",!!this.model&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/_ContentAreaCommand":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command"],function(_134b,lang,_134c){return _134b([_134c],{_onModelChange:function(){var model=this.model;if(this._handles){for(var i=0;i<this._handles.length;i++){this._handles[i].remove();}}this._handles=[];if(!model){this.set("canExecute",false);return;}this._watch("readOnly",function(){this._onModelValueChange();},this);this._onModelValueChange();},_watch:function(_134d,_134e,scope){if(scope){this._handles.push(this.model.watch(_134d,lang.hitch(scope,_134e)));}else{this._handles.push(this.model.watch(_134d,_134e));}},_getItem:function(){return this.model.contentGroup?this.model.parent:this.model;},_getContainer:function(){var _134f=function(item){if(item.parent){return _134f(item.parent);}return item;};return _134f(this.model);},_onModelValueChange:function(){}});});},"epi-cms/contentediting/command/BlockEdit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1350,lang,topic,when,epi,_1351,_1352,_1353,_1354){return _1350([_1352],{name:"edit",label:epi.resources.action.edit,tooltip:epi.resources.action.edit,iconClass:"epi-iconPen",category:"menuWithSeparator",constructor:function(){this.contentActionSupport=this.contentActionSupport||_1353;var _1355=_1351.resolve("epi.storeregistry");this._store=_1355.get("epi.cms.content.light");},_execute:function(){var _1356=this.model.contentLink;topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1356},{});},_onModelValueChange:function(){var item=this.model;if(!item||!item.contentLink){this.set("canExecute",false);return;}var _1357=item&&this._store.get(item.contentLink);when(_1357,lang.hitch(this,function(_1358){this.set("canExecute",_1358&&!_1358.isDeleted);if(_1358&&_1358.accessMask){if(this.contentActionSupport.hasAccess(_1358.accessMask,this.contentActionSupport.accessLevel[this.contentActionSupport.action.Edit])){this.set("label",_1354.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_1354.view);this.set("iconClass","epi-iconSearch");}}}));}});});},"epi-cms/contentediting/command/MoveVisibleToPrevious":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToPrevious"],function(array,_1359,_135a){return _1359([_135a],{_execute:function(){this._getContainer().moveVisible(this._getItem(),false);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _135b=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_135b,this._getItem());this.set("canExecute",index>0);}});});},"epi-cms/contentediting/command/MoveToPrevious":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_135c,epi,_135d){return _135c([_135d],{label:epi.resources.action.moveup,tooltip:epi.resources.action.moveup,iconClass:"epi-iconUp",_execute:function(){this.model.movePrevious();},_onModelChange:function(){this.inherited(arguments);this._watch("canMovePrevious",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMovePrevious")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/MoveVisibleToNext":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToNext"],function(array,_135e,_135f){return _135e([_135f],{_execute:function(){this._getContainer().moveVisible(this._getItem(),true);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _1360=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_1360,this._getItem());this.set("canExecute",index!=-1&&index<_1360.length-1);}});});},"epi-cms/contentediting/command/MoveToNext":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1361,epi,_1362){return _1361([_1362],{label:epi.resources.action.movedown,tooltip:epi.resources.action.movedown,iconClass:"epi-iconDown",category:"menuWithSeparator",_execute:function(){this.model.moveNext();},_onModelChange:function(){this.inherited(arguments);this._watch("canMoveNext",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMoveNext")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/Personalize":function(){define(["dojo/_base/declare","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1363,_1364,_1365,_1366){return _1363([_1365],{label:_1366.label,iconClass:"epi-iconUsers",category:"menuWithSeparator",_execute:function(){if(!this.model.contentGroup){this.model.personalize();}},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.contentGroup&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/SelectDisplayOption":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/widget/DisplayOptionSelector","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions"],function(_1367,lang,when,_1368,_1369,_136a,_136b,_136c){return _1367([_1369],{label:_136c.label,category:"popup",_labelAutomatic:lang.replace(_136c.label,[_136c.automatic]),constructor:function(){this.popup=new _136b();},postscript:function(){this.inherited(arguments);if(!this.store){var _136d=_1368.resolve("epi.storeregistry");this.store=_136d.get("epi.cms.displayoptions");}when(this.store.get(),lang.hitch(this,function(_136e){this._setCommandAvailable(_136e);this.popup.set("displayOptions",_136e);}));},_onModelChange:function(){this.inherited(arguments);var _136f=this.popup.displayOptions,_1370=this.model.get("displayOption"),_1371=_136f&&_136f.length>0;_1371=_1371&&(this.model instanceof _136a);this._setCommandAvailable(_136f);if(!_1371){this.set("label",this._labelAutomatic);return;}this.popup.set("model",this.model);if(!_1370){this.set("label",this._labelAutomatic);}else{this._setLabel(_1370);}this._watch("displayOption",function(_1372,_1373,_1374){if(!_1374){this.set("label",this._labelAutomatic);}else{this._setLabel(_1374);}},this);},_setCommandAvailable:function(_1375){this.set("isAvailable",_1375&&_1375.length>0&&this.model instanceof _136a);},_setLabel:function(_1376){when(this.store.get(_1376),lang.hitch(this,function(_1377){this.set("label",lang.replace(_136c.label,[_1377.name]));}),lang.hitch(this,function(error){this.set("label",this._labelAutomatic);}));},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.get("readOnly"));}});});},"epi-cms/widget/DisplayOptionSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/MenuSeparator","epi-cms/widget/SelectorMenuBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions","epi/shell/widget/RadioMenuItem"],function(array,_1378,lang,when,_1379,_137a,_137b,_137c){return _1378([_137a],{model:null,headingText:_137b.title,_rdAutomatic:null,_separator:null,postCreate:function(){this.inherited(arguments);this.own(this._rdAutomatic=new _137c({label:_137b.automatic,value:""}));this.addChild(this._rdAutomatic);this._rdAutomatic.on("change",lang.hitch(this,this._restoreDefault));this.own(this._separator=new _1379({baseClass:"epi-menuSeparator"}));this.addChild(this._separator);},_restoreDefault:function(){this.model.modify(function(){this.model.set("displayOption",null);},this);},_setModelAttr:function(model){this._set("model",model);this._setup();},_setDisplayOptionsAttr:function(_137d){this._set("displayOptions",_137d);this._setup();},_setup:function(){if(!this.model||!this.displayOptions){return;}this._removeMenuItems();var _137e=this.model.get("displayOption");array.forEach(this.displayOptions,function(_137f){var item=new _137c({label:_137f.name,iconClass:_137f.iconClass,displayOptionId:_137f.id,checked:_137e===_137f.id});this.own(item.watch("checked",lang.hitch(this,function(_1380,_1381,_1382){if(!_1382){return;}this.model.modify(function(){this.model.set("displayOption",_137f.id);},this);this._rdAutomatic.set("checked",false);})));this.addChild(item);},this);this._rdAutomatic.set("checked",!_137e);},_removeMenuItems:function(){var items=this.getChildren();items.forEach(function(item){if(item===this._rdAutomatic||item==this._separator){return;}this.removeChild(item);item.destroy();},this);}});});},"epi-cms/widget/SelectorMenuBase":function(){define(["dojo/_base/declare","dojo/keys","dijit/_MenuBase","dojo/text!./templates/SelectorMenuBase.html"],function(_1383,keys,_1384,_1385){return _1383([_1384],{templateString:_1385,headingText:null,postCreate:function(){this.inherited(arguments);this.connectKeyNavHandlers([keys.UP_ARROW],[keys.DOWN_ARROW]);}});});},"url:epi-cms/widget/templates/SelectorMenuBase.html":"<div class=\"epi-DropDownMenu\">\r\n    <div class=\"epi-dijitTooltipContainer\">\r\n        <div class=\"epi-invertedTooltip\">\r\n            <div class=\"epi-tooltipDialogTop\">\r\n                <span>${headingText}</span>\r\n                <div class=\"dijitTooltipConnector\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-tooltipDialogContent--max-height\">\r\n            <table class=\"dijitReset dijitMenu epi-tooltipDialogMenu epi-menuInverted epi-mediumMenuItem\" style=\"width: 100%\" cellspacing=\"0\">\r\n\t            <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n            </table>\r\n        </div>\r\n    </div>\r\n</div>\r\n","url:epi-cms/widget/templates/Block.html":"<div class=\"dojoDndItem epi-overlay-block\">\r\n    <div data-dojo-attach-point=\"containerDomNode\"></div>\r\n    <span class=\"epi-personalized\" data-dojo-attach-point=\"iconsContainer\">\r\n        <span class=\"epi-overlayControls epi-mediumButton \">\r\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconWarning\" data-dojo-attach-point=\"warningIcon\"></span>\r\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconUsers\" data-dojo-attach-point=\"personalizedIcon\"></span>\r\n        </span>\r\n    </span>\r\n    <button class=\"epi-chromelessButton epi-overlayControls epi-settingsButton epi-mediumButton\" data-dojo-attach-point=\"settingsButton\" data-dojo-type=\"dijit/form/DropDownButton\" data-dojo-props=\"showLabel:false, title:'${res.settingstooltip}', iconClass:'epi-iconContextMenu'\">\r\n        <div data-dojo-attach-point=\"contextMenu\" data-dojo-type=\"epi/shell/widget/ContextMenu\"></div>\r\n    </button>\r\n</div>","epi-cms/contentediting/command/MoveOutsideGroup":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1386,_1387,_1388){return _1386([_1387],{label:_1388.moveoutsidegroup,tooltip:_1388.moveoutsidegroup,iconClass:"",category:"menuWithSeparator",_execute:function(){this.model.moveOutsideGroup();},_onModelValueChange:function(){this.set("canExecute",this.model.contentGroup&&!this.model.get("readOnly"));}});});},"url:epi-cms/contentediting/editors/templates/ContentAreaEditor.html":"<div class=\"dijitInline\">\r\n    <div data-dojo-attach-point=\"treeNode\"></div>\r\n    <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>            \r\n</div>","epi-cms/contentediting/editors/ItemCollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/dom-geometry","dojo/keys","dojo/on","dojo/query","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","epi/shell/dgrid/Formatter","epi/shell/dnd/Target","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/ContextMenu","epi/shell/TypeDescriptorManager","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/extension/events","epi-cms/contentediting/command/NewItem","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/contentediting/command/ItemCollectionCommands","epi-cms/widget/_HasChildDialogMixin","./_TextWithActionLinksMixin","dojo/text!./templates/ItemCollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.itemcollection"],function(array,_1389,lang,event,_138a,_138b,_138c,_138d,_138e,keys,on,query,topic,when,_138f,_1390,_1391,_1392,_1393,_1394,_1395,_1396,_1397,_1398,_1399,_139a,DnD,_139b,_139c,_139d,_139e,_139f,_13a0,_13a1,_13a2){return _1389([_1391,_138f,_1390,_1394,_139f,_13a0],{baseClass:"epi-item-collection-editor",multiple:true,res:_13a2,actionsResource:_13a2,templateString:_13a1,value:null,model:null,contextMenu:null,grid:null,commandProviderClass:_139e,_newItemCommand:null,_gridClass:_1389([_1398,_1392,_1399,DnD,_1397]),_mouseOverClass:"epi-dgrid-mouseover",actionsVisible:true,customTypeIdentifier:null,onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);this.setupAllowedTypes();},postCreate:function(){this.inherited(arguments);this.set("model",new _139d(this.value,{itemModelType:this.itemModelType,readOnly:this.readOnly}));this.setupCommands();this.setupList();this.setupActionContainer();this.setupEvents();},startup:function(){this.inherited(arguments);this.contextMenu.startup();},setupActionContainer:function(){this.own(this._dndTarget=new _1393(this.actionsContainer,{accept:this.get("allowedDndTypes"),isSource:false,alwaysCopy:false,insertNodes:function(){}}));this.setupActionLinks(this.actionsContainer);this._displayActionsContainer();},setupCommands:function(){this.contextMenu=this.contextMenu||new _1395(),this.commandProvider=this.commandProvider||new this.commandProviderClass({model:this.model,commandOptions:this.commandOptions}),this.contextMenu.addProvider(this.commandProvider),this.own(this.contextMenu,this.commandProvider,this._newItemCommand=new _139c({"model":this.model,"dialogContentParams":this.commandOptions?this.commandOptions.dialogContentParams:{}}));},setupList:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:this.res?this.res.menutooltip:""}},_13a3=function(data,_13a4,row){return "<div class='epi-rowIcon'><span class='dijitInline dijitIcon epi-iconLink epi-objectIcon'></span></div>"+data;},_13a5={selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",formatters:[_139a.contentItemFactory("text","title","typeIdentifier",menu),_13a3],dndParams:{copyOnly:true,accept:this.get("allowedDndTypes"),creator:lang.hitch(this,this._dndNodeCreator)},dndSourceTypes:this.customTypeIdentifier?[this.customTypeIdentifier]:[],consumer:this},_13a6=function(_13a7){var types=_1396.getAndConcatenateValues(this.dndSourceTypes,"dndTypes");if(types.length===0){types=this.dndSourceTypes;}return types;};if(this.customTypeIdentifier){_13a5._getDndType=_13a6;}this.own(this.grid=new this._gridClass(_13a5,this.itemsContainer));this.grid.set("showHeader",false);this.grid.renderArray(this.model.get("data"));this.grid.startup();},setupEvents:function(){var self=this,_13a8=on.selector;this.own(self.model.on("selectedItem",lang.hitch(this,this.focus)),self.model.on("initCompleted",lang.hitch(this,this._renderUI)),self.grid.on(_13a8(".dgrid-row",_139b.mouse.enter),function(e){_138b.add(self,self._mouseOverClass);}),self.grid.on(_13a8(".dgrid-row",_139b.mouse.leave),function(e){_138b.remove(self,self._mouseOverClass);}),self.grid.on("dgrid-select",function(e){self.model.set("selectedItem",e.rows[0].data);self.commandProvider.set("model",self.model);}),self.grid.on(_13a8(".dgrid-row",_139b.keys.del),function(e){self.model.remove();}),self.grid.on(_13a8(".dgrid-row",_139b.keys.shiftf10),function(e){self._showContextMenu(e);}),self.grid.on(_13a8(".dgrid-row",_139b.contextmenu),function(e){var item=self.grid.row(e).data;self.model.set("selectedItem",item);self.select(item);self._showContextMenu(e);}),self.grid.on(".epi-iconContextMenu:click",function(e){self.contextMenu.scheduleOpen(self,null,{x:e.pageX,y:e.pageY});}),_138a.around(self.grid.dndSource,"checkAcceptance",function(_13a9){return function(_13aa,nodes){return !self.readOnly&&_13a9.apply(self.grid.dndSource,arguments);};}),_138a.after(self.grid.dndSource,"onDropData",function(_13ab,_13ac,nodes,copy){var i;if(self.grid.dndSource===_13ac){for(i=0;i<nodes.length;i++){self.model.moveTo(self.grid.dndSource.getItem(nodes[i].id).data,self.grid.dndSource.current!=null?self.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);}}else{var item;for(i=0;i<_13ab.length;i++){when(_13ab[i].data,lang.hitch(this,function(_13ad){self.model.addTo(_13ad,self.grid.dndSource.current!=null?this.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);if(_13ac&&_13ac.grid&&_13ac.grid.consumer&&_13ac.grid.consumer!==self){_13ac.grid.consumer.model.set("selectedItem",_13ad);_13ac.grid.consumer.model.remove();}}));}}},true),_138a.around(self.grid,"insertRow",lang.hitch(self,self._aroundInsertRow)),this.model.on("changed",lang.hitch(this,function(){this.onChange(this.value=this.model.get("value")||[]);this._renderUI();this.focus();})),_138a.after(this.grid.dndSource,"onDndStart",lang.hitch(this,function(_13ae,nodes,copy){var _13af=this.grid.dndSource,_13b0=_13af.accept&&_13af.checkAcceptance(_13ae,nodes);_138b[_13b0?"remove":"add"](this.container,"dojoDndTargetDisabled");}),true),_138a.after(this._dndTarget,"onDropData",lang.hitch(this,function(_13b1,_13b2,nodes,copy){var item;for(var i=0;i<_13b1.length;i++){when(_13b1[i].data,lang.hitch(this,function(_13b3){this.model.addTo(_13b3,null,false);if(_13b2&&_13b2.grid&&_13b2.grid.consumer&&_13b2.grid.consumer!==this){_13b2.grid.consumer.model.set("selectedItem",_13b3);_13b2.grid.consumer.model.remove();}}));}}),true));var _13b4=this.commandProvider.commands.concat(this._newItemCommand);_13b4.forEach(function(_13b5){this.own(_138a.after(_13b5,"onDialogOpen",function(){self.set("isShowingChildDialog",true);self.validate();}),_138a.after(_13b5,"onDialogHideComplete",function(){self.set("isShowingChildDialog",false);self.focus();}));},this);},executeAction:function(_13b6){if(_13b6==="createnewitem"){if(this._newItemCommand){this._newItemCommand.execute();}}},setupAllowedTypes:function(){var _13b7=this.itemConverterKey;this.allowedDndTypes=this.allowedDndTypes||[];if(_13b7){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_13b7;});}if(this.customTypeIdentifier){this.allowedDndTypes.unshift(this.customTypeIdentifier);}},focus:function(){if(this.value&&this.value.length>0){this._focusManager.focus(this.container);if(this.model){var _13b8=this.model.get("selectedItem"),_13b9=this.model.getItemIndex(_13b8);if(_13b8){this.grid&&this.grid.focus(this.grid.row(_13b9).element);}}}else{this.textWithLinks.focus();}},select:function(item){this.grid.clearSelection();if(item){this.grid.select(this.model.getItemIndex(item));}},isValid:function(){return (!this.required||(this.model&&this.model.get("value").length>0));},_onBlur:function(){if(this.contextMenu&&this.contextMenu.isShowingNow){return;}this.inherited(arguments);},_setValueAttr:function(val){this._set("value",val);if(!val||!(val instanceof Array)){this._set("value",[]);}if(this._started){this.model?this.model.set("data",this.value):(this.model=new _139d(this.value,{readOnly:this.readOnly}));this._renderUI();}},_setReadOnlyAttr:function(_13ba){this._set("readOnly",_13ba);this._displayActionsContainer();if(this.model){this.model.set("readOnly",_13ba);}},_dndNodeCreator:function(item,hint){var _13bb=this.allowedDndTypes,node=_138c.create("div").appendChild(document.createTextNode(item.text));if(item.typeIdentifier){_13bb=_1396.getAndConcatenateValues(item.typeIdentifier,"dndTypes");}return {"node":node,"type":_13bb,"data":item};},_aroundInsertRow:function(_13bc){return lang.hitch(this,function(_13bd,_13be,_13bf,i,_13c0){var row=_13bc.apply(this.grid,arguments);var _13c1=this.model.get("selectedItem");if(_13c1&&_13c1.id===_13bd.id){this.select(_13c1);}return row;});},_renderUI:function(){this.grid.refresh();this.grid.renderArray(this.model.get("data"));},_showContextMenu:function(e){var _13c2=this.model.get("selectedItem"),_13c3=this.model.getItemIndex(_13c2);if(_13c2){event.stop(e);this.contextMenu.scheduleOpen(this,null,_138e.position(query(".epi-iconContextMenu",this.grid.row(_13c3).element)[0],true));}},_displayActionsContainer:function(){_138d.set(this.actionsContainer,"display",this.readOnly||!this.actionsVisible?"none":"");}});});},"epi-cms/extension/events":function(){define(["dojo/_base/lang","dojo/keys","dojo/mouse","dojo/on"],function(lang,keys,mouse,on){function _13c4(e){return e.keyCode===keys.DELETE;};function _13c5(e){return e.shiftKey;};function isF10(e){return e.keyCode==keys.F10;};function _13c6(e){return _13c5(e)&&isF10(e);};function _13c7(e){return mouse.isLeft(e)||mouse.isMiddle(e)||mouse.isRight(e);};function _13c8(type,_13c9){var _13ca=function(node,_13cb){return on(node,type,function(evt){if(_13c9){return _13c9(evt,_13cb);}return _13cb.call(this,evt);});};return _13ca;};var _13cc={selector:on.selector,contextmenu:_13c8("contextmenu",function(e,_13cd){_13cd.call(this,e);}),keys:{shiftf10:_13c8("keydown",function(e,_13ce){if(_13c6(e)){_13ce.call(this,e);}}),del:_13c8("keydown",function(e,_13cf){if(_13c4(e)){_13cf.call(this,e);}}),contextmenu:_13c8("contextmenu",function(e,_13d0){if(_13c7(e)){return;}_13d0.call(this,e);})},mouse:lang.mixin({contextmenu:_13c8("contextmenu",function(e,_13d1){if(_13c7(e)){_13d1.call(this,e);}})},mouse)};return _13cc;});},"epi-cms/contentediting/command/NewItem":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_13d2,_13d3,_13d4,_13d5){return _13d2([_13d3,_13d4],{dialogContentClass:_13d5,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.set("value",null);this.showDialog();},_onModelChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("canExecute",true);},onDialogExecute:function(){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){this.model.addTo(this.value,null,null);}}});});},"epi-cms/contentediting/command/_CommandWithDialogMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","dijit/Destroyable","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","epi/i18n!epi/nls/episerver.shared"],function(array,_13d6,lang,_13d7,when,_13d8,_13d9,_13da,_13db){return _13d6([_13d8],{res:_13da,title:null,destroyOnHide:true,dialogClass:"epi-dialog-portrait",dialogContentClass:null,dialogParams:null,dialogContentParams:null,dialogContent:null,defaultActionsVisible:true,confirmActionText:_13db.action.ok,cancelActionText:_13db.action.cancel,value:null,_dialog:null,_getTitle:function(){return this.title||lang.replace(this.value?this.res.title.template.edit:this.res.title.template.create,this.res.title.action);},onDialogOpen:function(){},onDialogExecute:function(){},onDialogCancel:function(){},onDialogHideComplete:function(){},showDialog:function(){if(this.dialogContent){this.dialogContent.destroy();this.dialogContent=null;}this.dialogContent=new this.dialogContentClass(this.dialogContentParams);this._dialog=new _13d9(lang.mixin({title:this._getTitle(),dialogClass:this.dialogClass,content:this.dialogContent,destroyOnHide:this.destroyOnHide,defaultActionsVisible:this.defaultActionsVisible,confirmActionText:this.confirmActionText,cancelActionText:this.cancelActionText},this.dialogParams));this._dialog.startup();this.dialogContent.set("value",this.value);this.own(this.dialogContent,_13d7.after(this._dialog,"onExecute",lang.hitch(this,this.onDialogExecute),true),_13d7.after(this._dialog,"onCancel",lang.hitch(this,this.onDialogCancel),true),_13d7.after(this._dialog,"onHide",lang.hitch(this,this.onDialogHideComplete),true),this._dialog.watch("open",lang.hitch(this,function(name,_13dc,_13dd){if(!_13dd){return;}this.onDialogOpen();})));this._dialog.show();}});});},"epi-cms/widget/LinkEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dijit/_CssStateMixin","epi","epi/dependency","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/viewmodel/LinkEditorViewModel"],function(array,_13de,lang,_13df,_13e0,_13e1,epi,_13e2,_13e3,_13e4,_13e5,_13e6,_13e7){return _13de([_13e4,_13e5,_13e3,_13e1,_13e6],{_metadataManager:null,modelClassName:_13e7,hiddenFields:[],postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this._metadataManager=this._metadataManager||_13e2.resolve("epi.shell.MetadataManager");if(!this.model&&this.modelClassName){var _13e8=_13de(this.modelClassName);this.model=new _13e8();}this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog({action:"ok"});}})},{name:"delete",label:epi.resources.action.deletelabel,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){array.forEach(this.form._getDescendantFormWidgets(),function(_13e9){_13e9.set("value","");},this);this.executeDialog({action:"delete"});})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];},postCreate:function(){if(this.modelType){this.metadata=this._metadataManager.getMetadataForType(this.modelType);}this.inherited(arguments);},_setValueAttr:function(value){this.inherited(arguments);this._handleActions(value);},onFormCreated:function(_13ea){array.forEach(this.form._getDescendantFormWidgets(),function(_13eb){if(this.hiddenFields&&this.hiddenFields.indexOf(_13eb.name)>-1){var _13ec=this._getAncestorNode(_13eb.domNode,"epi-formsRow");_13df.set(_13ec,{display:"none"});_13eb.set("required",false);}},this);this._handleActions(this.value);},_handleActions:function(value){if(this.hasAction("delete")){this.setActionProperty("delete","disabled",this.model._isEmptyObject(value));}},getFormWidget:function(_13ed){var _13ee=array.filter(this.form._getDescendantFormWidgets(),function(_13ef){return _13ef&&_13ef.name===_13ed;},this);return _13ee?_13ee[0]:null;},_getAncestorNode:function(node,_13f0){var _13f1=node?node.parentNode:null;if(!_13f1){return null;}if(!_13e0.contains(_13f1,_13f0)){return this._getAncestorNode(_13f1,_13f0);}return _13f1;},getActions:function(){return this._actions;},isValidValue:function(){return array.every(this.form._getDescendantFormWidgets(),function(_13f2){return _13f2.get("required")?!!_13f2.get("value"):true;});}});});},"epi-cms/widget/viewmodel/LinkEditorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/io-query","dojo/topic","dojo/Stateful","dojo/when","epi/shell/_StatefulGetterSetterMixin","epi/dependency"],function(array,_13f3,_13f4,lang,_13f5,topic,_13f6,when,_13f7,_13f8){return _13f3([_13f6,_13f7],{_isEmptyObject:function(obj){for(var i in obj){if(obj[i]&&obj[i]!==""){return false;}}return true;}});});},"epi-cms/contentediting/viewmodel/ItemCollectionViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when","epi/dependency","epi/string","epi-cms/contentediting/viewmodel/LinkItemModel","epi-cms/contentediting/viewmodel/_ViewModelMixin"],function(array,_13f9,lang,_13fa,all,when,_13fb,_13fc,_13fd){return _13f9([_13fd],{_instanceId:null,_autoId:0,_selectedItem:null,_data:null,itemModelClass:null,itemModelType:null,constructor:function(data,_13fe){_13f9.safeMixin(this,_13fe);},postscript:function(data){var _13ff=_13fc.slashName(this.itemModelType);require([_13ff],lang.hitch(this,function(_1400){this.itemModelClass=_1400;this._instanceId=new Date().getTime();this._init(data);}));},moveNext:function(){this._move(1)&&this.emit("changed");},movePrevious:function(){this._move(-1)&&this.emit("changed");},remove:function(){if(!this.get("canEdit")){return;}var index=this.getItemIndex(this._selectedItem);this._data.splice(index,1);var len=this._data.length;this.set("selectedItem",this._data[index>=len?len-1:index]||null);this.emit("changed");},addTo:function(_1401,item,_1402){if(!_1401){return false;}if(this.getItemIndex(_1401)>=0){this.moveTo(_1401,null,false);this.emit("changed");}else{var self=this;when(self._createItemModel(_1401),function(model){if(!item){self._data.push(model);}else{var _1403=self.getItemIndex(item)+(_1402?0:1);self._data.splice(_1403,0,model);}self.emit("changed",{uiChanged:false});});}},moveTo:function(_1404,item,_1405){if(!_1404&&!this._selectedItem){return false;}this.set("selectedItem",_1404||this._selectedItem);var _1406=this.getItemIndex(this._selectedItem);this._data.splice(_1406,1);var _1407=(item?this.getItemIndex(item):(this._data.length-1))+(_1405?0:1);this._data.splice(_1407,0,this._selectedItem);this.emit("changed");},updateItemData:function(item){var index=this.getItemIndex(this._selectedItem);if(index<0){return;}var self=this;when(self._createItemModel(item),function(model){self._selectedItem=self._data[index]=model;self.emit("changed");});},swap:function(_1408,_1409){if(!this._data[_1408]||!this._data[_1409]){return false;}var temp=this._data[_1408];this._data[_1408]=this._data[_1409];this._data[_1409]=temp;return true;},getItemIndex:function(item){var index=-1;if(!item||!(item instanceof this.itemModelClass)){return index;}this._data.some(function(i,o){if(i.id===item.id){index=o;return true;}return false;},this);return index;},_init:function(data){var self=this,_140a;this.set("selectedItem",null);if(!(data instanceof Array)){this._data=[];}else{_140a=data.map(function(item){return this._createItemModel(item);},this);all(_140a).then(function(_140b){self._data=_140b;self.emit("initCompleted");});}},_generateItemId:function(){return this._instanceId+"_"+this._autoId++;},_createItemModel:function(item){var _140c=this.itemModelClass,id={id:this._generateItemId()},model,dfd=new _13fa();if(this.getItemIndex(item)>=0){return item;}if(item instanceof _140c){model=lang.mixin(lang.clone(item),id);}else{model=new _140c(lang.mixin(lang.clone(item),id));}when(model.parse(true),function(){dfd.resolve(model);});return dfd;},_move:function(_140d){var index=this.getItemIndex(this._selectedItem);if(index<0){return false;}return this.swap(index,index+_140d);},_canMoveNextGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>=0&&index<(this._data.length-1));},_canMovePreviousGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>0&&index<=(this._data.length-1));},_canEditGetter:function(){return !this.readOnly&&!!this._selectedItem;},_valueGetter:function(){return this._data.map(function(item){return item.serialize();},this);},_dataGetter:function(){return this._data||[];},_dataSetter:function(data){this._init(data);},_selectedItemGetter:function(){return this._selectedItem;},_selectedItemSetter:function(value){this._selectedItem=value;}});});},"epi-cms/contentediting/viewmodel/LinkItemModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi/Url","epi-cms/contentediting/viewmodel/CollectionItemModel","epi-cms/core/PermanentLinkHelper"],function(_140e,lang,_140f,when,Url,_1410,_1411){return _140e([_1410],{titleKey:"publicUrl",publicUrl:null,permanentUrl:null,_defaultDataStoreName:"epi.cms.content.light",serialize:function(){return {attributes:this.attributes,text:this.text,href:this.href||this.url,target:this.target||null,title:this.title||"",publicUrl:this.publicUrl,typeIdentifier:this.typeIdentifier||""};},_buildPublicUrl:function(url){var _1412=new Url(url);if(!_1412.scheme){_1412=new Url("",{"scheme":window.location.protocol,"authority":window.location.hostname,"path":url});}return _1412.toString();},_publicUrlGetter:function(){return this._buildPublicUrl(this.publicUrl||this.url||this.href);},_permanentUrlSetter:function(value){this.href=this.permanentUrl=value;},_onTryUpdateItemModel:function(){if(!this.typeIdentifier){return when(_1411.getContent(this.href),lang.hitch(this,function(_1413){if(_1413&&_1413.length>0){this._parseFromContent(_1413[0]);}}));}},_parseFromContent:function(_1414){if(_1414){this.typeIdentifier=_1414.typeIdentifier;this.publicUrl=this._buildPublicUrl(_1414.publicUrl);}}});});},"epi-cms/contentediting/viewmodel/CollectionItemModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi-cms/contentediting/viewmodel/_ViewModelMixin"],function(_1415,lang,_1416,when,_1417){return _1415([_1417],{id:null,textKey:"text",titleKey:null,iconTypeKey:"typeIdentifier",typeIdentifier:null,serialize:function(){},parse:function(_1418){if(_1418){return this._onTryUpdateItemModel();}return null;},_onTryUpdateItemModel:function(){},_getPropertyValue:function(_1419,_141a){if(_1419===_141a){return this[_1419];}return this.get(_1419);},_nameGetter:function(){return this._getPropertyValue(this.textKey,"name");},_textGetter:function(){return this._getPropertyValue(this.textKey,"text");},_titleGetter:function(){return this._getPropertyValue(this.titleKey,"title")||this._getPropertyValue(this.textKey,"title");},_iconTypeIdentifierGetter:function(){return this._getPropertyValue(this.iconTypeKey,"iconTypeIdentifier");}});});},"epi-cms/contentediting/command/ItemCollectionCommands":function(){define(["dojo/_base/declare","./BlockRemove","./ItemEdit","./MoveToPrevious","./MoveToNext","./ContentAreaCommands"],function(_141b,_141c,Edit,_141d,_141e,_141f){return _141b([_141f],{constructor:function(_1420){var _1421=_1420?_1420.commandOptions:{};this.commands=[new Edit(_1421),new _141d(_1421),new _141e(_1421),new _141c(_1421)];}});});},"epi-cms/contentediting/command/ItemEdit":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_1422,_1423,_1424,_1425){return _1422([_1423,_1424],{dialogContentClass:_1425,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.showDialog();},_onModelValueChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("value",this.model.get("selectedItem"));this.set("canExecute",this.model.get("canEdit"));},onDialogExecute:function(_1426){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){if(_1426&&_1426.action==="delete"){this.model.remove();}else{this.model.updateItemData(this.value);}}}});});},"url:epi-cms/contentediting/editors/templates/ItemCollectionEditor.html":"<div class=\"dijitInline\">\r\n    <!-- To reuse styling of content area we wrap into a div that include content area class -->\r\n    <div class=\"epi-content-area-editor\" data-dojo-attach-point=\"container\">\r\n        <div data-dojo-attach-point=\"itemsContainer\"></div>\r\n        <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/editors/PreviewableDateTimeEditor":function(){define(["dojo/_base/declare","dojo/dom-construct","epi/datetime","epi/shell/widget/DateTimeSelectorDropDown","epi-cms/contentediting/editors/_PreviewableEditor"],function(_1427,_1428,_1429,_142a,_142b){return _1427([_142b],{required:false,controlParams:["required"],buildRendering:function(){this.control=new _142a({datePackage:null});this.inherited(arguments);},onChange:function(val){this.set("labelValue",_1429.toUserFriendlyHtml(val));}});});},"epi-cms/contentediting/editors/_PreviewableEditor":function(){define(["dojo/_base/array","dojo/_base/event","dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","epi","dojo/text!./templates/_PreviewableEditor.html","dojox/html/entities"],function(array,event,_142c,lang,on,_142d,_142e,_142f,dijit,_1430,_1431,_1432,_1433,_1434,epi,_1435,_1436){return _142c([_1431,_1430,_1432,_1433],{value:null,changeLabel:epi.resources.action.change,templateString:_1435,control:null,controlParams:[],state:"",_setLabelValueAttr:{node:"labelNode",type:"innerHTML"},_setIsEmptyAttr:function(_1437){this._set("isEmpty",_1437);if(_1437){_142d.add(this.domNode,"epi-state-empty");}else{_142d.remove(this.domNode,"epi-state-empty");}},_setValueAttr:function(value){this._set("value",value);this.control.set("value",value);this.set("labelValue",typeof (value)=="string"?_1436.encode(value):value);this.set("isEmpty",!value);},onChange:function(val){},buildRendering:function(){this.inherited(arguments);if(!this.control){this.control=new _1434();this.own(this.control);}this.control.placeAt(this.domNode,"first");},postCreate:function(){this.inherited(arguments);this._setDisplay(false);this.connect(this.labelNode,"onclick",this._onChangeNodeClick);this.connect(this.changeNode,"onclick",this._onChangeNodeClick);this.connect(this.control,"onChange",this._onControlChange);this.connect(this.control,"onBlur",this._onControlBlur);this.own(this.control.watch("state",lang.hitch(this,function(name,old,value){this.set("state",value);})));this.control.validate();this.set("state",this.control.state);array.forEach(this.controlParams,function(_1438){this.control.set(_1438,this.get(_1438));},this);},onBlur:function(){this._setDisplay(false);},_setDisplay:function(_1439){if(!_1439&&!this.validate()){return;}this.showControl=_1439;_142f.set(this.labelNode,"display",_1439?"none":"");_142f.set(this.control.domNode,"display",_1439?"":"none");if(!this.readOnly){_142f.set(this.changeNode,"display",_1439?"none":"");}},focus:function(){if(this.showControl){this.control.focus();}else{this.changeNode.focus();}},_onControlChange:function(value){this._set("value",value);this.set("labelValue",typeof (value)=="string"?_1436.encode(value):value);this.set("isEmpty",!value);this.onChange(value);},_onControlBlur:function(){this._setDisplay(false);},_onChangeNodeClick:function(e){event.stop(e);this._setDisplay(true&&!this.readOnly);dijit.selectInputText(this.control.focusNode);},_setReadOnlyAttr:function(_143a){this._set("readOnly",_143a);_142f.set(this.changeNode,"display",this.readOnly?"none":"");this.readOnly&&this._setDisplay(false);},validate:function(){return this.control.validate();},isValid:function(){return this.control.isValid();},getErrorMessage:function(){return this.control.getErrorMessage();}});});},"url:epi-cms/contentediting/editors/templates/_PreviewableEditor.html":"<div class=\"dijitReset dijitInline epi-previewableTextBox-wrapper\">\r\n    <span data-dojo-attach-point=\"labelNode\" class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\"></span>\r\n    <a href=\"#\" data-dojo-attach-point=\"changeNode, focusNode\" class=\"epi-functionLink\">${changeLabel}</a>\r\n</div>\r\n","epi-cms/contentediting/editors/PreviewableTextEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dijit/form/ValidationTextBox","epi-cms/contentediting/editors/_PreviewableEditor"],function(array,_143b,_143c,_143d,_143e){return _143b([_143e],{required:false,intermediateChanges:false,controlParams:["intermediateChanges","regExp","required","invalidMessage"],_getRegExpAttr:function(){return this.regExp||"";}});});},"epi-cms/contentediting/editors/SelectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/on","dijit/form/Select","dijit/MenuItem","dijit/MenuSeparator","epi/shell/layout/_LayoutWidget","epi/shell/widget/_ValueRequiredMixin"],function(array,_143f,lang,_1440,on,_1441,_1442,_1443,_1444,_1445){return _143f([_1444,_1441,_1445],{actualValue:null,value:null,maxHeight:-1,postMixInProperties:function(){this.inherited(arguments);this.set("selections",this.selections);this.actualValue=this.value;},_setSelectionsAttr:function(_1446){this.set("options",array.map(_1446,function(item){return {label:item.text,value:item.value,selected:(item.value==this.value)||(!item.value&&!this.value)};},this));},postCreate:function(){this.inherited(arguments);on(this,"change",lang.hitch(this,function(){if(!this.disabled){this.validate();}this.onLayoutChanged();}));},_getMenuItemForOption:function(_1447){if(_1447.type=="separator"){return new _1443();}else{var click=lang.hitch(this,"_setValueAttr",_1447);var item=new _1442({option:_1447,label:_1447.label||this.emptyLabel,onClick:click,disabled:_1447.disabled||false});item.focusNode.setAttribute("role","listitem");return item;}},_getValueFromOpts:function(){var _1448=this.getOptions()||[];if(!this.multiple&&_1448.length){var _1449=array.filter(_1448,function(i){return i.selected;})[0];if(_1449&&_1449.value!==undefined){return _1449.value;}else{return null;}}else{if(this.multiple){return array.map(array.filter(_1448,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_setValueAttr:function(value,_144a){var _144b=this.getOptions()||[];if(value===null||typeof value!="object"){value=array.filter(_144b,function(i){return (i.value==value)||(!i.value&&!value);});}if(!lang.isArray(value)){value=[value];}if(this._onChangeActive){var _144c=value[0]?value[0].value:null;this._pendingOnChange=this.actualValue!==_144c;this.actualValue=_144c;}array.forEach(_144b,function(i){i.selected=array.some(value,function(v){return v.value===i.value;});});var val=array.map(value,function(i){return i.value;}),disp=array.map(value,function(i){return i.label;});this._set("value",this.multiple?val:val[0]);this._setDisplay(this.multiple?disp:disp[0]);this._updateSelection();this._handleOnChange(this.value,_144a);},_updateSelection:function(){this._set("value",this._getValueFromOpts());var value=this.value;if(value!==undefined){if(!lang.isArray(value)){value=[value];}array.forEach(this._getChildren(),function(child){var _144d=array.some(value,function(v){return child.option&&(v===child.option.value);});child.domNode.setAttribute("aria-selected",_144d);},this);}},validator:function(value,flags){}});});},"epi-cms/contentediting/editors/ShortcutEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/ShortcutDialog","../viewmodel/ShortcutDialogViewModel","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.shortcutblockeditor","epi/i18n!epi/nls/episerver.shared"],function(_144e,lang,_144f,_1450,_1451,_1452,_1453,_1454,epi,_1455,_1456,_1457,_1458,_1459,_145a){return _144e([_1451,_1452,_1453,_1458],{templateString:"<div><span data-dojo-attach-point=\"shortcutTypeNameNode\" class=\"dijitInline\"></span> <div data-dojo-attach-point=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_showDialog\" >${resources.action.manage}</div></div>",resources:epi.resources,value:null,contentLink:null,metadata:null,watchHandlers:null,postCreate:function(){this.inherited(arguments);_144f.add(this.button.domNode,"epi-chromelessButton epi-chromelessLinkButton epi-functionLink");},destroy:function(){if(this.button){this.button.destroyRecursive();}this.inherited(arguments);},onChange:function(value){},_showDialog:function(){var _145b=new _1456({metadata:this.metadata,contentLink:this.contentLink,value:this.value,model:new _1457({contentLink:this.contentLink,contentName:this.contentName,value:this.value})});var _145c=new _1455({destroyOnHide:true,defaultActionsVisible:false,confirmActionText:_145a.action.save,content:_145b,title:_1459.dialogtitle});_145c.connect(_145c,"onExecute",lang.hitch(this,function(value){this.set("value",_145b.get("value"));this.onChange(_145b.get("value"));}));_145c.connect(_145c,"onHide",lang.hitch(this,function(){this.isShowingChildDialog=false;}));this.isShowingChildDialog=true;_145c.show();},_setShortcutTypeNameAttr:{node:"shortcutTypeNameNode",type:"innerHTML"},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1450.set(this.button.domNode,"display",value?"none":"");},_setValueAttr:function(value){this._set("value",value);this.set("ShortcutTypeName",value&&value.pageShortcutTypeName?value.pageShortcutTypeName:"");}});});},"epi-cms/contentediting/ShortcutDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/html","dijit/_CssStateMixin","epi-cms/widget/Breadcrumb","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ShortcutDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.shortcutblockeditor","epi/i18n!epi/nls/episerver.shared"],function(_145d,lang,_145e,_145f,html,_1460,_1461,_1462,_1463,_1464,_1465,_1466,res,_1467){return _145d([_1463,_1465,_1462,_1460,_1464],{templateString:_1466,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",_externalLinkWidget:null,_shortcutLinkWidget:null,_shortcutTypeWidget:null,_targetFrameWidget:null,_switchLinkTypeFirstRunDone:false,modelBindingMap:{"contentLink":["contentLink"],"contentName":["contentName"],"enableSaveButton":["enableSaveButton"],"enableShortcutLink":["enableShortcutLink"],"enableExternalLink":["enableExternalLink"],"clearExternalLink":["clearExternalLink"],"enableOpenIn":["enableOpenIn"]},postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;},_setContentLinkAttr:function(value){this.breadcrumb.set("contentLink",value);},_setContentNameAttr:{node:"contentNameNode",type:"innerHTML"},_setEnableSaveButtonAttr:function(value){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!value);}},_setEnableShortcutLinkAttr:function(value){if(this._shortcutLinkWidget){this._shortcutLinkWidget.set("required",value);this._shortcutLinkWidget.set("state","");var _1468=this._getAncestorNode(this._shortcutLinkWidget.domNode,"epi-formsRow");if(_1468){_145e.set(_1468,"display",value?"":"none");}}},_setEnableExternalLinkAttr:function(value){if(this._externalLinkWidget){this._externalLinkWidget.set("required",value);this._externalLinkWidget.set("disabled",!value);this._externalLinkWidget._set("state","");var _1469=this._getAncestorNode(this._externalLinkWidget.domNode,"epi-formsRow");if(_1469){_145e.set(_1469,"display",value?"":"none");}}},_setEnableOpenInAttr:function(value){if(this._targetFrameWidget){var _146a=this._getAncestorNode(this._targetFrameWidget.domNode,"epi-formsRow");if(_146a){_145e.set(_146a,"display",value?"":"none");}}},_getAncestorNode:function(node,_146b){var _146c=node?node.parentNode:null;if(!_146c){return null;}if(!_145f.contains(_146c,_146b)){return this._getAncestorNode(_146c,_146b);}return _146c;},_setClearExternalLinkAttr:function(value){if(this._externalLinkWidget&&value&&!this._switchLinkTypeFirstRunDone){this._externalLinkWidget.reset();this._switchLinkTypeFirstRunDone=true;}},onFieldCreated:function(_146d,_146e){switch(_146d){case "pageLinkURL":this._externalLinkWidget=_146e;this._externalLinkWidget.set("invalidMessage",res.protocolwarning);this._externalLinkWidget.set("acceptUrl",true);this._externalLinkWidget.set("acceptMailAddress",true);this._externalLinkWidget.set("regExp","^[a-z][a-z\\d+-.]*:.*");this.connect(this._externalLinkWidget.domNode,"onkeyup",lang.hitch(this,function(evt){this.model.set("enableSaveButton",true);}));break;case "pageShortcutLink":this._shortcutLinkWidget=_146e;this._shortcutLinkWidget.set("contentLink",this.model.get("contentLink"));break;case "pageShortcutType":this._shortcutTypeWidget=_146e;break;case "pageTargetFrame":this._targetFrameWidget=_146e;break;default:break;}},onChange:function(value){this.inherited(arguments);this.model.set("intermediateValue",lang.mixin(value,{"pageShortcutTypeName":this._shortcutTypeWidget?this._shortcutTypeWidget.get("displayedValue"):""}));},_getValueAttr:function(){return this.model.get("intermediateValue");},getActions:function(){this._actions=[{name:"save",label:_1467.action.save,settings:{type:"button",disabled:true,"class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog();}else{this.model.set("enableSaveButton",false);}})},{name:"cancel",label:_1467.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"url:epi-cms/contentediting/templates/ShortcutDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-type=\"dijit/form/Form\" class=\"epi-formArea\" data-dojo-attach-point=\"form\"></div>\r\n</div>","epi-cms/contentediting/viewmodel/ShortcutDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi-cms/contentediting/PageShortcutTypeSupport","epi/epi","epi/shell/_StatefulGetterSetterMixin"],function(_146f,_1470,_1471,_1472,epi,_1473){return _146f([_1470,_1473],{value:null,intermediateValue:null,savedValue:null,contentLink:null,contentName:null,enableSaveButton:null,enableShortcutLink:null,enableExternalLink:null,enableOpenIn:true,postscript:function(){this.inherited(arguments);this.set("savedValue",this.value);},_setIntermediateValueAttr:function(value){this._set("intermediateValue",value);this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.savedValue));this.set("enableShortcutLink",value&&(value.pageShortcutType==_1472.pageShortcutTypes.Shortcut||value.pageShortcutType==_1472.pageShortcutTypes.FetchData)?true:false);this.set("enableExternalLink",value&&value.pageShortcutType==_1472.pageShortcutTypes.External?true:false);this.set("clearExternalLink",value&&value.pageShortcutType==_1472.pageShortcutTypes.External&&this.savedValue.pageShortcutType!=_1472.pageShortcutTypes.External?true:false);this.set("enableOpenIn",value&&!(value.pageShortcutType===_1472.pageShortcutTypes.FetchData||value.pageShortcutType===_1472.pageShortcutTypes.Inactive||value.pageShortcutType===_1472.pageShortcutTypes.Normal));},_setSavedValueAttr:function(value){this._set("savedValue",value);this.set("enableSaveButton",false);},save:function(){this.set("savedValue",this.intermediateValue);}});});},"epi-cms/contentediting/editors/TinyMCEEditor":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojox/html/entities","dijit/_TemplatedMixin","dijit/focus","epi/dependency","epi/routes","epi/shell/conversion/ObjectConverterRegistry","epi/shell/dnd/Target","epi/shell/layout/_LayoutWidget","epi/shell/TypeDescriptorManager","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/_DndStateMixin","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/_UserResizable","epi/shell/widget/dialog/Alert","dojo/text!./templates/TinyMCEEditor.html","epi/i18n!epi/cms/nls/tinymce","epi/i18n!epi/cms/nls/episerver.tinymce"],function(array,_1474,_1475,lang,win,_1476,_1477,_1478,_1479,keys,on,when,_147a,_147b,_147c,_147d,_147e,_147f,_1480,_1481,_1482,_1483,_1484,_1485,_1486,Alert,_1487,_1488,_1489){return _1475([_1481,_147b,_1485,_1486,_1483,_1484],{baseClass:"epiTinyMCEEditor",width:null,height:null,value:null,intermediateChanges:true,templateString:_1487,settings:null,dirtyCheckInterval:2000,autoResizable:false,isResized:false,tinymceRendered:null,dropTarget:null,readOnly:false,_dirtyCheckTimeout:null,constructor:function(_148a){lang.mixin(this,_148a);this.tinymceRendered=new _1479();},postMixInProperties:function(){if(this.autoResizable){this.height=0;}},postCreate:function(){this.dropTarget=new _1480(this.dndOverlay,{accept:this.allowedDndTypes,createItemOnDrop:false,readOnly:this.readOnly});this.connect(this.dropTarget,"onDropData","onDropData");this.connect(this.dndOverlay,"onmousemove","_onOverlayMouseMove");this.inherited(arguments);},startup:function(){this.inherited(arguments);if(!window.tinymce){require(["tinymce/tiny_mce_src"],lang.hitch(this,function(){var res=lang.mixin({},_1488,_1489);tinymce.addI18n({en:res});when(this._loadLegacyPlugins(),lang.hitch(this,function(){this._initTinyMCE();}));}));}else{this._initTinyMCE();}},destroy:function(){if(this._destroyed){return;}this._cancelDirtyCheckInterval();var ed=this.getEditor();tinymce.remove(ed);this.inherited(arguments);},_loadLegacyPlugins:function(){var dfd=new _1479();this.legacyPlugins.forEach(function(_148b){var url=_147e.getActionPath({moduleArea:"Util",path:"Editor/tinymce/plugins/"+_148b+"/"+(_1474.isDebug?"editor_plugin_src.js":"editor_plugin.js")});tinymce.PluginManager.load(_148b,url);});tinymce.ScriptLoader.loadQueue(function(){dfd.resolve();});return dfd;},canAccept:function(){return !_1477.contains(this.dndOverlay,"dojoDndTargetDisabled");},_onDndStart:function(){_1476.set(this.dndOverlay,"display","block");this.inherited(arguments);},_onDndCancel:function(){_1476.set(this.dndOverlay,"display","none");this.inherited(arguments);},_onDndDrop:function(){_1476.set(this.dndOverlay,"display","none");this.inherited(arguments);},_onOverlayMouseMove:function(evt){this._dragPosition={x:evt.pageX,y:evt.pageY};},onDropData:function(_148c,_148d,nodes,copy){var _148e=_148c?(_148c.length?_148c[0]:_148c):null;if(!_148e){return;}if(this.onDropping){this.onDropping();}this._dropDataProcessor(_148e);},_dropDataProcessor:function(_148f){when(_148f.data,lang.hitch(this,function(model){var self=this,type=_148f.type,ed=this.getEditor();function _1490(url){ed.focus();ed.execCommand("CreateLink",false,url);};function _1491(html){ed.focus();if(ed.execCommand("mceInsertContent",false,html)){self._onChange(ed.getContent());}};function _1492(data){if(!ed.selection.isCollapsed()){_1490(data.url);}else{var _1493="<a href=\"{0}\" title=\"{1}\">{1}</a>";_1491(lang.replace(_1493,[data.url,_147a.encode(data.text)]));}};function _1494(data){var _1495="<img alt=\"{alt}\" src=\"{src}\" width=\"{width}\" height=\"{height}\" />";var _1496=_1478.create("img",{src:data.previewUrl||data.url,style:{display:"none;"}},win.body(),"last");on.once(_1496,"load",function(){_1491(lang.replace(_1495,this));_1478.destroy(_1496);});};if(type&&type.indexOf("link")!==-1){_1492(model);}else{if(type&&type.indexOf("fileurl")!==-1){_1494(model);}}var _1497=model.typeIdentifier;var _1498=_1482.getValue(_1497,"editorDropBehaviour");if(_1498){if(_1498===1){var html="<div data-contentlink=\""+model.contentLink+"\" data-classid=\"36f4349b-8093-492b-b616-05d8964e4c89\" class=\"mceNonEditable epi-contentfragment\">"+model.name+"</div>";_1491(html);return;}var _1499,_149a=_1482.getInheritanceChain(_1497);for(var i=0;i<_149a.length;i++){var _149b=_149a[i];_1499=_147f.getConverter(_149b,_149b+".link");if(_1499){break;}}if(!_1499){return;}when(_1499.convert(_1497,_1497+".link",model),lang.hitch(this,function(data){if(!data.url){var _149c=new Alert({description:_1489.notabletocreatelinkforpage});_149c.show();this.own(_149c);}else{switch(_1498){case 2:_1492(data);break;case 3:_1494(data);break;}}}));}}));_1476.set(this.dndOverlay,{"display":"none"});},focus:function(){var ed=this.getEditor();if(ed!=null){this._focused=true;ed._gainedFocus=true;when(this.tinymceRendered,lang.hitch(this,function(){tinymce.execCommand("mceFocus",false,this.editorFrame.id);}));}},validate:function(){return this.inherited(arguments);},getEditor:function(){return (typeof tinymce!=="undefined"&&tinymce!=null?tinymce.get(this.editorFrame.id):null);},getEditorDOM:function(){return tinymce.DOM;},resizeEditor:function(){var ed=this.getEditor(),_149d=0,_149e=(tinymce.isIE?document.body.clientHeight:window.innerHeight)-200,_149f=(tinymce.isIE?document.body.clientWidth:window.innerWidth)-200,d=ed.getDoc(),b=d.body,DOM=tinymce.DOM,_14a0=this.height,_14a1=this.width,_14a2,_14a3;_14a2=b.scrollHeight;_14a3=b.scrollWidth;if(_14a2>_149d){_14a0=_14a2;}if(_14a2>_149e){_14a0=_149e;}if(_14a3>_149f){_14a1=_149f;}DOM.setStyle(ed.contentWindow.frameElement,"height",_14a0+80+"px");if(ed.getBody().scrollWidth!=ed.getBody().offsetWidth){var _14a4=20;if(_14a0==_149e){_14a4=30;}DOM.setStyle(ed.contentWindow.frameElement,"width",ed.getBody().scrollWidth+_14a4+"px");}this.isResized=true;},_setValueAttr:function(_14a5){var _14a6=(_14a5===null||_14a5===undefined);this._emptyRawValue=_14a6;this._rawValue=_14a5;this.value=_14a5;if(_14a6){this.value="";}var _14a7=function(t){var _14a8=t.getEditor();if(_14a8!=null){_14a8.setContent(t.value);}this._started&&setTimeout(lang.hitch(t,t.validate),0);};when(this.tinymceRendered,lang.hitch(this,function(){_14a7(this);}));},_getValueAttr:function(){return this._emptyRawValue?this._rawValue:this.value;},_updateTinySettings:function(){this.settings=lang.mixin(this.settings,{mode:"exact",width:this.width,height:this.height,relative_urls:false,elements:this.editorFrame.id,readonly:this.readOnly});},_initTinyMCE:function(){this._updateTinySettings();if(this.legacyPlugins&&this.legacyPlugins.length>0){this.settings.plugins=this.settings.plugins+","+this.legacyPlugins.join(",");}this.editorFrame.value=this.value||"";if(typeof tinymce!=="undefined"){tinymce.dom.Event.domLoaded=true;this._setupHandle=tinymce.onAddEditor.add(lang.hitch(this,this._setupEditorEventHandling));tinymce.init(this.settings);this._startDirtyCheckInterval();}else{console.error("Couldn't initialize the editor");}},_isFullScreen:function(ed){return ed.editorId==="mce_fullscreen";},_onPostRender:function(ed){if(this.tinymceRendered.fired!==0){this.tinymceRendered.resolve();this.own(_147c.registerIframe(ed.contentWindow.frameElement));this._handlePopupMenu(ed);this._handlePopupWindow(ed);}},_handlePopupWindow:function(ed){ed.windowManager.onOpen.add(lang.hitch(this,function(){this.isShowingChildDialog=true;}));ed.windowManager.onClose.add(lang.hitch(this,function(){this.focus();this.isShowingChildDialog=this._isFullScreen(ed);if(!this.isShowingChildDialog&&this._hasPendingChanges){this._onChange(ed.getContent());}}));},_handlePopupMenu:function(ed){var _14a9;for(var i in ed.controlManager.controls){_14a9=ed.controlManager.controls[i];if(_14a9.onRenderMenu){_14a9.onRenderMenu.add(lang.hitch(this,function(_14aa,menu){menu.onShowMenu.add(lang.hitch(this,function(){this.isShowingChildDialog=true;}));menu.onHideMenu.add(lang.hitch(this,function(){this.isShowingChildDialog=this._isFullScreen(ed);}));}));}}},_setupEditorEventHandling:function(_14ab,ed){tinymce.onAddEditor.remove(this._setupHandle);ed.onInit.add(lang.hitch(this,function(){if(ed&&ed.selection){ed.selection.onSetContent.add(lang.hitch(this,function(_14ac,args){var isSet=args.set;if(isSet){this._onChange(ed.getContent());}}));}}));ed.onSetContent.add(lang.hitch(this,function(ed,e){this.onSetContent(ed);}));ed.onPostRender.add(lang.hitch(this,function(ed,e){this._onPostRender(ed);}));ed.onKeyUp.add(lang.hitch(this,function(ed,e){this.onKeyUp(ed,e);}));ed.onChange.add(lang.hitch(this,function(ed,e){this._onChange(ed.getContent());}));ed.onRemove.add(lang.hitch(this,function(ed){this.onEditorRemoved(ed);}));ed.onRedo.add(lang.hitch(this,function(ed,level){this.onRedo(ed,level);}));ed.onUndo.add(lang.hitch(this,function(ed,level){this.onUndo(ed,level);}));ed.onBeforeExecCommand.add(lang.hitch(this,function(ed,cmd,ui,val,a){if(cmd==="mceFullScreen"){this.isShowingChildDialog=!this._isFullScreen(ed);}}));},onSetContent:function(ed){if(this.isResized){this._hasPendingChanges=this.value!=ed.getContent()||this._hasPendingChanges;}if(this.autoResizable){setTimeout(lang.hitch(this,function(){this.resizeEditor();}),200);}else{if(!this.isResized){this.isResized=true;}}this.onLayoutChanged();},onEditorRemoved:function(ed){},_isMetaKey:function(e){if(e.keyCode==keys.CTRL||e.keyCode==keys.ALT||e.keyCode==keys.SHIFT||e.keyCode==keys.META){return true;}return false;},onKeyUp:function(_14ad,e){if(_14ad){if(!tinymce.VK.metaKeyPressed(e)&&!this._isMetaKey(e)){this._hasPendingChanges=_14ad.undoManager.typing;}}},_onChange:function(val){this.value=val;this._emptyRawValue=false;if(this.validate()){this._hasPendingChanges=false;this.onChange(this.value);}},onChange:function(val){},_stopEditing:function(){this._focused=false;this.displayMessage(null);var ed=this.getEditor();if(ed&&ed.undoManager&&ed.undoManager.typing){ed.undoManager.typing=0;ed.undoManager.add();}if(this._hasPendingChanges){var val=ed.getContent();if(!this.intermediateChanges){this._onChange(val);}else{this.value=val;this._emptyRawValue=false;}}},_onBlur:function(){this._stopEditing();this.inherited(arguments);},_cancelDirtyCheckInterval:function(){if(this._dirtyCheckTimeout){clearTimeout(this._dirtyCheckTimeout);this._dirtyCheckTimeout=null;}},_startDirtyCheckInterval:function(){if(this._destroyed||!this.intermediateChanges){return;}this._cancelDirtyCheckInterval();this._dirtyCheck();this._dirtyCheckTimeout=setTimeout(lang.hitch(this,this._startDirtyCheckInterval),this.dirtyCheckInterval);},_dirtyCheck:function(){var ed=this.getEditor();if(ed){if(this._hasPendingChanges){this._onChange(ed.getContent());}}},onRedo:function(ed,level){this._hasPendingChanges=true;},onUndo:function(ed,level){this._hasPendingChanges=true;}});});},"epi-cms/widget/_DndStateMixin":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/aspect","dojo/dom-class"],function(dojo,array,_14ae,lang,_14af,_14b0,_14b1){return _14ae([],{baseDndStateClass:"epi-dropTarget",dndStateClass:null,dropTarget:null,_aspectAfterHandler:null,postCreate:function(){this.subscribe("/dnd/start","_onDndStart");this.subscribe("/dnd/cancel","_onDndCancel");this.subscribe("/dnd/drop","_onDndDrop");if(this.dropTarget){this._aspectAfterHandler=_14b0.after(this.dropTarget,"onDndStart",lang.hitch(this,"_onAfterDndStart"));}},_getDndStateClassAttr:function(){var _14b2=this.canAccept()?"Enabled":"Disabled";this.dndStateClass=this.baseDndStateClass+_14b2;return this.dndStateClass;},canAccept:function(){return false;},_onDndStart:function(){if(!this.dropTarget){_14b1.add(this.domNode,this.get("DndStateClass"));}},_onAfterDndStart:function(){_14b1.add(this.domNode,this.get("DndStateClass"));},_onDndCancel:function(){_14b1.remove(this.domNode,this.dndStateClass);},_onDndDrop:function(){_14b1.remove(this.domNode,this.dndStateClass);},destroy:function(){this.inherited(arguments);if(this._aspectAfterHandler){this._aspectAfterHandler.remove();this._aspectAfterHandler=null;}}});});},"epi-cms/widget/_UserResizable":function(){define(["epi","dojo"],function(epi,dojo){return dojo.declare(null,{onResizeStart:function(){},onResizeStop:function(){}});});},"url:epi-cms/contentediting/editors/templates/TinyMCEEditor.html":"<div id=\"widget_${id}\">\r\n    <div style=\"display: inline-block\" data-dojo-attach-point=\"stateNode, tooltipNode\">\r\n        <textarea data-dojo-attach-point=\"editorFrame\" id=\"${id}_editorFrame\" style=\"border: none;\"></textarea>\r\n    </div>\r\n    <div data-dojo-attach-point=\"dndOverlay\" style=\"background: rgba(0, 0, 0, 0.01); position: absolute; left: 0; top: 0; right: 0; bottom: 0; display: none\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/TinyMCEInlineEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/on","dojo/sniff","epi/string","epi-cms/contentediting/_HasFloatingComponent","epi-cms/contentediting/editors/TinyMCEEditor","dojo/text!./templates/TinyMCEInlineEditor.html"],function(array,_14b3,lang,dom,_14b4,_14b5,_14b6,_14b7,on,sniff,_14b8,_14b9,_14ba,_14bb){return _14b3([_14b9,_14ba],{baseClass:"epiTinyMCEInlineEditor",autoResizable:true,templateString:_14bb,inlineSettings:null,supportCustomDnd:true,_lastRng:null,_maxCheckRenderedTime:10,_editorIframe:null,onEditorBlur:function(evt){this._stopEditing();},onEditorResizing:function(_14bc){},onEditorResized:function(_14bd){},isEditing:function(){return this.domNode&&_14b6.get(this.domNode,"display").toLowerCase()!=="none";},startup:function(){this._checkingTime=0;if(this._started){return;}this.inherited(arguments);if(!this.ready){return;}this.own(this.watch("state",lang.hitch(this,function(name,_14be,_14bf){on.emit(this.domNode,"editorstatechanged",_14bf);})));},destroy:function(){this._clearLocalDefers();this._externalToolbar=this._toolbarSizeBox=this._toolbarRelativeContainer=this._toolbarRefContainer=null;this._latestButtonIds=this._editorIframe=this._toolbarFinishRender=null;this._lastRng=null;this.inherited(arguments);},focus:function(){this.inherited(arguments);var _14c0=this.getEditor();if(!_14c0){return;}_14c0.selection.setRng(this._lastRng||_14c0.selection.getRng());this.resizeEditor();},resizeEditor:function(){if(_14b6.get(this.containerNode,"display")=="none"){this.onEditorResized();return;}var _14c1=this.getEditor(),style={"height":"auto"},_14c2=this._getEditorIframe();_14b6.set(_14c2,style);style.height=_14c1.getBody().parentNode.scrollHeight+"px";this.onEditorResizing({"style":style});_14b6.set(_14c2,style);this.onEditorResized(lang.hitch(this,this._floatToolbar));this.isResized=true;},_onBlur:function(){},_updateTinySettings:function(){this.inherited(arguments);this.settings.width=this.settings.height="100%";this.settings=lang.mixin(this.settings,this.inlineSettings);},_setupEditorEventHandling:function(_14c3,_14c4){this.inherited(arguments);this._disableSetTopStyle();this._appendEditorResizeHandler(_14c4);this._appendEditorFloatToolbarHandler(_14c4);sniff("ie")&&_14c4.onNodeChange.add(lang.hitch(this,function(_14c5){this._lastRng=_14c5.selection.getRng();}));},_clearLocalDefers:function(){this._deferToolbarFullSize&&this._deferToolbarFullSize.remove();this._deferOnKeyUp&&this._deferOnKeyUp.remove();},_appendEditorResizeHandler:function(_14c6){var _14c7=lang.hitch(this,this.resizeEditor);_14c6.onChange.add(_14c7);_14c6.onSetContent.add(_14c7);_14c6.onPaste.add(_14c7);_14c6.onPostRender.add(_14c7);_14c6.onKeyUp.add(lang.hitch(this,function(){this._clearLocalDefers();this._deferOnKeyUp=this.defer(_14c7,10);}));_14c6.onInit.add(lang.hitch(this,function(ed){if(this._isFullScreen(ed)){_14b4.remove(ed.getBody(),this.settings.body_class);}}));},_appendEditorFloatToolbarHandler:function(_14c8){_14c8.onInit.add(lang.hitch(this,this._showEditorToolbar));_14c8.onActivate.add(lang.hitch(this,this._floatToolbar));_14c8.onMouseUp.add(lang.hitch(this,this._floatToolbar));},_showEditorToolbar:function(_14c9){if(!_14c9){return;}this.focus();_14c9.dom.show(this._getExternalToolbar());this._floatToolbar();},_disableSetTopStyle:function(){this.own(_14b7.before(this.getEditorDOM(),"setStyle",lang.hitch(this,function(n,na,v){if(n==this._getExternalToolbar()&&na==="top"){return [];}return;})));},_floatToolbar:function(){this._clearLocalDefers();if(!this._getExternalToolbar()){return;}if(!this._isToolbarRendered()){this._deferToolbarFullSize=this.defer(this._floatToolbar,100);return;}this.onComponentFloat(this._getComponentFloatInfo());},_getComponentFloatInfo:function(){return {"componentInfo":{"component":this._getExternalToolbar(),"componentSizeBox":lang.hitch(this,function(){return this._toolbarSizeBox||(this._toolbarSizeBox=dom.byId(this.editorFrame.id+"_tblext"));})(),"relativeContainer":lang.hitch(this,function(){return this._toolbarRelativeContainer||(this._toolbarRelativeContainer=this._getExternalToolbar().parentNode);})(),"refContainer":lang.hitch(this,function(){return this._toolbarRefContainer||(this._toolbarRefContainer=dom.byId(this.editorFrame.id+"_parent"));})()},"floatingInfo":{"refreshPosition":false}};},_isToolbarRendered:function(){if(this._checkingTime>this._maxCheckRenderedTime){return true;}this._checkingTime++;var _14ca=null,_14cb=0;return this._toolbarFinishRender||(this._toolbarFinishRender=this._getToolbarLatestButtonIds().every(function(_14cc){_14ca=dom.byId(this.editorFrame.id+"_"+_14cc);_14cb=_14ca&&_14b5.position(_14ca).w;return _14cb!==0;},this));},_getToolbarLatestButtonIds:function(){if(this._latestButtonIds){return this._latestButtonIds;}this._latestButtonIds=[];var _14cd=null;for(var _14ce in this.settings){if(_14ce.toLowerCase().indexOf("theme_advanced_button")!=-1){_14cd=this.settings[_14ce].split(",").pop();if(!_14b8.isNullOrEmpty(_14cd)){this._latestButtonIds.push(_14cd);}}}return this._latestButtonIds;},_getExternalToolbar:function(){return this._externalToolbar||(this._externalToolbar=dom.byId(this.editorFrame.id+"_external"));},_getEditorIframe:function(){return this._editorIframe||(this._editorIframe=dom.byId(this.editorFrame.id+"_ifr"));}});});},"epi-cms/contentediting/_HasFloatingComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/dom-style"],function(_14cf,lang,_14d0,_14d1){return _14cf(null,{componentGutter:7,_floatingComponentSize:null,_floatingComponent:null,_floatingComponentSizeBox:null,_floatingRelativeContainer:null,_floatingRefContainer:null,onComponentFloat:function(_14d2){this._floatingComponent=_14d2.componentInfo.component;this._floatingComponentSizeBox=_14d2.componentInfo.componentSizeBox;this._floatingRelativeContainer=_14d2.componentInfo.relativeContainer;this._floatingRefContainer=_14d2.componentInfo.refContainer;},getComponentInfo:function(){return {"component":this._floatingComponent,"componentSize":this._getFloatingComponentSize(),"relativeContainer":this._floatingRelativeContainer,"refContainer":this._floatingRefContainer};},destroy:function(){this._floatingComponentSizeBox=this._floatingComponent=this._floatingRelativeContainer=this._floatingRefContainer=null;this._floatingComponentSize=null;this.inherited(arguments);},_getFloatingComponentSize:function(){if(this._floatingComponentSize){return this._floatingComponentSize;}var _14d3=_14d0.getMarginBox(this._floatingComponentSizeBox);return this._floatingComponentSize={"height":parseInt(_14d3.h,10)+this.componentGutter,"width":parseInt(_14d3.w,10)};}});});},"url:epi-cms/contentediting/editors/templates/TinyMCEInlineEditor.html":"<div id=\"widget_${id}\" style=\"position: relative; overflow: visible;\">\r\n    <div data-dojo-attach-point=\"stateNode, tooltipNode\">\r\n        <textarea data-dojo-attach-point=\"editorFrame\" id=\"${id}_editorFrame\" style=\"border: none; visibility: hidden; position: absolute; top:0; left:0; bottom:0; right:0;\"></textarea>\r\n    </div>\r\n    <div data-dojo-attach-point=\"dndOverlay\" style=\"background: rgba(0, 0, 0, 0.01); position: absolute; left: 0; top: 0; right: 0; bottom: 0; display: none\"></div>\r\n</div>\r\n","epi-cms/contentediting/EditToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/DeferredList","dojo/dom-class","dojo/topic","dojo/when","dojox/html/ellipsis","epi","epi/dependency","epi/shell/widget/ToolbarSet","epi/shell/command/withConfirmation","epi-cms/contentediting/command/Editing","epi-cms/contentediting/viewmodel/EditActionPanelViewModel","epi-cms/contentediting/StandardToolbar","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi-cms/widget/NotificationStatusBar","epi-cms/contentediting/EditActionPanel"],function(_14d4,lang,array,_14d5,_14d6,topic,when,_14d7,epi,_14d8,_14d9,_14da,_14db,_14dc,_14dd,res,_14de){return _14d4([_14dd],{res:res,_editActionViewModel:null,_commands:null,_revertToPublished:null,postMixInProperties:function(){this.inherited(arguments);this._commands=_14db;this._revertToPublished=_14da(this._commands.revertToPublished,null,{title:_14de.reverttopublishconfirmation.dialogtitle,heading:_14de.reverttopublishconfirmation.confirmquestion,description:_14de.reverttopublishconfirmation.description});this._commands.revertToPublished.watch("canExecute",lang.hitch(this,function(){this.setItemProperty(this._commands.revertToPublished.name,"disabled",!this._commands.revertToPublished.canExecute);}));this._editActionViewModel=new _14dc();this.own(this._editActionViewModel);},resize:function(_14df){this.inherited(arguments);if(_14df){_14d6.toggle(this.domNode,"epi-editToolbarNarrow",_14df.w<620);_14d6.toggle(this.domNode,"epi-editToolbarMedium",_14df.w>=620&&_14df.w<1000);this._editActionViewModel.set("expanded",_14df.w>=1000);this.setItemProperty("autosave","isInNarrowToolbar",_14df.w<1000);}},setupChildren:function(){var _14e0=[{parent:"center",name:"autosave",label:this.res.autosave.savinglabel,type:"dropdown",settings:{"class":"epi-autosave-hidden"}},{parent:"autosave",name:"undo",title:this.res.undo.title,label:epi.resources.action.undo,type:"menuitem",iconClass:"epi-iconUndo",settings:{disabled:true,showLabel:false},action:function(){topic.publish("/epi/cms/action/undo",[]);}},{parent:"autosave",name:"redo",title:this.res.redo.title,label:epi.resources.action.redo,type:"menuitem",iconClass:"epi-iconRedo",settings:{disabled:true,showLabel:false},action:function(){topic.publish("/epi/cms/action/redo",[]);}},{parent:"autosave",name:"reverttopublished",title:this._commands.revertToPublished.tooltip,label:this._commands.revertToPublished.label,type:"menuitem",iconClass:"epi-iconRevert",settings:{separate:true},action:lang.hitch(this,function(){this._revertToPublished.execute();})},{parent:"trailing",name:"notifications",widgetType:"epi-cms/widget/NotificationStatusBar"},{name:"editactionpanel",label:epi.resources.action.publish,parent:"trailing",widgetType:"epi-cms/contentediting/EditActionPanel",settings:{model:this._editActionViewModel}},{parent:"trailing",name:"editmodeswitch",title:this.res.formedit.title,label:this.res.formedit.label,widgetType:"dijit/form/ToggleButton",iconClass:"epi-iconForms",settings:{showLabel:false,"class":"epi-mediumButton epi-modeButton"},action:function(){if(this.get("state")==="Loading"){return;}this.set("state","Loading");setTimeout(function(){topic.publish("/epi/cms/action/switcheditmode");},0);}}];return when(this.inherited(arguments),lang.hitch(this,function(){return this.add(_14e0);}));},_setContentViewModelAttr:function(value){this._set("contentViewModel",value);when(this.isSetup(),lang.hitch(this,function(){this._updateToolbarItemsModel(value);}));},_updateToolbarItemsModel:function(_14e1){this.setItemProperty("autosave","label","");this.setItemProperty("autosave","class","epi-autoSaveButton epi-disabledDropdownArrow");var _14e2=_14e1.contentData;this.setItemProperty("notifications","notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_14e2.contentLink});var _14e3="",_14e4="";if(_14e1.viewName==="formedit"){this.setItemProperty("editmodeswitch","checked",true);_14e3=this.res.onpageedit.title;_14e4=this.res.onpageedit.label;}else{this.setItemProperty("editmodeswitch","checked",false);_14e3=this.res.formedit.title;_14e4=this.res.formedit.label;}this.setItemProperty("editmodeswitch","title",_14e3);this.setItemProperty("editmodeswitch","label",_14e4);var _14e5=this._hasCustomViews(this.viewConfigurations.availableViews);var _14e6=this._hasBuiltInViews(this.viewConfigurations.availableViews);this.setItemVisibility("editmodeswitch",!_14e5&&_14e6&&_14e2.hasTemplate);this.setItemVisibility("viewselect",_14e5);this._editActionViewModel.set("dataModel",_14e1);},_hasCustomViews:function(_14e7){return array.filter(_14e7,function(view){return !view.hideFromViewMenu&&view.key!=="onpageedit"&&view.key!=="formedit";}).length;},_hasBuiltInViews:function(_14e8){return array.filter(_14e8,function(view){return view.key=="onpageedit"||view.key=="formedit";}).length==2;}});});},"epi-cms/contentediting/viewmodel/EditActionPanelViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/string","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi-cms/contentediting/viewmodel/PublishMenuViewModel","epi/datetime","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel"],function(array,_14e9,lang,_14ea,_14eb,_14ec,_14ed,_14ee,_14ef,_14f0,res){return _14e9([_14ed],{state:null,buttonText:null,statusText:null,statusIcon:null,additionalClass:null,nonEditableIndicator:null,visible:null,publishMenuViewModel:null,inUseNotificationManager:null,skipChildModels:false,_virtualStatusEnum:{NotCreated:0,NotPublishedYet:1,NoChangeToPublish:2,ChangesToPublish:3,ReadyToPublish:4,ScheduledPublish:5,Published:6,PreviouslyPublished:7,Expired:8,InUse:9,Deleted:10},_virtualStatusCssState:[],_virtualStatusLocalization:[],_statusIcon:[],_watchers:null,_statusMap:{},postscript:function(){this.res=this.res||res;this.inherited(arguments);this.inUseNotificationManager=this.inUseNotificationManager||_14f0.resolve("epi.cms.contentediting.inUseNotificationManager");if(this._virtualStatusCssState.length===0){for(var _14f1 in this._virtualStatusEnum){this._virtualStatusCssState.push(_14f1);this._virtualStatusLocalization.push(this.res["status"][_14f1.toLowerCase()]);}this._statusMap[_14ec.versionStatus.CheckedOut]=this._virtualStatusEnum.NotPublishedYet;this._statusMap[_14ec.versionStatus.CheckedIn]=this._virtualStatusEnum.ReadyToPublish;this._statusMap[_14ec.versionStatus.Rejected]=this._virtualStatusEnum.ChangesToPublish;this._statusMap[_14ec.versionStatus.DelayedPublish]=this._virtualStatusEnum.ScheduledPublish;this._statusMap[_14ec.versionStatus.Published]=this._virtualStatusEnum.Published;this._statusMap[_14ec.versionStatus.PreviouslyPublished]=this._virtualStatusEnum.PreviouslyPublished;this._statusMap[_14ec.versionStatus.Expired]=this._virtualStatusEnum.Expired;this._statusIcon[_14ec.versionStatus.DelayedPublish]="epi-iconClock";this._statusIcon[_14ec.versionStatus.Rejected]="epi-iconStop";}if(!this.skipChildModels){this.publishMenuViewModel=new _14ee({inUseNotificationManager:this.inUseNotificationManager});}},destroy:function(){if(this.publishMenuViewModel){this.publishMenuViewModel.destroy();}this.inherited(arguments);},_setDataModelAttr:function(value){this.inherited(arguments);if(this.publishMenuViewModel){this.publishMenuViewModel.set("dataModel",value);}},onDataModelChange:function(name,_14f2,value){var _14f3=this.dataModel.contentData,_14f4=this._getVirtualStatus(_14f3);this.set("state",this._virtualStatusCssState[_14f4]);this.set("additionalClass",_14f4===this._virtualStatusEnum.ChangesToPublish?"animated8 shake":"");this._setStatusText(_14f4,_14f3);this.set("buttonText",this._getButtonText(_14f4,_14f3));this.set("statusIcon",this._statusIcon[_14f3.versionStatus]||"");var _14f5=this.dataModel.canChangeContent(_14ec.action.Edit);this.set("nonEditableIndicator",!_14f5);this.set("visible",!_14f3.isWastebasket);},_setStatusText:function(_14f6,_14f7){if(_14f7.status===_14ec.versionStatus.DelayedPublish){this.set("statusText",_14eb.substitute(this._virtualStatusLocalization[_14f6],[_14ef.toUserFriendlyHtml(_14f7.properties.iversionable_startpublish)]));}else{if(_14f6===this._virtualStatusEnum.InUse){var _14f8=this.inUseNotificationManager.getOtherUsersInUseNotifications(_14f7.inUseNotifications);this.set("statusText",_14eb.substitute(this._virtualStatusLocalization[_14f6],[_14f8.join(",")]));}else{this.set("statusText",this._virtualStatusLocalization[_14f6]);}}},_getButtonText:function(_14f9,_14fa){if((_14f9==this._virtualStatusEnum.NotPublishedYet||_14f9==this._virtualStatusEnum.ChangesToPublish||_14f9==this._virtualStatusEnum.ReadyToPublish)&&this.dataModel.canChangeContent(_14ec.action.Publish)){return this.res.buttonlabel.publish;}else{return this.res.buttonlabel.option;}},_getVirtualStatus:function(_14fb){if(_14fb.isDeleted){return this._virtualStatusEnum.Deleted;}var _14fc,_14fd,_14fe;_14fc=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_14fd=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_14fc;_14fe=this.inUseNotificationManager.hasInUseNotificationWarning(_14fb.inUseNotifications);if(_14fe&&_14fd){return this._virtualStatusEnum.InUse;}if(_14fb.isCommonDraft){if(_14fb.status===_14ec.versionStatus.Published){return this._virtualStatusEnum.NoChangeToPublish;}if(_14fb.status===_14ec.versionStatus.CheckedOut){return _14fb.isMasterVersion?this._virtualStatusEnum.NotPublishedYet:this._virtualStatusEnum.ChangesToPublish;}}return this._statusMap[_14fb.status];}});});},"epi-cms/contentediting/viewmodel/_ContentViewModelObserver":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin"],function(_14ff,array,lang,_1500,_1501){return _14ff([_1500,_1501],{dataModel:null,_watchers:null,destroy:function(){this._unbindDataModel();},_bindDataModel:function(){this._watchers.push(this.dataModel.watch("status",lang.hitch(this,this.onDataModelChange)));this._watchers.push(this.dataModel.watch("contentData",lang.hitch(this,this.onDataModelChange)));},_unbindDataModel:function(){array.forEach(this._watchers,function(w){w.unwatch();});this._watchers=[];},_setDataModelAttr:function(value){this._unbindDataModel();this._set("dataModel",value);this.onDataModelChange();this._bindDataModel();},onDataModelChange:function(name,_1502,value){}});});},"epi-cms/contentediting/viewmodel/PublishMenuViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi","epi/datetime","epi/dependency","epi/username","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_1503,lang,epi,_1504,_1505,_1506,_1507,_1508,_1509,_150a,res){return _1503([_1508,_1509,_150a],{commandKey:"epi.cms.publishmenu",contentActionSupport:null,inUseNotificationManager:null,_currentUser:null,commands:null,mainButtonCommand:null,lastExecutedCommand:null,mainButtonSectionVisible:null,lastChangeStatus:null,topInfoSectionVisible:null,publishInfoSectionVisible:null,lastPublishedText:null,lastPublishedViewLinkVisible:null,lastPublishedViewLinkHref:null,additionalInfoSectionVisible:null,additionalInfoText:null,isOpen:null,typeIdentifier:null,postscript:function(){this.inherited(arguments);this.res=this.res||res;this.contentActionSupport=this.contentActionSupport||_1507;this.initializeCommandProviders();},_setDataModelAttr:function(value){this.updateCommandModel(value);this.inherited(arguments);},_setIsOpenAttr:function(value){if(value){this.set("lastChangeStatus",this._getLastChangeStatus(this.dataModel.contentData));}},onDataModelChange:function(name,_150b,value){var _150c=this.dataModel.contentData,_150d=(_150c.publishedBy!==null&&_150c.publishedBy!==undefined);this._updateCommands();this.set("lastChangeStatus",this._getLastChangeStatus(_150c));this.set("topInfoSectionVisible",this._getTopInfoSectionVisible(_150c));this.set("publishInfoSectionVisible",this._getPublishInfoSectionVisible(_150c));this.set("lastPublishedTitle",this._getLastPublishedTitle(_150c));this.set("lastPublishedTitleVisible",_150d);this.set("lastPublishedText",this._getLastPublishedText(_150c));this.set("lastPublishedViewLinkVisible",this._getLastPublishedViewLinkVisible(_150c,_150d));this.set("lastPublishedViewLinkHref",_150c.publicUrl);this.set("typeIdentifier",_150c.typeIdentifier);this._setAdditionalInfo(_150c);},_updateCommands:function(){var _150e=this.getCommands(),_150f=null;dojo.forEach(_150e,dojo.hitch(this,function(_1510){if(_1510.canExecute&&_1510.options&&_1510.options.isMain&&_1510.options.priority&&(!_150f||_150f.options.priority<_1510.options.priority)){_150f=_1510;}}));this.set("mainButtonCommand",_150f);this.set("commands",_150e);this.set("mainButtonSectionVisible",_150f!==null);},_getTopInfoSectionVisible:function(_1511){return this.mainButtonCommand||!((_1511.status===_1507.versionStatus.Published||_1511.status===_1507.versionStatus.Expired)&&!_1511.isCommonDraft);},_getPublishInfoSectionVisible:function(_1512){var _1513=this.inUseNotificationManager.hasInUseNotificationWarning(_1512.inUseNotifications),_1514=this._isOriginallyEditable();return !(_1513&&_1514);},_getLastPublishedViewLinkVisible:function(_1515,_1516){return _1516&&!!_1515.publicUrl;},_getLastChangeStatus:function(_1517){if(this.lastExecutedCommand&&this.lastExecutedCommand.options&&this.lastExecutedCommand.options.successStatus){var _1518=this.lastExecutedCommand.options.successStatus;this.lastExecutedCommand=this.mainButtonCommand;return _1518;}if(_1517.missingLanguageBranch&&_1517.missingLanguageBranch.isTranslationNeeded){return lang.replace(this.res.nottranslated,{languageName:epi.resources.language[_1517.missingLanguageBranch.languageId],languageId:_1517.missingLanguageBranch.languageId});}if(_1517.status==_1507.versionStatus.Published||_1517.status==_1507.versionStatus.Expired){return this.res.notmodifiedsincelastpublish;}if(_1517.status==_1507.versionStatus.PreviouslyPublished){return this._getTemplatedText(this.res.previouslypublished,_1517.versionCreatedBy,_1517.versionCreatedTime);}if(_1517.status==_1507.versionStatus.CheckedIn){return this._getTemplatedText(this.res.pendingapproval,_1517.versionCreatedBy,_1517.versionCreatedTime);}return this._getTemplatedText(this.res.lastchangestatus,_1517.changedBy,_1517.saved);},_getLastPublishedTitle:function(_1519){return _1519.status===_1507.versionStatus.PreviouslyPublished?this.res.currentlypublished:this.res.lastpublishedby;},_getLastPublishedText:function(_151a){return (_151a.publishedBy===null||_151a.publishedBy===undefined)?this.res.notpublishedbefore:this._getTemplatedText(this.res.publishedtime,_151a.publishedBy,_151a.lastPublished,true);},_setAdditionalInfo:function(_151b){var _151c=this.inUseNotificationManager.hasInUseNotificationWarning(_151b.inUseNotifications),_151d=this._isOriginallyEditable(),_151e=_151c&&_151d;this.set("additionalInfoSectionVisible",_151e);if(_151e){var _151f=this.inUseNotificationManager.getOtherUsersInUseNotifications(_151b.inUseNotifications);this.set("additionalInfoText",this._getTemplatedText(this.res.inusewarning,_151f.join(",")));}},_isOriginallyEditable:function(){var _1520=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;var _1521=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_1520;return _1521;},_getFriendlyUsername:function(name,_1522){return _1506.toUserFriendlyHtml(name,null,_1522);},_getTemplatedText:function(_1523,_1524,_1525,_1526){var date=_1504.deserialize(_1525);return dojo.replace(_1523,{username:this._getFriendlyUsername(_1524,_1526),time:_1504.toUserFriendlyHtml(date),timepassed:_1504.timePassed(date)});}});});},"epi-cms/contentediting/StandardToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dijit/form/DropDownButton","epi/shell/layout/ToolbarContainer","epi/shell/widget/ToolbarLabel","epi/shell/widget/ToolbarSet","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","epi-cms/widget/ViewSelectorDropDownButton"],function(_1527,lang,all,when,_1528,_1529,_152a,_152b,_152c,_152d,_152e){return _1527([_152b],{currentContext:null,availableViews:null,viewName:null,_setupPromise:null,buildRendering:function(){this.inherited(arguments);when(this._setupPromise=this.setupChildren(),lang.hitch(this,function(){this.updateChildren();}));},isSetup:function(){return this._setupPromise;},setupChildren:function(){var _152f=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"center",type:"toolbargroup",settings:{region:"center"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _1530=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{displayAsText:false,showCurrentNode:false}},{parent:"trailing",name:"viewselect",widgetType:"epi-cms/widget/ViewSelectorDropDownButton",settings:{showLabel:false,"class":"epi-mediumButton epi-trailingContainer"}},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"}];return when(this.add(_152f),lang.hitch(this,function(){return this.add(_1530);}));},updateChildren:function(){var _1531=this.currentContext,_1532=_1531&&_1531.id;this.setItemProperty("breadcrumbs","contentLink",_1532);this.setItemProperty("viewselect","viewConfigurations",this.viewConfigurations);if(_1531){this.setItemProperty("currentcontent","currentItemInfo",{name:_1531.name,dataType:_1531.dataType});}},update:function(data){if(!data){return;}this.currentContext=data.currentContext;this.viewConfigurations=data.viewConfigurations;when(this.isSetup(),lang.hitch(this,function(){this.updateChildren();}));}});});},"epi-cms/widget/ViewSelectorDropDownButton":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/form/DropDownButton","epi-cms/widget/ViewSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector"],function(array,_1533,lang,_1534,_1535,_1536){return _1533([_1534],{buildRendering:function(){this.inherited(arguments);this.set("title",_1536.title);this.own(this.dropDown=new _1535());},_setViewConfigurationsAttr:function(value){if(!value){return;}array.some(value.availableViews,lang.hitch(this,function(view){if(view.key===value.viewName){this.set("iconClass",view.iconClass);return true;}}));this.dropDown.set("viewConfigurations",value);}});});},"epi-cms/widget/ViewSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","dijit/MenuSeparator","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector","epi-cms/widget/SelectorMenuBase","epi/shell/widget/CheckedMenuItem"],function(array,_1537,lang,topic,when,_1538,_1539,_153a,_153b){return _1537([_153a],{viewConfigurations:null,headingText:_1539.title,_setViewConfigurationsAttr:function(value){this._set("viewConfigurations",value);this._setup();},onExecute:function(){},onCancel:function(){},_setup:function(){if(!this.viewConfigurations){return;}array.forEach(this.getChildren(),lang.hitch(this,this.removeChild));var _153c=this.viewConfigurations.viewName,_153d=this.viewConfigurations.availableViews;var _153e="";array.forEach(_153d,function(view){if(view.hideFromViewMenu){return;}var _153f=view.category||"";if(_153f!=_153e){this.addChild(new _1538({baseClass:"epi-menuSeparator"}));}_153e=_153f;var item=new _153b({label:view.name,title:view.description,iconClass:view.iconClass,checked:view.key===_153c,onClick:lang.hitch(this,function(){this.onExecute();item.set("checked",!item.checked);if(_153c=="view"){topic.publish("/epi/cms/action/disablepreview");}topic.publish("/epi/shell/action/changeview",view.key,null,null);})});this.addChild(item);},this);}});});},"epi/shell/widget/CheckedMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\r\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>\r\n"}});define("epi/shell/widget/CheckedMenuItem",["dojo/_base/declare","dijit/CheckedMenuItem","dojo/text!./templates/CheckedMenuItem.html"],function(_1540,_1541,_1542){return _1540(_1541,{templateString:_1542});});},"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\r\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>\r\n","epi-cms/widget/NotificationStatusBar":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/keys","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/BorderContainer","dojox/html/entities","epi/dependency","epi-cms/widget/NotificationStatusZone","epi-cms/widget/TooltipDialog","dojo/text!./templates/NotificationStatusBar.html","epi/i18n!epi/cms/nls/episerver.cms.widget.statusbar.notificationstatus"],function(array,_1543,event,lang,_1544,keys,_1545,_1546,_1547,_1548,_1549,_154a,_154b,_154c,_154d,_154e){return _1543([_1545,_1546,_1547],{res:_154e,templateString:_154d,_itemTemplate:"<li>{message}</li>",_notificationTooltipDialogCssClass:"epi-notificationToolipDialog epi-notificationToolipDialogCompact",_dimmedOutCssClass:"epi-notificationIcon-DimmedOut",_notificationErrorClass:"epi-notificationIcon-Error",_notificationWarningClass:"epi-notificationIcon-Warning",_notificationNoteClass:"epi-notificationIcon-Note",_totalNotifications:0,messageContext:null,_tooltipDialog:null,messageService:null,_observeHandle:null,zoneContainer:null,notificationContext:null,baseClass:"epi-notificationIcon",postMixInProperties:function(){this.inherited(arguments);this.messageService=this.messageService||_154a.resolve("epi.shell.MessageService");},postCreate:function(){this.inherited(arguments);this._tooltipDialog=new _154c({connectorMargin:47,hideOnBlur:true,content:this.zoneLayoutNode});this._buildIconBlock();_1544.add(this._tooltipDialog.domNode,this._notificationTooltipDialogCssClass);this.connect(this.domNode,"onclick",lang.hitch(this,this._show));this.connect(this.domNode,"onkeypress",lang.hitch(this,this._onKeyPress));this.connect(this.closeIcon,"onclick",lang.hitch(this,this._hideTooltip));},update:function(_154f){this._hideTooltip();this.messageContext=_154f;this._listenMessagePool();this._updateUI();},destroy:function(){this._unListenMessagePool();this.inherited(arguments);},focus:function(){this.domNode.focus();},show:function(){this._keepShowing=true;this._showTooltip();},getMessages:function(_1550){var query=(_1550)?lang.mixin({typeName:_1550},this.messageContext):this.messageContext;return this.messageService.query(query);},_onKeyPress:function(evt){if(evt.keyCode===keys.ENTER){this._show();}},_listenMessagePool:function(){this._unListenMessagePool();this._observeHandle=this.messageService.observe(this.messageContext,lang.hitch(this,function(){this._updateUI();}));},_unListenMessagePool:function(){if(this._observeHandle){this._observeHandle.cancel();delete this._observeHandle;}},_updateNotificationZone:function(zone,_1551,items){if(items&&items.length>0){array.forEach(items,function(item){zone.addRow(lang.replace(_1551,{message:_1549.encode(item.message)}),"last");});zone.show();}else{zone.hide();}},_updateUI:function(){this.errorZone.empty();this.warningZone.empty();this.infoZone.empty();var _1552=this.getMessages("error");var _1553=this.getMessages("warn");var _1554=this.getMessages("info");this._totalNotifications=_1552.length+_1553.length+_1554.length;this._buildIconBlock();this._updateNotificationZone(this.errorZone,this._itemTemplate,_1552);this._updateNotificationZone(this.warningZone,this._itemTemplate,_1553);this._updateNotificationZone(this.infoZone,this._itemTemplate,_1554);this._updateIconStatus(_1552.length,_1553.length,_1554.length);},_buildIconBlock:function(){this.domNode.innerHTML=this._totalNotifications;if(this._totalNotifications===0){_1544.add(this.domNode,this._dimmedOutCssClass);_1544.remove(this.domNode,this._notificationNoteClass);_1544.remove(this.domNode,this._notificationWarningClass);_1544.remove(this.domNode,this._notificationErrorClass);this._hideTooltip();}else{_1544.remove(this.domNode,this._dimmedOutCssClass);}},_updateIconStatus:function(_1555,_1556,_1557){if(_1555){_1544.add(this.domNode,this._notificationErrorClass);_1544.remove(this.domNode,this._notificationNoteClass);_1544.remove(this.domNode,this._notificationWarningClass);}else{if(_1556){_1544.add(this.domNode,this._notificationWarningClass);_1544.remove(this.domNode,this._notificationNoteClass);}else{if(_1557){_1544.add(this.domNode,this._notificationNoteClass);}}}},_setNotificationContextAttr:function(value){this._set("notificationContext",value);this.update(value);},_show:function(e){if(e){event.stop(e);}this._showTooltip();},_showTooltip:function(){if(this._totalNotifications===0){return;}this._tooltipDialog.showTooltipDialog(this.domNode,["below-alt"]);},_hideTooltip:function(){this._tooltipDialog.hideTooltipDialog();}});});},"epi-cms/widget/NotificationStatusZone":function(){define(["dojo","dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin"],function(dojo,_1558,_1559,_155a){return _1558([_1559,_155a],{templateString:"            <div>                <div class=\"epi-dijitTooltipNotificationBlock epi-dijitTooltipBlock${TypeName}\" data-dojo-attach-point=\"Zone\">                    <span class=\"epi-notificationTypeTitle\"><span class=\"dijitIcon dijitInline epi-dijitTooltip${TypeName}Icon\"></span>${title}</span>                    <ul data-dojo-attach-point=\"contentContainer\"></ul>                </div>            </div>",title:"",type:"",TypeName:"",_hiddenCssClass:"epi-dijitTooltipBlockHidden",postMixInProperties:function(){this.TypeName=this.type.charAt(0).toUpperCase()+this.type.slice(1);},empty:function(){dojo.empty(this.contentContainer);},addRow:function(_155b,_155c){dojo.place(_155b,this.contentContainer,_155c);},show:function(){dojo.removeClass(this.Zone,this._hiddenCssClass);},hide:function(){dojo.addClass(this.Zone,this._hiddenCssClass);}});});},"epi-cms/widget/TooltipDialog":function(){define(["dojo","dojo/number","dijit","dijit/TooltipDialog","dijit/_Widget","dijit/_TemplatedMixin","dojo/text!./templates/TooltipDialog.html"],function(dojo,_155d,dijit,_155e,_155f,_1560,_1561){return dojo.declare([_155e],{templateString:_1561,connectorMargin:25,_defaultConnectorMargin:25,hideOnBlur:false,_isFirstShow:false,_beforeCssClass:"epi-dijitTooltipBefore",_afterCssClass:"epi-dijitTooltipAfter",_pos:0,_defaultConnectorRight:0,_defaultConnectorLeft:0,_wrapperPosX:0,_availableSpace:0,_right:0,_left:0,onBlur:function(){this.inherited(arguments);if(this.hideOnBlur){this.hideTooltipDialog();}},postCreate:function(){this.inherited(arguments);if(!this.connectorMargin||!_155d.parse(this.connectorMargin)||this.connectorMargin===""||this.connectorMargin<this._defaultConnectorMargin){this.connectorMargin=this._defaultConnectorMargin;}},showTooltipDialog:function(_1562,_1563){dijit.popup.open({popup:this,around:_1562,orient:_1563});if(this.hideOnBlur){this.focus();}},hideTooltipDialog:function(){dijit.popup.close(this);},onOpen:function(pos){this._pos=pos;this.inherited(arguments);},_onShow:function(){this._setDefaultValues();this._updatePositions();this.inherited(arguments);},_setDefaultValues:function(){if(!this._isFirstShow){this._defaultConnectorRight=this._getConnectorSpace("right")||this._defaultConnectorMargin;this._defaultConnectorLeft=this._getConnectorSpace("left")||this._defaultConnectorMargin;this._isFirstShow=true;}this._wrapperPosX=_155d.parse(this._pos.x);this._availableSpace=dojo.body().clientWidth;if(this._pos.aroundCorner=="MR"||this._pos.aroundCorner=="ML"){var _1564=_155d.round((this._pos.h-this.connectorNode.clientHeight)/2);dojo.style(this.connectorNode,"top",this._getNumberInPx(_1564));}},_updatePositions:function(){switch(this._pos.aroundCorner){case "TR":case "BR":this._calculateConnectorMarginRight();this._calculateAvailableSpaceLeft();this._updateAlignedRightPositions();break;case "TL":case "BL":this._calculateConnectorMarginLeft();this._calculateAvailableSpaceRight();this._updateAlignedLeftPositions();break;case "MR":dojo.addClass(this.domNode,this._afterCssClass);break;case "ML":dojo.addClass(this.domNode,this._beforeCssClass);break;default:break;}},_updateAlignedRightPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"right",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._right)));}else{dojo.style(this.connectorNode,"right",this._getNumberInPx(this._defaultConnectorRight));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._right-this._defaultConnectorRight)));}},_updateAlignedLeftPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"left",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._left)));}else{dojo.style(this.connectorNode,"left",this._getNumberInPx(this._defaultConnectorLeft));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._left-this._defaultConnectorLeft)));}},_calculateAvailableSpaceRight:function(){this._wrapperPosX-=this._left+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateAvailableSpaceLeft:function(){this._wrapperPosX+=this._right+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateConnectorMarginRight:function(){this._right=this._getConnectorSpace("right");if(this._right<this.connectorMargin){this._right=this.connectorMargin;}},_calculateConnectorMarginLeft:function(){this._left=this._getConnectorSpace("left");if(this._left<this.connectorMargin){this._left=this.connectorMargin;}},_getConnectorSpace:function(_1565){if(!_1565){return 0;}if(_1565=="right"||_1565=="left"){var _1566=dojo.style(this.connectorNode,_1565);if(!_1566){return 0;}var _1567=/(px|em|%)/ig;return _155d.parse(_1566)||_155d.parse(_1566.replace(_1567,""));}return 0;},_getNumberInPx:function(_1568){return _1568+"px";},_getCenterHorizontalAroundNode:function(){return _155d.round((_155d.parse(this.connectorNode.clientWidth)-_155d.parse(this._pos.aroundNodePos.w))/2);}});});},"url:epi-cms/widget/templates/TooltipDialog.html":"<div class=\"epi-dijitTooltipDialog\" role=\"presentation\" tabindex=\"-1\">\r\n    <div class=\"dijitTooltipContainer epi-dijitTooltipContainer\" role=\"presentation\">\r\n        <div class=\"dijitTooltipContents dijitTooltipFocusNode epi-dijitTooltipContents\" data-dojo-attach-point=\"containerNode\" role=\"dialog\"></div>\r\n    </div>\r\n    <div class=\"dijitTooltipConnector epi-dijitTooltipConnector\" data-dojo-attach-point=\"connectorNode\" role=\"presentation\"></div>\r\n</div>","url:epi-cms/widget/templates/NotificationStatusBar.html":"<div>\r\n    <div class=\"epi-dijitTooltipTitleBar\">\r\n        <span class=\"epi-dijitTooltipTitle\">${res.title}</span>\r\n        <span class=\"epi-closeButton dijitDialogCloseIcon\" data-dojo-attach-point=\"closeIcon\" title=\"${res.title}\" role=\"button\"></span>\r\n    </div>\r\n    <div class=\"epi-dijitTooltipContent\" data-dojo-attach-point=\"zoneLayoutNode\">\r\n        <div data-dojo-attach-point=\"zoneContainer\">\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"errorZone\" data-dojo-props=\"title: '${res.errortitle}', type: 'error'\"></div>\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"warningZone\" data-dojo-props=\"title: '${res.warningtitle}', type: 'warning'\"></div>\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"infoZone\"  data-dojo-props=\"title: '${res.notetitle}', type: 'note'\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/FloatingEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dojo/Deferred","dojo/has","dojo/when","epi/dependency","epi/string","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_1569,lang,_156a,_156b,_156c,has,when,_156d,_156e,_156f,_1570){return _1569([_1570],{formContainerWidgetType:"epi/shell/widget/FormContainer",destroy:function(){this._removeEditingFeatures();this._destroyDialog();this.inherited(arguments);},startEdit:function(_1571){lang.mixin(this.editorParams,_1571);var self=this,def=new _156c();self._destroyDialog();when(self._setupDialog(),function(){self._dialog.show();self.own(_156b.after(self._dialog,"onAfterShow",function(){self._startEdit(_1571);self._onTryToStopWithInvalidValue();def.resolve();}));});return def;},_createDialog:function(_1572){return new _156f({title:this.propertyDisplayName,content:_1572,duration:350,snapToNode:this.blockDisplayNode,positioner:_156d.resolve("epi.shell.layout.PositioningUtility")});},_setupDialog:function(){var _1573={};var _1574=function(_1575,_1576){_1573[_1575]=_1576;};var _1577=lang.hitch(this,function(_1578){for(var _1579 in _1573){var _157a=_1573[_1579];_157a.set("parent",this);if(_157a.stopEditOnBlur===true){this.connect(_157a,"onBlur",this.onStopEdit);}}_1573=null;});var _157b=lang.mixin({intermediateChanges:true},this.editorParams);if(this.editorWidgetType===this.formContainerWidgetType){lang.mixin(_157b,{onFieldCreated:_1574,onFormCreated:_1577});}var def=new _156c();var _157c=_156e.slashName(this.editorWidgetType);require([_157c],lang.hitch(this,function(_157d){var _157e=new _157d(_157b);this.editorWidget=_157e;var _157f=this._createDialog(_157e);this._handlers=[this.connect(_157f,"onButtonClose",this._onButtonClose),this.connect(_157f,"onCancel",this._onDialogCancel),this.connect(_157f.doneButtonNode,"onClick",this._onButtonClose),this.connect(_157e,"onChange",this._onChange),this.connect(_157e,"onKeyPress","_onEditorKeyPress")];this._dialog=_157f;if(this._createdEditor&&this.editorWidget.startup){this.editorWidget.startup();}def.resolve();}));return def;},_onDialogCancel:function(){this.cancel();},_destroyDialog:function(){array.forEach(this._handlers,function(_1580){_1580.remove();});if(this._dialog){this._dialog.destroy();this._dialog=null;}if(this.editorWidget){this.editorWidget.destroy();this.editorWidget=null;}},_removeEditingFeatures:function(){if(this._dialog.open){this._dialog.hide();}},_onTryToStopWithInvalidValue:function(){dijit.focus(this._dialog.titleNode);if(this.editorWidget.focus){this.editorWidget.focus();}},_onButtonClose:function(){if(!this.editorWidget.isShowingChildDialog){this.tryToStopEditing(false);}}});});},"epi/shell/widget/dialog/LightWeight":function(){require({cache:{"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\r\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\r\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"-1\">\r\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\r\n        </span>\r\n    </div>\r\n    <div class=\"dijitDialogPaneContent\">\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\r\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\r\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("epi/shell/widget/dialog/LightWeight",["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/Dialog","dijit/DialogUnderlay","epi/shell/widget/dialog/_DialogMixin","dojo/text!./templates/LightWeight.html"],function(_1581,lang,_1582,_1583,focus,_1584,_1585,_1586,_1587){return _1581([_1584,_1586,_1583],{templateString:_1587,buttonCloseText:epi.resources.action.close,buttonDoneText:epi.resources.action.done,buttonLearnMoreText:epi.resources.action.learnmore,useGlassUnderlay:false,_glassUnderlay:null,"class":"epi-lfw-dialog",snapToNode:null,positioner:null,destroy:function(){if(this._glassUnderlay){this._glassUnderlay.destroyRecursive();delete this._glassUnderlay;}this.inherited(arguments);},show:function(){return this.inherited(arguments).then(lang.hitch(this,this._onAfterShow));},_size:function(){this.inherited(arguments);if(this.positioner){this._relativePosition=this.positioner.findPosition(this.domNode,{snapTo:this.snapToNode});}},resize:function(){this._size();this._position();},_onAfterShow:function(){if(this.content&&this.content.focus){this.content.focus();}if(this.useGlassUnderlay){this._createUnderlay();}else{if(this._moveable&&!this._attachedMoveEvents){this.connect(this._moveable,"onMoveStart",lang.hitch(this,this._createUnderlay));this.connect(this._moveable,"onMoveStop",lang.hitch(this,this._removeUnderlay));this._attachedMoveEvents=true;}if(this.content&&this.content.onResizeStart&&this.content.onResizeStop&&!this._attachedContentResizeEvents){this.connect(this.content,"onResizeStart",lang.hitch(this,this._createUnderlay));this.connect(this.content,"onResizeStop",lang.hitch(this,this._removeUnderlay));this._attachedContentResizeEvents=true;}}this.onAfterShow();},_createUnderlay:function(){if(this._glassUnderlay){this._glassUnderlay.show();}else{this._glassUnderlay=new _1585();this._glassUnderlay.show();var _1588=_1582.get(this.domNode,"zIndex");_1582.set(this._glassUnderlay.domNode,"zIndex",_1588-1);_1582.set(this._glassUnderlay.domNode,"filter","alpha(opacity=0)");_1582.set(this._glassUnderlay.domNode,"opacity","0");}},_removeUnderlay:function(){this._glassUnderlay.hide();},_onContainerNodeClick:function(e){if(e.target===this.containerNode){this._getFocusItems();this._firstFocusItem&&focus.focus(this._firstFocusItem);}},onButtonClose:function(){},onAfterShow:function(){},onAfterHide:function(){},hide:function(){return this.inherited(arguments).then(lang.hitch(this,this._onAfterHide));},_onAfterHide:function(){if(this.useGlassUnderlay){this._removeUnderlay();}this.onAfterHide();},layout:function(){if(this._glassUnderlay&&_1582.get(this._glassUnderlay.domNode,"display")!="none"){this._glassUnderlay.layout();}var _1589=dijit._underlay?_1582.get(dijit._underlay.domNode,"display"):null;this.inherited(arguments);if(dijit._underlay){_1582.set(dijit._underlay.domNode,"display",_1589);}}});});},"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\r\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\r\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"-1\">\r\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\r\n        </span>\r\n    </div>\r\n    <div class=\"dijitDialogPaneContent\">\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\r\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\r\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/OverlayBasedEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/IframeWithOverlay","epi-cms/contentediting/_EditorWrapperBase"],function(_158a,lang,on,_158b,_158c){return _158a([_158c],{postCreate:function(){this.inherited(arguments);this.own(on(this.get("iframeWithOverlay").iframe,"mousedown",lang.hitch(this,this._onViewportClick)));},destroy:function(){this._iframeWithOverlay=null;this.inherited(arguments);},_onViewportClick:function(evt){},_onEditorResize:function(_158d){},_onEditorResizeFinished:function(_158e){},_getOverlayItemAttr:function(){return this.overlayItem||this.editorParams.overlayItem;},_getIframeWithOverlayAttr:function(){if(this._iframeWithOverlay){return this._iframeWithOverlay;}var _158f=null,_1590=this.overlayItem;while(_1590){if(_1590 instanceof _158b){_158f=_1590;break;}_1590=_1590.getParent();}return this._iframeWithOverlay=_158f;}});});},"epi-cms/contentediting/FlyoutEditorWrapper":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/number","epi/shell/widget/IframeWithOverlay","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/FloatingEditorWrapper"],function(_1591,_1592,lang,_1593,_1594,_1595,_1596,_1597,_1598,_1599){return _1592([_1599],{_eventHandlers:null,_overlayContainer:null,isOverlayDisabled:true,isUndoDisabled:true,constructor:function(){this._eventHandlers=[];},_createDialog:function(_159a){var _159b=function(_159c){if(!this.open||!_159c){return;}this._containerNodeCS=this._containerNodeCS||_1595.getComputedStyle(this.containerNode);if(!this._dialogChromeSize){this._chromeHeight=_1594.getMarginBox(this.domNode).h-_1594.getMarginBox(this.containerNode).h;}_1594.setMarginBox(this.containerNode,{h:_159c.h-this._chromeHeight},this._containerNodeCS);_1595.set(this.domNode,{top:_159c.t+"px",left:_159c.l+"px"});};var _159d=new _1598({title:this.propertyDisplayName,content:_159a,duration:350,draggable:false,closeIconVisible:false,region:"trailing",resize:_159b,overlayItem:this.overlayItem,_position:function(){},_size:function(){}});_1593.add(_159d.domNode,"epi-floatingEditorWrapperDialog");_159d.placeAt(this.get("iframeWithOverlay"));_1595.set(_159d.domNode,{top:"-10000px"});return _159d;},_onViewportClick:function(evt){this.tryToStopEditing(false);},_removeEditingFeatures:function(){this.inherited(arguments);this._disconnectLocal(this._eventHandlers);},_disconnectLocal:function(_159e){if(lang.isArray(_159e)){var _159f;while(_159f=_159e.pop()){_1591.disconnect(_159f);}}}});});},"epi-cms/contentediting/FormEditing":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/layout/ContentPane","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_15a0,_15a1,_15a2,_15a3,_15a4,_15a5){return _15a0([_15a5,_15a3,_15a4],{createOverlays:false,selectFormOnCreation:true,placeForm:function(form){form.set("transitionMode","reveal");form.set("fitContainer",true);this.editLayoutContainer.addChild(form,0);},removeForm:function(form){this.editLayoutContainer.leftOver=form;_15a1.replace(this.iframeWithOverlay.domNode,"dijitVisible","dijitHidden");return false;}});});},"epi-cms/contentediting/_FormEditingMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/contentediting/SideBySideEditorWrapper","epi/shell/widget/FormContainer"],function(array,_15a6,lang,when,_15a7,_15a8){return _15a6(null,{_form:null,_formWidgets:null,canHandleLeftOver:true,selectFormOnCreation:false,formSettings:null,connectOverlayItemsToFormWidgets:false,_formConnects:null,destroy:function(){this._removeAndDestroyForm();this._formWidgets=null;this.inherited(arguments);},_removeAndDestroyForm:function(){if(this._form){if(this.removeForm(this._form)){this._form.destroy();this._form=null;}var _15a9;while(_15a9=this._formConnects.pop()){this.disconnect(_15a9);_15a9=null;}this._formConnects=null;this._form=null;}for(var p in this._formWidgets){this._formWidgets[p]=null;}},_setupForm:function(){this._formWidgets={};this._form=new _15a8(lang.mixin({readOnly:!this.viewModel.canChangeContent(),metadata:this.viewModel.metadata,baseClass:"epi-cmsEditingForm"},this.formSettings));this._formConnects=[];this._formConnects.push(this.connect(this._form,"onFieldCreated",this.onFieldCreated));this._formConnects.push(this.connect(this._form,"onGroupCreated",this.onGroupCreated));this._formConnects.push(this.connect(this._form,"onFormCreated",this.onFormCreated));this.placeForm(this._form);this._formPlaced=true;this._finishFormCreation();},_createFormEditorWrappers:function(){for(var _15aa in this._formWidgets){var _15ab={name:_15aa,metadata:this.viewModel.getPropertyMetaData(_15aa)};var value=lang.clone(this.viewModel.getProperty(_15ab.name));var _15ac=new _15a7({property:_15ab,propertyName:_15aa,value:value,editorWidget:this._formWidgets[_15aa],contentModel:this.viewModel.contentModel,operation:this.viewModel._operation});_15ac.editorWidget.set("parent",_15ac);_15ac.editorWidget.set("editMode","formedit");this.connect(_15ac,"onValueChange","_onWrapperValueChange");this.connect(_15ac,"onCancel","_onWrapperCancel");this.connect(_15ac,"onStopEdit","_onWrapperStopEdit");this._createMapping(_15aa,_15ac);_15ab=null;value=null;_15ac=null;}},_createMapping:function(_15ad,_15ae){var names=_15ad.split(".");var _15af=false;if(this.connectOverlayItemsToFormWidgets){while(names.length>0){var _15b0=names.join(".");var _15b1=this._mappingManager.find("propertyName",_15b0);array.forEach(_15b1,function(_15b2){_15af=true;_15b2.propertyName=_15ad;_15b2.wrapper=_15b2.wrapper||_15ae;});names.pop();}}if(!_15af){this._mappingManager.add({propertyName:_15ad,wrapper:_15ae});}},placeForm:function(form){},removeForm:function(form){},onFieldCreated:function(_15b3,_15b4){this._formWidgets[_15b3]=_15b4;if(this._addStateWatch){this._addStateWatch(_15b4);}},onGroupCreated:function(_15b5,_15b6){if(_15b6.contentViewModel!==undefined){_15b6.set("contentViewModel",this.viewModel);}},onFormCreated:function(form){this._formCreated=true;this._finishFormCreation();},_finishFormCreation:function(){if(this._formPlaced&&this._formCreated){when(this.selectFormOnCreation?this.editLayoutContainer.selectChild(this._form):null,lang.hitch(this,this._removeLeftOver));this.toolbar.setItemProperty("editmodeswitch","state","");this._createFormEditorWrappers(this._form);this.onSetupEditModeComplete();}},_removeLeftOver:function(){if(this.editLayoutContainer.leftOver){var _15b7=this.editLayoutContainer.selectedChildWidget===this.editLayoutContainer.leftOver;when(_15b7?this.editLayoutContainer.selectChild(this.iframeWithOverlay):null,lang.hitch(this,function(){this.editLayoutContainer.removeChild(this.editLayoutContainer.leftOver);this.editLayoutContainer.leftOver.destroyRecursive();this.editLayoutContainer.leftOver=null;}));}},onReadySetupEditMode:function(){this.inherited(arguments);this._removeAndDestroyForm();this._setupForm();},remapEditMode:function(){this.inherited(arguments);this._form&&this._form.set("readOnly",!this.viewModel.canChangeContent());}});});},"epi-cms/contentediting/SideBySideEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/window","epi-cms/contentediting/_EditorWrapperBase"],function(_15b8,lang,_15b9,_15ba){return _15b8([_15ba],{_grabFocusOnStartEdit:true,postCreate:function(){this.inherited(arguments);if(this.editorWidget){this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onFocus",lang.hitch(this,function(){setTimeout(lang.hitch(this,function(){this._tryToStartEditing(false);}),0);}));this.connect(this.editorWidget,"onBlur",lang.hitch(this,function(){setTimeout(lang.hitch(this,function(){this.tryToStopEditing(true);}),0);}));this.connect(this.editorWidget,"onDropping",lang.hitch(this,function(){this._tryToStartEditing(true);}));}},contentModelChanged:function(name,_15bb,value){this.set("value",value);},_tryToStartEditing:function(_15bc){if(this.editing){return;}this._grabFocusOnStartEdit=_15bc;this.startEdit();this._grabFocusOnStartEdit=true;},_onChange:function(val){if(this._preventChangeEvent){return;}var _15bd=this.editing;if(this.operation&&this.operation.inProgress&&!this.editing){this.editing=true;}this.inherited(arguments);this.editing=_15bd;},_setValueAttr:function(value){this._preventChangeEvent=true;this.inherited(arguments);this._preventChangeEvent=false;},startEdit:function(){if(this._grabFocusOnStartEdit){this.editorWidget.focus();_15b9.scrollIntoView(this.editorWidget.domNode);}this.inherited(arguments);},stopEdit:function(_15be){this.set("value",this.getEditorValue());this.inherited(arguments);}});});},"epi-cms/contentediting/_ValidationMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(array,_15bf,lang){return _15bf(null,{_watchHandles:null,constructor:function(){this._watchHandles=[];},destroy:function(){array.forEach(this._watchHandles,function(_15c0){_15c0.unwatch();});this._watchHandles=null;this.inherited(arguments);},_addStateWatch:function(_15c1){var _15c2=_15c1.get("name"),_15c3=this.viewModel;var _15c4=function(){var state=_15c1.get("state");if(state!=="Error"){_15c3.validator.clearPropertyErrors(_15c2,_15c3.validator.validationSource.client);}else{if(state==="Error"){var _15c5=_15c1.get("message");_15c5===""&&(_15c5=_15c1.getErrorMessage());_15c3.validator.setPropertyErrors(_15c2,[{"severity":_15c3.validator.severity.error,"errorMessage":_15c5}],_15c3.validator.validationSource.client);}}};this._watchHandles.push(_15c1.watch("state",_15c4));this._watchHandles.push(_15c1.watch("message",_15c4));}});});},"epi-cms/contentediting/InlineEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/Deferred","dojo/on","dojo/when","epi/string","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_15c6,event,lang,_15c7,_15c8,on,when,_15c9,_15ca){return _15c6([_15ca],{width:"100%",hasInlineEditor:true,matchStyle:false,destroy:function(){this._removeEditingFeatures();this._removeLocalHandlers();this._blockDisplayNodeOpacity=null;this.inherited(arguments);},_onViewportClick:function(evt){this._stopEditorEditing(evt);},_stopEditorEditing:function(evt){var _15cb=this.getEditorWidget();if(!_15cb||!_15cb.isEditing()){return;}_15cb.onEditorBlur(evt);this.tryToStopEditing(true);},_getOrCreateEditor:function(){if(this._createdEditor){return this.editorWidget;}var _15cc=new _15c8();var _15cd=_15c9.slashName(this.editorWidgetType),_15ce=lang.mixin(this.editorParams,{value:this.value});if(this.matchStyle){_15ce.style=this._computeStyling();}require([_15cd],lang.hitch(this,function(_15cf){var _15d0=this.editorWidget=new _15cf(_15ce);_15d0.placeAt(this.get("overlayItem").domNode);this.own(on(_15d0.domNode,"editorstatechanged",lang.hitch(this,this._onEditorStateChanged)));this._handlers=[this.connect(_15d0,"onClick",event.stop),this.connect(_15d0,"onEditorResizing",this._onEditorResizing),this.connect(_15d0,"onEditorResized",this._onEditorResized)];this._handlers.push(this.connect(_15d0,"onChange","_onEditorChange"));this._handlers.push(this.connect(_15d0,"onKeyPress","_onEditorKeyPress"));this._createdEditor=true;_15cc.resolve(_15d0);}));return _15cc;},_computeStyling:function(){var _15d1=_15c7.getComputedStyle(this.blockDisplayNode),_15d2="line-height:"+_15d1.lineHeight+";",_15d3=_15c7.getComputedStyle(this.domNode);["Weight","Family","Size","Style"].forEach(function(prop){var _15d4=_15d1["font"+prop],_15d5=_15d3["font"+prop];if(_15d5!=_15d4){_15d2+="font-"+prop+":"+_15d1["font"+prop]+";";}},this);var width=this.width;if(width=="100%"){_15d2+="width:100%;";}else{_15d2+="width:"+(width+(Number(width)==width?"px":""))+";";}_15d2+="position: absolute; left: 0px; top: 0px;";return _15d2;},_onEditorChange:function(value){this._onChange(value);},_onEditorResizing:function(_15d6){},_onEditorResized:function(_15d7){},_onEditorStateChanged:function(_15d8){var _15d9=this.get("overlayItem");_15d9&&_15d9.set("error",_15d8==="Error");},startEdit:function(){var _15da=this.getInherited(arguments);when(this._getOrCreateEditor(),lang.hitch(this,function(_15db){this._blockDisplayNodeOpacity=_15c7.get(this.blockDisplayNode,"opacity");_15c7.set(_15db.domNode,{"display":""});_15c7.set(this.blockDisplayNode,{"opacity":0.5});_15da.apply(this);this.focus();}));},_removeLocalHandlers:function(){(this._handlers instanceof Array&&this._handlers.length>0)&&this._handlers.forEach(function(_15dc){_15dc.remove();});},_removeEditingFeatures:function(){(this.blockDisplayNode&&this._blockDisplayNodeOpacity)&&_15c7.set(this.blockDisplayNode,{"opacity":this._blockDisplayNodeOpacity});(this.editorWidget&&this.editorWidget.domNode)&&_15c7.set(this.editorWidget.domNode,"display","none");},_toggleSupportCustomDnd:function(_15dd){var _15de=this.get("overlayItem");if(!_15de){return;}var _15df=this.getEditorWidget();if(!_15df||!_15df.supportCustomDnd){return;}if(_15dd===true){_15de.transferDndControlTo(_15df);_15df._onDropDataHandler||(_15df._onDropDataHandler=_15df.connect(_15de,"onDropData",lang.hitch(_15df,function(_15e0,_15e1,nodes,copy){_15df.onDropData(_15e0,_15e1,nodes,copy);})));return;}_15de.transferDndControlTo(_15de);_15df._onDropDataHandler&&_15df.disconnect(_15df._onDropDataHandler);_15df._onDropDataHandler=null;},_toggleOverlayItemZIndex:function(_15e2){var _15e3=this.get("overlayItem");if(!_15e3||!_15e3.item){return;}var _15e4=parseInt(_15c7.get(_15e3.item,"zIndex"),10);_15c7.set(_15e3.item,{"zIndex":_15e2===true?++_15e4:--_15e4});}});});},"epi-cms/contentediting/NotificationBar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/_base/array","dojo/on","dijit/_TemplatedMixin","dijit/_Widget","dijit/_Container","dijit/_WidgetsInTemplateMixin","dojo/Evented","dijit/form/Button","dojox/html/ellipsis","dojo/text!./templates/NotificationBar.html","dojo/text!./templates/NotificationBarItem.html"],function(_15e5,lang,_15e6,_15e7,_15e8,array,on,_15e9,_15ea,_15eb,_15ec,_15ed,_15ee,_15ef,_15f0,_15f1){var _15f2=_15e5([_15ea,_15e9,_15ec,_15ed],{templateString:_15f1,item:null,viewModel:null,postCreate:function(){this.inherited(arguments);if(this.item.content){this._addContent(this.item);}this._addCommands(this.item);},_onClose:function(e){e.preventDefault();this.emit("close",this);},_addContent:function(item){if(lang.isString(item.content)){this.textContainer.innerHTML=this.item.content;}else{_15e8.place(this.item.content,this.textContainer);}},_addCommands:function(item){if(lang.isArray(this.item.commands)){array.forEach(this.item.commands,lang.hitch(this,function(_15f3){this._addButtonForCommand(_15f3);}));}},_addButtonForCommand:function(_15f4){var _15f5=new _15ee({label:_15f4.label,title:_15f4.tooltip,iconClass:_15f4.iconClass});if(_15f4.cssClass){_15e6.add(_15f5.domNode,_15f4.cssClass);}_15f5.set("disabled",!_15f4.canExecute);_15f5.on("click",function(){_15f4.execute();});this.own(_15f4.watch("canExecute",lang.hitch(this,function(){_15f5.set("disabled",!_15f4.canExecute);})));if(_15f4.category==="leftAligned"){_15f5.placeAt(this.contentContainer,"first");}else{_15f5.placeAt(this.buttonContainer,"first");}this.own(_15f5);}});var _15f6=_15e5([_15ea,_15eb,_15e9,_15ec,_15ed],{templateString:_15f0,noBorderClass:"epi-notificationBarWithoutBorder",clear:function(){this._hideIfEmpty();array.forEach(this.getChildren(),function(_15f7){this.removeChild(_15f7);_15f7.destroy();_15f7=null;},this);this.emit("notificationsChanged");},destroy:function(){this.destroyDescendants();this.inherited(arguments);},add:function(_15f8){var _15f9=new _15f2({item:_15f8});on(_15f9,"close",lang.hitch(this,"_onCloseNotification"));this.addChild(_15f9);this._hideIfEmpty();this.emit("notificationsChanged");},remove:function(_15fa){array.forEach(this.getChildren(),lang.hitch(this,function(_15fb){if(_15fb.item&&_15fb.item==_15fa){this._onCloseNotification(_15fb);}}));this._hideIfEmpty();},_onCloseNotification:function(item){this.removeChild(item);item.destroy();item=null;this._hideIfEmpty();this.emit("notificationsChanged");},_hideIfEmpty:function(){var show=this.getChildren().length>0;_15e6.toggle(this.domNode,this.noBorderClass,!show);_15e7.set(this.domNode,"display",show?"":"none");}});return _15f6;});},"url:epi-cms/contentediting/templates/NotificationBar.html":"<div class=\"epi-notificationBar\">\r\n    <div data-dojo-attach-point=\"containerNode\"></div>\r\n</div>","url:epi-cms/contentediting/templates/NotificationBarItem.html":"<div class=\"epi-notificationBarItem\">\r\n    <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"contentContainer\">\r\n        <p data-dojo-attach-point=\"textContainer\"></p>\r\n    </div>\r\n    <div class=\"epi-notificationBarButtonContainer\" data-dojo-attach-point=\"buttonContainer\">\r\n        <button data-dojo-type=\"dijit/form/Button\" class=\"epi-chromelessButton\" data-dojo-props=\"iconClass:'epi-iconClose', showLabel:false\" data-dojo-attach-event=\"onClick:_onClose\"></button>\r\n    </div>\r\n</div>","epi-cms/contentediting/OnPageEditing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","epi/shell/gesture/ScrollPullDown","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_15fc,lang,_15fd,when,_15fe,_15ff,_1600,_1601){return _15fc([_1601,_15ff,_1600],{_iframeConnects:null,postMixInProperties:function(){this.inherited(arguments);this.formSettings={doLayout:false,baseClass:"epi-cmsEditingForm epi-cmsEditingFormOpe",propertyFilter:function(_1602,_1603){return _1603.groupName==="EPiServerCMS_SettingsPanel";}};},destroy:function(){this._removePullDownGesture();this.inherited(arguments);},onEditorWrapperCreated:function(_1604){if(_1604&&_1604.editorWidget){var _1605=_1604.editorWidget;if(_1605.onFieldCreated){this.connect(_1605,"onFieldCreated",function(_1606,_1607){this._addStateWatch(_1607);});}else{_1605.set("name",_1604.get("propertyName"));this._addStateWatch(_1605);}_1605.validate&&_1605.validate();}},onSetActiveProperty:function(_1608){var _1609=this._mappingManager.findOne("propertyName",_1608);if(!_1609){dojo.publish("/epi/cms/action/switcheditmode",[null,{activePropertyOnStartup:_1608}]);}else{this.inherited(arguments);}},_onOverlayItemClick:function(_160a,e){var _160b=this._activeEditorWrapper;if(_160b){_160b.tryToStopEditing();if(_160b.editing||_160a.name===_160b.overlayItem.name){return;}}this.inherited(arguments);},placeForm:function(form){form.set("fitContainer",false);form.set("transitionMode","slideIn");this.editLayoutContainer.addChild(form,0);this._setupPullDownGesture(form);},_setupPullDownGesture:function(form){var _160c=this;this._pullDownGesture=_15fe(_160c.iframeWithOverlay.previewContainer,{isShown:false,show:function(){this.isShown=null;when(_160c.editLayoutContainer.selectChild(form),lang.hitch(this,function(){this.isShown=true;_160c.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=false;_160c.iframeWithOverlay.onViewportPullDown();}));},hide:function(){this.isShown=null;when(_160c.editLayoutContainer.selectChild(_160c.iframeWithOverlay),lang.hitch(this,function(){this.isShown=false;_160c.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=true;_160c.iframeWithOverlay.onViewportPullDown();}));}});this._pullDownGesture.addMouseWheelListener(form.domNode);if(_160c.iframeWithOverlay.iframe.isInspectable()){this._setupIframeMouseWheelListeners();}},_setupIframeMouseWheelListeners:function(){var _160d=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());this._iframeConnects=[];this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onLoad",function(){_160d=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());}));this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onUnload",function(){_160d&&_160d.remove();}));},_teardownIframeMouseWheelListeners:function(){if(this._iframeConnects){var c;while(c=this._iframeConnects.pop()){this.disconnect(c);}c=null;this._iframeConnects=null;}},_removePullDownGesture:function(){this._teardownIframeMouseWheelListeners();if(this._pullDownGesture){this._pullDownGesture.destroy();this._pullDownGesture=null;}},removeForm:function(form){this._removePullDownGesture();this.editLayoutContainer.leftOver=form;return false;}});});},"epi/shell/gesture/ScrollPullDown":function(){define("epi/shell/gesture/ScrollPullDown",["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/mouse","dojo/on","dijit/Destroyable"],function(_160e,event,lang,mouse,on,_160f){return _160e([_160f],{_delegate:null,_scrollTarget:null,_isScrolling:false,_pullDownInertia:100,_ts:null,_tb:null,destroy:function(){this._delegate=null;},constructor:function(_1610,_1611){this._delegate=_1611;this._scrollTarget=_1610;this.addMouseWheelListener(_1610);},addMouseWheelListener:function(_1612){if(_1612){return this.own(on(_1612,mouse.wheel,lang.hitch(this,this._onMouseWheel)))[0];}},_blockShowEvent:function(){if(this._scrollTarget.scrollTop>0){this._isScrolling=true;}this._ts&&clearTimeout(this._ts);this._ts=setTimeout(lang.hitch(this,function(){this._isScrolling=false;}),this._pullDownInertia);return this._isScrolling;},_initiateScrollBlock:function(){this._scrollBlock=true;},_blockScrollEvent:function(){this._tb&&clearTimeout(this._tb);this._tb=setTimeout(lang.hitch(this,function(){this._scrollBlock=false;}),this._pullDownInertia);return (this._delegate.isShown==null)||this._scrollBlock;},_raiseShow:function(evt){if(this._delegate.isShown===false){event.stop(evt);this._delegate.show();this._initiateScrollBlock();}},_raiseHide:function(evt){if(this._delegate.isShown===true){event.stop(evt);this._delegate.hide();this._initiateScrollBlock();}},_onMouseWheel:function(evt){if(!evt.wheelDelta){this._blockScrollEvent();return;}if(this._blockScrollEvent()){event.stop(evt);return;}if(evt.wheelDelta<0||(this._delegate.isShown&&this._scrollTarget.scrollTop>0)){this._raiseHide(evt);}else{if(!this._blockShowEvent()){this._raiseShow(evt);}}}});});},"epi-cms/contentediting/PageDataController":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/Deferred","dojo/promise/all","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/layout/BorderContainer","epi/dependency","epi/string","epi/Url","epi/shell/layout/CardContainer","epi/shell/widget/IframeWithOverlay","epi-cms/_ContentContextMixin","epi-cms/contentediting/ContentReferencesNotification","epi-cms/contentediting/ContentViewModel","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/ExpirationNotification","epi-cms/contentediting/LanguageNotification","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/ShortcutNotification","epi-cms/contentediting/ViewSettingsNotification","epi-cms/contentediting/WorkflowTaskNotification","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting","dojo/text!./templates/PageDataController.html"],function(array,_1613,lang,_1614,_1615,_1616,all,topic,when,_1617,_1618,_1619,_161a,_161b,_161c,Url,_161d,_161e,_161f,_1620,_1621,_1622,_1623,_1624,_1625,_1626,_1627,_1628,_1629,res,_162a){return _1613([_1618,_1617,_1619,_161f],{templateString:_162a,contextTypeName:"epi.cms.contentdata",pendingNotificationTimeOutId:null,isActive:true,defaultEditCssRules:[{selector:".epi-injected-minSize",css:"min-height: 30px;"},{selector:".epi-injected-minSize-inline",css:"min-height: 30px; min-width: 100px; display: inline-block !important;"},{selector:"[contenteditable=true]:focus",css:"outline: 3px #b4c600 solid;"}],_currentViewComponent:null,_viewModels:null,_notificationHandlerId:null,_messageService:null,_editingCommands:null,_currentViewModel:null,_pageDataStore:null,_contentReferencesNotification:null,_shortcutNotification:null,_languageNotification:null,_expirationNotification:null,_workflowTaskNotification:null,_availableViews:null,_previewQueryParameters:null,_viewSettingsManager:null,_inUseNotificationManager:null,_showOverlay:true,postMixInProperties:function(){this.inherited(arguments);var _162b=_161b.resolve("epi.storeregistry");this._viewSettingsManager=_161b.resolve("epi.viewsettingsmanager");this._messageService=this._messageService||_161b.resolve("epi.shell.MessageService");this._profile=this._profile||_161b.resolve("epi.shell.Profile");this._pageDataStore=_162b.get("epi.cms.contentdata");this._editingCommands=_1629;if(!this._viewModels){this._viewModels=[];}this._inUseNotificationManager=this.inUseNotificationManager||_161b.resolve("epi.cms.contentediting.inUseNotificationManager");this._contentReferencesNotification=new _1620();this._languageNotification=new _1624();this._expirationNotification=new _1623();this._shortcutNotification=new _1626();this._viewSettingsNotification=new _1627();this._workflowTaskNotification=new _1628();},postCreate:function(){this.inherited(arguments);this.subscribe("/epi/cms/action/switcheditmode",lang.hitch(this,this._switchEditMode));var cs=_161b.resolve("epi.shell.ContextService");this._interceptorHandle=cs.registerRequestInterceptor(lang.hitch(this,this._interceptRequestContext));this.notificationBar.on("notificationsChanged",lang.hitch(this,function(){this.mainLayoutContainer.layout();}));this.own(this._contentReferencesNotification.watch("notification",lang.hitch(this,this._contentReferencesNotificationWatchHandler)),this._languageNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)),this._expirationNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)),this._shortcutNotification.watch("notification",lang.hitch(this,this._shortcutNotificationWatchHandler)),this._viewSettingsNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)),this._workflowTaskNotification.watch("notification",lang.hitch(this,this._workflowTaskNotificationWatchHandler)));},startup:function(){if(this._started){return;}this.inherited(arguments);var url=new Url(window.location.href),_162c=url.getQueryParameterValue("view");this.iFrame=this.iframeWithOverlay.iframe;this.connect(this.iFrame,"onLoad","_iFrameLoaded");this.connect(this.iFrame,"onUnload","_iFrameUnLoaded");_1614.add(this.toolbar.domNode,"epi-localToolbar epi-viewHeaderContainer");this._injectCssRules();when(this.getCurrentContext(),lang.hitch(this,function(_162d){this.contextChanged(_162d);}));},_defaultNotificationWatchHandler:function(name,_162e,_162f){if(_162e){this.notificationBar.remove(_162e);}if(_162f&&_162f.content){this.notificationBar.add(_162f);}},_shortcutNotificationWatchHandler:function(name,_1630,_1631){this._defaultNotificationWatchHandler(name,_1630,_1631);this._showOverlay=_1626.LinkTypes[_1631.shortcutType]!=="fetchdata";},_contentReferencesNotificationWatchHandler:function(name,_1632,_1633){this._defaultNotificationWatchHandler(name,_1632,_1633);this.notificationBar.set("viewModel",this._currentViewModel.contentData);},_workflowTaskNotificationWatchHandler:function(name,_1634,_1635){if(_1634 instanceof Array){array.forEach(_1634,function(_1636){this.notificationBar.remove(_1636);},this);}if(_1635 instanceof Array){array.forEach(_1635,function(_1637){this.notificationBar.add(_1637);},this);}},_switchEditMode:function(_1638,_1639){var _163a,_163b=this._currentViewModel.viewName,_163c=null,_163d="view",_163e="onpageedit",_163f="formedit";if(_163b===_163d){topic.publish("/epi/cms/action/disablepreview");}if(_163b===_163f){_163a=_163e;_163c=this._getPreviewUrl(this._currentContentContext,_163a);}else{_163a=_163f;}this._ensurePreviewReady(this.setView(_163a,_1639),_163c,true);},destroy:function(){this._interceptorHandle.remove();this._destroyCurrentViewComponent();this._viewModels=null;this.inherited(arguments);},_iFrameLoaded:function(url,_1640){if(!!url&&!_1640){this._requestContextChangeByUrl(url,true,true);}},_iFrameUnLoaded:function(url){this.iframeWithOverlay.overlay.set("enabled",false);},_destroyCurrentViewComponent:function(){if(this._currentViewComponentReloadRequireHandle){this._currentViewComponentReloadRequireHandle.remove();this._currentViewComponentReloadRequireHandle=null;}if(this._currentViewComponent){this._currentViewComponent.destroyRecursive();this._currentViewComponent=null;}},_getViewModelIndex:function(id){var index=-1;array.some(this._viewModels,function(item,idx){if(item.contentLink==id){index=idx;return true;}});return index;},_getViewModel:function(id){var index=this._getViewModelIndex(id);if(index>=0){return this._viewModels[index];}else{return null;}},_removeViewModel:function(id){var index=this._getViewModelIndex(id);if(index>=0){var _1641=this._viewModels.splice(index,1)[0];_1641.clear();}},_createViewModel:function(_1642,ctx){var _1643=new _1621({contentLink:_1642.contentLink,contextTypeName:this.contextTypeName});_1643.set("contentData",_1642);_1643.set("languageContext",ctx.languageContext);this._viewModels.push(_1643);return _1643;},contentContextUpdated:function(ctx,_1644){var _1645=ctx.id;this._pageDataStore.refresh(_1645).then(lang.hitch(this,function(_1646){if(this._currentViewModel){this._updateContentViewModel(_1646,ctx.languageContext);this._refreshModel(_1646,ctx);}}));},updateView:function(_1647,ctx,_1648){if(_1647&&_1647.skipUpdateView){return;}if(_1648&&_1648.widgetResumed){_1615.set(this.domNode,"visibility","hidden");}if(_1647&&_1647.contextIdSyncChange){this._pageDataStore.refresh(ctx.id).then(lang.hitch(this,function(_1649){this._updateContentViewModel(_1649,ctx.languageContext);this._currentViewComponent.onContentLinkSyncChange();this._refreshModel(_1649,ctx);}));}else{this._previousEditMode=null;if(this._currentViewModel){this._currentViewModel.suspend();}var _164a;if(_1647&&_1647.viewName){if(_1647.availableViews){this._availableViewsLookup={};array.forEach(_1647.availableViews,lang.hitch(this,function(_164b){this._availableViewsLookup[_164b.key]=_164b;}));}_164a=_1647.viewName;}this.toolbar.update({currentContext:ctx,viewConfigurations:{availableViews:_1647.availableViews,viewName:_1647.viewName}});if(this._currentViewComponent&&this._currentViewComponent.isSticky){_164a=this._currentViewModel.viewName;}var _164c=this._getPreviewUrl(ctx,_164a);this._ensurePreviewReady(this._loadContentDataAndSetView(ctx.id,_164a,ctx),_164c);}},_getPreviewUrl:function(_164d,_164e){return (_164e==="view"&&_164d.previewUrl)?_164d.previewUrl:_164d.editablePreviewUrl;},_ensurePreviewReady:function(_164f,_1650,_1651){var _1652=[];if(_164f){_1652.push(_164f);}if(_1650!==null&&_1650!==undefined){_1652.push(this._changeUrl(_1650,_1651));}all(_1652).then(lang.hitch(this,function(){var doc=this.iframeWithOverlay.iframe.getDocument();var _1653=this.connect(this._currentViewComponent,"onPrepareOverlayComplete",function(){this.disconnect(_1653);_1653=null;this.iframeWithOverlay.overlay.set("enabled",this._showOverlay&&this.iframeWithOverlay.iframe.isInspectable());this.iframeWithOverlay.layout(true);});_1615.set(this.domNode,"visibility","visible");this._viewSettingsManager.onPreviewReady(this.iframeWithOverlay);this._currentViewComponent.onPreviewReady(this._currentViewModel,doc);this._viewSettingsNotification.set("invokeActionValue",{viewModel:this._currentViewModel,viewSetting:this._viewSettingsManager});}));},_loadContentDataAndSetView:function(_1654,_1655,ctx){var def=new _1616();when(this._pageDataStore.refresh(_1654),lang.hitch(this,function(_1656){if(!_1656){return;}this._currentViewModel=this._getViewModel(_1656.contentLink);this.notificationBar.clear();if(!this._currentViewModel){this._currentViewModel=this._createViewModel(_1656,ctx);}else{this._updateContentViewModel(_1656,ctx.languageContext);}this._currentViewModel.set("viewLanguage",this._viewSettingsManager.get("enabled")?this._viewSettingsManager.getSettingProperty("viewlanguage"):null);this._refreshModel(_1656,ctx);when(this.setView(_1655),function(){def.resolve();},function(){def.cancel();});}),function(){def.reject();});return def;},_updateContentViewModel:function(_1657,_1658){this._currentViewModel.wakeUp();this._currentViewModel.set("contentData",_1657);this._currentViewModel.set("languageContext",_1658);},_refreshModel:function(_1659,_165a){var model=this._currentViewModel;if(model){this.toolbar.set("contentViewModel",model);this._inUseNotificationManager.updateCommandModel(model);this._editingCommands.set("model",model);this._contentReferencesNotification.set("invokeActionValue",model.contentData);this._languageNotification.set("invokeActionValue",_165a);this._shortcutNotification.set("invokeActionValue",model);this._workflowTaskNotification.set("invokeActionValue",model.contentData);this._expirationNotification.set("invokeActionValue",model);}},itemChanged:function(id,item){},setView:function(_165b,_165c){var def=new _1616();if(_165b==="onpageedit"&&(!this._currentViewModel.contentData.hasTemplate||!(_165b in this._availableViewsLookup))){_165b="formedit";}if(_165b&&!(_165b in this._availableViewsLookup)){return;}var _165d=lang.hitch(this,function(){when(this._setView(_165b,_165c),function(){def.resolve();},function(){def.cancel();});});var _165e=lang.hitch(this,function(){topic.publish("/epi/cms/action/showerror");def.cancel();});when(this._savePendingChanges(),_165d,_165e);return def;},_setView:function(_165f,_1660){var def=new _1616(),_1661=this._currentViewComponent,_1662=_1661&&_1661.viewModel&&_1661.viewModel.viewName===_165f;_1662=false;if(_1662){this._currentViewModel.viewName=_165f;this.toolbar.set("contentViewModel",this._currentViewModel);def.resolve();}else{this._destroyCurrentViewComponent();var _1663=_161c.slashName(this._availableViewsLookup[_165f].viewType);require([_1663],lang.hitch(this,function(_1664){this._currentViewComponent=new _1664(lang.mixin({mainLayoutContainer:this.mainLayoutContainer,editLayoutContainer:this.editLayoutContainer,iframeWithOverlay:this.iframeWithOverlay,contextTypeName:this.contextTypeName,toolbar:this.toolbar},_1660));this._currentViewComponentReloadRequireHandle=this.connect(this._currentViewComponent,"onReloadRequired",this._onViewRequireReload);this._currentViewComponent.startup();this._currentViewModel.viewName=_165f;this.toolbar.set("contentViewModel",this._currentViewModel);if(this.editLayoutContainer.leftOver&&!this._currentViewComponent.canHandleLeftOver){when(this.editLayoutContainer.selectedChildWidget===this.editLayoutContainer.leftOver?this.editLayoutContainer.selectChild(this.iframeWithOverlay):null,lang.hitch(this,function(){this.editLayoutContainer.removeChild(this.editLayoutContainer.leftOver);this.editLayoutContainer.leftOver.destroyRecursive();this.editLayoutContainer.leftOver=null;}));}def.resolve();}));}return def;},_onViewRequireReload:function(){var _1665=this._getPreviewUrl(this._currentContentContext,this._currentViewModel.viewName);this._ensurePreviewReady(null,_1665,true);},resize:function(size){this.inherited(arguments);this.mainLayoutContainer.resize(size);},onShow:function(){this.iframeWithOverlay.overlay.set("enabled",this._showOverlay);},onHide:function(){this.iframeWithOverlay.overlay.set("enabled",false);},_clearNotifications:function(){if(this._currentViewModel&&this._currentViewModel.validator){this._currentViewModel.validator.clear();}},_requestContextChangeByUrl:function(url,_1666,_1667,_1668,_1669){var _166a=new Url(url,_1668,_1669),_166b={url:_166a.toString()},_166c={sender:this,forceContextChange:_1666,suppressFailure:_1667,viewName:this._currentViewModel&&this._currentViewModel.viewName};topic.publish("/epi/shell/context/request",_166b,_166c);},_changeUrl:function(url,_166d){var _166e=lang.mixin(this._previewQueryParameters,this._viewSettingsManager.get("previewParams"));return this.iframeWithOverlay.iframe.load(url,{query:_166e},true,_166d);},_interceptRequestContext:function(_166f,_1670){if(!(_1670&&_1670.sender&&_1670.sender===this)){return this._savePendingChanges();}else{var def=new _1616();def.resolve();return def;}},_savePendingChanges:function(){if(this._currentViewModel&&!this._currentViewModel.isSaved){return this._currentViewModel.save();}else{var def=new _1616();def.resolve();return def;}},savePendingChanges:function(){return this._savePendingChanges();},_injectCssRules:function(){this.iFrame.addCssRules(this.defaultEditCssRules);}});});},"epi/shell/layout/CardContainer":function(){define("epi/shell/layout/CardContainer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/fx","dojo/aspect","dojo/has","dojo/on","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/Deferred","dojo/when","dijit/_TemplatedMixin","dijit/layout/StackContainer","dgrid/util/has-css3"],function(_1671,lang,fx,_1672,has,on,_1673,_1674,_1675,_1676,when,_1677,_1678,_1679){return _1671([_1678,_1677],{doLayout:false,transitionClass:"epi-transition",transitionDirection:"vertical",baseClass:"epi-cardContainer",templateString:"<div><div class='dijitContainer' style='position: relative;' data-dojo-attach-point='containerNode'></div></div>",layout:function(){var child=this.selectedChildWidget;var _167a=this.getChildren(),_167b=_167a[_167a.length-1];if(child&&child.resize){if(child.fitContainer){child.resize(this._containerContentBox||this._contentBox);}else{child.resize();}}if(child!==_167b&&!child.fitContainer){_1673.replace(_167b.domNode,"dijitVisible","dijitHidden");if(_167b&&_167b!==child&&_167b.resize){if(_167b.fitContainer){_167b.resize(this._containerContentBox||this._contentBox);}else{_167b.resize();}}}},addChild:function(child,_167c){if(this._started){var _167d=this.getChildren(),_167e=_167d[_167d.length-1];if(_167c>=_167d.length){_1673.replace(_167e.domNode,"dijitHidden","dijitVisible");}}this.inherited(arguments);},_transition:function(_167f,_1680){var _1681=this.getChildren(),_1682=_1681[_1681.length-1];if(!_1680||_1680._destroyed){return;}if(_1680.fitContainer&&_1680!==_1682){_1673.replace(_1682.domNode,"dijitVisible","dijitHidden");}return when(_167f===_1682?this._hideTransition(_1680,_1682):null,lang.hitch(this,function(n){var _1683=0;if(_1680&&!_1680._destroyed&&_1680!==_1682){_1683=_1675.getMarginBox(_1680.domNode).h;this._hideChild(_1680);}if(!_167f||_167f._destroyed){return;}this._showChild(_167f);if(_167f.resize){if(_167f.fitContainer){_167f.resize(this._containerContentBox||this._contentBox);}else{_167f.resize(null);}return when(this._showTransition(_167f,_1682,_1683),function(){if(_167f.fitContainer&&_167f!==_1682){_1673.replace(_1682.domNode,"dijitHidden","dijitVisible");}});}else{return;}}));},_hideTransition:function(_1684,_1685){return this._doTransition(_1684,_1685,false);},_showTransition:function(_1686,_1687,_1688){return this._doTransition(_1686,_1687,true,_1688);},_doTransition:function(page,_1689,_168a,_168b){if(page!==_1689){var _168c=_1675.getMarginBox(page.domNode),_168d=this._getAnimationNode(page,_1689);var _168e=this.transitionDirection==="vertical"?"top":"left",size=this.transitionDirection==="vertical"?_168c.h:_168c.w;from=_168a?-(size-_168b)+"px":"0px",to=_168a?"0px":-size+"px",restore=!_168a;return this._animate(_168d,_168e,from,to,restore);}},_getAnimationNode:function(page,_168f){return page.transitionMode==="slideIn"?this.containerNode:"reveal"?_168f.domNode:null;},_animate:function(node,_1690,from,to,_1691){var dfd=new _1676();if(node&&has("css-transitions")){_1674.set(node,_1690,from);setTimeout(lang.hitch(this,function(){_1673.add(node,this.transitionClass);var _1692=on(node,has("transitionend"),lang.hitch(this,function(){_1692.remove();_1673.remove(node,this.transitionClass);if(_1691){_1674.set(node,_1690,from);}dfd.resolve();}));setTimeout(function(){_1674.set(node,_1690,to);},1);}),1);}else{dfd.resolve();}return dfd.promise;}});});},"epi-cms/contentediting/ContentReferencesNotification":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/dom-construct","dojo/on","dojo/when","epi","epi/shell/TypeDescriptorManager","epi-cms/contentediting/_ContentEditingNotification","epi-cms/command/BackCommand","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.notificationbar"],function(array,_1693,event,_1694,on,when,epi,_1695,_1696,_1697,_1698,_1699){return _1693([_1696],{_backCommand:null,constructor:function(_169a){this._backCommand=new _1697();},postscript:function(){this._storeName="epi.cms.contentreferences";this.inherited(arguments);},_executeAction:function(value){var _169b=_1695.getValue(value.typeIdentifier,"actAsAnAsset");if(!_169b){return false;}return this._store.get(value.contentLink);},_onExecuteSuccess:function(_169c){if(!_169c){return;}var _169d=_1694.create("div");if(_169c.length>0){_169d.innerHTML+=_1699.affect;var _169e=_169c.length+" "+(_169c.length===1?epi.resources.text.item:epi.resources.text.items),self=this,_169f=_1694.create("a",{href:"#",innerHTML:_169e,title:_1699.referencestooltip},_169d);on(_169f,"click",function(evt){event.stop(evt);self._showReferenceDialog();});}else{_169d.innerHTML+=epi.resources.messages.notinuse;}this._backCommand.set("model",{});this._setNotification({content:_169d,commands:[this._backCommand]});},_showReferenceDialog:function(){_1698({contentData:this.get("invokeActionValue"),showToolbar:true,mode:_1698.mode.show});}});});},"epi-cms/contentediting/_ContentEditingNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","epi/dependency"],function(_16a0,lang,_16a1,when,_16a2){return _16a0([_16a1],{invokeActionValue:null,notification:null,_storeName:null,_store:null,_invokeActionProperty:"invokeActionValue",postscript:function(){this.inherited(arguments);this._setupStore();this.watch(this._invokeActionProperty,lang.hitch(this,this._invokeActionPropertyWatchHandler));},_setupStore:function(){if(!this._store&&this._storeName){var _16a3=_16a2.resolve("epi.storeregistry");this._store=_16a3.get(this._storeName);}},_executeAction:function(value){return value;},_onExecuteSuccess:function(){},_onExecuteFailed:function(){},_invokeActionPropertyWatchHandler:function(name,_16a4,value){if(value==null){return;}when(this._executeAction(value),lang.hitch(this,this._onExecuteSuccess),lang.hitch(this,this._onExecuteFailed));},_setNotification:function(_16a5){this.set("notification",_16a5);}});});},"epi-cms/command/BackCommand":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_16a6,topic,_16a7,_16a8,_16a9){return _16a6([_16a8],{label:_16a9.backtoprevious,tooltip:_16a9.backtoprevious,category:"leftAligned",iconClass:"epi-iconLeft",cssClass:"epi-chromelessButton epi-visibleLink",_previousContent:null,postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_16a7.resolve("epi.cms.BackContextHistory");},_execute:function(){topic.publish("/epi/shell/context/request",{uri:this._previousContent.uri},{trigger:"back",sender:this});},_onModelChange:function(){this._previousContent=this.contextHistory.getPrevious();this.set("canExecute",this._previousContent!=null);}});});},"epi-cms/contentediting/ContentViewModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/on","dojo/when","dojo/Stateful","dijit/Destroyable","epi/dependency","epi/datetime","epi/string","epi/shell/UndoManager","epi/shell/conversion/ObjectConverterRegistry","epi/shell/widget/dialog/Alert","epi/shell/Stateful","../ApplicationSettings","./ContentActionSupport","./ContentEditingValidator","./ContentModelServerSync","./Operation","epi/i18n!epi/cms/nls/episerver.cms.contentediting","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(array,_16aa,_16ab,_16ac,lang,on,when,_16ad,_16ae,_16af,_16b0,_16b1,_16b2,_16b3,Alert,_16b4,_16b5,_16b6,_16b7,_16b8,_16b9,res,_16ba){return _16ab([_16ad,_16ae],{contentModel:null,metadata:null,syncService:null,editorFactory:null,syncInterval:10000,validator:null,contentDataStore:null,profileHandler:null,languageContext:null,_converterRegistry:null,_contentVersionStore:null,_syncRetryTimeout:60000,undoManager:null,contextTypeName:"",contentLink:null,contentData:null,viewName:null,isCreatingNewVersion:false,hasUndoSteps:false,hasRedoSteps:false,isValid:true,hasPendingChanges:false,lastSaved:null,isSaved:true,isSaving:false,isOnline:true,hasErrors:false,isChangingContentStatus:false,_isSuspended:false,constructor:function(){},postscript:function(){this.inherited(arguments);this.profileHandler=this.profileHandler||_16af.resolve("epi.shell.Profile");this.metadataManager=this.metadataManager||_16af.resolve("epi.shell.MetadataManager");this.currentContentLanguage=this.currentContentLanguage||_16b5.currentContentLanguage;this.contentDataStore=this.contentDataStore||_16af.resolve("epi.storeregistry").get("epi.cms.contentdata");if(!this._contentVersionStore){this._contentVersionStore=_16af.resolve("epi.storeregistry").get("epi.cms.contentversion");}this.undoManager=this.undoManager||new _16b2();this.validator=this.validator||new _16b7({contextId:this.contentLink,contextTypeName:this.contextTypeName});if(!this.syncService){this._createSyncService();}var _16bb=lang.hitch(this,function(name,_16bc,_16bd){this.set(name,_16bd);});this._operation=new _16b9();this.own(this.syncService.watch("hasPendingChanges",_16bb),this.validator.watch("isValid",_16bb),this.validator.watch("hasErrors",_16bb),this.undoManager.watch("hasUndoSteps",_16bb),this.undoManager.watch("hasRedoSteps",_16bb),on(this._operation,"commit",lang.hitch(this,this._commitChanges)));},setActiveProperty:function(name){this.onSetActiveProperty(name);},suspend:function(){this._isSuspended=true;this.onContentChange();this.onSuspend();},onSuspend:function(){},wakeUp:function(){this._isSuspended=false;},destroy:function(){this.clear();this.inherited(arguments);},clear:function(){this.undoManager.clear();},_createSyncService:function(){var _16be=new _16b8({contentLink:this.contentLink,contentDataStore:this.contentDataStore});this.syncService=_16be;},connectLocal:function(_16bf,obj,evt,_16c0){if(!lang.isArray(_16bf)){throw Error("First argument to connectLocal must be an Array");}return _16bf.push(_16aa.connect(obj,evt,this,_16c0));},disconnectLocal:function(_16c1){if(lang.isArray(_16c1)){var _16c2;while(_16c2=_16c1.pop()){_16aa.disconnect(_16c2);}}},resetNotifications:function(){this.validator.clearErrorsBySource(this.validator.validationSource.client);},beginOperation:function(){this._operation.begin();},endOperation:function(){this._operation.end();},abortOperation:function(){this._operation.abort();},getProperty:function(_16c3){return this.contentModel.get(_16c3);},setProperty:function(_16c4,value,_16c5){this._setModelProperty(_16c4,value,_16c5);},publishProperty:function(_16c6,value){this.syncService.publishProperty(_16c6,value).then(lang.hitch(this,function(){this.contentModel.set(_16c6,value);this._patchContentDataStore(this.contentData.contentLink,_16c6,null,value);when(this.contentDataStore.refresh(this.contentData.contentLink),lang.hitch(this,function(_16c7){this.set("contentData",_16c7);}));}));},_commitChanges:function(_16c8){var _16c9=array.map(_16c8,function(item){return {propertyName:item.propertyName,value:item.oldValue,oldValue:item.value};});this.undoManager.createStep(this,this._saveProperties,[_16c9],"Edit properties");},_saveProperties:function(_16ca){this.beginOperation();array.forEach(_16ca,function(p){this._setModelProperty(p.propertyName,p.value,p.oldValue);},this);this.endOperation();},_setModelProperty:function(_16cb,value,_16cc){this.set("isSaved",false);this._operation.save({propertyName:_16cb,value:value,oldValue:_16cc||this.contentModel.get(_16cb)});this.contentModel.set(_16cb,value);this.syncService.scheduleForSync(_16cb,value);this.onPropertyEdited(_16cb,value);},onPropertyEdited:function(_16cd,value){},_onSynchronizeSuccess:function(_16ce,_16cf,_16d0){array.forEach(_16cf,lang.hitch(this,function(_16d1){this.validator.clearPropertyErrors(_16d1.name,this.validator.validationSource.server);this._patchContentDataStore(_16ce,_16d1.name,null,_16d1.value);}));this.validator.setGlobalErrors(_16d0.validationErrors,this.validator.validationSource.server);},_onSynchronizeFailure:function(_16d2,_16d3,_16d4,_16d5){array.forEach(_16d3,function(_16d6){if("successful" in _16d6){if(_16d6.successful){this.validator.clearPropertyErrors(_16d6.name,this.validator.validationSource.server);}else{this.validator.setPropertyErrors(_16d6.name,[{"errorMessage":_16d6.validationErrors,severity:this.validator.severity.error}],this.validator.validationSource.server);}}else{}},this);if(_16d5){if(_16d5.validationErrors){this.validator.setGlobalErrors(_16d5.validationErrors,this.validator.validationSource.server);}else{this.validator.clearGlobalErrors(this.validator.validationSource.server);}}},_contentLinkChanged:function(_16d7,_16d8){this.contentLink=_16d8;this.syncService.contentLink=_16d8;this.validator.setContextId(_16d8);if(!this._isSuspended){var _16d9={uri:"epi.cms.contentdata:///"+_16d8};_16aa.publish("/epi/shell/context/request",[_16d9,{sender:this,contextIdSyncChange:true,trigger:"internal"}]);}},ensureWritableVersion:function(){var _16da=this.contentLink;if(!this.contentData.isNewVersionRequired){return _16da;}this.isCreatingNewVersion=true;var def=new _16ac();when(this._contentVersionStore.put({originalContentLink:_16da}),lang.hitch(this,function(_16db){this._contentLinkChanged(_16da,_16db.contentLink);this.isCreatingNewVersion=false;def.resolve(_16db);}),lang.hitch(this,function(){this.isCreatingNewVersion=false;def.reject();}));return def;},validate:function(){var def;if(!this.validator){def=new _16ac();def.resolve();}else{def=this.validator.validate();}return def;},revertToPublished:function(){var _16dc=this.contentLink;when(this._contentVersionStore.remove(_16dc),lang.hitch(this,function(){this._loadPublishedVersion(_16dc);}),lang.hitch(this,function(error){var _16dd;if(error.status===403){_16dd=_16ba.deleteversion.cannotdeletepublished;}else{if(error.status===404){_16dd=res.versionstatus.versionnotfound;}}if(_16dd){this.dialog=new Alert({description:_16dd,onAction:lang.hitch(this,function(){this._loadPublishedVersion(_16dc);})});this.dialog.show();}}));},_loadPublishedVersion:function(_16de){when(this._contentVersionStore.query({contentLink:_16de,language:this.languageContext?this.languageContext.language:"",query:"getpublishedversion"}),lang.hitch(this,function(_16df){if(_16df!==null){var _16e0={uri:"epi.cms.contentdata:///"+_16df.contentLink,context:this};_16aa.publish("/epi/shell/context/request",[_16e0,{sender:this,trigger:"internal"}]);}}));},createDraft:function(){var _16e1=this.contentLink;var _16e2=this.contentData.status;var _16e3=_16b6.versionStatus;var _16e4=_16e2===_16e3.DelayedPublish;return when(this._contentVersionStore.put({originalContentLink:_16e1,isCommonDraft:_16e4}),lang.hitch(this,function(_16e5){var _16e6={uri:"epi.cms.contentdata:///"+_16e5.contentLink,context:this};_16aa.publish("/epi/shell/context/request",[_16e6,{sender:this}]);}));},editCommonDraft:function(){var _16e7=this.contentLink;return when(this._contentVersionStore.query({contentLink:_16e7,query:"getcommondraftversion"}),lang.hitch(this,function(_16e8){var _16e9={uri:"epi.cms.contentdata:///"+_16e8.contentLink,context:this};_16aa.publish("/epi/shell/context/request",[_16e9,{sender:this}]);}));},_populateContentModel:function(data,_16ea){var props={},_16eb,_16ec;for(var _16ed in data){var _16ee=_16ea.getPropertyMetadata(_16ed);var _16ef=data[_16ed];if(_16ee.hasSubProperties()){props[_16ed]=this._populateContentModel(_16ef,_16ee);}else{props[_16ed]=_16ef;_16eb=_16ee.customEditorSettings.converter;if(_16eb){_16ec=_16b3.getConverter(_16eb,"runtimeType");if(_16ec){props[_16ed]=_16ec.convert(_16eb,"runtimeType",_16ef);}}}}return props;},getPropertyMetaData:function(_16f0){if(this.metadata){return this.metadata.getPropertyMetadata(_16f0);}else{var _16f1=[],def=new _16ac();this.connectLocal(_16f1,this,"onMetadataResolve",function(_16f2){if(_16f2){def.resolve(this.metadata.getPropertyMetadata(_16f0));}else{def.reject();}this.disconnectLocal(_16f1);});return def;}},getContentModelAndMetadata:function(){var def=new _16ac();when(this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:this.contentLink}),lang.hitch(this,function(_16f3){this.set("metadata",_16f3);var _16f4=this.createContentModelObject(_16f3);this.set("contentModel",_16f4);this.onMetadataResolve(true);def.resolve();}),lang.hitch(this,function(){this.onMetadataResolve(false);def.reject();}));return def;},onMetadataResolve:function(_16f5){},getMetadataThenUpdateModel:function(){var def=new _16ac();when(this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:this.contentLink}),lang.hitch(this,function(_16f6){this.set("metadata",_16f6);var _16f7=this.createContentModelObject(_16f6);this.set("contentModel",lang.mixin(this.contentModel,_16f7));def.resolve();}),function(){def.reject();});return def;},createContentModelObject:function(_16f8){var _16f9=this._populateContentModel(this.contentData.properties,_16f8);var _16fa=new _16b4();_16fa.set(_16f9);return _16fa;},save:function(){if(!this.isOnline){var def=new _16ac();def.resolve(true);return def;}return this._save();},_save:function(){var def=new _16ac(),_16fb=lang.hitch(this,function(_16fc){if(_16fc){if(_16fc.successful){this._onSynchronizeSuccess(_16fc.contentLink,_16fc.properties,_16fc);}else{this._onSynchronizeFailure(_16fc.contentLink,_16fc.properties,_16fc.validationErrors,_16fc);}if(_16fc&&_16fc.hasContentLinkChanged){this._contentLinkChanged(_16fc.contentLink,_16fc.oldContentLink);}}this.set("isOnline",true);this.set("lastSaved",new Date());this.set("isSaving",false);this.set("isSaved",true);def.resolve(true);}),_16fd=lang.hitch(this,function(_16fe){this.set("hasErrors",true);this.set("isSaving",false);this.set("isSaved",false);this.set("isOnline",false);if(_16fe){array.forEach(_16fe.properties,lang.hitch(this,function(_16ff){if(!this.syncService.pendingSync(_16ff.name)){this.syncService.scheduleForSync(_16ff.name,_16ff.value);}}));}setTimeout(lang.hitch(this,function(){this.set("isOnline",true);this._save();}),this._syncRetryTimeout);def.reject(_16fe);});if(this.isCreatingNewVersion||!this.hasPendingChanges){_16fb();}else{when(this.ensureWritableVersion(),lang.hitch(this,function(){this.set("isSaving",true);when(this.syncService.save(),_16fb,_16fd);}),_16fd);}return def;},undo:function(){this.undoManager.undo();},redo:function(){this.undoManager.redo();},_patchContentDataStore:function(_1700,_1701,_1702,_1703){var _1704={};lang.setObject(_1701,_1703,_1704);return this.contentDataStore.patchCache({contentLink:_1700,changedBy:this.profileHandler.userName,saved:_16b0.serialize(new Date()),properties:_1704});},changeContentStatus:function(_1705){var _1706=this.contentLink;var def=new _16ac();this.set("isChangingContentStatus",true);var _1707=lang.hitch(this,function(_1708){var _1709=_1708&&_1708.success;var _170a=this.validator;if(_1709){if(_1705==_16b6.action.Publish||_1705==_16b6.action.CheckIn||_1705==(_16b6.saveAction.CheckIn|_16b6.saveAction.DelayedPublish|_16b6.saveAction.ForceCurrentVersion)){this.set("lastSaved",null);}if(_170a){_170a.clearGlobalErrors(_170a.validationSource.server);}def.resolve({id:_1708.id,oldId:_1706});}else{if(_1708&&_1708.validationErrors){if(_170a){_170a.setGlobalErrors(_1708.validationErrors,_170a.validationSource.server);_170a.validate();}def.reject(null);}else{def.reject((_1708&&_1708.errorMessage)?_1708.errorMessage:res.publish.error);}}this.set("isChangingContentStatus",false);});var _170b=lang.hitch(this,function(_170c){_16aa.publish("/epi/cms/action/showerror");def.reject((_170c&&_170c.errorMessage)?_170c.errorMessage:res.publish.error);this.set("isChangingContentStatus",false);});this.onContentChange();when(this.validate(),lang.hitch(this,function(){when(this.save(),lang.hitch(this,function(){when(this.contentDataStore.executeMethod("ChangeStatus",this.contentLink,{action:_1705}),_1707,_170b);}),_170b);}),_170b);return def;},onContentChange:function(){},hasEditAccess:function(){return _16b6.hasAccess(this.contentData.accessMask,_16b6.accessLevel.Edit);},hasAccess:function(_170d){var _170e=!this.languageContext||!this.languageContext.isTranslationNeeded;return _170e&&_16b6.isActionAvailable(this.contentData,_170d||_16b6.action.Edit,_16b6.providerCapabilities.Edit);},canTranslateContent:function(){if(this.viewLanguage&&this.languageContext&&this.viewLanguage!=this.currentContentLanguage){return false;}return true;},canChangeContent:function(_170f){return this.canEditCurrentLanguage()&&this.hasAccess(_170f);},canEditCurrentLanguage:function(){if(!this.languageContext){return true;}return this.languageContext.language==this.currentContentLanguage;}});});},"epi-cms/contentediting/ContentModelServerSync":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/json","dojo/_base/lang","dojo/Stateful","epi/datetime","epi/string"],function(array,_1710,_1711,json,lang,_1712,_1713,_1714){return _1710([_1712],{_queue:null,_isSynchronizing:false,hasPendingChanges:false,contentLink:null,contentDataStore:null,processInterval:200,_processIntervalId:0,_saveDeferred:null,_publish:false,constructor:function(_1715){lang.mixin(this,_1715);this._queue=[];},scheduleForSync:function(_1716,value){if(value===undefined){return;}this.set("hasPendingChanges",true);value=_1713.transformDate(value);var index=this._propertyIndexInQueue(_1716);if(index<0){this._queue.push({name:_1716,value:value});}else{this._queue[index].value=value;}},publishProperty:function(_1717,value){this._publish=true;this.scheduleForSync(_1717,value);return this._synchronizeItem(true);},_propertyIndexInQueue:function(_1718){var index=-1;array.some(this._queue,function(item,i){if(item.name===_1718){index=i;return true;}});return index;},save:function(){return this._startSynchronizeInterval();},_startSynchronizeInterval:function(){if(this._processIntervalId>0){return this._saveDeferred;}var fn=lang.hitch(this,function(){return this._synchronizeItem();});var def=fn();if(this.processInterval>=0){this._processIntervalId=setInterval(fn,this.processInterval);}return def;},_stopSynchronizeInterval:function(){if(this._processIntervalId){clearInterval(this._processIntervalId);this._processIntervalId=0;}},_synchronizeItem:function(){if(this._isSynchronizing){return this._saveDeferred;}if(this._queue.length===0){return this._saveDeferred;}if(!this._saveDeferred){this._saveDeferred=new _1711();}this._isSynchronizing=true;var items=this._queue;this._queue=[];var _1719=this.contentLink;var _171a=lang.hitch(this,function(_171b){var _171c=true;var _171d={};if(_171b){array.forEach(_171b.properties,lang.hitch(this,function(_171e){_171e.name=_1714.pascalToCamel(_171e.name);}));var _171f=_171b.savedContentLink;_171d=lang.mixin({successful:false,contentLink:_171c?_171b.savedContentLink:_1719,hasContentLinkChanged:_171b.savedContentLink&&_171f!=this.contentLink},_171b);if(_171f&&_171f!=this.contentLink){_171d.oldContentLink=this.contentLink;this.contentLink=_171f;}}else{_171c=false;}this._isSynchronizing=false;if(this._queue.length===0){this._stopSynchronizeInterval();this.set("hasPendingChanges",false);var def=this._saveDeferred;this._saveDeferred=null;if(_171c){def.resolve(_171d);}else{def.reject({contentLink:_1719,properties:items,error:"Unexpected result returned from the server."});}}});var _1720=lang.hitch(this,function(error){var _1721={contentLink:_1719,properties:items,error:error};this._isSynchronizing=false;if(this._queue.length===0){var def=this._saveDeferred;this._saveDeferred=null;this._stopSynchronizeInterval();this.set("hasPendingChanges",false);def.reject(_1721);}});_1711.when(this._saveProperties(items),_171a,_1720);return this._saveDeferred;},pendingSync:function(_1722){return this._propertyIndexInQueue(_1722)!==-1;},_saveProperties:function(items){var _1723=this.contentLink;var _1724={};array.forEach(items,lang.hitch(this,function(item){_1724[item.name]=json.toJson(item.value);}));var _1725={id:_1723,properties:_1724,publishChanges:this._publish};this._publish=false;return this.contentDataStore.patch(_1725,{id:_1725.id});}});});},"epi-cms/contentediting/Operation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/Stateful"],function(array,_1726,lang,_1727,_1728){return _1726([_1728,_1727],{inProgress:false,changes:null,constructor:function(){this.changes=[];},begin:function(){this.set("inProgress",true);},save:function(data){if(this.inProgress){this.changes=array.filter(this.changes,function(_1729){if(_1729.propertyName===data.propertyName){data.oldValue=_1729.oldValue;return false;}return true;});this.changes.push(data);return;}if(!lang.isArray(data)){data=[data];}this.emit("commit",data);},end:function(){this.set("inProgress",false);if(this.changes.length>0){this.save(this.changes);}this.changes=[];},abort:function(){this.set("inProgress",false);this.changes=[];}});});},"epi-cms/contentediting/ExpirationNotification":function(){define(["dojo/_base/declare","dojo/string","epi/datetime","epi/dependency","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContentEditingNotification","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_172a,_172b,_172c,_172d,_172e,_172f,_1730,_1731){return _172a([_172f],{postscript:function(){this.inherited(arguments);this._notificationPeriod=_172e.expirationNotificationPeriod;this._setupCommands();},_executeAction:function(_1732){return _1732.contentData.properties.iversionable_expire;},_onExecuteSuccess:function(_1733){var _1734=_172c.serverTime();var _1735=_1733?_1733.stopPublish:null,_1736=new Date(_1735);var text=null;if(_1735&&_172c.isDateValid(_1736)){if(new Date(_1734.getTime()+this._notificationPeriod*1000)>_1736){text=_1736<_1734?_1731.expired:_172b.substitute(_1730.expiretimetext,[_172c.timeToGo(_1736)]);}}if(!text){this._setNotification(null);}else{this._setNotification({content:text,commands:[this._editingCommands.manageExpiration]});}},_viewModelValueHandler:null,_setupCommands:function(){if(!this._editingCommands){this._editingCommands=_172d.resolve("epi.cms.contentEditing.command.Editing");}if(this._commandsWatchHandler){this._commandsWatchHandler.unwatch();}var self=this;var _1737=null;self._commandsWatchHandler=this._editingCommands.manageExpiration.watch("viewModel",function(name,_1738,_1739){if(self._viewModelValueHandler){self._viewModelValueHandler.unwatch();}self._viewModelValueHandler=_1739.watch("value",function(name,_173a,value){self._onExecuteSuccess(value);});});}});});},"epi-cms/contentediting/LanguageNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/dom-construct","epi/dependency","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContentEditingNotification","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting.languagenotification"],function(_173b,lang,array,Url,_173c,_173d,_173e,_173f,_1740,_1741){return _173b([_173f],{_onExecuteSuccess:function(_1742){if(!_1742.languageContext){return;}var store=_173d.resolve("epi.storeregistry").get("epi.cms.language");store.query().then(lang.hitch(this,function(_1743){languageResource={};array.forEach(_1743,function(_1744){languageResource[_1744.languageId]=_1744.name;},this);var _1745=_1742.languageContext.warning;var _1746=_173e.currentContentLanguage;var _1747=_1742.languageContext;var _1748;if(_1746!=_1747.preferredLanguage&&_1747.isTranslationNeeded){_1745=lang.replace(_1741.nottranslatedswitchto,[languageResource[_1747.language],languageResource[_1747.preferredLanguage]]);_1748=_1747.preferredLanguage;}else{if(_1746!=_1747.language&&!_1747.isTranslationNeeded){_1745=lang.replace(_1741.workinginwrongsite,[languageResource[_1746],languageResource[_1747.language]]);_1748=_1747.language;}}if(!_1745){this._setNotification(null);return;}var html=_173c.create("div",{innerHTML:_1745});if(_1748){var url=new Url(window.top.location.href);var text=lang.replace(_1741.switchto,[languageResource[_1748]]);var link=_173c.create("a",{href:[url.scheme,"://",url.authority,url.path,"?language=",_1748,"#context=",_1742.versionAgnosticUri].join(""),innerHTML:text,title:text},html);}this._setNotification({content:html,commands:_1747.isTranslationNeeded&&_1746==_1747.preferredLanguage?[_1740.translate]:[]});}));}});});},"epi-cms/contentediting/ShortcutNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi-cms/contentediting/_ContentEditingNotification","epi/i18n!epi/cms/nls/episerver.cms.contentediting.shortcutnotification"],function(_1749,lang,_174a,_174b,_174c){var _174d=["normal","shortcut","external","inactive","fetchdata"];var _174e=_1749([_174b],{contentData:null,postscript:function(){this.inherited(arguments);this.watch("contentData",lang.hitch(this,this._contentDataWatchHandler));},_onExecuteSuccess:function(value){if(this._viewModelWatch){this._viewModelWatch.unwatch();}this._viewModelWatch=value.watch("contentModel",lang.hitch(this,function(name,_174f,_1750){if(this._contentModelWatch){this._contentModelWatch.unwatch();}this._contentModelWatch=_1750.watch("iversionable_shortcut",lang.hitch(this,function(name,_1751,_1752){this._updateNotification(_1752&&_1752.pageShortcutType);}));}));this.set("contentData",value.contentData);},_contentDataWatchHandler:function(name,_1753,value){if(value&&value.capabilities&&value.capabilities.isPage){this._updateNotification(value.properties.pageShortcutType);}},_updateNotification:function(_1754){var _1755,_1756=null;if(_1754>0){_1755=_174d[_1754];_1756=_174a.toHTML(_174c[_1755]);}this._setNotification({shortcutType:_1754,content:_1756});}});_174e.LinkTypes=_174d;return _174e;});},"epi-cms/contentediting/ViewSettingsNotification":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/_ContentEditingNotification","epi/i18n!epi/cms/nls/episerver.cms.contentediting.viewsettingsnotification"],function(_1757,_1758,_1759,_175a){return _1757([_1759],{_onExecuteSuccess:function(value){var _175b=value.viewModel.contentData&&value.viewModel.contentData.accessMask<=_1758.accessLevel.Read,_175c=_175b&&value.viewSetting.get("enabled")&&value.viewSetting.hasVisitorGroup();this._setNotification(_175c?{content:_175a.visitorgroups.noaccessright}:null);}});});},"epi-cms/contentediting/WorkflowTaskNotification":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojox/html/entities","epi/datetime","epi/string","epi-cms/contentediting/_ContentEditingNotification","epi-cms/contentediting/command/WorkflowTask","epi/i18n!epi/ui/nls/personalization.task"],function(array,_175d,lang,topic,_175e,_175f,_1760,_1761,_1762,_1763){return _175d([_1761],{_contentData:null,taskStatus:["statusnotstarted","statusinprogress","statuscompleted","statusrejected"],constructor:function(){this._storeName="epi.cms.workflowtask";this.inherited(arguments);},_executeAction:function(_1764){this._contentData=_1764;return this._store.query({id:_1764.contentLink});},_onExecuteSuccess:function(tasks){var _1765=[];array.forEach(tasks,function(task){_1765.push({content:_1760.toHTML(this._renderMessage(task)),commands:[new _1762({model:{contentData:this._contentData,task:task}})]});},this);this._setNotification(_1765);if(!tasks||tasks.length===0){topic.publish("/epi/cms/action/refreshmytasks");}},_renderMessage:function(task){var _1766="";_1766+=task.subject&&task.subject.length>0?_175e.encode(task.subject):"-";_1766+=task.dueDate?lang.replace(", {0} {1}",[_1763.duedate.toLowerCase(),_175f.toUserFriendlyString(task.dueDate)]):"";_1766+=", "+_1763[this.taskStatus[task.status]];return _1766;}});});},"epi-cms/contentediting/command/WorkflowTask":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/io-query","epi","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.contentediting.command.workflowtask"],function(_1767,lang,_1768,_1769,_176a,epi,_176b,_176c,_176d){return _1767([_176b],{label:_176d.label,tooltip:_176d.tooltip,cssClass:"epi-chromelessButton epi-visibleLink",dialogPath:"Edit/WorkflowTask.aspx",raiseCloseEvent:true,getDialogParams:function(){var self=this;return {dialogTitle:_176d.title,legacyButtonQuery:"div span.epi-cmsButton",onMapDialogButton:function(_176e){return self._mapDialogButtons(_176e);},onLoad:function(_176f){self._closeLegacyDialogOnRedirect(_176f,this);},destroyOnHide:true,showCloseButton:true};},getRouteParams:function(){return lang.mixin(this.inherited(arguments),{"id":this.getContentReference(true),task:this.model.task.taskId});},_onModelChange:function(){var model=this.model;var _1770=!!(model&&model.contentData&&!model.contentData.isDeleted&&model.task&&model.task.taskId);this.set("canExecute",_1770);},_isCancelButton:function(_1771){return _1771&&_1769.contains(_1771,"epi-cmsButton-Cancel");},_mapDialogButtons:function(_1772){return !(this._isCancelButton(_1772)||_1769.contains(_1772,"epi-cmsButton-ViewMode"));},_closeLegacyDialogOnRedirect:function(_1773,_1774){var uri=_1773.containerIframe.contentWindow.location.href,query=uri.substring(uri.indexOf("?")+1,uri.length),_1775=_176a.queryToObject(query);if(!_1775||!(_1775.task)){_1774.hide();}}});});},"url:epi-cms/contentediting/templates/PageDataController.html":"<div style=\"width: 100%; height: 100%;\">\r\n    <div data-dojo-attach-point=\"mainLayoutContainer\" data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\" style=\"width: 100%; height: 100%\">\r\n        <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/EditToolbar\" data-dojo-props=\"region:'top'\"></div>\r\n        <div data-dojo-attach-point=\"notificationBar\" data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-props=\"region:'top'\"></div>\r\n        <div data-dojo-attach-point=\"editLayoutContainer\" data-dojo-type=\"epi/shell/layout/CardContainer\" data-dojo-props=\"region: 'center'\">\r\n            <div data-dojo-attach-point=\"iframeWithOverlay\" data-dojo-type=\"epi/shell/widget/IframeWithOverlay\" data-dojo-props=\"fitContainer: true\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/contentediting/SettingsPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/when","dojo/dom-geometry","dijit/_Container","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","epi/shell/layout/SimpleContainer","dojo/text!./templates/SettingsPanel.html"],function(_1776,lang,array,_1777,when,_1778,_1779,_177a,_177b,_177c,_177d,_177e,_177f){return _1776([_177c,_1779,_177a,_177b],{templateString:_177f,contentViewModel:null,detailsWidgetIdentifier:"epi-cms/contentediting/ContentDetails",detailsModelIdentifier:"epi-cms/contentediting/viewmodel/ContentDetailsViewModel",detailsWidgetProperties:null,_contentDetailsDef:null,_contentDetailsModelDef:null,buildRendering:function(){this.inherited(arguments);var _1780=this.detailsWidgetIdentifier;var _1781=this.detailsModelIdentifier;var _1782=new _1777();var _1783=new _1777();require([_1780,_1781],lang.hitch(this,function(_1784,_1785){var _1786=new _1784({},this.contentDetails);this.own(_1786);var model=new _1785();this.own(model);_1786.set("model",model);_1786.startup();this.contentDetails=_1786;_1782.resolve(_1786);_1783.resolve(model);}));this._contentDetailsDef=_1782;this._contentDetailsModelDef=_1783;},_setContentViewModelAttr:function(_1787){this._set("contentViewModel",_1787);when(this._contentDetailsModelDef,function(model){model.set("dataModel",_1787);});},addChild:function(w){if(this.detailsWidgetProperties){var _1788=array.filter(this.detailsWidgetProperties,function(item){return item.propertyName==w.name;});if(_1788.length>0){when(this._contentDetailsDef,lang.hitch(this,function(_1789){_1789.addChild(w,_1788[0].options);}));return;}}this.widgetContainer.addChild(w);}});});},"url:epi-cms/contentediting/templates/SettingsPanel.html":"<div class=\"epi-documentHeader\">\r\n    <div data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></div>\r\n    <div data-dojo-attach-point=\"contentDetails\"></div>\r\n</div>","epi-cms/contentediting/ValidationTextboxWithWarning":function(){define(["dojo/_base/declare","dojox/validate/regexp","dijit/form/ValidationTextBox"],function(_178a,_178b,_178c){return _178a([_178c],{regExpForWarning:null,acceptUrl:false,acceptMailAddress:false,_refreshState:function(){if(!this._created){return;}this.focused?this._validateWhenTyping():this.validate(false);},_isValidWhenTyping:function(){var value=this.textbox.value;return (this.acceptUrl&&(new RegExp(_178b.url({scheme:true}))).test(value))||(this.acceptMailAddress&&(new RegExp("mailto\\:"+_178b.emailAddress())).test(value))||(this.regExpForWarning&&(new RegExp("^(?:"+this.regExpForWarning+")"+(this.required?"":"?")+"$")).test(value));},_validateWhenTyping:function(){var _178d="";var _178e=this.disabled||this.isValid(true);if(_178e){this._maskValidSubsetError=true;}var _178f=this._isEmpty(this.textbox.value);var _1790=!_178e&&this._isValidSubset();this._set("state",_178e?(this._isValidWhenTyping()?"":"Incomplete"):(((_178f||_1790)&&this._maskValidSubsetError)?"Incomplete":"Error"));this.focusNode.setAttribute("aria-invalid",_178e?"false":"true");if(this.state=="Error"){this._maskValidSubsetError=_1790;_178d=this.getErrorMessage(true);}else{if(this.state=="Incomplete"){_178d=this.getPromptMessage(true);this._maskValidSubsetError=!this._hasBeenBlurred;}else{if(_178f){_178d=this.getPromptMessage(true);}}}this.set("message",_178d);return _178e;}});});},"dojox/validate/regexp":function(){define("dojox/validate/regexp",["dojo/_base/lang","dojo/regexp","dojox/main"],function(lang,_1791,dojox){var _1792=lang.getObject("validate.regexp",true,dojox);_1792=dojox.validate.regexp={ipAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowDottedDecimal!="boolean"){flags.allowDottedDecimal=true;}if(typeof flags.allowDottedHex!="boolean"){flags.allowDottedHex=true;}if(typeof flags.allowDottedOctal!="boolean"){flags.allowDottedOctal=true;}if(typeof flags.allowDecimal!="boolean"){flags.allowDecimal=true;}if(typeof flags.allowHex!="boolean"){flags.allowHex=true;}if(typeof flags.allowIPv6!="boolean"){flags.allowIPv6=true;}if(typeof flags.allowHybrid!="boolean"){flags.allowHybrid=true;}var _1793="((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var _1794="(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]";var _1795="(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]";var _1796="(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|"+"4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])";var hexRE="0[xX]0*[\\da-fA-F]{1,8}";var _1797="([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}";var _1798="([\\da-fA-F]{1,4}\\:){6}"+"((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var a=[];if(flags.allowDottedDecimal){a.push(_1793);}if(flags.allowDottedHex){a.push(_1794);}if(flags.allowDottedOctal){a.push(_1795);}if(flags.allowDecimal){a.push(_1796);}if(flags.allowHex){a.push(hexRE);}if(flags.allowIPv6){a.push(_1797);}if(flags.allowHybrid){a.push(_1798);}var _1799="";if(a.length>0){_1799="("+a.join("|")+")";}return _1799;},host:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowIP!="boolean"){flags.allowIP=true;}if(typeof flags.allowLocal!="boolean"){flags.allowLocal=false;}if(typeof flags.allowPort!="boolean"){flags.allowPort=true;}if(typeof flags.allowNamed!="boolean"){flags.allowNamed=false;}var _179a="(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)";var _179b="(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)";var _179c=flags.allowPort?"(\\:\\d+)?":"";var _179d="((?:"+_179a+"\\.)+"+_179b+"\\.?)";if(flags.allowIP){_179d+="|"+_1792.ipAddress(flags);}if(flags.allowLocal){_179d+="|localhost";}if(flags.allowNamed){_179d+="|^[^-][a-zA-Z0-9_-]*";}return "("+_179d+")"+_179c;},url:function(flags){flags=(typeof flags=="object")?flags:{};if(!("scheme" in flags)){flags.scheme=[true,false];}var _179e=_1791.buildGroupRE(flags.scheme,function(q){if(q){return "(https?|ftps?)\\://";}return "";});var _179f="(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?";return _179e+_1792.host(flags)+_179f;},emailAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowCruft!="boolean"){flags.allowCruft=false;}flags.allowPort=false;var _17a0="([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+";var _17a1=_17a0+"@"+_1792.host(flags);if(flags.allowCruft){_17a1="<?(mailto\\:)?"+_17a1+">?";}return _17a1;},emailAddressList:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.listSeparator!="string"){flags.listSeparator="\\s;,";}var _17a2=_1792.emailAddress(flags);var _17a3="("+_17a2+"\\s*["+flags.listSeparator+"]\\s*)*"+_17a2+"\\s*["+flags.listSeparator+"]?\\s*";return _17a3;},numberFormat:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.format=="undefined"){flags.format="###-###-####";}var _17a4=function(_17a5){return _1791.escapeString(_17a5,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d");};return _1791.buildGroupRE(flags.format,_17a4);},ca:{postalCode:function(){return "([A-Z][0-9][A-Z] [0-9][A-Z][0-9])";},province:function(){return "(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)";}},us:{state:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowTerritories!="boolean"){flags.allowTerritories=true;}if(typeof flags.allowMilitary!="boolean"){flags.allowMilitary=true;}var _17a6="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|"+"NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";var _17a7="AS|FM|GU|MH|MP|PW|PR|VI";var _17a8="AA|AE|AP";if(flags.allowTerritories){_17a6+="|"+_17a7;}if(flags.allowMilitary){_17a6+="|"+_17a8;}return "("+_17a6+")";}}};return _1792;});},"dojox/main":function(){define("dojox/main",["dojo/_base/kernel"],function(dojo){return dojo.dojox;});},"epi-cms/contentediting/viewmodel/ContentDetailsViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi","epi/datetime","epi/dependency","epi/username","epi-cms/contentediting/command/AccessRights","epi-cms/contentediting/command/LanguageSettings","epi-cms/contentediting/command/DynamicProperties","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/contentediting/viewmodel/_ContentViewModelObserver"],function(array,_17a9,lang,epi,_17aa,_17ab,_17ac,_17ad,_17ae,_17af,_17b0,_17b1,_17b2,_17b3,_17b4){return _17a9([_17b4,_17b0,_17b1],{commandKey:"epi.cms.contentdetailsmenu",res:null,contentTypeName:null,contentId:null,visibleToEveryOne:null,existingLanguages:null,accessRightsCommand:null,languageSettingsCommand:null,dynamicPropertiesCommand:null,expirationCommand:null,constructor:function(_17b5){_17a9.safeMixin(this,_17b5);},postscript:function(){this.initializeCommandProviders();this.accessRightsCommand=new _17ad();this.languageSettingsCommand=new _17ae();this.dynamicPropertiesCommand=new _17af();if(!this.expirationCommand){var _17b6=_17ab.resolve("epi.cms.contentEditing.command.Editing");this.expirationCommand=_17b6.manageExpiration;}if(!this.store){var _17b7=_17ab.resolve("epi.storeregistry");this.store=_17b7.get("epi.cms.contenttype");}this.inherited(arguments);},destroy:function(){this.accessRightsCommand.destroy();this.languageSettingsCommand.destroy();this.dynamicPropertiesCommand.destroy();this.inherited(arguments);},_setDataModelAttr:function(value){this.updateCommandModel(value);this.accessRightsCommand.set("model",value);this.languageSettingsCommand.set("model",value);this.dynamicPropertiesCommand.set("model",value);this.inherited(arguments);},onDataModelChange:function(name,_17b8,value){var _17b9=this.dataModel.contentData,_17ba=new _17b3(_17b9.contentLink);this.set("contentId",_17ba.id);this.set("existingLanguages",array.map(_17b9.existingLanguageBranches,function(item){return {text:item.languageId,urlSegment:item.urlSegment,isCurrentLanguage:_17b9.currentLanguageBranch&&item.languageId===_17b9.currentLanguageBranch.languageId,contentLink:new _17b3(item.commonDraftLink).createVersionUnspecificReference().toString()};}));this.set("visibleToEveryOne",_17b9.visibleToEveryOne);dojo.when(this.store.get(_17b9.contentTypeID),dojo.hitch(this,function(type){this.set("contentTypeName",type.localizedName);}));this.set("commands",this.getCommands());},getCommands:function(){var _17bb=this.inherited(arguments);return [this.dynamicPropertiesCommand,this.languageSettingsCommand,this.expirationCommand].concat(_17bb);}});});},"epi-cms/contentediting/command/AccessRights":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.accessrights"],function(_17bc,_17bd,_17be,_17bf){return _17bc([_17be],{name:"AccessRights",label:_17bf.label,tooltip:_17bf.tooltip,dialogPath:"Edit/EditSecurity.aspx",raiseCloseEvent:true,_onModelChange:function(){var _17c0=this.model.contentData,_17c1=_17bd.hasAccess(_17c0.accessMask,_17bd.accessLevel.Administer),_17c2=this.model.canChangeContent();this.set("canExecute",_17c0.capabilities.securable&&_17c1&&_17c2);}});});},"epi-cms/contentediting/command/LanguageSettings":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.languagesettings"],function(_17c3,_17c4,_17c5,_17c6){return _17c3([_17c5],{name:"LanguageSettings",label:_17c6.label,tooltip:_17c6.tooltip,dialogPath:"Edit/LanguageSettings.aspx",raiseCloseEvent:true,_onModelChange:function(){var _17c7=this.model.contentData,_17c8=_17c4.hasAccess(_17c7.accessMask,_17c4.accessLevel.Administer),_17c9=this.model.canChangeContent();this.set("canExecute",_17c7.capabilities.languageSettings&&_17c8&&_17c9);}});});},"epi-cms/contentediting/command/DynamicProperties":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.dynamicproperties"],function(_17ca,_17cb,_17cc,_17cd){return _17ca([_17cc],{label:_17cd.label,tooltip:_17cd.tooltip,dialogPath:"Edit/EditDynProp.aspx",raiseCloseEvent:false,_onModelChange:function(){var _17ce=this.model.contentData,_17cf=_17cb.hasAccess(_17ce.accessMask,_17cb.accessLevel.Administer),_17d0=this.model.canChangeContent();this.set("canExecute",_17ce.capabilities.dynamicProperties&&_17cf&&_17d0);}});});},"epi-cms/conversion/PropertyContentAreaConverter":function(){define(["dojo/_base/declare"],function(_17d1){return _17d1(null,{sourceDataType:"epi.cms.propertycontentarea",targetDataType:"runtimeType",registerDefaultConverters:function(_17d2){_17d2.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_17d3,_17d4,data){if(_17d3===this.sourceDataType&&_17d4===this.targetDataType){return data?data._unparsedString:data;}return null;}});});},"epi-cms/layout/CreateContentGroupContainer":function(){define(["dojo/_base/declare","dojo/dom-construct","epi/shell/layout/SimpleContainer"],function(_17d5,_17d6,_17d7){return _17d5([_17d7],{templateString:"<div class='epi-containerLayout clearfix'>                            <div class='epi-formsHeaderContainer'>                                <h2>${title}</h2>                            </div>                            <ul data-dojo-attach-point='containerNode'></ul>                        </div>"});});},"epi-cms/layout/EditLayoutContainer":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dijit/layout/TabContainer","dijit/registry","dojo/text!./templates/EditLayoutContainer.html"],function(array,_17d8,_17d9,_17da,_17db,_17dc){return _17d8([_17da],{templateString:_17dc,postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this.tabPosition="top";},addChild:function(_17dd,index){if(_17dd.region==="top"){_17d9.place(_17dd.domNode,this.topPaneContainerNode);if(this._started&&!_17dd._started){_17dd.startup();}}else{this.inherited(arguments);}},removeChild:function(_17de){if(_17de.region==="top"){if(this._descendantsBeingDestroyed){return;}if(this._started){this.layout();}}else{this.inherited(arguments);}},getChildren:function(){var _17df=this.topPaneContainerNode?_17db.findWidgets(this.topPaneContainerNode):[];return _17df.concat(this.inherited(arguments));},layout:function(){if(!this._contentBox||typeof (this._contentBox.l)=="undefined"){return;}var _17e0=_17db.findWidgets(this.topPaneContainerNode);array.forEach(_17e0,function(_17e1){_17e1.resize();});return this.inherited(arguments);},selectChild:function(_17e2){if(_17e2.region==="top"){return;}else{return this.inherited(arguments);}}});});},"url:epi-cms/layout/templates/EditLayoutContainer.html":"<div class=\"dijitTabContainer\">\r\n    <div data-dojo-attach-point=\"topPaneContainerNode\"></div>\r\n\t<div class=\"dijitTabListWrapper\" data-dojo-attach-point=\"tablistNode\"></div>\r\n\t<div data-dojo-attach-point=\"tablistSpacer\" class=\"dijitTabSpacer ${baseClass}-spacer\"></div>\r\n\t<div class=\"dijitTabPaneWrapper ${baseClass}-container\" data-dojo-attach-point=\"containerNode\"></div>\r\n</div>\r\n","epi-cms/legacy/LegacyFormEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi/dependency","epi/shell/widget/dialog/Dialog","epi-cms/widget/_HasChildDialogMixin","epi/shell/widget/_ValueRequiredMixin","epi-cms/legacy/EditPropertyWidget","epi/i18n!epi/cms/nls/episerver.cms.legacy.legacyformeditor"],function(_17e3,lang,_17e4,_17e5,_17e6,_17e7,_17e8,_17e9,_17ea,_17eb,_17ec,_17ed,res){return _17e3([_17e5,_17e6,_17e7,_17eb,_17ec],{localization:res,destroyOnHide:false,editorWidgetClass:_17ed,templateString:"            <div class=\"dijit dijitReset dijitInline dijitLeft epi-legacyFormEditor\">                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"openButton\" data-dojo-attach-event=\"onClick: openEditor\" data-dojo-props=\"label:'${localization.helptext}'\"></div>            </div>",editorWidget:null,value:null,multiple:false,contentLink:null,contentTypeId:null,contentLanguage:null,propertyName:null,_dialog:null,onChange:function(){},postCreate:function(){this.inherited(arguments);lang.mixin(this.params,{contentLink:this.contentLink});},buildRendering:function(){this.inherited(arguments);if(this.output){this.output.set("disabled",true);}},destroy:function(){if(this._dialog){this._dialog.destroyRecursive();}this.inherited(arguments);},_setReadOnlyAttr:function(value){this._set("readOnly",value);this.openButton.set("disabled",value);},_setValueAttr:function(value){this._set("value",value);this.setDisplayValue(value);},_getValueAttr:function(value){if(this.editorWidget){this._set("value",this.editorWidget.get("value",value));}return this.value;},_onChange:function(){var value=this.editorWidget.get("value");this.onChange(value);if(this._dialog&&this._dialog.open){this._dialog.hide();}this.setDisplayValue(value);},_onCancel:function(){this._dialog.hide();},_onDialogHide:function(){this.isShowingChildDialog=false;},openEditor:function(){this.isShowingChildDialog=true;if(!this._dialog||this.destroyOnHide){this._createDialog();}this.editorWidget.set("value",this.value);this._dialog.show();},_createDialog:function(){var _17ee=this.editorWidgetClass;this.editorWidget=new _17ee(this.params);this._dialog=new _17ea({destroyOnHide:this.destroyOnHide,content:this.editorWidget,title:this.editorWidget.title||this.label,defaultActionsVisible:false,dialogClass:"",contentClass:"epi-dialog-fullWidth"});this.connect(this.editorWidget,"onResize",lang.hitch(this,function(){this._dialog.resize();}));this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onCancel","_onCancel");this.connect(this._dialog,"onHide","_onDialogHide");},setDisplayValue:function(value){if(this.output){this.output.set("value",this.localization.helptext);}},focus:function(){this.openButton.focus();}});});},"epi-cms/legacy/EditPropertyWidget":function(){define(["epi","dojo","dijit","dojo/i18n","dojo/string","dojox/html/entities","epi-cms/contentediting/RenderManager","epi-cms/legacy/LegacyDialogWrapper","epi/routes"],function(epi,dojo,dijit,i18n,_17ef,_17f0,_17f1,_17f2,_17f3){return dojo.declare([_17f2],{editorFeatures:null,value:"",contentLink:null,contentTypeId:null,contentLanguage:null,propertyName:null,fullName:null,_reloadOnNextEdit:false,onChange:function(_17f4){},postMixInProperties:function(){this.features=dojo.mixin({width:400,height:30},this.editorFeatures);this.autoFit=true;this.connect(this,"onCallback","_onCallback");this.inherited(arguments);},startup:function(){this.inherited(arguments);var _17f5={moduleArea:"LegacyCMS",path:"edit/EditProperty.aspx",epslanguage:this.contentLanguage,propertyname:this.fullName};dojo.mixin(_17f5,this.contentLink?{id:this.contentLink}:{contentTypeId:this.contentTypeId,parentLink:this.parentLink});this.set("url",_17f3.getActionPath(_17f5));},_setUrlAttr:function(url){this._currentUrl=url;var value=_17f0.encode(dojo.toJson(this.value));var _17f6=_17ef.substitute("<html><body><form method=\"post\" action=\"${0}\" ><input type=\"hidden\" name=\"value\" value=\"${1}\" /></form></body></html>",[url,value]);this.containerIframe.contentDocument.write(_17f6);this.containerIframe.contentDocument.forms[0].submit();},_onCallback:function(_17f7){var _17f8=_17f7.value;var _17f9=dojo.fromJson(_17f8);if(this._oldStringValue===undefined){this._oldStringValue=dojo.toJson(this.value);}if(_17f8!==this._oldStringValue){this._oldStringValue=dojo.toJson(_17f9);this.value=_17f9;this.onChange(_17f9);}else{this.onCancel();}},resize:function(){this.inherited(arguments);if(this._reloadOnNextEdit){this._reloadOnNextEdit=false;this._reloadUrl(true);}},_setValueAttr:function(value){this._set("value",value);if(this._started){this._reloadOnNextEdit=true;}}});});},"epi-cms/legacy/LegacyDialogWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/sniff","dojo/aspect","dojo/on","dojo/topic","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/query","dojo/string","dojo/when","dijit/_Contained","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/a11y","dijit/focus","dijit/form/Button","dijit/layout/_LayoutWidget","epi/Url","epi/shell/widget/_ActionProviderWidget","epi-cms/legacy/_LegacyDialogObject","epi-cms/legacy/LegacyDialogPopup","epi/i18n!epi/cms/nls/episerver.shared.action"],function(array,_17fa,lang,sniff,_17fb,on,topic,_17fc,_17fd,_17fe,_17ff,_1800,has,query,_1801,when,_1802,_1803,_1804,a11y,_1805,_1806,_1807,Url,_1808,_1809,_180a,_180b){return _17fa([_1807,_1803,_1804,_1808,_1802],{_currentUrl:null,dialogArguments:null,callbackArguments:null,features:null,autoFit:false,showCloseButton:false,_isIframeInitialLoad:true,_iframeFocusRegistration:null,_scrollbarWidth:null,_iframeHandles:null,templateString:"        <div style=\"position: relative;\" tabindex=\"0\">            <iframe data-dojo-attach-point=\"containerIframe\" tabindex=\"-1\" frameborder=\"0\" style=\"border: none; position: absolute, top:0, left: 0;\" src=\"about:blank\" ></iframe>        </div>",_mappedButtons:null,postMixInProperties:function(){this.inherited(arguments);this._isIframeInitialLoad=true;this._iframeHandles=[];this.features=lang.mixin({width:320,height:240},this.features);},postCreate:function(){this.inherited(arguments);this._legacyDialog=this._createLegacyDialogObject(lang.hitch(this,function(){this.onCallback.apply(this,arguments);}),this.callbackArguments,this.dialogArguments,window);this._resetIframeContainerSize();},startup:function(){this.inherited(arguments);if(this.containerIframe.attachEvent){this.containerIframe.attachEvent("onload",lang.hitch(this,this._onIframeLoad));}else{this.connect(this.containerIframe,"onload",lang.hitch(this,this._onIframeLoad));}},resize:function(){this.inherited(arguments);if(this._started){this._setIframeSizeFromDomNode();}},_setUrlAttr:function(value){var url=value||"about:blank";this._currentUrl=url;_17fc.set(this.containerIframe,"src",url);},onCallback:function(_180c){},onLoad:function(){},onCancel:function(){},onFocus:function(){this.inherited(arguments);this._focusIframeContent();},onMapDialogButton:function(_180d){return true;},onBeforePerformAction:function(_180e){},getLegacyDialog:function(){return this._legacyDialog;},_focusIframeContent:function(){var _180f=this.containerIframe.contentWindow,doc=_180f&&_180f.document,_1810=(doc&&a11y.getFirstInTabbingOrder(doc))||this.containerIframe;_1805.focus(_1810);},_onIframeLoad:function(){this.own(topic.subscribe("/IsInLegacyWrapper/NeedToBeCloseOnLoad",lang.hitch(this,function(_1811){this.onCancel();})));if(!has("ie")){this._iframeFocusRegistration=_1805.registerIframe(this.containerIframe);}this._focusIframeContent();this._overrideLegacyDialogUtilities();var _1812=this.containerIframe.contentWindow;this._iframeHandles.push(on(_1812,"unload",lang.hitch(this,this._removeIframeHandles)));if(_1812.EPi&&_1812.EPi.ToolButton){this._iframeHandles.push(_17fb.after(_1812.EPi.ToolButton,"SetEnabled",lang.hitch(this,this._toolButtonChanged),true));}this._iframeHandles.push(_17fb.after(this._legacyDialog,"ButtonChanged",lang.hitch(this,this._toolButtonChanged),true));this._mapDialogButtons();this._setTitle();var _1813=query(".epi-contentContainer",this.containerIframe.contentWindow.document)[0];if(_1813){_17fd.add(_1813,"epi-legacyDialog");}if(this.autoFit){this._calculateAndSetContentSize();}this.onResize();this.onResize();if(this.onLoad){this.onLoad.apply(this,arguments);}this._isIframeInitialLoad=false;},_removeIframeHandles:function(){array.forEach(this._iframeHandles,function(_1814){_1814.remove();});this._iframeHandles=[];this._mappedButtons=null;},_setTitle:function(){if(this.dialogTitle){this.title=this.dialogTitle;return;}var title=query("title",this.containerIframe.contentWindow.document)[0];if(title){this.title=_1801.trim(title.innerHTML);}},_getScrollbarWidth:function(){if(this._scrollbarWidth===null){var d=_17fe.create("div",{style:"position:absolute; top:-2000; left:-2000; width:100px; height:100px; overflow:scroll"},document.body);this._scrollbarWidth=d.offsetWidth-d.clientWidth;_17fe.destroy(d);}return this._scrollbarWidth;},_boxToStyle:function(size){return {width:size.w+"px",height:size.h+"px"};},_setIframeSizeFromDomNode:function(){_1800.set(this.containerIframe,this._boxToStyle(_17ff.getContentBox(this.domNode)));},_setContentSize:function(size){_1800.set(this.domNode,this._boxToStyle(size));this._setIframeSizeFromDomNode();},_calculateAndSetContentSize:function(_1815){function _1816(doc,dir){if(doc&&doc.body&&doc.documentElement){return Math.max(doc.documentElement["client"+dir],doc.documentElement["scroll"+dir],doc.documentElement["offset"+dir],doc.body["scroll"+dir],doc.body["offset"+dir]);}return 0;};var _1817=null;try{_1817=this.containerIframe.contentWindow.document;}catch(e){return;}var _1818=(_1817.documentElement.scrollHeight-_1817.documentElement.clientHeight)>0,_1819=_1818&&this.autoFit?this._getScrollbarWidth():0,_181a={w:_1816(_1817,"Width")+_1819,h:_1816(_1817,"Height")};this._setContentSize(_181a);},_resetIframeContainerSize:function(){this._setContentSize({w:this.features.width,h:this.features.height});},_showNode:function(_181b,show){if(!_181b){return;}_1800.set(_181b,"display",show?"":"none");},_toolButtonChanged:function(_181c,_181d){if(typeof _181c==="string"){var _181e=lang.getObject("containerIframe.contentWindow.EPi",false,this);_181c=_181e&&_181e._GetDomObject&&_181e._GetDomObject(_181c);}if(_181c){if(this.hasAction(_181c.id)){this.setActionProperty(_181c.id,"disabled",_181c.disabled);this.setActionProperty(_181c.id,"visible",_181c.style.display!="none");this.setActionProperty(_181c.id,"label",_181c.value||_181c.innerHTML);}var _181f=this._mappedButtons[_181c.id];if(_181f){this._showNode(_181f.containerNode,false);}}},_mapDialogButtons:function(){var _1820=query(this.legacyButtonQuery||"[data-epi-dialog-button]",this.containerIframe.contentWindow.document);this.removeActions(this.getActions());this._mappedButtons={};array.forEach(_1820,function(_1821){var _1822=_17fc.get(_1821,"data-epi-dialog-button"),_1823=null;switch(_1822){case "functioner":return;case "container":_1823=query("[data-epi-dialog-button=\"functioner\"]",_1821)[0];break;default:if(_1821.tagName=="INPUT"){_1823=_1821;if(_17fd.contains(_1823.parentNode,"epi-cmsButton")){_1821=_1823.parentNode;}}else{_1823=query("INPUT",_1821)[0];}break;}this._mappedButtons[_1823.id]={containerNode:_1821,functionNode:_1823};this._showNode(_1821,false);when(this.onMapDialogButton(_1823),lang.hitch(this,function(_1824){if(_1824){var label=_1823.tagName=="INPUT"?_1823.value:_1823.innerHTML,title=_1823.tagName=="INPUT"?_17fc.get(_1823,"title"):_1823.innerHTML,_1825={name:_1823.id,label:label,disabled:_1823.disabled,title:title,action:lang.hitch(this,function(){this.onBeforePerformAction(_1825,_1823);_1823.click();})};this.addActions(_1825);}}));},this);if(this.showCloseButton){this.addActions({name:"close",label:_180b.close,action:lang.hitch(this,this.onCancel)});}},_overrideLegacyDialogUtilities:function(){var _1826=this.containerIframe.contentWindow;if(!_1826.EPi){_1826.EPi={};}_1826.EPi.CreateDialog=lang.hitch(this,this._createLegacyDialogFnc);_1826.EPi.GetDialog=lang.hitch(this,this._getLegacyDialogFnc);},_getLegacyDialogFnc:function(win){if(win){return win.EPi.GetDialog();}return this._legacyDialog;},_createLegacyDialogFnc:function(url,_1827,_1828,_1829,_182a,_182b){var _182c=new _180a({url:url,destroyOnHide:true,dialogArguments:_1829,callbackArguments:_1828,features:_182a});_182c.on("Callback",lang.hitch(this,function(){if(_1827){_1827.apply(this,arguments);}}));_182c.show();return _182c.legacyDialogObject;},_createLegacyDialogObject:function(_182d,_182e,_182f,_1830){var obj=new _1809({callbackMethod:_182d,callbackArguments:_182e,dialogArguments:_182f,_opener:_1830?_1830.top:window.top});try{obj._dialog=this.containerIframe.contentWindow;}catch(e){obj._dialog=null;}return obj;},_reloadUrl:function(_1831){this._isIframeInitialLoad=_1831;if(this._isIframeInitialLoad){this._resetIframeContainerSize();}var url=new Url(this._currentUrl);lang.mixin(url.query,{"epi.preventCache":new Date().valueOf()});this.set("url",url.toString());},cleanup:function(){var _1832=this.containerIframe.contentWindow;_1832.EPi.CreateDialog=null;_1832.EPi.GetDialog=null;if(this._legacyDialog&&!this._legacyDialog.IsCleaned()){this._legacyDialog.Cleanup();}},destroy:function(){this.cleanup();if(this._iframeFocusRegistration){this._iframeFocusRegistration.remove();this._iframeFocusRegistration=null;}this.inherited(arguments);}});});},"epi-cms/legacy/_LegacyDialogObject":function(){define(["dojo/_base/declare","dojo/_base/kernel"],function(_1833,_1834){return _1833(null,{_dialog:null,constructor:function(_1835){this.callbackMethod=_1835.callbackMethod||null;this.callbackArguments=_1835.callbackArguments||null;this.dialogArguments=_1835.dialogArguments||null;this._opener=(_1835.opener?_1835.opener.top:window.top);while(this._opener.EPiOpenedDialog&&this._opener.EPiOpenedDialog._dialog){this._opener=this._opener.EPiOpenedDialog._dialog;}this._opener.EPiOpenedDialog=this;},Close:function(_1836){if(typeof (this.callbackMethod)=="function"){(this.callbackMethod).call(this,_1836,this.callbackArguments);}},ButtonChanged:function(_1837){},Cleanup:function(){var _1838;if(this._dialog!=null){}this._CleanDialog();if(this._opener){this._opener.EPiOpenedDialog=null;}delete this._opener;this.callbackMethod=null;this.callbackArguments=null;delete this.callbackMethod;delete this.callbackArguments;this._cleaned=true;},IsCleaned:function(){return this._cleaned;},_CleanDialog:function(){for(var prop in this){if(prop!="callbackMethod"&&prop!="callbackArguments"&&prop!="_opener"){this[prop]=null;delete this[prop];}}}});});},"epi-cms/widget/CategorySelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/query","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","dijit/Tooltip","dojox/html/entities","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/CategorySelectorDialog","epi/shell/widget/_ValueRequiredMixin","epi/dependency","epi/epi","epi/shell/widget/dialog/Dialog","dojo/text!./templates/CategorySelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.CategorySelector"],function(array,_1839,lang,all,_183a,_183b,_183c,_183d,query,_183e,_183f,_1840,_1841,_1842,_1843,_1844,_1845,_1846,_1847,epi,_1848,_1849,res){return _1839([_183f,_183e,_1840,_1844,_1846],{templateString:_1849,localization:res,multiple:true,value:null,store:null,_categories:null,_categoriesParentsName:{},onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _184a=_1847.resolve("epi.storeregistry");this.store=_184a.get("epi.cms.category");}},destroyDescendants:function(){if(this._tooltip){this._tooltip.destroy();delete this._tooltip;}this.inherited(arguments);},_setValueAttr:function(value){if(!lang.isArray(value)){value=[value];}var _184b=array.filter(value,function(v){return !!v;});this._setValueAndFireOnChange(_184b);if(_184b.length>0){this._set("value",_184b);}else{this._set("value",null);}this._started&&this.validate();},_setValueAndFireOnChange:function(value){if(epi.areEqual(this._categories,value)){return;}this._categories=value;this.onChange(this._categories);this._updateDisplayNode();},_getValueAttr:function(){return this._categories;},_setReadOnlyAttr:function(value){this._set("readOnly",value);_183d.set(this.button.domNode,"display",value?"none":"");_183b.toggle(this.domNode,"dijitReadOnly",value);},focus:function(){this.button.focus();},_createCategoryButton:function(_184c){if(query("div[data-epi-category-id="+_184c.id+"]",this.categoriesGroupContainer).length!==0){return;}var _184d=_183c.create("div",{"class":"dijitReset dijitLeft dijitInputField dijitInputContainer epi-categoryButton"});var _184e=_183c.create("div",{"class":"dijitInline epi-resourceName"});var _184f=_183c.create("div",{"class":"dojoxEllipsis",innerHTML:_1843.encode(_184c.description)});_183c.place(_184f,_184e);_183c.place(_184e,_184d);this._tooltip=new _1842({connectId:_184f,label:_1843.encode(this._getCategoryPath(_184c))});var _1850=_183c.create("div",{"class":"epi-removeButton",innerHTML:"&nbsp;"});_183a.set(_1850,"data-epi-category-id",_184c.id);var _1851=_1850.onClick?"onClick":"onclick";if(!this.readOnly){this.connect(_1850,_1851,lang.hitch(this,this._onRemoveClick));_183c.place(_1850,_184e);}else{_183c.place(_183c.create("span",{innerHTML:"&nbsp;"}),_184e);}_183c.place(_184d,this.categoriesGroupContainer);},_getCategoryPath:function(_1852){if(!_1852.parentsNameCollection||_1852.parentsNameCollection.length==1){return "";}var path=_1852.parentsNameCollection[1];for(i=2;i<_1852.parentsNameCollection.length;i++){path=path+"/"+_1852.parentsNameCollection[i];}return path;},_createNoCategoriesChosenSpan:function(){this.categoriesGroupContainer.innerHTML="";_183c.create("span",{innerHTML:this.localization.nocategorieschosen},this.categoriesGroupContainer);},_updateDisplayNode:function(){this.categoriesGroupContainer.innerHTML="";if(!this._categories||this._categories.length===0){this._createNoCategoriesChosenSpan();return;}this._categoriesParentsName={};var _1853=[];this._categories.forEach(function(_1854){_1853.push(this.store.refresh(_1854));},this);all(_1853).then(lang.hitch(this,function(_1855){_1855.forEach(function(_1856){if(_1856&&_1856.visible){this._categoriesParentsName[_1856.id]=_1856.parentsNameCollection;this._createCategoryButton(_1856);}else{var _1857=this._categories.indexOf(_1856.id);if(_1857!=-1){this._categories.splice(_1857,1);}}if(this._categories.length===0){this._createNoCategoriesChosenSpan();}},this);}));},_onRemoveClick:function(arg){if(!this._categories){return;}var _1858=parseInt(_183a.get(arg.target,"data-epi-category-id"),10);var _1859=this._categories.indexOf(_1858);if(_1859==-1){return;}var _185a=lang.clone(this._categories);_185a.splice(_1859,1);this.set("value",_185a);},_getCategoriesParentsNameClone:function(){var _185b={};array.forEach(this._categories,lang.hitch(this,function(_185c){_185b[_185c]=this._categoriesParentsName[_185c];}));return _185b;},_onShow:function(){this.categorySelectorDialog.set("value",lang.clone(this._categories));this.categorySelectorDialog.set("selectedCategoriesData",this._getCategoriesParentsNameClone());this.isShowingChildDialog=true;this.categorySelectorDialog.onShow();},_onExecute:function(){var _185d=this.categorySelectorDialog.get("value");this.set("value",_185d);},_isEmptyArray:function(array){return !array||array.length===0;},_onDialogHide:function(){this.focus();this.isShowingChildDialog=false;},_createDialog:function(){this.categorySelectorDialog=new _1845({rootCategory:this.root});this.dialog=new _1848({title:this.localization.popuptitle,content:this.categorySelectorDialog,dialogClass:"epi-dialog-portrait"});this.connect(this.dialog,"onExecute","_onExecute");this.connect(this.dialog,"onShow","_onShow");this.connect(this.dialog,"onHide","_onDialogHide");this.dialog.startup();},_onButtonClick:function(){if(!this.dialog){this._createDialog();}this.dialog.show(true);}});});},"epi-cms/widget/CategorySelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/dependency","epi-cms/widget/CategoryTree"],function(array,_185e,lang,_185f,_1860,_1861,_1862,epi,_1863,_1864){return _185e([_1860,_185f,_1861],{templateString:"<div class=\"epi-categorySelectorDialog\">                             <div data-dojo-attach-point=\"categoryTree\" data-dojo-type=\"epi-cms/widget/CategoryTree\" data-dojo-props=\"rootCategory: ${rootCategory}\"></div>                         </div>",selectedCategoriesData:null,_selectedCategoryIds:null,rootCategory:null,onShow:function(){if(!this._selectedCategoryIds&&!this.categoryTree){return;}this.categoryTree.set("selectedNodeIds",this._selectedCategoryIds);this.categoryTree.set("selectedNodeData",this.selectedCategoriesData);},_setValueAttr:function(value){this._selectedCategoryIds=value;if(!this._selectedCategoryIds){this._selectedCategoryIds=[];}},_getValueAttr:function(){return this.categoryTree.get("selectedNodeIds");}});});},"epi-cms/widget/CategoryTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/Tree","epi","epi-cms/widget/_CategoryTreeNode","epi-cms/widget/CategoryTreeStoreModel"],function(array,_1865,lang,Tree,epi,_1866,_1867){return _1865([Tree],{showRoot:false,selectedNodeIds:null,selectedNodeData:null,constructor:function(){this.selectedNodeIds=[];this.selectedNodeData={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new _1867({rootCategory:this.rootCategory});this.persist=false;}},postCreate:function(){this.inherited(arguments);this.connect(this,"onOpen",lang.hitch(this,this._onNodeOpen));this.connect(this,"onClose",lang.hitch(this,this._onNodeClose));this.watch("selectedNodeData",lang.hitch(this,this._loadSelectedNodes));},startup:function(){this.inherited(arguments);this.dndController.singular=true;},buildNodeFromTemplate:function(args){return new _1866(args);},getNodeById:function(_1868){var nodes=this.getNodesByItem(_1868.toString());if(!nodes){return null;}return nodes[0];},_getTotalSelectedNodes:function(_1869,_186a,_186b){if(!_1869||!_1869.item||!_1869.item.hasChildren||!lang.isArray(_186a)||_186a.length===0||!_186b){return 0;}var _186c=0,_186d=[],_186e=[],_186f=lang.clone(_1869.item.parentsNameCollection);var _1870=function(_1871){if(lang.isArray(_1871)&&_1871.length>0){_1871.pop();}};_186f[_186f.length-1]=_1869.item.name;array.forEach(_186a,function(_1872){_186d=lang.clone(_186b[_1872]);_1870(_186d);_186e=lang.clone(_186d);lang.mixin(_186e,_186f);if(lang.isArray(_186d)&&epi.areEqual(_186d,_186e)){_186c++;}},this);return _186c;},_setTotalSelectedNodes:function(_1873){if(_1873){_1873.set("totalSelectedNodes",this._getTotalSelectedNodes(_1873,this.selectedNodeIds,this.selectedNodeData));array.forEach(_1873.getChildren(),function(_1874){if(_1874&&_1874.item&&_1874.item.hasChildren){if(_1874.isExpanded){this._setTotalSelectedNodes(_1874);}else{_1874.set("totalSelectedNodes",this._getTotalSelectedNodes(_1874,this.selectedNodeIds,this.selectedNodeData));}}},this);}},_loadSelectedNodes:function(){this.expandChildrenDeferred.then(lang.hitch(this,function(){this.set("toggleSelectNodes",this.rootNode,this.selectedNodeIds);this._setTotalSelectedNodes(this.rootNode);}));},_onNodeCreated:function(node){node.set("totalSelectedNodes",this._getTotalSelectedNodes(node,this.selectedNodeIds,this.selectedNodeData));},_onNodeSelectChanged:function(_1875,item){if(!this.getNodeById(item.id)){return;}var index=this.selectedNodeIds.indexOf(item.id),exist=index!=-1;if(_1875&&!exist){this.selectedNodeIds.push(item.id);this.selectedNodeData[item.id]=item.parentsNameCollection;}if(!_1875&&exist){this.selectedNodeIds.splice(index,1);this.selectedNodeData[item.id]={};}},_onNodeOpen:function(item,node){this.set("toggleSelectNodes",node,this.selectedNodeIds);this._setTotalSelectedNodes(node);},_onNodeClose:function(item,node){this._setTotalSelectedNodes(node);},_setToggleSelectNodesAttr:function(_1876,_1877){if(!_1876||!lang.isArray(_1877)){return;}var _1878=false;array.forEach(_1876.getChildren(),function(_1879){if(_1879){_1878=_1877.indexOf(_1879.item.id)!=-1;_1879.set("checked",_1878);if(_1879.hasChildren()){this.set("toggleSelectNodes",_1879,_1877);}}},this);},_createTreeNode:function(args){var node=this.buildNodeFromTemplate(args);node.connect(node,"onNodeSelectChanged",lang.hitch(this,function(_187a,item){this._onNodeSelectChanged(_187a,item);}));this._onNodeCreated(node);return node;}});});},"epi-cms/widget/_CategoryTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/keys","dojo/text!./templates/_CategoryTreeNode.html","dijit/_TemplatedMixin","dijit/form/CheckBox","epi","epi-cms/widget/_ContentTreeNode"],function(_187b,lang,_187c,_187d,keys,_187e,_187f,_1880,epi,_1881){return _187b([_1881,_187f],{templateString:_187e,_checkbox:null,checked:false,postCreate:function(){this.inherited(arguments);_187c.add(this.iconNode,"dijitHidden");this._checkbox=this._createCheckbox();},_createCheckbox:function(){if(!this.item.selectable){return;}var _1882=_187d.create("span",{"class":"epi-checkboxNode dijitTreeExpando"});var _1883=new _1880({name:"checkboxCategory",value:this.item.id,tabIndex:-1,checked:false,onChange:lang.hitch(this,function(_1884){this.onNodeSelectChanged(_1884,this.item);})});_1883.placeAt(_1882);_187d.place(_1882,this.expandoNode,"after");return _1883;},onNodeSelectChanged:function(_1885,item){},_onLabelClick:function(){if(!this._checkbox){return;}this.set("checked",!this._checkbox.checked);},_onLabelKeyUp:function(evt){if(evt.keyCode==keys.SPACE||evt.keyCode==keys.ENTER){this._onLabelClick();}},_setCheckedAttr:function(_1886){if(!this._checkbox){return;}this._set("checked",_1886);this._checkbox.set("checked",_1886);},_setTotalSelectedNodesAttr:function(_1887){var _1888=this.tree.model.getLabel(this.item),_1889=!this.isExpanded&&_1887>0;this.labelNode.innerHTML=_1889?_1888+" ("+_1887+")":_1888;}});});},"url:epi-cms/widget/templates/_CategoryTreeNode.html":"<div class=\"dijitTreeNode epi-categoryTreeNode\" role=\"presentation\">\r\n    <a href=\"#\" tabIndex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel epi-categoryTreeLabel\" role=\"treeitem\"\r\n                  tabindex=\"-1\" aria-selected=\"false\" data-dojo-attach-event=\"onclick:_onLabelClick, keyup:_onLabelKeyUp\">\r\n            </span>\r\n        </span>\r\n    </a>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/CategoryTreeStoreModel":function(){define(["dojo","epi/dependency","epi/routes"],function(dojo,_188a,_188b){return dojo.declare(null,{store:null,rootCategory:undefined,constructor:function(args){dojo.mixin(this,args);if(!this.store){var _188c=_188a.resolve("epi.storeregistry");this.store=_188c.get("epi.cms.category");}},getRoot:function(_188d){dojo.when(this.store.get(this.rootCategory),_188d);},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_188e,_188f){var id=this.getIdentity(_188e),_1890=this.store.query({id:id,query:"getchildren"});_1890.then(function(_1891){_188e.children=_1891;_188f(_1891);});},getIdentity:function(item){return this.store.getIdentity(item);},getLabel:function(item){return item.description;}});});},"url:epi-cms/widget/templates/CategorySelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer epi-categorySelector\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"categoriesGroupContainer\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode epi-categoriesGroup\">\r\n    </div> \r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" class=\"epi-categoriesSelectorButton\" data-dojo-props=\"label:'+'\"></div>\r\n</div>","epi-cms/widget/ContentSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/query","dojo/string","dojo/when","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/form/Button","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_Droppable","epi-cms/widget/_HasClearButton","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/ContentSelectorDialog","dojo/text!./templates/ContentSelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselector"],function(array,_1892,lang,_1893,_1894,_1895,query,_1896,when,_1897,_1898,_1899,_189a,_189b,_189c,_189d,_189e,_189f,_18a0,_18a1,_18a2,_18a3,_18a4,_18a5,_18a6,_18a7,_18a8,_18a9){return _1892([_1899,_1898,_189a,_1897,_18a5,_18a6,_18a4,_189f],{templateString:_18a8,roots:null,value:null,required:false,missingMessage:_18a9.requiredmessage,tooltipPosition:[],contentLink:null,permanentLink:null,canSelectOwnerContent:false,accessLevel:_18a3.accessLevel.Read,showAllLanguages:true,_setSelectedContentNameAttr:function(value){query(this.selectedContentNameNode).text(value);},_setDisabledAttr:function(value){this.inherited(arguments);this.button.set("disabled",value);this._set("disabled",value);},_setSelectedContentLinkAttr:{node:"selectedContentLinkNode",type:"innerHTML"},postMixInProperties:function(){this.inherited(arguments);var _18aa=_189d.resolve("epi.storeregistry");this._store=_18aa.get("epi.cms.content.light");if(!this.roots){var _18ab=this.contentRepositoryDescriptors||_189d.resolve("epi.cms.contentRepositoryDescriptors");var _18ac=_18ab[this.repositoryKey];this.roots=_18ac.roots;}this.nameAttrSetting=this.name?("name=\""+this.name.replace(/"/g,"&quot;")+"\""):"";},postCreate:function(){this.inherited(arguments);if(!this.value){this._updateDisplayNode(null);}},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1895.set(this.button.domNode,"display",value?"none":"");_1895.set(this.clearButton,"display",value?"none":"");_1894.toggle(this.domNode,"dijitReadOnly",value);},_setValueAttr:function(value){this._setValueAndFireOnChange(value);},_getDialog:function(){if(this.dialog&&this.dialog.domNode){return this.dialog;}var title=_18a9.title;if(this.allowedTypes&&this.allowedTypes.length===1){var name=_189e.getResourceValue(this.allowedTypes[0],"name");if(name){title=_1896.substitute(_18a9.format,[name]);}}this.contentSelectorDialog=new _18a7({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:false,roots:this.roots,allowedTypes:this.allowedTypes,showAllLanguages:this.showAllLanguages});this.dialog=new _18a0({title:title,dialogClass:"epi-dialog-portrait",content:this.contentSelectorDialog,destroyOnHide:true});this.connect(this.contentSelectorDialog,"onChange","_setDialogButtonState");this.connect(this.dialog,"onExecute","_onDialogExecute");this.connect(this.dialog,"onHide","_onDialogHide");return this.dialog;},_isContentAllowed:function(_18ad){var _18ae=array.indexOf(this.allowedTypes,_18ad)!==-1;if(!_18ae){_18ae=array.some(this.allowedTypes,function(type){return _189e.isBaseTypeIdentifier(_18ad,type);});}return _18ae;},_onButtonClick:function(){when(this._getContentData(this.contentLink),lang.hitch(this,function(_18af){this.canSelectOwnerContent=_18af&&this._isContentAllowed(_18af.typeIdentifier);var _18b0=this._getDialog();this.isShowingChildDialog=true;var _18b1;if(this.value){_18b1=this._convertValueToContentReference(this.value);}if(_18b1){_18b1=_18b1.createVersionUnspecificReference().toString();}this.contentSelectorDialog.set("value",_18b1);_18b0.show();}));},_onDialogExecute:function(){var value=this.contentSelectorDialog.get("value");this._setValueAndFireOnChange(value);},_convertValueToContentReference:function(value){return new _18a1(value);},_onDialogHide:function(){this.isShowingChildDialog=false;},_setValueAndFireOnChange:function(value){var _18b2=value==="-"?this.contentLink:value;this.set("permanentLink",null);when(this._getContentData(_18b2),lang.hitch(this,function(_18b3){var _18b4=this.value!==_18b2;this.value=_18b2;this.input.value=this.value;this._started&&this.validate();this._updateDisplayNode(_18b3);if(_18b4){this.onChange(_18b2);}if(_18b3){this.set("permanentLink",_18a2.toPermanentLink(_18b3));}}));},_getContentData:function(_18b5){if(!_18b5){return null;}return this._store.get(_18b5);},_getValueAttr:function(){return this.value;},_onFocus:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},_onBlur:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},focus:function(){if(!this.button.disabled&&this.button.focusNode&&this.button.focusNode.focus){try{_189b.focus(this.button.focusNode);}catch(e){}}},onChange:function(value){},_updateDisplayNode:function(_18b6){if(_18b6){_1894.remove(this.domNode,"epi-noValue");_1894.remove(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",_18b6.name);this.set("selectedContentLink",new _18a1(_18b6.contentLink).id);}else{_1894.add(this.domNode,"epi-noValue");_1894.add(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",_18a9.helptext);this.set("selectedContentLink","");}},reset:function(){this.set("value",null);},_setDialogButtonState:function(_18b7){var self=this;if(!_18b7){return;}when(self._store.get(_18b7),function(_18b8){self.dialog.definitionConsumer.setItemProperty(self.dialog._okButtonName,"disabled",!_18a3.hasAccess(_18b8.accessMask,self.accessLevel));});}});});},"epi-cms/widget/_Droppable":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/shell/dnd/Target"],function(_18b9,lang,when,_18ba){return _18b9(null,{dropAreaNode:null,allowedDndTypes:null,postCreate:function(){this.inherited(arguments);var _18bb=this.own(new _18ba(this.dropAreaNode,{accept:this.allowedDndTypes,createItemOnDrop:false,readOnly:this.readOnly,skipForm:true}))[0];this.connect(_18bb,"onDropData","_onDropData");},onDropping:function(){},onDrop:function(){},_onDropData:function(_18bc,_18bd,nodes,copy){var _18be=_18bc?(_18bc.length?_18bc[0]:_18bc):null;if(_18be){this.onDropping();when(_18be.data,lang.hitch(this,function(_18bf){var value;if(this.dndSourcePropertyName){value=_18bf[this.dndSourcePropertyName];}else{value=_18bf;}this.set("value",value);this.onDrop();}));}}});});},"epi-cms/widget/_HasClearButton":function(){define(["epi","dojo","dijit"],function(epi,dojo,dijit){return dojo.declare(null,{postCreate:function(){this.inherited(arguments);var _18c0=this.clearButton.onClick?"onClick":"onclick";dojo.connect(this.clearButton,_18c0,dojo.hitch(this,this.clearValue));},clearValue:function(){if(this.readOnly){return;}var value=this.getEmptyValue();this.set("value",value);},getEmptyValue:function(){return null;}});});},"url:epi-cms/widget/templates/ContentSelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"displayNode, dropAreaNode, stateNode\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode\">\r\n        <div class=\"dijitReset dijitLeft dijitInputField dijitInputContainer\">\r\n            <div data-dojo-attach-point=\"clearButton\" class=\"epi-clearButton\">&nbsp;</div>\r\n            <div data-dojo-attach-point=\"resourceName\" class=\"dijitInline epi-resourceName dojoxEllipsis\"/>\r\n                <span data-dojo-attach-point=\"selectedContentNameNode\"></span> <span data-dojo-attach-point=\"selectedContentLinkNode\"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <input type=\"hidden\" ${!nameAttrSetting} value=\"${value}\" data-dojo-attach-point=\"input\"/>\r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" data-dojo-props=\"label:'...'\"></div>\r\n</div>","epi-cms/widget/HyperLinkSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dom-style","dojo/dom-construct","dojo/when","dojo/DeferredList","dijit/_Widget","epi/string","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/_HyperLinkFieldItem","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel"],function(array,_18c1,lang,_18c2,_18c3,_18c4,when,_18c5,_18c6,_18c7,_18c8,_18c9,_18ca){return _18c1([_18c6,_18c8],{value:null,_dfCreateWidget:null,modelClassName:_18ca,modelBindingMap:{"wrapperSettings":["wrapperSettings"],"selectedWrapper":["selectedWrapper"]},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _18cb=_18c1(this.modelClassName);this.model=new _18cb({providers:this.providers});}},_setSelectedWrapperAttr:function(_18cc){if(!_18cc){return;}array.forEach(this.wrappers,function(_18cd){_18cd.set("selected",false);if(_18cd.inputWidget){_18cd.inputWidget.set("state","");}});if(_18cc.inputWidget){_18cc.set("selected",true);}},_setWrapperSettingsAttr:function(_18ce){var _18cf=[];array.forEach(_18ce,lang.hitch(this,function(_18d0){_18d0.groupname+=this.id;var _18d1=new _18c9(_18d0);if(_18d0.invisible){_18c3.set(_18d1.domNode,{display:"none"});}_18d1.on("radioButtonChange",lang.hitch(this,function(){this.set("selectedWrapper",_18d1);_18d1.focus();}));_18cf.push(_18d1);}));this.set("wrappers",_18cf);},_setWrappersAttr:function(_18d2){this._set("wrappers",_18d2);if(this._dfCreateWidget){this._dfCreateWidget.cancel();this._dfCreateWidget=null;}var _18d3=[],_18d4=lang.hitch(this,function(ctor,_18d5){var child=new ctor(_18d5.settings);_18d5.addChild(child);_18d5.set("required",this.required);});array.forEach(_18d2,function(_18d6){var df=new _18c2();_18d3.push(df);var ctor=lang.getObject(_18d6.widgetType);if(!ctor){require([_18c7.slashName(_18d6.widgetType)],function(ctor){_18d4(ctor,_18d6);df.resolve();});}else{_18d4(ctor,_18d6);df.resolve();}});this._dfCreateWidget=new _18c5(_18d3);when(this._dfCreateWidget,lang.hitch(this,function(_18d7){array.forEach(_18d2,function(_18d8){_18c4.place(_18d8.domNode,this.domNode);},this);this.onSelectorsCreated(this);if(this.value){this._setValueForWidgets(this.value);}else{if(this.wrappers&&this.wrappers.length>0){this.wrappers[0].set("selected",true);}}}));},onSelectorsCreated:function(_18d9){},_getSelectedWrapper:function(){return array.filter(this.wrappers,function(_18da){return (_18da.inputWidget&&_18da.get("selected"));})[0];},_getValueAttr:function(){var _18db=this._getSelectedWrapper();if(_18db){if(_18db.inputWidget&&_18db.settings.isContentLink){this.value=_18db.inputWidget.get("permanentLink");}else{this.value=_18db.get("value");}}return this.value;},_setValueAttr:function(value){this._set("value",value);this._setValueForWidgets(value);},_setValueForWidgets:function(value){array.forEach(this.wrappers,function(_18dc){_18dc.set("value",null);});if(!value){return;}when(this.model.getContentData(value),lang.hitch(this,function(_18dd){if(_18dd){array.every(this.wrappers,function(_18de){if(_18de&&_18de.settings.isContentLink){if(array.some(_18de.settings.allowedTypes,lang.hitch(this,function(_18df){return this.model.isBaseTypeIdentifier(_18dd.typeIdentifier,_18df);}))){_18de.set("value",_18dd.contentLink);var _18e0=_18dd.missingLanguageBranch&&_18dd.missingLanguageBranch.isTranslationNeeded;_18de.set("showAllLanguages",_18e0);this.set("selectedWrapper",_18de);return false;}}return true;},this);}else{array.every(this.wrappers,function(_18e1){if(_18e1&&!_18e1.settings.isContentLink){var _18e2=_18e1.inputWidget;if(_18e2&&_18e2.validator(value,_18e2.constraints)){_18e1.set("value",value);this.set("selectedWrapper",_18e1);return false;}}return true;},this);}}));},validate:function(){var _18e3=this._getSelectedWrapper();return _18e3?_18e3.validate():false;},focus:function(){var _18e4=this._getSelectedWrapper();if(_18e4){_18e4.focus();}},reset:function(){this.set("value",null);}});});},"epi-cms/widget/_HyperLinkFieldItem":function(){define(["dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin","dijit/_Container","dijit/_Contained","dojo/text!./templates/_HyperLinkFieldItem.html"],function(_18e5,_18e6,_18e7,_18e8,_18e9,_18ea){return _18e5([_18e6,_18e8,_18e9,_18e7],{templateString:_18ea,inputWidget:null,settings:[],_onRadioButtonChange:function(evt){this.onRadioButtonChange(this,evt);},onRadioButtonChange:function(_18eb,evt){},addChild:function(child){this.inputWidget=child;this.inherited(arguments);},validate:function(){return this.inputWidget?this.inputWidget.validate():false;},_setValueAttr:function(value){if(this.inputWidget){this.inputWidget.set("value",value);}},_getValueAttr:function(){return this.inputWidget.get("value");},_setRequiredAttr:function(val){if(this.inputWidget){this.inputWidget.set("required",val);}},_setSelectedAttr:function(value){if(this.inputWidget){this.inputWidget.set("disabled",!value);this.radioNode.checked=value;}},_getSelectedAttr:function(){return this.radioNode.checked;},_setShowAllLanguagesAttr:function(val){if(this.inputWidget){this.inputWidget.set("showAllLanguages",val);}},focus:function(){if(this.inputWidget){this.inputWidget.focus();}}});});},"url:epi-cms/widget/templates/_HyperLinkFieldItem.html":"<div class='epi-formsRow epi-hyperLink'>\r\n    <input type='radio' name='${groupname}' id='${id}_${name}' value='${name}' data-dojo-type='dijit.form.RadioButton' data-dojo-attach-event='onchange:_onRadioButtonChange' data-dojo-attach-point='radioNode'/>\r\n    <label for='${id}_${name}'>${displayName}</label>\r\n    <div class='epi-formsWidgetWrapper' data-dojo-attach-point='containerNode'></div>\r\n</div>","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/io-query","dojo/dom-style","dojo/dom-construct","dojo/when","epi/string","epi/shell/TypeDescriptorManager","epi/shell/_StatefulGetterSetterMixin","epi-cms/core/PermanentLinkHelper"],function(array,_18ec,lang,_18ed,_18ee,_18ef,_18f0,when,_18f1,_18f2,_18f3,_18f4){return _18ec([_18ed,_18f3],{_setProvidersAttr:function(_18f5){var _18f6=[];array.forEach(_18f5,lang.hitch(this,function(_18f7){_18f6.push({name:_18f7.name,displayName:_18f7.displayName?_18f7.displayName:_18f7.name,title:_18f7.title?_18f7.title:"",groupname:"hyperLink_",widgetType:_18f7.widgetType,invisible:_18f7.invisible,settings:{roots:_18f7.roots,allowedTypes:_18f7.linkableTypes,isContentLink:(_18f7.linkableTypes&&_18f7.linkableTypes.length>0),allowedDndTypes:[],disabled:true,value:null}});}));this.set("wrapperSettings",_18f6);},getContentData:function(value){if(value){return _18f4.getContent(value,{"allLanguages":true});}return null;},isBaseTypeIdentifier:function(type,base){return _18f2.isBaseTypeIdentifier(type,base);}});});},"epi-cms/widget/overlay/ContentArea":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dnd/Manager","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/json","dojo/on","dojo/query","dojo/when","dijit/_Container","dijit/registry","epi/dependency","epi/shell/widget/overlay/Item","epi/shell/dnd/Source","epi/shell/dnd/_MarkerSource","epi-cms/widget/overlay/Block","epi-cms/contentediting/editors/ContentBlockEditor","epi-cms/widget/command/CreateContentFromSelector","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/editors/_TextWithActionLinksMixin","dojo/text!../templates/ContentArea.html"],function(array,_18f8,lang,_18f9,_18fa,_18fb,_18fc,_18fd,_18fe,_18ff,json,on,query,when,_1900,_1901,_1902,Item,_1903,_1904,Block,_1905,_1906,_1907,_1908,_1909,_190a,_190b){return _18f8([Item,_1900,_190a],{templateString:_190b,layout:"",defaultWatchKey:"",allowedDndTypes:null,blockClass:Block,modelClass:_1908,dndSourceClass:_18f8([_1903,_1904]),dndSourceSettings:null,_supressValueChanged:false,constructor:function(){this._watches={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new this.modelClass();}this.model.set("value",lang.clone(this.contentModel.get(this.name)));this.contentModel.watch(this.name,lang.hitch(this,function(name,_190c,value){if(epi.areEqual(value,this.model.get("value"))){return;}this.refresh();}));this._pendingPersonalizations=[];this._contentStore=this._contentStore||_1902.resolve("epi.storeregistry").get("epi.cms.contentdata");this._ownerContentLink=this.contentModel.get("icontent_contentlink");},buildRendering:function(){this.inherited(arguments);this.setupActionLinks(this.actionsNodeControls);},postCreate:function(){this.inherited(arguments);this.own(on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._onChildrenChanged();if(this._pendingPersonalizations.length>0){this._pendingPersonalizations=[];this.onClick(this);}})));this._setupDirectionality();this._setupBlocks();},destroy:function(){this.inherited(arguments);for(var i in this._watches){this._watches[i].remove();}this._watches={};this._source.destroy();if(this.textWithLinks){this.textWithLinks.destroy();this.textWithLinks=null;}},isCreateLinkVisible:function(){var _190d=new _18fa();when(this._contentStore.get(this._ownerContentLink),function(_190e){var _190f=_1907.isActionAvailable(_190e,_1907.action.Create,_1907.providerCapabilities.Create,true);_190d.resolve(_190f);});return _190d.promise;},_setHasChildrenAttr:function(value){this._set("hasChildren",value);},_getMinHeightAttr:function(){return _18ff.get(this.sourceItemNode,"minHeight");},onValueChange:function(_1910){},updatePosition:function(_1911){if(!this.canUpdatePosition()){return false;}var _1912=this.inherited(arguments),_1913,_1914,_1915,_1916;if(this.hasChildren){this._setupDirectionality();this._positionBlocks();}_1915=this.get("minHeight");_18ff.set(this.sourceItemNode,"minHeight","");_1913=Math.floor(_18fe.position(this.actionsNodeControls,false).h);_1914=_1913>0?_1913:this.get("actionNodeHeight")||0;_1916=Math.floor(_18fe.position(this.sourceItemNode,false).h);if(_1914===0){this._clearPosition();return _1912;}_1914&&(this.set("actionNodeHeight",_1914));_18ff.set(this.sourceItemNode,"minHeight",(_1916+_1914)+"px");_18ff.set(this.actionsNodeControls,"marginTop",(_1916)+"px");if(_1915===_1916+_1914){return _1912;}return true;},refresh:function(){this._actionNodeHeight=null;this.destroyDescendants();this._source.clearItems();if(this._source.anchor){_18fd.destroy(this._source.anchor);}for(var i in this._watches){this._watches[i].remove();}this._watches={};this._supressValueChanged=true;this.model.set("value",lang.clone(this.contentModel.get(this.name)));this._setupBlocks();this.inherited(arguments);this._supressValueChanged=false;},_setupDnd:function(){var _1917=lang.mixin({_skipStartup:true,creator:lang.hitch(this,"_creator"),copyOnly:false,alwaysCopy:false,dropParent:this.containerNode,type:this.allowedDndTypes,accept:this.allowedDndTypes,singular:true,propertyName:this.name},this.dndSourceSettings||{});this._source=new this.dndSourceClass(this.domNode,_1917);this._source.defaultCheckAcceptance=this._source.checkAcceptance;this._source.checkAcceptance=lang.hitch(this,this._checkAcceptance),this.own(_18f9.after(this._source,"onDropData",lang.hitch(this,"_onDrop"),true));this.own(_18f9.before(this._source,"delItem",lang.hitch(this,"_onDndItemRemoved"),true));},_creator:function(item){var node=_18fd.create("div"),_1918;if(typeof item.getNormalizedData=="function"){_1918=item.getNormalizedData();}_1918=_1918?_1918.data:item;return {node:node,type:this.allowedDndTypes,data:_1918};},_setupBlocks:function(){var _1919=this._getBlockNodes();array.forEach(_1919,this._createBlock,this);this.set("hasChildren",_1919.length>0);},_createBlock:function(node){var id=_18fc.get(node,"data-epi-block-id"),info=json.parse(_18fc.get(node,"data-epi-block-personalization")),_191a=info?info.contentGroup:this.defaultWatchKey,model=this.model;if(_191a){model=model.getChild({name:_191a});}model=model&&model.getChild(lang.mixin({contentLink:id},info));if(!model){return;}var block=new this.blockClass({disabled:this.disabled,viewModel:model,sourceItemNode:node});this.addChild(block);this._watches["block_"+id+"_ensurePersonalization"]=model.watch("ensurePersonalization",lang.hitch(this,function(_191b,_191c,_191d){var index=array.indexOf(this._pendingPersonalizations,model);if(_191d){if(index<0){this._pendingPersonalizations.push(model);}}else{if(index>0){this._pendingPersonalizations.splice(index,1);}}}));model.set("visible",true);this._source.setItem(block.domNode.id,{name:model.name,data:model,type:this.allowedDndTypes});},_onChildrenChanged:function(){this.onValueChange({propertyName:this.name,value:this.model.get("value")});},_positionBlocks:function(){var _191e=this.getChildren(),_191f=[],_1920=this.get("position");array.forEach(_191e,function(_1921,i){var _1922,_1923,_1924;if(!_191f[i]){_191f[i]=_18fe.position(_1921.sourceItemNode,false);}_1922=_191f[i];_1922.x-=_1920.x;_1922.y-=_1920.y;_1921.resize(_1922);},this);},_checkAcceptance:function(_1925,nodes){if(this.readOnly){return false;}var _1926=_1901.getEnclosingWidget(nodes[0]);if(_1926.isInstanceOf(_1905)){return false;}return this._source.defaultCheckAcceptance(_1925,nodes);},_getBlockNodes:function(){var _1927=query("[data-epi-block-id]",this.sourceItemNode);var _1928=query("[data-epi-block-id] [data-epi-block-id]",this.sourceItemNode);return array.filter(_1927,function(node){return _1928.indexOf(node)===-1;});},_setupDirectionality:function(){var _1929;if(/vertical|horizontal/.test(this.layout)){_1929=this.layout==="horizontal";}else{_1929=array.some(this._getBlockNodes(),function(node){var style=_18ff.getComputedStyle(node),_192a=/left|right/.test(style.cssFloat),_192b=/inline|inline-block/.test(style.display);return _192a||_192b;});}this._source.setHorizontal(_1929);},executeAction:function(_192c){if(_192c==="createnewblock"){var _192d=new _1906({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,canChangeLocalAssetName:false,treatAsSecondaryView:true});_192d.set("model",{save:lang.hitch(this,function(block){var value=lang.clone(this.model.get("value"),true)||[];value.push(block);this.onValueChange({propertyName:this._source.propertyName,value:value});})});_192d.execute();}else{this.inherited(arguments);}},_onDrop:function(data,_192e,nodes,_192f){var model=this.model,_1930=this._source;if(_1930.anchor===_1930.targetAnchor){return;}var index=array.indexOf(_1930.getAllNodes(),_1930.targetAnchor)+(_1930.before?-1:1),_1931=array.filter(model.getChildren(),function(child){return child.get("visible");});index=model.indexOf(_1931[index-1])+1;if(!lang.isArray(data)){data=[data];}if(_1930==_192e&&!_192f){model.modify(function(){array.forEach(data,function(item,i){var data=item.data;if(data.contentGroup){data=model.getChild({name:data.contentGroup});}model.move(data,index+i);});});}else{model.modify(function(){array.forEach(data,function(item,i){var block=new _1909(item.data);model.addChild(block,index+i);});});}},_onDndItemRemoved:function(key){var data=this._source.getItem(key);if(!lang.isArray(data)){data=[data];}this.model.modify(function(){array.forEach(data,function(item){this.model.removeChild(item.data);},this);},this);}});});},"epi/shell/dnd/_MarkerSource":function(){define("epi/shell/dnd/_MarkerSource",["dojo/_base/array","dojo/_base/declare","dojo/dnd/Manager","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style"],function(array,_1932,_1933,_1934,_1935,_1936,_1937){return _1932(null,{_markerNode:null,markerTemplateString:"<div class=\"dojoDndItem-marker\"><div class=\"epi-dndDropMarker\"></div></div>",markerDelay:150,markOnlyAllowedDropLocations:false,_calculatedCurrent:false,destroy:function(){this.inherited(arguments);this.targetAnchorSibling=null;if(this._markerNode){_1935.destroy(this._markerNode);this._markerNode=null;}},setHorizontal:function(_1938){_1934.toggle(this.node,"dojoDndHorizontal",_1938);this.horizontal=_1938;},onMouseOver:function(e){this.inherited(arguments);this._calculatedCurrent=false;},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}dojo.dnd.Source.superclass.onMouseMove.call(this,e);var m=_1933.manager();if(!this.isDragging){if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){var nodes=this.getSelectedNodes();if(nodes.length){m.startDrag(this,nodes,this.copyState(dojo.isCopyKey(e),true));}}}if(this.isDragging){var _1939=false;if(this.current&&!this._calculatedCurrent){if(!this.targetBox||this.targetAnchor!=this.current){this.targetBox=_1936.position(this.current,true);}if(this.horizontal){_1939=(e.pageX-this.targetBox.x)<(this.targetBox.w/2);}else{_1939=(e.pageY-this.targetBox.y)<(this.targetBox.h/2);}}else{_1939=this._calculateCurrent({x:e.pageX,y:e.pageY});}if(this.current!=this.targetAnchor||_1939!=this.before){this._markTargetAnchor(_1939);m.canDrop(!this.current||m.source!=this||!this.markOnlyAllowedDropLocations||!(this.current.id in this.selection));}}},_calculateCurrent:function(point){var _193a=[],_193b,_193c;function _193d(_193e,_193f){function _1940(value){return value*value;};return Math.sqrt(_1940(_193e.x-_193f.x)+_1940(_193e.y-_193f.y));};this.getAllNodes().forEach(function(node){var pos=_1936.position(node);pos.x2=pos.x+pos.w;pos.xCentered=pos.x+pos.w/2;pos.y2=pos.y+pos.h;pos.yCentered=pos.y+pos.h/2;if(this.horizontal){_193a.push({node:node,before:true,x:pos.x,y:pos.yCentered},{node:node,before:false,x:pos.x2,y:pos.yCentered});}else{_193a.push({node:node,before:true,x:pos.xCentered,y:pos.y},{node:node,before:false,x:pos.xCentered,y:pos.y2});}},this);array.forEach(_193a,function(value){value.distance=_193d(point,value);if(!_193b||value.distance<_193c){_193b=value;_193c=value.distance;}},this);if(_193b){this.current=_193b.node;this._calculatedCurrent=true;return _193b.before;}return false;},_markTargetAnchor:function(_1941){var _1942=true,_1943=true;if(this.current===this.targetAnchor&&this.before===_1941){return;}if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this.targetAnchor=this.current;this.targetBox=null;this.before=_1941;if(this.targetAnchor){this.targetAnchorSibling=_1941?this.targetAnchor.previousSibling:this.targetAnchor.nextSibling;if(!(this.targetAnchorSibling&&this.targetAnchorSibling.nodeType===1&&_1934.contains(this.targetAnchorSibling,"dojoDndItem"))){this.targetAnchorSibling=null;}if(this.markOnlyAllowedDropLocations){_1942=!(this.targetAnchor.id in this.selection);_1943=!this.targetAnchorSibling||!(this.targetAnchorSibling.id in this.selection);}if(_1942&&_1943){this._addItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling&&_1942&&_1943){this._addItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(_1942&&_1943);}else{this._positionMarker(false);}},_unmarkTargetAnchor:function(){if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(false);this.targetAnchor=this.targetAnchorSibling=this.targetBox=null;this.before=true;},_positionMarker:function(_1944){var _1945=this._markerNode,_1946,_1947,_1948,style,top,left,_1949,gap=-1;if(_1944){_1946=_1936.position(this.targetAnchor,false);_1947=this.targetAnchorSibling?_1936.position(this.targetAnchorSibling,false):{h:0,w:0};_1948=_1936.position(this.node,false);if(this.horizontal){if(this.before){left=_1946.x-_1948.x;if(this.targetAnchorSibling){gap=(_1946.x-_1947.x-_1947.w)/2;}if(gap>=0){left-=gap;}}else{left=_1946.x+_1946.w-_1948.x;if(this.targetAnchorSibling){gap=(_1947.x-_1946.x-_1946.w)/2;}if(gap>=0){left+=gap;}}_1949=gap>=0?Math.max(_1946.h,_1947.h):_1946.h;style={display:"block",top:_1946.y-_1948.y+"px",left:left+"px",height:_1949+"px"};}else{if(this.before){top=_1946.y-_1948.y;if(this.targetAnchorSibling){gap=(_1946.y-_1947.y-_1947.h)/2;}if(gap>=0){top-=gap;}}else{top=_1946.y+_1946.h-_1948.y;if(this.targetAnchorSibling){gap=(_1947.x-_1946.x-_1946.w)/2;}if(gap>=0){top-=gap;}}width=gap>=0?Math.max(_1946.w,_1947.w):_1946.w;style={display:"block",top:top+"px",width:width+"px"};}}else{style={display:"none"};}if(!_1945){_1945=this._markerNode=_1935.place(this.markerTemplateString,this.node);_1937.set(_1945,style);}else{setTimeout(function(){_1937.set(_1945,style);},this.markerDelay);}}});});},"epi-cms/contentediting/editors/ContentBlockEditor":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/html","dojo/NodeList-dom","dojo/query","dijit/_Widget","dijit/_TemplatedMixin","dijit/popup","dojox/html/ellipsis","epi/shell/widget/_ModelBindingMixin","epi-cms/contentediting/editors/ContentBlockEditorViewModel","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!./templates/ContentBlockEditor.html","dojo/NodeList-manipulate"],function(_194a,_194b,event,_194c,_194d,_194e,html,_194f,query,_1950,_1951,pm,_1952,_1953,_1954,res,_1955){return _194a([_1950,_1951,_1953],{templateString:_1955,model:null,contextMenu:null,isDraggable:true,modelBindingMap:{"contentLink":["contentLink"],"name":["name"],"contentGroup":["contentGroup"],"roleIdentities":["roleIdentities"],"selected":["selected"]},_setSelectedAttr:function(_1956){this.inherited(arguments);_194d.toggle(this.itemNode,"epi-content-block-editor-node-selected",_1956);_194e.set(this.iconNodeMenu,"visibility",_1956?"visible":"hidden");},_setNameAttr:function(value){this.inherited(arguments);query(this.labelNode).text(value);_194c.set(this.iconNodeMenu,"title",res.settingstooltip);},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _1954(this.modelData);},_setIsDraggableAttr:function(_1957){this._set("isDraggable",_1957);if(this.isDraggable){_194d.add(this.domNode,"dojoDndItem");}else{_194d.remove(this.domNode,"dojoDndItem");}},_onClick:function(evt){event.stop(evt);this.contextMenu&&pm.close(this.contextMenu);this.model.set("selected",!this.model.selected);},_onContextMenu:function(evt){event.stop(evt);this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});}});});},"epi-cms/contentediting/editors/ContentBlockEditorViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_1958,lang,_1959,_195a){return _1958([_1959,_195a],{contentLink:"",contentGroup:"",roleIdentities:null,selected:false,name:"",index:0,getValue:function(){return {contentLink:this.contentLink,name:this.name,contentGroup:this.contentGroup,roleIdentities:this.roleIdentities};}});});},"url:epi-cms/contentediting/editors/templates/ContentBlockEditor.html":"<div class=\"epi-content-block-editor\">\r\n    <a href=\"#\" data-dojo-attach-point=\"itemNode\" style=\"display: block;\" data-dojo-attach-event=\"onclick:_onClick\">\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"epi-content-block-node\">\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dojoxEllipsis\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-floatRight\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-iconContextMenu\" style=\"visibility: hidden;\" data-dojo-attach-event=\"onclick:_onContextMenu\"></span>\r\n            </span>\r\n        </span>\r\n    </a>\r\n</div>","url:epi-cms/widget/templates/ContentArea.html":"<div class=\"epi-overlay-blockarea\">\r\n\t<div class=\"epi-overlay-item-container\">\r\n\t\t<div class=\"epi-overlay-bracket\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"containerNode\" class=\"epi-overlay-blockarea-container\"></div>\r\n\t<div data-dojo-attach-point=\"actionsNode\" class=\"epi-overlay-blockarea-actionscontainer\">\r\n\t\t<div data-dojo-attach-point=\"actionsNodeControls\" class=\"epi-overlay-blockarea-actions\"></div>\r\n\t</div>\r\n</div>","epi-cms/widget/overlay/ItemCollection":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/widget/overlay/Property","epi/string"],function(_195b,lang,_195c,_195d,_195e){return _195b([_195d],{modelType:"epi-cms/contentediting/viewmodel/ItemCollectionViewModel",model:null,postMixInProperties:function(){this.inherited(arguments);this._setupAllowedTypes();this._setupModel(this.contentModel.get(this.name));this.own(this.contentModel.watch(this.name,lang.hitch(this,function(name,_195f,_1960){this.model.set("data",_1960);})));},onDrop:function(_1961,value){this.model.addTo(value,null,false);},_setupModel:function(data){var _1962=_195e.slashName(this.modelType);require([_1962],lang.hitch(this,function(_1963){this.model=new _1963(data,this.modelParams);this.own(this.model.on("changed",lang.hitch(this,function(_1964){this.onValueChange({propertyName:this.name,value:this.model.get("value")});})));}));},_setupAllowedTypes:function(){var _1965=this.modelParams.itemConverterKey,_1966=this.modelParams.customTypeIdentifier;this.allowedDndTypes=this.allowedDndTypes||[];if(_1965){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_1965;});}if(_1966){this.allowedDndTypes.unshift(_1966);}}});});},"epi-cms/widget/ReadOnlyDateTimeEditor":function(){define(["dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin","epi/datetime","dojo/text!./templates/ReadOnlyDateTimeEditor.html"],function(_1967,_1968,_1969,_196a,_196b){return _1967([_1968,_1969],{templateString:_196b,value:null,_setValueAttr:function(value){this._set("value",value);if(value){this.valueNode.innerHTML=_196a.toUserFriendlyHtml(value);}}});});},"url:epi-cms/widget/templates/ReadOnlyDateTimeEditor.html":"<div class=\"dijit dijitReset dijitInline dijitLeft\" data-dojo-attach-point=\"valueNode\"></div>","epi-cms/widget/UrlContentSelector":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/when","epi/Url","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper","epi-cms/widget/ContentSelector"],function(_196c,_196d,lang,when,Url,_196e,_196f,_1970){return _196c([_1970],{_contentData:null,_isValueInitilized:false,_setValueAndFireOnChange:function(value){var _1971;if(!value){this._updateDisplayNode(null);_1971=this.value!==value;this.value=value;this._contentData=null;if(_1971&&this._isValueInitilized){this.onChange(value);}this._started&&this.validate();this._isValueInitilized=true;return;}when(this._getContentByPermanentLink(value),lang.hitch(this,function(_1972){this._updateDisplayNode(_1972);var _1973=_196f.toPermanentLink(_1972);this._started&&this.validate();_1971=!epi.areEqual(this.value,_1973);this.value=_1973;if(this._isValueInitilized&&_1971){this.onChange(_1973);}this._isValueInitilized=true;}));},_convertValueToContentReference:function(value){if(this._contentData){return new _196e(this._contentData.contentLink);}return null;},_getContentByPermanentLink:function(value){if(epi.areEqual(this.value,value)&&this._contentData){return this._contentData;}return when(_196f.getContent(value,{"allLanguages":true}),lang.hitch(this,function(_1974){this._contentData=_1974;return _1974;}));}});});},"epi-cms/widget/UrlSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/when","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/LinkEditor","epi-cms/widget/viewmodel/UrlSelectorViewModel","epi-cms/widget/_SelectorBase","epi-cms/contentediting/command/_CommandWithDialogMixin"],function(_1975,lang,_1976,_1977,when,_1978,_1979,_197a,_197b,_197c){return _1975([_197b,_197c,_1978],{modelClassName:_197a,dialogContentClass:_1979,dialogContentParams:null,defaultActionsVisible:false,modelBindingMap:{"internalValue":["internalValue"]},postMixInProperties:function(){this.inherited(arguments);this.dialogContentParams={modelType:this.metadata.additionalValues["modelType"],hiddenFields:["text","title","target"]};if(!this.model&&this.modelClassName){var _197d=_1975(this.modelClassName);this.model=new _197d();}},_onButtonClick:function(){this.showDialog();},onChange:function(value){},isValid:function(){return (!this.required||(this.model&&!this.model.get("isEmpty")));},onDialogExecute:function(){this.inherited(arguments);if(this.dialogContent){if(this.parent){this.parent.editing=true;}var _197e=this.dialogContent.get("value");this.set("value",_197e);this.onChange(_197e?_197e.href:null);}this._updateDisplayNode(this.value);},_updateDisplayNode:function(value){if(value){_1976.remove(this.domNode,"epi-noValue");_1976.remove(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",value.name);}else{_1976.add(this.domNode,"epi-noValue");_1976.add(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName","");}},_getValueAttr:function(){return this.model.get("value");},_setValueAttr:function(value){this.model.set("value",value);},_setInternalValueAttr:function(value){this._set("value",value);this._updateDisplayNode(value);}});});},"epi-cms/widget/viewmodel/UrlSelectorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/io-query","dojo/topic","dojo/Stateful","dojo/when","epi/shell/_StatefulGetterSetterMixin","epi-cms/core/PermanentLinkHelper"],function(array,_197f,_1980,lang,_1981,topic,_1982,when,_1983,_1984){return _197f([_1982,_1983],{_getValueAttr:function(){if(typeof this.internalValue==="string"||!this.internalValue){return this.internalValue;}else{return this.internalValue.href;}},_setValueAttr:function(value){if(typeof value==="string"){value={href:value};}if(!value||!value.href){this.set("internalValue",null);this.set("isEmpty",true);return;}this.set("isEmpty",false);when(_1984.getContent(value.href,{"allLanguages":true}),lang.hitch(this,function(_1985){value.name=_1985?_1985.name:value.href;this.set("internalValue",value);}));}});});},"epi-cms/widget/_SelectorBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/query","dojo/when","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","epi/dependency","epi/i18n","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/_Droppable","epi-cms/widget/_HasClearButton","epi-cms/widget/_HasChildDialogMixin","dojo/text!./templates/_SelectorBase.html"],function(_1986,lang,_1987,_1988,_1989,_198a,query,when,_198b,_198c,_198d,_198e,_198f,i18n,_1990,_1991,_1992,_1993,_1994){return _1986([_198d,_198c,_198e,_198b,_1992,_1993,_1991,_1990],{templateString:_1994,roots:null,value:null,required:false,missingMessage:"",tooltipPosition:[],canSelectOwnerContent:false,contentRepositoryDescriptors:null,allowedDndTypes:[],_setSelectedContentNameAttr:function(value){query(this.selectedContentNameNode).text(value);},_setSelectedContentLinkAttr:{node:"selectedContentLinkNode",type:"innerHTML"},postCreate:function(){this.inherited(arguments);this.own(_1987.after(this,"onDrop",lang.hitch(this,this.focus)));},postMixInProperties:function(){this.inherited(arguments);if(!this.contentRepositoryDescriptors){this.contentRepositoryDescriptors=_198f.resolve("epi.cms.contentRepositoryDescriptors");}if(!this.roots&&this.repositoryKey){var _1995=this.contentRepositoryDescriptors[this.repositoryKey];this.roots=_1995.roots;}},_setReadOnlyAttr:function(value){this._set("readOnly",value);_198a.set(this.button.domNode,"display",value?"none":"");_198a.set(this.clearButton,"display",value?"none":"");_1989.toggle(this.domNode,"dijitReadOnly",value);},_setValueAttr:function(value){this.value=value;},_getDialog:function(){},_onButtonClick:function(){},_onDialogExecute:function(){},_onDialogHide:function(){},_getValueAttr:function(){return this.value;},_onBlur:function(){this.inherited(arguments);this.validate();},focus:function(){this.button.focus();},onChange:function(value){},_updateDisplayNode:function(_1996){},_setDialogButtonState:function(_1997){}});});},"url:epi-cms/widget/templates/_SelectorBase.html":"<div data-dojo-attach-point=\"inputContainer\" class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"displayNode, dropAreaNode, stateNode\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode\">\r\n        <div class=\"dijitReset dijitLeft dijitInputField dijitInputContainer\">\r\n            <div data-dojo-attach-point=\"clearButton\" class=\"epi-clearButton\">&nbsp;</div>\r\n            <div data-dojo-attach-point=\"resourceName\" class=\"dijitInline epi-resourceName dojoxEllipsis\"/>\r\n                <span data-dojo-attach-point=\"selectedContentNameNode\"></span> <span data-dojo-attach-point=\"selectedContentLinkNode\"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" data-dojo-props=\"label:'...'\"></div>\r\n</div>","epi-cms/widget/XFormEditor":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/_base/Deferred","dojo/when","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/query","dojo/html","dijit/focus","dijit/form/Button","epi/shell/widget/dialog/Dialog","epi/dependency","epi-cms/legacy/LegacyFormEditor","epi-cms/_ContentContextMixin","epi-cms/legacy/LegacyDialogPopup","epi/routes","epi-cms/widget/XFormPropertyWidget","epi/i18n!epi/cms/nls/episerver.cms.legacy.legacyformeditor","epi/i18n!epi/cms/nls/episerver.cms.widget.xformeditor"],function(_1998,event,lang,_1999,when,_199a,_199b,_199c,query,html,_199d,_199e,_199f,_19a0,_19a1,_19a2,_19a3,_19a4,_19a5,res,_19a6){return _1998([_19a1,_19a2],{localization:lang.mixin(res,_19a6),destroyOnHide:true,editorWidgetClass:_19a5,store:null,stopEditOnBlur:true,templateString:"            <div class=\"dijit dijitReset dijitInline dijitLeft epi-xFormEditor\">                <div data-dojo-attach-point=\"output\" data-dojo-type=\"dijit/form/TextBox\" value=\"${localization.helptext}\"></div>                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"openButton\" data-dojo-attach-event=\"onClick: openEditor\" data-dojo-props=\"label:'${localization.buttonlabel}'\"></div>                <a href=\"#\" data-dojo-attach-point=\"viewDataLink\" data-dojo-attach-event=\"click: _openViewDataDialog\" title=\"${localization.viewdata.tooltip}\" class=\"disabled\">${localization.viewdata.text}</a>            </div>",postMixInProperties:function(){this.inherited(arguments);var _19a7=_19a0.resolve("epi.storeregistry");this.store=this.store||_19a7.get("epi.cms.xform");},openEditor:function(){this.inherited(arguments);this.onFocus();},_createDialog:function(){if(this.contentLink){lang.mixin(this.params,{"contentLink":this.contentLink});}else{when(this.getCurrentContext(),lang.hitch(this,function(_19a8){lang.mixin(this.params,{"contentLink":_19a8.id});}));}this.inherited(arguments);},_openViewDataDialog:function(evt){event.stop(evt);if(_199a.contains(this.viewDataLink,"disabled")){return;}this._showFormDataDialog("Edit/XFormViewData.aspx",this.contentLink,this.value);},_onCancel:function(){this.inherited(arguments);this.setDisplayValue(this.value);},_onDialogCancel:function(){this.inherited(arguments);this.setDisplayValue(this.value);},_showFormDataDialog:function(path,_19a9,_19aa){var route=_19a4.getActionPath({id:_19a9,path:path,moduleArea:"LegacyCMS",IsInLegacyWrapper:true,formid:_19aa}),_19ab=new _19a3({url:route,dialogArguments:window.document,showCancelButton:true,features:{width:750,height:300},autoFit:true,showLoadingOverlay:false});this.connect(_19ab,"onLoad",function(_19ac){if(!_19ac){return;}var h1=query("h1[class=\"EP-prefix\"]",_19ac.containerIframe.contentDocument.body);_199c.create("span",{innerHTML:this.localization.viewdata.forms+" >"},h1.parent()[0],"first");var _19ad=query("select[id$=\"SelectForm\"]",_19ac.containerIframe.contentDocument.body);if(_19ad){_199b.set(_19ad.parent()[0],"display","none");}var _19ae=query("input[type=\"checkbox\"][id$=\"ShowResultFromAllPages\"]",_19ac.containerIframe.contentDocument.body);if(_19ae){_199b.set(_19ae.parent()[0],"display","none");}});_19ab.show();},setDisplayValue:function(value){if(!value){this.output.set("value",this.localization.helptext);_199a.add(this.viewDataLink,"disabled");return;}_1999.when(this.store.query({id:value}),lang.hitch(this,function(_19af){if(_19af&&_19af.name){this.output.set("value",_19af.name);this.contentLink&&_199a.remove(this.viewDataLink,"disabled");}else{this.set("value",null);}this.onBlur();}));}});});},"epi-cms/widget/XFormPropertyWidget":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/epi","epi/routes","epi-cms/legacy/LegacyDialogWrapper","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.widget.xformeditor"],function(_19b0,lang,epi,_19b1,_19b2,_19b3,res){return _19b0([_19b2],{title:res.selectform,onChange:function(_19b4){},postMixInProperties:function(){this.features=lang.mixin({width:800,height:400},this.editorFeatures);this.autoFit=true;this.connect(this,"onCallback","_onCallback");this.inherited(arguments);},startup:function(){this.inherited(arguments);this.set("url",this._buildIframeUrl());},onCancel:function(){},_buildIframeUrl:function(){var _19b5={moduleArea:"LegacyCMS",path:"edit/XFormSelect.aspx",epslanguage:this.contentLanguage,propertyname:this.fullName};lang.mixin(_19b5,{"pageId":new _19b3(this.contentLink).createVersionUnspecificReference().id,"form":this.value?this.value:""});return _19b1.getActionPath(_19b5);},_onCallback:function(_19b6){var _19b7=_19b6?_19b6.id:null;if(!epi.areEqual(this.value,_19b7)&&_19b6!==null){this.value=_19b7;this.onChange(_19b7);}else{this.onCancel();}}});});},"*now":function(r){r(["dojo/i18n!*preload*epi-cms/nls/widgets*[\"ar\",\"ca\",\"cs\",\"da\",\"de\",\"el\",\"en-gb\",\"en-us\",\"es-es\",\"fi-fi\",\"fr-fr\",\"he-il\",\"hu\",\"it-it\",\"ja-jp\",\"ko-kr\",\"nl-nl\",\"nb\",\"pl\",\"pt-br\",\"pt-pt\",\"ru\",\"sk\",\"sl\",\"sv\",\"th\",\"tr\",\"zh-tw\",\"zh-cn\",\"ROOT\"]"]);}}});